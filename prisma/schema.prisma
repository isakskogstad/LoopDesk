generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Account {
  id                String   @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  User              User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Announcement {
  id          String    @id @default(cuid())
  query       String
  reporter    String?
  type        String?
  subject     String
  pubDate     String?
  publishedAt DateTime?
  detailText  String?
  fullText    String?
  url         String?
  orgNumber   String?
  scrapedAt   DateTime  @default(now())
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([orgNumber])
  @@index([publishedAt])
  @@index([scrapedAt])
  @@index([subject])
  @@index([type])
}

model AnnouncementScrapeStats {
  id                 String    @id @default("stats")
  totalSearches      Int       @default(0)
  totalAnnouncements Int       @default(0)
  lastSearchAt       DateTime?
  captchaSolves      Int       @default(0)
  errors             Int       @default(0)
  isRunning          Boolean   @default(false)
  concurrentSearches Int       @default(5)
  delayMs            Int       @default(3000)
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
}

model AnnouncementSearchQueue {
  id          String    @id @default(cuid())
  query       String
  status      String    @default("pending")
  resultCount Int       @default(0)
  error       String?
  createdAt   DateTime  @default(now())
  startedAt   DateTime?
  completedAt DateTime?

  @@index([createdAt])
  @@index([status])
}

model Article {
  id                  String                @id @default(cuid())
  externalId          String
  url                 String                @unique
  title               String
  description         String?
  content             String?
  author              String?
  imageUrl            String?
  publishedAt         DateTime
  fetchedAt           DateTime              @default(now())
  sourceId            String
  sourceName          String
  sourceColor         String?
  sourceType          String
  freshRssId          Int?                  @unique
  feedId              String?
  titleHash           String?
  isRead              Boolean               @default(false)
  isBookmarked        Boolean               @default(false)
  userId              String?
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @updatedAt
  User                User?                 @relation(fields: [userId], references: [id])
  CompanyArticleMatch CompanyArticleMatch[]
  KeywordMatch        KeywordMatch[]

  @@index([freshRssId])
  @@index([isBookmarked])
  @@index([publishedAt])
  @@index([sourceId])
  @@index([titleHash])
  @@index([userId])
}

model CompanyArticleMatch {
  id             String         @id @default(cuid())
  articleId      String
  companyId      String
  matchType      String
  confidence     Float          @default(1.0)
  createdAt      DateTime       @default(now())
  Article        Article        @relation(fields: [articleId], references: [id], onDelete: Cascade)
  WatchedCompany WatchedCompany @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@unique([articleId, companyId])
  @@index([articleId])
  @@index([companyId])
}

model CompanyFavorite {
  id        String   @id @default(cuid())
  orgNumber String
  name      String
  userId    String
  createdAt DateTime @default(now())
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, orgNumber])
  @@index([userId])
}

model CompanySearchLog {
  orgNumber          String   @id
  lastSearched       DateTime @default(now()) @db.Timestamp(6)
  searchCount        Int      @default(1)
  lastResult         String?
  announcementsFound Int?     @default(0)
}

model FamilyOffice {
  id                 String    @id @default(cuid())
  name               String
  family             String?
  impactNiche        String?
  portfolioCompanies String?
  description        String?
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
  coInvestors        String?
  email              String?
  familyStory        String?
  founded            Int?
  keyPeople          String?
  linkedin           String?
  phone              String?
  region             String?
  website            String?
  assets             BigInt?
  companyStatus      String?
  employees          Int?
  financialsUpdated  DateTime?
  growthPercent      Float?
  lastFinancialYear  Int?
  orgNumber          String?
  profit             BigInt?
  revenue            BigInt?
  hasLogo            Boolean?  @default(false)
}

model Feed {
  id         String    @id @default(cuid())
  name       String
  url        String
  type       String
  category   String?
  color      String?
  enabled    Boolean   @default(true)
  tags       String?
  options    String?
  userId     String?
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  foloId     String?
  foloListId String?
  syncSource String?   @default("manual")
  syncedAt   DateTime?
  User       User?     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, url])
  @@index([foloListId])
  @@index([syncSource])
}

model FeedCache {
  id          String   @id @default(cuid())
  url         String   @unique
  data        String
  etag        String?
  lastFetched DateTime @default(now())
  expiresAt   DateTime
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model FoloListConfig {
  id           String    @id @default(cuid())
  userId       String
  listId       String
  listUrl      String
  listName     String?
  autoSync     Boolean   @default(true)
  syncInterval Int       @default(3600)
  lastSyncAt   DateTime?
  feedCount    Int       @default(0)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  User         User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, listId])
  @@index([listId])
  @@index([userId])
}

model GlobalFeedCache {
  id          String   @id @default("global")
  items       String
  itemCount   Int      @default(0)
  sourceCount Int      @default(0)
  lastUpdated DateTime @default(now())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Keyword {
  id           String         @id @default(cuid())
  term         String
  isActive     Boolean        @default(true)
  notifyPush   Boolean        @default(true)
  color        String?
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  userId       String?
  User         User?          @relation(fields: [userId], references: [id], onDelete: Cascade)
  KeywordMatch KeywordMatch[]

  @@unique([userId, term])
}

model KeywordMatch {
  id        String   @id @default(cuid())
  articleId String
  keywordId String
  matchedIn String
  createdAt DateTime @default(now())
  Article   Article  @relation(fields: [articleId], references: [id], onDelete: Cascade)
  Keyword   Keyword  @relation(fields: [keywordId], references: [id], onDelete: Cascade)

  @@unique([articleId, keywordId])
  @@index([keywordId])
}

model PasswordResetToken {
  id        String    @id @default(cuid())
  userId    String
  tokenHash String    @unique
  expiresAt DateTime
  usedAt    DateTime?
  createdAt DateTime  @default(now())
  User      User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([expiresAt])
  @@index([userId])
}

model SearchHistory {
  id        String   @id @default(cuid())
  query     String
  type      String
  name      String?
  userId    String
  createdAt DateTime @default(now())
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([userId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  User         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Settings {
  id        String   @id @default(cuid())
  darkMode  Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  userId    String   @unique
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model SyncState {
  id          String   @id @default("freshrss")
  lastItemId  Int      @default(0)
  lastSyncAt  DateTime @default(now())
  totalSynced Int      @default(0)
  errorCount  Int      @default(0)
  lastError   String?
  updatedAt   DateTime @updatedAt
}

model User {
  id                  String               @id @default(cuid())
  name                String?
  email               String               @unique
  emailVerified       DateTime?
  image               String?
  passwordHash        String?
  role                String               @default("user")
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  phone               String?
  failedLoginAttempts Int                  @default(0)
  lastLoginAt         DateTime?
  lockedUntil         DateTime?
  Account             Account[]
  Article             Article[]
  CompanyFavorite     CompanyFavorite[]
  Feed                Feed[]
  FoloListConfig      FoloListConfig[]
  Keyword             Keyword[]
  PasswordResetToken  PasswordResetToken[]
  SearchHistory       SearchHistory[]
  Session             Session[]
  Settings            Settings?
}

model VCCompany {
  id                  String    @id @default(cuid())
  name                String
  impactNiche         String?
  portfolioCompanies  String?
  description         String?
  readMoreUrl         String?
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  descriptionOriginal String?
  email               String?
  history             String?
  linkedin            String?
  notableDeals        String?
  office              String?
  phone               String?
  portfolioExamples   String?
  sources             String?
  type                String?
  website             String?
  assets              BigInt?
  aum                 BigInt?
  companyStatus       String?
  employees           Int?
  financialsUpdated   DateTime?
  growthPercent       Float?
  lastFinancialYear   Int?
  orgNumber           String?
  profit              BigInt?
  revenue             BigInt?
  hasLogo             Boolean?  @default(false)
}

model VerificationToken {
  identifier String
  token      String
  expires    DateTime

  @@unique([identifier, token])
}

model WatchedCompany {
  id                  String                @id @default(cuid())
  orgNumber           String                @unique
  name                String
  hasLogo             Boolean               @default(false)
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @updatedAt
  lastUpdated         DateTime?
  ceo                 String?
  city                String?
  fundraising         String?
  growth2023to2024    String?
  growthNum           Float?
  impactNiche         String?
  largestOwners       String?
  latestFundingDate   String?
  latestFundingRound  String?
  latestValuation     String?
  latestValuationNum  BigInt?
  profit2023          String?
  profit2024          String?
  profit2024Num       BigInt?
  startYear           String?
  totalFunding        String?
  totalFundingNum     BigInt?
  turnover2023        String?
  turnover2024        String?
  turnover2024Num     BigInt?
  address             String?
  chairman            String?
  companyType         String?
  email               String?
  employees           Int?
  enrichmentError     String?
  fSkatt              Boolean?
  lastEnriched        DateTime?
  legalName           String?
  momsRegistered      Boolean?
  municipality        String?
  parentCompany       String?
  paymentRemarks      Boolean?
  phone               String?
  postalCode          String?
  registrationDate    String?
  shareCapital        BigInt?
  sniCode             String?
  sniDescription      String?
  status              String?
  subsidiaryCount     Int?
  website             String?
  lastScraped         DateTime?
  CompanyArticleMatch CompanyArticleMatch[]

  @@index([city])
  @@index([impactNiche])
  @@index([municipality])
  @@index([name])
  @@index([orgNumber])
  @@index([status])
}

model WidgetSchedule {
  id         String    @id @default(cuid())
  name       String
  widgetType String
  frequency  String
  time       String
  dayOfWeek  Int?
  isActive   Boolean   @default(true)
  lastRunAt  DateTime?
  lastStatus String?
  lastError  String?
  lastStats  String?
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @default(now()) @updatedAt

  @@index([isActive])
  @@index([widgetType])
}
