;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="25eb4273-b446-26d8-b788-89242415d8b8")}catch(e){}}();
module.exports=[918622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},556704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},832319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},324725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},120635,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},814747,(e,t,r)=>{t.exports=e.x("path",()=>require("path"))},130101,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var s={ActionDidNotRevalidate:function(){return i},ActionDidRevalidateDynamicOnly:function(){return n},ActionDidRevalidateStaticAndDynamic:function(){return o}};for(var a in s)Object.defineProperty(r,a,{enumerable:!0,get:s[a]});let i=0,o=1,n=2},193695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},219985,(e,t,r)=>{"use strict";t.exports=e.r(918622)},666870,(e,t,r)=>{"use strict";t.exports=e.r(219985).vendored["react-rsc"].React},179475,(e,t,r)=>{t.exports=e.x("@prisma/client-935491d6e3ada45d",()=>require("@prisma/client-935491d6e3ada45d"))},109357,e=>e.a(async(t,r)=>{try{let t=await e.y("pg-3f7efcb9b626a319");e.n(t),r()}catch(e){r(e)}},!0),254799,(e,t,r)=>{t.exports=e.x("crypto",()=>require("crypto"))},720034,e=>e.a(async(t,r)=>{try{var s=e.i(528227),a=t([s]);[s]=a.then?(await a)():a;let c=new Map;async function i(e){let t=function(e){let t=Date.now(),r=e.toLowerCase(),s=c.get(r);if(!s||t-s.windowStart>6e4)return c.set(r,{attempts:1,windowStart:t}),{allowed:!0};if(s.attempts>=5){let e=Math.ceil((s.windowStart+6e4-t)/1e3);return{allowed:!1,retryAfterSeconds:e}}return s.attempts++,{allowed:!0}}(e);if(!t.allowed)return{allowed:!1,error:"RATE_LIMITED",retryAfterSeconds:t.retryAfterSeconds};try{let t=await s.prisma.user.findUnique({where:{email:e.toLowerCase()},select:{id:!0,failedLoginAttempts:!0,lockedUntil:!0}});if(!t)return{allowed:!0};if(t.lockedUntil&&new Date(t.lockedUntil)>new Date){let e=Math.ceil((new Date(t.lockedUntil).getTime()-Date.now())/6e4);return{allowed:!1,error:"ACCOUNT_LOCKED",lockoutMinutes:e}}t.lockedUntil&&new Date(t.lockedUntil)<=new Date&&await s.prisma.user.update({where:{id:t.id},data:{failedLoginAttempts:0,lockedUntil:null}});let r=10-(t.failedLoginAttempts||0);return{allowed:!0,remainingAttempts:r}}catch(e){return console.error("[RateLimit] Error checking login attempt:",e),{allowed:!0}}}async function o(e){try{let t=await s.prisma.user.findUnique({where:{email:e.toLowerCase()},select:{id:!0,failedLoginAttempts:!0}});if(!t)return{allowed:!1,error:"ACCOUNT_NOT_FOUND"};let r=(t.failedLoginAttempts||0)+1,a=r>=10;if(await s.prisma.user.update({where:{id:t.id},data:{failedLoginAttempts:r,lockedUntil:a?new Date(Date.now()+9e5):null}}),a)return{allowed:!1,error:"ACCOUNT_LOCKED",lockoutMinutes:15};return{allowed:!1,error:"INVALID_CREDENTIALS",remainingAttempts:10-r}}catch(e){return console.error("[RateLimit] Error recording failed attempt:",e),{allowed:!1,error:"INVALID_CREDENTIALS"}}}async function n(e){c.delete(e.toLowerCase());try{await s.prisma.user.update({where:{email:e.toLowerCase()},data:{failedLoginAttempts:0,lockedUntil:null,lastLoginAt:new Date}})}catch(e){console.error("[RateLimit] Error recording successful login:",e)}}function l(e,t){switch(e){case"RATE_LIMITED":return`F\xf6r m\xe5nga f\xf6rs\xf6k. V\xe4nta ${t?.retryAfterSeconds||60} sekunder.`;case"ACCOUNT_LOCKED":return`Kontot \xe4r l\xe5st i ${t?.lockoutMinutes||15} minuter pga f\xf6r m\xe5nga misslyckade f\xf6rs\xf6k.`;case"ACCOUNT_NOT_FOUND":return"Inget konto hittades med denna e-postadress.";case"INVALID_CREDENTIALS":if(t?.remainingAttempts!==void 0&&t.remainingAttempts<=3)return`Fel l\xf6senord. ${t.remainingAttempts} f\xf6rs\xf6k kvar innan kontot l\xe5ses.`;return"Fel e-postadress eller lösenord.";default:return"Något gick fel. Försök igen."}}e.s(["checkLoginAttempt",()=>i,"getErrorMessage",()=>l,"recordFailedAttempt",()=>o,"recordSuccessfulLogin",()=>n]),r()}catch(e){r(e)}},!1),522734,(e,t,r)=>{t.exports=e.x("fs",()=>require("fs"))},530447,e=>{"use strict";class t{proxies=[];currentIndex=0;isActive=!1;lastFetchTime=0;fetchCooldown=3e5;balance=0;blockingStats={http429Count:0,consecutiveCaptchas:0,lastCaptchaTime:0,sessionBlocked:!1};captchaTimes=[];failedProxies=new Set;proxyFailures=new Map;maxFailures=3;activationReason=null;shouldActivate(){if(this.isActive)return{shouldActivate:!1,reason:null};if(this.blockingStats.http429Count>=3)return{shouldActivate:!0,reason:`Rate limited ${this.blockingStats.http429Count} times`};if(this.blockingStats.consecutiveCaptchas>=5)return{shouldActivate:!0,reason:`${this.blockingStats.consecutiveCaptchas} consecutive CAPTCHAs`};let e=Date.now(),t=this.captchaTimes.filter(t=>e-t<6e4);return t.length>=3?{shouldActivate:!0,reason:`${t.length} CAPTCHAs in ${60}s`}:this.blockingStats.sessionBlocked?{shouldActivate:!0,reason:"Session blocked"}:{shouldActivate:!1,reason:null}}recordCaptcha(){let e=Date.now();this.blockingStats.consecutiveCaptchas++,this.blockingStats.lastCaptchaTime=e,this.captchaTimes.push(e),this.captchaTimes=this.captchaTimes.filter(t=>e-t<12e4),console.log(`[ProxyManager] CAPTCHA recorded: consecutive=${this.blockingStats.consecutiveCaptchas}`)}recordSuccess(){this.blockingStats.consecutiveCaptchas=0}recordRateLimit(){this.blockingStats.http429Count++,console.log(`[ProxyManager] Rate limit recorded: count=${this.blockingStats.http429Count}`)}recordSessionBlocked(){this.blockingStats.sessionBlocked=!0,console.log("[ProxyManager] Session blocked recorded")}resetStats(){this.blockingStats={http429Count:0,consecutiveCaptchas:0,lastCaptchaTime:0,sessionBlocked:!1},this.captchaTimes=[]}async fetchProxies(){let e=process.env.PROXY_SERVER||"",t=process.env.PROXY_USERNAME||"",r=process.env.PROXY_PASSWORD||"",s=process.env.TWOCAPTCHA_API_KEY||"";if(e&&"disabled"!==e){let s=!e||e.includes("://")?e:`http://${e}`,[a,i]=s.replace(/^[a-z]+:\/\//,"").split("/")[0].split(":"),o=parseInt(i||"80",10);return this.proxies=[{id:s,host:a,port:o,url:s,source:"static",username:t||void 0,password:r||void 0}],this.lastFetchTime=Date.now(),this.failedProxies.clear(),this.proxyFailures.clear(),console.log("[ProxyManager] Using static proxy from environment"),this.proxies}if(!s)return console.log("[ProxyManager] No API key configured - proxy functionality disabled"),console.log("[ProxyManager] Set TWOCAPTCHA_API_KEY or PROXY_SERVER to enable proxies"),this.proxies=[],this.proxies;let a=Date.now();if(a-this.lastFetchTime<this.fetchCooldown&&this.proxies.length>0)return console.log("[ProxyManager] Using cached proxies"),this.proxies;try{console.log("[ProxyManager] Fetching 10 SE proxies from 2captcha...");let e=new URL("https://api.2captcha.com/proxy");e.searchParams.set("key",s),e.searchParams.set("country","se"),e.searchParams.set("type","residential"),e.searchParams.set("limit","10");let t=await fetch(e.toString()),r=await t.json();if("OK"===r.status&&Array.isArray(r.data)){let e=r.data.map(e=>{if("string"==typeof e){let[t,r]=e.split(":");return t&&r?{id:e,host:t,port:parseInt(r,10),url:`http://${e}`,source:"2captcha"}:null}let t=e.proxy||e.proxy_string||e.ip_port,r=e.host||e.ip||(t?t.split(":")[0]:void 0),s=e.port||(t?t.split(":")[1]:void 0);if(!r||!s)return null;let a="string"==typeof s?parseInt(s,10):s,i=e.protocol||e.type||"http",o=e.login||e.username||e.user,n=e.password||e.pass;return{id:`${r}:${a}`,host:r,port:a,url:`${i}://${r}:${a}`,source:"2captcha",username:o,password:n}}).filter(e=>!!e);this.proxies=e,this.lastFetchTime=a,this.failedProxies.clear(),this.proxyFailures.clear(),console.log(`[ProxyManager] Got ${this.proxies.length} proxies from 2captcha`)}else console.error(`[ProxyManager] 2captcha error: ${r.message||JSON.stringify(r)}`)}catch(e){console.error("[ProxyManager] Error fetching proxies:",e)}return this.proxies}async checkBalance(){let e=process.env.TWOCAPTCHA_API_KEY||"";if(!e)return 0;try{let t=new URL("https://2captcha.com/res.php");t.searchParams.set("key",e),t.searchParams.set("action","getbalance"),t.searchParams.set("json","1");let r=await fetch(t.toString()),s=await r.json();if(1===s.status)return this.balance=parseFloat(s.request),this.balance}catch(e){console.error("[ProxyManager] Error checking balance:",e)}return 0}async activate(e){if(this.isActive)return console.log("[ProxyManager] Already active"),!0;console.log(`[ProxyManager] ACTIVATING PROXY - Reason: ${e}`),this.isActive=!0,this.activationReason=e;let t=await this.fetchProxies();return 0===t.length?(console.warn("[ProxyManager] No proxies available"),!1):(this.currentIndex=0,this.resetStats(),console.log(`[ProxyManager] Activated with ${t.length} proxies`),!0)}deactivate(){console.log("[ProxyManager] Deactivating proxy"),this.isActive=!1,this.activationReason=null,this.resetStats()}getCurrentProxy(){if(!this.isActive||0===this.proxies.length)return null;let e=this.proxies[this.currentIndex];return{server:e.url,username:e.username,password:e.password}}markFailed(e){if(!e)return;let t="server"in e?e.server:e.url,r=(this.proxyFailures.get(t)||0)+1;this.proxyFailures.set(t,r),r>=this.maxFailures&&(console.log(`[ProxyManager] Proxy ${t} marked as failed`),this.failedProxies.add(t))}markSuccess(e){if(!e)return;let t="server"in e?e.server:e.url;this.proxyFailures.set(t,0)}getPlaywrightConfig(e){let t=e||this.getCurrentProxy();if(!t)return{};let r="server"in t?t.server:t.url;return{proxy:{server:r,username:t.username,password:t.password}}}getNext(){if(!this.isActive||0===this.proxies.length)return null;let e=0;for(;e<this.proxies.length;){let t=this.proxies[this.currentIndex];if(this.currentIndex=(this.currentIndex+1)%this.proxies.length,!this.failedProxies.has(t.url))return t;e++}return console.log("[ProxyManager] All proxies exhausted, resetting..."),this.failedProxies.clear(),this.proxyFailures.clear(),this.proxies[0]||null}rotateProxy(){0!==this.proxies.length&&(this.currentIndex=(this.currentIndex+1)%this.proxies.length,console.log(`[ProxyManager] Rotated to proxy ${this.currentIndex+1}/${this.proxies.length}`))}getStatus(){return{isActive:this.isActive,enabled:this.isActive,reason:this.activationReason,total:this.proxies.length,failed:this.failedProxies.size,available:this.proxies.length-this.failedProxies.size}}async refresh(){let e=Date.now();if(!(e-this.lastFetchTime<this.fetchCooldown)||!(this.proxies.length>=3))try{let t=await this.checkBalance();if(t<.1)return void console.warn(`[ProxyManager] Low balance: $${t} - proxy disabled`);let r=await this.fetchProxies();r.length>0&&(this.proxies=r,this.currentIndex=0,this.lastFetchTime=e,this.failedProxies.clear(),this.proxyFailures.clear(),console.log(`[ProxyManager] Refreshed ${r.length} proxies`))}catch(e){console.error("[ProxyManager] Refresh failed:",e)}}getStats(){return{enabled:this.isActive,reason:this.activationReason,total:this.proxies.length,failed:this.failedProxies.size,available:this.proxies.length-this.failedProxies.size}}}let r=new t;e.s(["proxyManager",0,r])},28672,e=>{e.v(t=>Promise.all(["server/chunks/CLAUDE_projects_LoopDesk_src_lib_kungorelser_proxy-init_ts_f47622a1._.js"].map(t=>e.l(t))).then(()=>t(60025)))},103243,e=>{e.v(e=>Promise.resolve().then(()=>e(528227)))}];

//# debugId=25eb4273-b446-26d8-b788-89242415d8b8
//# sourceMappingURL=%5Broot-of-the-server%5D__ef15b60f._.js.map