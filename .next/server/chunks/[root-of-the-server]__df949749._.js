;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="c2c53f89-8f4a-5e61-b3d3-f6aad5792e2e")}catch(e){}}();
module.exports=[918622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},556704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},832319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},324725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},120635,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},814747,(e,t,r)=>{t.exports=e.x("path",()=>require("path"))},130101,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a={ActionDidNotRevalidate:function(){return o},ActionDidRevalidateDynamicOnly:function(){return n},ActionDidRevalidateStaticAndDynamic:function(){return i}};for(var s in a)Object.defineProperty(r,s,{enumerable:!0,get:a[s]});let o=0,i=1,n=2},193695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},219985,(e,t,r)=>{"use strict";t.exports=e.r(918622)},666870,(e,t,r)=>{"use strict";t.exports=e.r(219985).vendored["react-rsc"].React},179475,(e,t,r)=>{t.exports=e.x("@prisma/client-935491d6e3ada45d",()=>require("@prisma/client-935491d6e3ada45d"))},109357,e=>e.a(async(t,r)=>{try{let t=await e.y("pg-3f7efcb9b626a319");e.n(t),r()}catch(e){r(e)}},!0),254799,(e,t,r)=>{t.exports=e.x("crypto",()=>require("crypto"))},720034,e=>e.a(async(t,r)=>{try{var a=e.i(528227),s=t([a]);[a]=s.then?(await s)():s;let c=new Map;async function o(e){let t=function(e){let t=Date.now(),r=e.toLowerCase(),a=c.get(r);if(!a||t-a.windowStart>6e4)return c.set(r,{attempts:1,windowStart:t}),{allowed:!0};if(a.attempts>=5){let e=Math.ceil((a.windowStart+6e4-t)/1e3);return{allowed:!1,retryAfterSeconds:e}}return a.attempts++,{allowed:!0}}(e);if(!t.allowed)return{allowed:!1,error:"RATE_LIMITED",retryAfterSeconds:t.retryAfterSeconds};try{let t=await a.prisma.user.findUnique({where:{email:e.toLowerCase()},select:{id:!0,failedLoginAttempts:!0,lockedUntil:!0}});if(!t)return{allowed:!0};if(t.lockedUntil&&new Date(t.lockedUntil)>new Date){let e=Math.ceil((new Date(t.lockedUntil).getTime()-Date.now())/6e4);return{allowed:!1,error:"ACCOUNT_LOCKED",lockoutMinutes:e}}t.lockedUntil&&new Date(t.lockedUntil)<=new Date&&await a.prisma.user.update({where:{id:t.id},data:{failedLoginAttempts:0,lockedUntil:null}});let r=10-(t.failedLoginAttempts||0);return{allowed:!0,remainingAttempts:r}}catch(e){return console.error("[RateLimit] Error checking login attempt:",e),{allowed:!0}}}async function i(e){try{let t=await a.prisma.user.findUnique({where:{email:e.toLowerCase()},select:{id:!0,failedLoginAttempts:!0}});if(!t)return{allowed:!1,error:"ACCOUNT_NOT_FOUND"};let r=(t.failedLoginAttempts||0)+1,s=r>=10;if(await a.prisma.user.update({where:{id:t.id},data:{failedLoginAttempts:r,lockedUntil:s?new Date(Date.now()+9e5):null}}),s)return{allowed:!1,error:"ACCOUNT_LOCKED",lockoutMinutes:15};return{allowed:!1,error:"INVALID_CREDENTIALS",remainingAttempts:10-r}}catch(e){return console.error("[RateLimit] Error recording failed attempt:",e),{allowed:!1,error:"INVALID_CREDENTIALS"}}}async function n(e){c.delete(e.toLowerCase());try{await a.prisma.user.update({where:{email:e.toLowerCase()},data:{failedLoginAttempts:0,lockedUntil:null,lastLoginAt:new Date}})}catch(e){console.error("[RateLimit] Error recording successful login:",e)}}function l(e,t){switch(e){case"RATE_LIMITED":return`F\xf6r m\xe5nga f\xf6rs\xf6k. V\xe4nta ${t?.retryAfterSeconds||60} sekunder.`;case"ACCOUNT_LOCKED":return`Kontot \xe4r l\xe5st i ${t?.lockoutMinutes||15} minuter pga f\xf6r m\xe5nga misslyckade f\xf6rs\xf6k.`;case"ACCOUNT_NOT_FOUND":return"Inget konto hittades med denna e-postadress.";case"INVALID_CREDENTIALS":if(t?.remainingAttempts!==void 0&&t.remainingAttempts<=3)return`Fel l\xf6senord. ${t.remainingAttempts} f\xf6rs\xf6k kvar innan kontot l\xe5ses.`;return"Fel e-postadress eller lösenord.";default:return"Något gick fel. Försök igen."}}e.s(["checkLoginAttempt",()=>o,"getErrorMessage",()=>l,"recordFailedAttempt",()=>i,"recordSuccessfulLogin",()=>n]),r()}catch(e){r(e)}},!1),60025,e=>{"use strict";var t=e.i(530447);let r=0,a=null;async function s(){if(!process.env.TWOCAPTCHA_API_KEY)return void console.log("[ProxyInit] Skipping proxy initialization (no API key)");if(process.env.PROXY_SERVER&&"disabled"!==process.env.PROXY_SERVER){console.log("[ProxyInit] Static proxy configured, loading..."),await t.proxyManager.fetchProxies(),await t.proxyManager.activate("Static proxy configured");let e=t.proxyManager.getStatus();console.log(`[ProxyInit] Static proxy ready - ${e.available}/${e.total} proxies`);return}console.log("[ProxyInit] Initializing proxy auto-refresh...");try{await o()}catch(e){console.error("[ProxyInit] Initial refresh failed:",e)}a&&clearInterval(a),a=setInterval(async()=>{try{await o()}catch(e){console.error("[ProxyInit] Periodic refresh failed:",e)}},144e5),console.log("[ProxyInit] Auto-refresh scheduled every 4 hours")}async function o(){let e=Date.now();if(e-r<3e5)return void console.log("[ProxyInit] Skipping refresh (too recent)");console.log("[ProxyInit] Refreshing proxies..."),await t.proxyManager.refresh(),r=e;let a=t.proxyManager.getStatus();console.log(`[ProxyInit] Refresh complete - ${a.available}/${a.total} proxies available`)}async function i(){if(console.log("[ProxyInit] Force refreshing proxies via proxyManager..."),r=0,!process.env.TWOCAPTCHA_API_KEY)return void console.log("[ProxyInit] No API key configured - cannot fetch proxies");try{let e=await t.proxyManager.fetchProxies();console.log(`[ProxyInit] ProxyManager now has ${e.length} proxies`),e.length>0&&!t.proxyManager.getStatus().isActive&&await t.proxyManager.activate("Force refresh - proxies available")}catch(e){console.error("[ProxyInit] Failed to refresh proxies:",e)}}function n(){a&&(clearInterval(a),a=null,console.log("[ProxyInit] Auto-refresh stopped"))}s().catch(e=>{console.error("[ProxyInit] Failed to initialize:",e)}),e.s(["forceRefreshProxies",()=>i,"initializeProxyManager",()=>s,"stopProxyRefresh",()=>n])},522734,(e,t,r)=>{t.exports=e.x("fs",()=>require("fs"))},530447,e=>{"use strict";class t{proxies=[];currentIndex=0;isActive=!1;lastFetchTime=0;fetchCooldown=3e5;balance=0;blockingStats={http429Count:0,consecutiveCaptchas:0,lastCaptchaTime:0,sessionBlocked:!1};captchaTimes=[];failedProxies=new Set;proxyFailures=new Map;maxFailures=3;activationReason=null;shouldActivate(){if(this.isActive)return{shouldActivate:!1,reason:null};if(this.blockingStats.http429Count>=3)return{shouldActivate:!0,reason:`Rate limited ${this.blockingStats.http429Count} times`};if(this.blockingStats.consecutiveCaptchas>=5)return{shouldActivate:!0,reason:`${this.blockingStats.consecutiveCaptchas} consecutive CAPTCHAs`};let e=Date.now(),t=this.captchaTimes.filter(t=>e-t<6e4);return t.length>=3?{shouldActivate:!0,reason:`${t.length} CAPTCHAs in ${60}s`}:this.blockingStats.sessionBlocked?{shouldActivate:!0,reason:"Session blocked"}:{shouldActivate:!1,reason:null}}recordCaptcha(){let e=Date.now();this.blockingStats.consecutiveCaptchas++,this.blockingStats.lastCaptchaTime=e,this.captchaTimes.push(e),this.captchaTimes=this.captchaTimes.filter(t=>e-t<12e4),console.log(`[ProxyManager] CAPTCHA recorded: consecutive=${this.blockingStats.consecutiveCaptchas}`)}recordSuccess(){this.blockingStats.consecutiveCaptchas=0}recordRateLimit(){this.blockingStats.http429Count++,console.log(`[ProxyManager] Rate limit recorded: count=${this.blockingStats.http429Count}`)}recordSessionBlocked(){this.blockingStats.sessionBlocked=!0,console.log("[ProxyManager] Session blocked recorded")}resetStats(){this.blockingStats={http429Count:0,consecutiveCaptchas:0,lastCaptchaTime:0,sessionBlocked:!1},this.captchaTimes=[]}async fetchProxies(){let e=process.env.PROXY_SERVER||"",t=process.env.PROXY_USERNAME||"",r=process.env.PROXY_PASSWORD||"",a=process.env.TWOCAPTCHA_API_KEY||"";if(e&&"disabled"!==e){let a=!e||e.includes("://")?e:`http://${e}`,[s,o]=a.replace(/^[a-z]+:\/\//,"").split("/")[0].split(":"),i=parseInt(o||"80",10);return this.proxies=[{id:a,host:s,port:i,url:a,source:"static",username:t||void 0,password:r||void 0}],this.lastFetchTime=Date.now(),this.failedProxies.clear(),this.proxyFailures.clear(),console.log("[ProxyManager] Using static proxy from environment"),this.proxies}if(!a)return console.log("[ProxyManager] No API key configured - proxy functionality disabled"),console.log("[ProxyManager] Set TWOCAPTCHA_API_KEY or PROXY_SERVER to enable proxies"),this.proxies=[],this.proxies;let s=Date.now();if(s-this.lastFetchTime<this.fetchCooldown&&this.proxies.length>0)return console.log("[ProxyManager] Using cached proxies"),this.proxies;try{console.log("[ProxyManager] Fetching 10 SE proxies from 2captcha...");let e=new URL("https://api.2captcha.com/proxy");e.searchParams.set("key",a),e.searchParams.set("country","se"),e.searchParams.set("type","residential"),e.searchParams.set("limit","10");let t=await fetch(e.toString()),r=await t.json();if("OK"===r.status&&Array.isArray(r.data)){let e=r.data.map(e=>{if("string"==typeof e){let[t,r]=e.split(":");return t&&r?{id:e,host:t,port:parseInt(r,10),url:`http://${e}`,source:"2captcha"}:null}let t=e.proxy||e.proxy_string||e.ip_port,r=e.host||e.ip||(t?t.split(":")[0]:void 0),a=e.port||(t?t.split(":")[1]:void 0);if(!r||!a)return null;let s="string"==typeof a?parseInt(a,10):a,o=e.protocol||e.type||"http",i=e.login||e.username||e.user,n=e.password||e.pass;return{id:`${r}:${s}`,host:r,port:s,url:`${o}://${r}:${s}`,source:"2captcha",username:i,password:n}}).filter(e=>!!e);this.proxies=e,this.lastFetchTime=s,this.failedProxies.clear(),this.proxyFailures.clear(),console.log(`[ProxyManager] Got ${this.proxies.length} proxies from 2captcha`)}else console.error(`[ProxyManager] 2captcha error: ${r.message||JSON.stringify(r)}`)}catch(e){console.error("[ProxyManager] Error fetching proxies:",e)}return this.proxies}async checkBalance(){let e=process.env.TWOCAPTCHA_API_KEY||"";if(!e)return 0;try{let t=new URL("https://2captcha.com/res.php");t.searchParams.set("key",e),t.searchParams.set("action","getbalance"),t.searchParams.set("json","1");let r=await fetch(t.toString()),a=await r.json();if(1===a.status)return this.balance=parseFloat(a.request),this.balance}catch(e){console.error("[ProxyManager] Error checking balance:",e)}return 0}async activate(e){if(this.isActive)return console.log("[ProxyManager] Already active"),!0;console.log(`[ProxyManager] ACTIVATING PROXY - Reason: ${e}`),this.isActive=!0,this.activationReason=e;let t=await this.fetchProxies();return 0===t.length?(console.warn("[ProxyManager] No proxies available"),!1):(this.currentIndex=0,this.resetStats(),console.log(`[ProxyManager] Activated with ${t.length} proxies`),!0)}deactivate(){console.log("[ProxyManager] Deactivating proxy"),this.isActive=!1,this.activationReason=null,this.resetStats()}getCurrentProxy(){if(!this.isActive||0===this.proxies.length)return null;let e=this.proxies[this.currentIndex];return{server:e.url,username:e.username,password:e.password}}markFailed(e){if(!e)return;let t="server"in e?e.server:e.url,r=(this.proxyFailures.get(t)||0)+1;this.proxyFailures.set(t,r),r>=this.maxFailures&&(console.log(`[ProxyManager] Proxy ${t} marked as failed`),this.failedProxies.add(t))}markSuccess(e){if(!e)return;let t="server"in e?e.server:e.url;this.proxyFailures.set(t,0)}getPlaywrightConfig(e){let t=e||this.getCurrentProxy();if(!t)return{};let r="server"in t?t.server:t.url;return{proxy:{server:r,username:t.username,password:t.password}}}getNext(){if(!this.isActive||0===this.proxies.length)return null;let e=0;for(;e<this.proxies.length;){let t=this.proxies[this.currentIndex];if(this.currentIndex=(this.currentIndex+1)%this.proxies.length,!this.failedProxies.has(t.url))return t;e++}return console.log("[ProxyManager] All proxies exhausted, resetting..."),this.failedProxies.clear(),this.proxyFailures.clear(),this.proxies[0]||null}rotateProxy(){0!==this.proxies.length&&(this.currentIndex=(this.currentIndex+1)%this.proxies.length,console.log(`[ProxyManager] Rotated to proxy ${this.currentIndex+1}/${this.proxies.length}`))}getStatus(){return{isActive:this.isActive,enabled:this.isActive,reason:this.activationReason,total:this.proxies.length,failed:this.failedProxies.size,available:this.proxies.length-this.failedProxies.size}}async refresh(){let e=Date.now();if(!(e-this.lastFetchTime<this.fetchCooldown)||!(this.proxies.length>=3))try{let t=await this.checkBalance();if(t<.1)return void console.warn(`[ProxyManager] Low balance: $${t} - proxy disabled`);let r=await this.fetchProxies();r.length>0&&(this.proxies=r,this.currentIndex=0,this.lastFetchTime=e,this.failedProxies.clear(),this.proxyFailures.clear(),console.log(`[ProxyManager] Refreshed ${r.length} proxies`))}catch(e){console.error("[ProxyManager] Refresh failed:",e)}}getStats(){return{enabled:this.isActive,reason:this.activationReason,total:this.proxies.length,failed:this.failedProxies.size,available:this.proxies.length-this.failedProxies.size}}}let r=new t;e.s(["proxyManager",0,r])},339327,e=>e.a(async(t,r)=>{try{var a=e.i(985917),s=e.i(46092),o=e.i(235912),i=t([s]);async function n(e){try{let t,r=await (0,s.auth)();if(!r?.user?.id)return a.NextResponse.json({error:"Unauthorized"},{status:401});let i=e.nextUrl.searchParams,n={query:i.get("query")||void 0,orgNumber:i.get("orgNumber")||void 0,type:i.get("type")||void 0,fromDate:i.get("fromDate")?new Date(i.get("fromDate")):void 0,toDate:i.get("toDate")?new Date(i.get("toDate")):void 0,limit:i.get("limit")?parseInt(i.get("limit"),10):50,cursor:i.get("cursor")||void 0,offset:i.get("offset")?parseInt(i.get("offset"),10):0};if(n.cursor||!i.has("offset"))t=await (0,o.getAnnouncementsCursor)(n);else{let{announcements:e,total:r}=await (0,o.getAnnouncements)(n),a=(n.offset||0)+e.length<r;t={announcements:e,total:r,nextCursor:null,hasMore:a}}let[l,c]=await Promise.all([(0,o.getAnnouncementTypes)(),(0,o.getScrapeStats)()]);return a.NextResponse.json({...t,types:l,stats:c,filter:n})}catch(e){return console.error("Error fetching announcements:",e),a.NextResponse.json({error:"Failed to fetch announcements"},{status:500})}}[s]=i.then?(await i)():i,e.s(["GET",()=>n]),r()}catch(e){r(e)}},!1),393798,e=>e.a(async(t,r)=>{try{var a=e.i(4345),s=e.i(886530),o=e.i(368549),i=e.i(437313),n=e.i(476054),l=e.i(905303),c=e.i(581143),u=e.i(175398),d=e.i(288930),p=e.i(521605),h=e.i(831917),x=e.i(571367),g=e.i(448720),f=e.i(615849),y=e.i(955298),v=e.i(193695);e.i(952391);var m=e.i(541372),w=e.i(339327),P=t([w]);[w]=P.then?(await P)():P;let C=new a.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/kungorelser/route",pathname:"/api/kungorelser",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/CLAUDE/projects/LoopDesk/src/app/api/kungorelser/route.ts",nextConfigOutput:"standalone",userland:w}),{workAsyncStorage:k,workUnitAsyncStorage:E,serverHooks:S}=C;function A(){return(0,o.patchFetch)({workAsyncStorage:k,workUnitAsyncStorage:E})}async function R(e,t,r){C.isDev&&(0,i.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let a="/api/kungorelser/route";a=a.replace(/\/index$/,"")||"/";let o=await C.prepare(e,t,{srcPage:a,multiZoneDraftMode:!1});if(!o)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:w,params:P,nextConfig:A,parsedUrl:R,isDraftMode:k,prerenderManifest:E,routerServerContext:S,isOnDemandRevalidate:I,revalidateOnlyGenerated:T,resolvedPathname:b,clientReferenceManifest:D,serverActionsManifest:M}=o,N=(0,c.normalizeAppPath)(a),_=!!(E.dynamicRoutes[N]||E.routes[b]),O=async()=>((null==S?void 0:S.render404)?await S.render404(e,t,R,!1):t.end("This page could not be found"),null);if(_&&!k){let e=!!E.routes[b],t=E.dynamicRoutes[N];if(t&&!1===t.fallback&&!e){if(A.experimental.adapterPath)return await O();throw new v.NoFallbackError}}let U=null;!_||C.isDev||k||(U=b,U="/index"===U?"/":U);let L=!0===C.isDev||!_,$=_&&!L;M&&D&&(0,l.setManifestsSingleton)({page:a,clientReferenceManifest:D,serverActionsManifest:M});let F=e.method||"GET",q=(0,n.getTracer)(),j=q.getActiveScopeSpan(),H={params:P,prerenderManifest:E,renderOpts:{experimental:{authInterrupts:!!A.experimental.authInterrupts},cacheComponents:!!A.cacheComponents,supportsDynamicResponse:L,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:A.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a,s)=>C.onRequestError(e,t,a,s,S)},sharedContext:{buildId:w}},K=new u.NodeNextRequest(e),B=new u.NodeNextResponse(t),V=d.NextRequestAdapter.fromNodeNextRequest(K,(0,d.signalFromNodeResponse)(t));try{let o=async e=>C.handle(V,H).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=q.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let s=r.get("next.route");if(s){let t=`${F} ${s}`;e.setAttributes({"next.route":s,"http.route":s,"next.span_name":t}),e.updateName(t)}else e.updateName(`${F} ${a}`)}),l=!!(0,i.getRequestMeta)(e,"minimalMode"),c=async i=>{var n,c;let u=async({previousCacheEntry:s})=>{try{if(!l&&I&&T&&!s)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await o(i);e.fetchMetrics=H.renderOpts.fetchMetrics;let n=H.renderOpts.pendingWaitUntil;n&&r.waitUntil&&(r.waitUntil(n),n=void 0);let c=H.renderOpts.collectedTags;if(!_)return await (0,x.sendResponse)(K,B,a,H.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,g.toNodeOutgoingHttpHeaders)(a.headers);c&&(t[y.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==H.renderOpts.collectedRevalidate&&!(H.renderOpts.collectedRevalidate>=y.INFINITE_CACHE)&&H.renderOpts.collectedRevalidate,s=void 0===H.renderOpts.collectedExpire||H.renderOpts.collectedExpire>=y.INFINITE_CACHE?void 0:H.renderOpts.collectedExpire;return{value:{kind:m.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:s}}}}catch(t){throw(null==s?void 0:s.isStale)&&await C.onRequestError(e,t,{routerKind:"App Router",routePath:a,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:$,isOnDemandRevalidate:I})},!1,S),t}},d=await C.handleResponse({req:e,nextConfig:A,cacheKey:U,routeKind:s.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:E,isRoutePPREnabled:!1,isOnDemandRevalidate:I,revalidateOnlyGenerated:T,responseGenerator:u,waitUntil:r.waitUntil,isMinimalMode:l});if(!_)return null;if((null==d||null==(n=d.value)?void 0:n.kind)!==m.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(c=d.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",I?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),k&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,g.fromNodeOutgoingHttpHeaders)(d.value.headers);return l&&_||p.delete(y.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,f.getCacheControlHeader)(d.cacheControl)),await (0,x.sendResponse)(K,B,new Response(d.value.body,{headers:p,status:d.value.status||200})),null};j?await c(j):await q.withPropagatedContext(e.headers,()=>q.trace(p.BaseServerSpan.handleRequest,{spanName:`${F} ${a}`,kind:n.SpanKind.SERVER,attributes:{"http.method":F,"http.target":e.url}},c))}catch(t){if(t instanceof v.NoFallbackError||await C.onRequestError(e,t,{routerKind:"App Router",routePath:N,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:$,isOnDemandRevalidate:I})},!1,S),_)throw t;return await (0,x.sendResponse)(K,B,new Response(null,{status:500})),null}}e.s(["handler",()=>R,"patchFetch",()=>A,"routeModule",()=>C,"serverHooks",()=>S,"workAsyncStorage",()=>k,"workUnitAsyncStorage",()=>E]),r()}catch(e){r(e)}},!1),103243,e=>{e.v(e=>Promise.resolve().then(()=>e(528227)))}];

//# debugId=c2c53f89-8f4a-5e61-b3d3-f6aad5792e2e
//# sourceMappingURL=%5Broot-of-the-server%5D__df949749._.js.map