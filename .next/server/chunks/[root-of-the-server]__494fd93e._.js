;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="37ed1311-7aef-8ffe-5078-ffcfc57c70c3")}catch(e){}}();
module.exports=[918622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},556704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},832319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},324725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},120635,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},814747,(e,t,r)=>{t.exports=e.x("path",()=>require("path"))},130101,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a={ActionDidNotRevalidate:function(){return n},ActionDidRevalidateDynamicOnly:function(){return i},ActionDidRevalidateStaticAndDynamic:function(){return o}};for(var s in a)Object.defineProperty(r,s,{enumerable:!0,get:a[s]});let n=0,o=1,i=2},193695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},219985,(e,t,r)=>{"use strict";t.exports=e.r(918622)},666870,(e,t,r)=>{"use strict";t.exports=e.r(219985).vendored["react-rsc"].React},179475,(e,t,r)=>{t.exports=e.x("@prisma/client-935491d6e3ada45d",()=>require("@prisma/client-935491d6e3ada45d"))},109357,e=>e.a(async(t,r)=>{try{let t=await e.y("pg-3f7efcb9b626a319");e.n(t),r()}catch(e){r(e)}},!0),254799,(e,t,r)=>{t.exports=e.x("crypto",()=>require("crypto"))},720034,e=>e.a(async(t,r)=>{try{var a=e.i(528227),s=t([a]);[a]=s.then?(await s)():s;let c=new Map;async function n(e){let t=function(e){let t=Date.now(),r=e.toLowerCase(),a=c.get(r);if(!a||t-a.windowStart>6e4)return c.set(r,{attempts:1,windowStart:t}),{allowed:!0};if(a.attempts>=5){let e=Math.ceil((a.windowStart+6e4-t)/1e3);return{allowed:!1,retryAfterSeconds:e}}return a.attempts++,{allowed:!0}}(e);if(!t.allowed)return{allowed:!1,error:"RATE_LIMITED",retryAfterSeconds:t.retryAfterSeconds};try{let t=await a.prisma.user.findUnique({where:{email:e.toLowerCase()},select:{id:!0,failedLoginAttempts:!0,lockedUntil:!0}});if(!t)return{allowed:!0};if(t.lockedUntil&&new Date(t.lockedUntil)>new Date){let e=Math.ceil((new Date(t.lockedUntil).getTime()-Date.now())/6e4);return{allowed:!1,error:"ACCOUNT_LOCKED",lockoutMinutes:e}}t.lockedUntil&&new Date(t.lockedUntil)<=new Date&&await a.prisma.user.update({where:{id:t.id},data:{failedLoginAttempts:0,lockedUntil:null}});let r=10-(t.failedLoginAttempts||0);return{allowed:!0,remainingAttempts:r}}catch(e){return console.error("[RateLimit] Error checking login attempt:",e),{allowed:!0}}}async function o(e){try{let t=await a.prisma.user.findUnique({where:{email:e.toLowerCase()},select:{id:!0,failedLoginAttempts:!0}});if(!t)return{allowed:!1,error:"ACCOUNT_NOT_FOUND"};let r=(t.failedLoginAttempts||0)+1,s=r>=10;if(await a.prisma.user.update({where:{id:t.id},data:{failedLoginAttempts:r,lockedUntil:s?new Date(Date.now()+9e5):null}}),s)return{allowed:!1,error:"ACCOUNT_LOCKED",lockoutMinutes:15};return{allowed:!1,error:"INVALID_CREDENTIALS",remainingAttempts:10-r}}catch(e){return console.error("[RateLimit] Error recording failed attempt:",e),{allowed:!1,error:"INVALID_CREDENTIALS"}}}async function i(e){c.delete(e.toLowerCase());try{await a.prisma.user.update({where:{email:e.toLowerCase()},data:{failedLoginAttempts:0,lockedUntil:null,lastLoginAt:new Date}})}catch(e){console.error("[RateLimit] Error recording successful login:",e)}}function l(e,t){switch(e){case"RATE_LIMITED":return`F\xf6r m\xe5nga f\xf6rs\xf6k. V\xe4nta ${t?.retryAfterSeconds||60} sekunder.`;case"ACCOUNT_LOCKED":return`Kontot \xe4r l\xe5st i ${t?.lockoutMinutes||15} minuter pga f\xf6r m\xe5nga misslyckade f\xf6rs\xf6k.`;case"ACCOUNT_NOT_FOUND":return"Inget konto hittades med denna e-postadress.";case"INVALID_CREDENTIALS":if(t?.remainingAttempts!==void 0&&t.remainingAttempts<=3)return`Fel l\xf6senord. ${t.remainingAttempts} f\xf6rs\xf6k kvar innan kontot l\xe5ses.`;return"Fel e-postadress eller lösenord.";default:return"Något gick fel. Försök igen."}}e.s(["checkLoginAttempt",()=>n,"getErrorMessage",()=>l,"recordFailedAttempt",()=>o,"recordSuccessfulLogin",()=>i]),r()}catch(e){r(e)}},!1),60025,e=>{"use strict";var t=e.i(530447);let r=0,a=null;async function s(){if(!process.env.TWOCAPTCHA_API_KEY)return void console.log("[ProxyInit] Skipping proxy initialization (no API key)");if(process.env.PROXY_SERVER&&"disabled"!==process.env.PROXY_SERVER){console.log("[ProxyInit] Static proxy configured, loading..."),await t.proxyManager.fetchProxies(),await t.proxyManager.activate("Static proxy configured");let e=t.proxyManager.getStatus();console.log(`[ProxyInit] Static proxy ready - ${e.available}/${e.total} proxies`);return}console.log("[ProxyInit] Initializing proxy auto-refresh...");try{await n()}catch(e){console.error("[ProxyInit] Initial refresh failed:",e)}a&&clearInterval(a),a=setInterval(async()=>{try{await n()}catch(e){console.error("[ProxyInit] Periodic refresh failed:",e)}},144e5),console.log("[ProxyInit] Auto-refresh scheduled every 4 hours")}async function n(){let e=Date.now();if(e-r<3e5)return void console.log("[ProxyInit] Skipping refresh (too recent)");console.log("[ProxyInit] Refreshing proxies..."),await t.proxyManager.refresh(),r=e;let a=t.proxyManager.getStatus();console.log(`[ProxyInit] Refresh complete - ${a.available}/${a.total} proxies available`)}async function o(){if(console.log("[ProxyInit] Force refreshing proxies via proxyManager..."),r=0,!process.env.TWOCAPTCHA_API_KEY)return void console.log("[ProxyInit] No API key configured - cannot fetch proxies");try{let e=await t.proxyManager.fetchProxies();console.log(`[ProxyInit] ProxyManager now has ${e.length} proxies`),e.length>0&&!t.proxyManager.getStatus().isActive&&await t.proxyManager.activate("Force refresh - proxies available")}catch(e){console.error("[ProxyInit] Failed to refresh proxies:",e)}}function i(){a&&(clearInterval(a),a=null,console.log("[ProxyInit] Auto-refresh stopped"))}s().catch(e=>{console.error("[ProxyInit] Failed to initialize:",e)}),e.s(["forceRefreshProxies",()=>o,"initializeProxyManager",()=>s,"stopProxyRefresh",()=>i])},522734,(e,t,r)=>{t.exports=e.x("fs",()=>require("fs"))},530447,e=>{"use strict";class t{proxies=[];currentIndex=0;isActive=!1;lastFetchTime=0;fetchCooldown=3e5;balance=0;blockingStats={http429Count:0,consecutiveCaptchas:0,lastCaptchaTime:0,sessionBlocked:!1};captchaTimes=[];failedProxies=new Set;proxyFailures=new Map;maxFailures=3;activationReason=null;shouldActivate(){if(this.isActive)return{shouldActivate:!1,reason:null};if(this.blockingStats.http429Count>=3)return{shouldActivate:!0,reason:`Rate limited ${this.blockingStats.http429Count} times`};if(this.blockingStats.consecutiveCaptchas>=5)return{shouldActivate:!0,reason:`${this.blockingStats.consecutiveCaptchas} consecutive CAPTCHAs`};let e=Date.now(),t=this.captchaTimes.filter(t=>e-t<6e4);return t.length>=3?{shouldActivate:!0,reason:`${t.length} CAPTCHAs in ${60}s`}:this.blockingStats.sessionBlocked?{shouldActivate:!0,reason:"Session blocked"}:{shouldActivate:!1,reason:null}}recordCaptcha(){let e=Date.now();this.blockingStats.consecutiveCaptchas++,this.blockingStats.lastCaptchaTime=e,this.captchaTimes.push(e),this.captchaTimes=this.captchaTimes.filter(t=>e-t<12e4),console.log(`[ProxyManager] CAPTCHA recorded: consecutive=${this.blockingStats.consecutiveCaptchas}`)}recordSuccess(){this.blockingStats.consecutiveCaptchas=0}recordRateLimit(){this.blockingStats.http429Count++,console.log(`[ProxyManager] Rate limit recorded: count=${this.blockingStats.http429Count}`)}recordSessionBlocked(){this.blockingStats.sessionBlocked=!0,console.log("[ProxyManager] Session blocked recorded")}resetStats(){this.blockingStats={http429Count:0,consecutiveCaptchas:0,lastCaptchaTime:0,sessionBlocked:!1},this.captchaTimes=[]}async fetchProxies(){let e=process.env.PROXY_SERVER||"",t=process.env.PROXY_USERNAME||"",r=process.env.PROXY_PASSWORD||"",a=process.env.TWOCAPTCHA_API_KEY||"";if(e&&"disabled"!==e){let a=!e||e.includes("://")?e:`http://${e}`,[s,n]=a.replace(/^[a-z]+:\/\//,"").split("/")[0].split(":"),o=parseInt(n||"80",10);return this.proxies=[{id:a,host:s,port:o,url:a,source:"static",username:t||void 0,password:r||void 0}],this.lastFetchTime=Date.now(),this.failedProxies.clear(),this.proxyFailures.clear(),console.log("[ProxyManager] Using static proxy from environment"),this.proxies}if(!a)return console.log("[ProxyManager] No API key configured - proxy functionality disabled"),console.log("[ProxyManager] Set TWOCAPTCHA_API_KEY or PROXY_SERVER to enable proxies"),this.proxies=[],this.proxies;let s=Date.now();if(s-this.lastFetchTime<this.fetchCooldown&&this.proxies.length>0)return console.log("[ProxyManager] Using cached proxies"),this.proxies;try{console.log("[ProxyManager] Fetching 10 SE proxies from 2captcha...");let e=new URL("https://api.2captcha.com/proxy");e.searchParams.set("key",a),e.searchParams.set("country","se"),e.searchParams.set("type","residential"),e.searchParams.set("limit","10");let t=await fetch(e.toString()),r=await t.json();if("OK"===r.status&&Array.isArray(r.data)){let e=r.data.map(e=>{if("string"==typeof e){let[t,r]=e.split(":");return t&&r?{id:e,host:t,port:parseInt(r,10),url:`http://${e}`,source:"2captcha"}:null}let t=e.proxy||e.proxy_string||e.ip_port,r=e.host||e.ip||(t?t.split(":")[0]:void 0),a=e.port||(t?t.split(":")[1]:void 0);if(!r||!a)return null;let s="string"==typeof a?parseInt(a,10):a,n=e.protocol||e.type||"http",o=e.login||e.username||e.user,i=e.password||e.pass;return{id:`${r}:${s}`,host:r,port:s,url:`${n}://${r}:${s}`,source:"2captcha",username:o,password:i}}).filter(e=>!!e);this.proxies=e,this.lastFetchTime=s,this.failedProxies.clear(),this.proxyFailures.clear(),console.log(`[ProxyManager] Got ${this.proxies.length} proxies from 2captcha`)}else console.error(`[ProxyManager] 2captcha error: ${r.message||JSON.stringify(r)}`)}catch(e){console.error("[ProxyManager] Error fetching proxies:",e)}return this.proxies}async checkBalance(){let e=process.env.TWOCAPTCHA_API_KEY||"";if(!e)return 0;try{let t=new URL("https://2captcha.com/res.php");t.searchParams.set("key",e),t.searchParams.set("action","getbalance"),t.searchParams.set("json","1");let r=await fetch(t.toString()),a=await r.json();if(1===a.status)return this.balance=parseFloat(a.request),this.balance}catch(e){console.error("[ProxyManager] Error checking balance:",e)}return 0}async activate(e){if(this.isActive)return console.log("[ProxyManager] Already active"),!0;console.log(`[ProxyManager] ACTIVATING PROXY - Reason: ${e}`),this.isActive=!0,this.activationReason=e;let t=await this.fetchProxies();return 0===t.length?(console.warn("[ProxyManager] No proxies available"),!1):(this.currentIndex=0,this.resetStats(),console.log(`[ProxyManager] Activated with ${t.length} proxies`),!0)}deactivate(){console.log("[ProxyManager] Deactivating proxy"),this.isActive=!1,this.activationReason=null,this.resetStats()}getCurrentProxy(){if(!this.isActive||0===this.proxies.length)return null;let e=this.proxies[this.currentIndex];return{server:e.url,username:e.username,password:e.password}}markFailed(e){if(!e)return;let t="server"in e?e.server:e.url,r=(this.proxyFailures.get(t)||0)+1;this.proxyFailures.set(t,r),r>=this.maxFailures&&(console.log(`[ProxyManager] Proxy ${t} marked as failed`),this.failedProxies.add(t))}markSuccess(e){if(!e)return;let t="server"in e?e.server:e.url;this.proxyFailures.set(t,0)}getPlaywrightConfig(e){let t=e||this.getCurrentProxy();if(!t)return{};let r="server"in t?t.server:t.url;return{proxy:{server:r,username:t.username,password:t.password}}}getNext(){if(!this.isActive||0===this.proxies.length)return null;let e=0;for(;e<this.proxies.length;){let t=this.proxies[this.currentIndex];if(this.currentIndex=(this.currentIndex+1)%this.proxies.length,!this.failedProxies.has(t.url))return t;e++}return console.log("[ProxyManager] All proxies exhausted, resetting..."),this.failedProxies.clear(),this.proxyFailures.clear(),this.proxies[0]||null}rotateProxy(){0!==this.proxies.length&&(this.currentIndex=(this.currentIndex+1)%this.proxies.length,console.log(`[ProxyManager] Rotated to proxy ${this.currentIndex+1}/${this.proxies.length}`))}getStatus(){return{isActive:this.isActive,enabled:this.isActive,reason:this.activationReason,total:this.proxies.length,failed:this.failedProxies.size,available:this.proxies.length-this.failedProxies.size}}async refresh(){let e=Date.now();if(!(e-this.lastFetchTime<this.fetchCooldown)||!(this.proxies.length>=3))try{let t=await this.checkBalance();if(t<.1)return void console.warn(`[ProxyManager] Low balance: $${t} - proxy disabled`);let r=await this.fetchProxies();r.length>0&&(this.proxies=r,this.currentIndex=0,this.lastFetchTime=e,this.failedProxies.clear(),this.proxyFailures.clear(),console.log(`[ProxyManager] Refreshed ${r.length} proxies`))}catch(e){console.error("[ProxyManager] Refresh failed:",e)}}getStats(){return{enabled:this.isActive,reason:this.activationReason,total:this.proxies.length,failed:this.failedProxies.size,available:this.proxies.length-this.failedProxies.size}}}let r=new t;e.s(["proxyManager",0,r])},901043,e=>e.a(async(t,r)=>{try{var a=e.i(528227),s=e.i(235912),n=t([a]);[a]=n.then?(await n)():n;let h={hourly:36e5,every2h:72e5,every4h:144e5,every6h:216e5,every8h:288e5,every12h:432e5,daily:864e5,weekly:6048e5},g=null,x=!1,f=!1,m={currentBatch:0,totalBatches:0,companiesProcessed:0,companiesSkipped:0,newAnnouncementsFound:0,startTime:null,consecutiveFailures:0};async function o(){let e=await a.prisma.announcementScrapeStats.findUnique({where:{id:"stats"}}),t=new Date,r=e?.delayMs?function(e){for(let[t,r]of Object.entries(h))if(r===e)return t;return"daily"}(e.delayMs):"daily",s=h[r]||h.daily,n=e?.lastSearchAt?new Date(e.lastSearchAt.getTime()+s):null,o=null;if(x&&m.startTime&&m.companiesProcessed>0){let e=(t.getTime()-m.startTime.getTime())/m.companiesProcessed,r=3*m.totalBatches-m.companiesProcessed;o=Math.round(e*r/6e4)}return{enabled:e?.isRunning??!1,interval:r,lastRun:e?.lastSearchAt??null,nextRun:n,isRunning:x,currentBatch:m.currentBatch,totalBatches:m.totalBatches,companiesProcessed:m.companiesProcessed,companiesSkipped:m.companiesSkipped,newAnnouncementsFound:m.newAnnouncementsFound,estimatedTimeRemaining:o}}async function i(e){let t=e.interval?h[e.interval]||h.daily:void 0;return await a.prisma.announcementScrapeStats.upsert({where:{id:"stats"},create:{id:"stats",totalSearches:0,totalAnnouncements:0,isRunning:e.enabled??!1,delayMs:t??h.daily},update:{isRunning:e.enabled,delayMs:t}}),!1===e.enabled?g&&(clearInterval(g),g=null):!0===e.enabled&&(g&&clearInterval(g),g=setInterval(async()=>{try{let e=await o();e.enabled&&!x&&e.nextRun&&new Date>=e.nextRun&&await c()}catch(e){console.error("[Scheduler] Timer check error:",e)}},6e4)),o()}async function l(){return x?(f=!0,{success:!0,message:"Stop signal sent, will stop after current batch"}):{success:!1,message:"No scheduled run is currently running"}}async function c(){return x?{success:!1,message:"Scheduled run already in progress"}:(x=!0,f=!1,m={currentBatch:0,totalBatches:0,companiesProcessed:0,companiesSkipped:0,newAnnouncementsFound:0,startTime:new Date,consecutiveFailures:0},u().catch(e=>{console.error("[Scheduler] Scrape loop error:",e),x=!1}),{success:!0,message:"Scheduled run started"})}async function u(){let e=Date.now();console.log("[Scheduler] Starting scheduled run...");try{let t=await a.prisma.watchedCompany.findMany({select:{orgNumber:!0,name:!0,lastScraped:!0},orderBy:[{lastScraped:"asc"},{createdAt:"asc"}]});console.log(`[Scheduler] Found ${t.length} watched companies`);let r=Math.ceil(t.length/3);m.totalBatches=r;for(let a=0;a<r;a++){if(f){console.log("[Scheduler] Stop requested, finishing...");break}if(Date.now()-e>288e5){console.log("[Scheduler] Max runtime reached, stopping...");break}if(m.consecutiveFailures>=10){console.log("[Scheduler] Circuit breaker triggered, stopping...");break}m.currentBatch=a+1;let s=3*a,n=Math.min(s+3,t.length),o=t.slice(s,n);for(let e of(console.log(`[Scheduler] Processing batch ${a+1}/${r} (${o.length} companies)`),await Promise.allSettled(o.map(e=>d(e)))))"fulfilled"===e.status?(e.value.skipped?m.companiesSkipped++:m.newAnnouncementsFound+=e.value.newAnnouncements,m.consecutiveFailures=0):m.consecutiveFailures++,m.companiesProcessed++;a<r-1&&await new Promise(e=>setTimeout(e,3e4))}await a.prisma.announcementScrapeStats.update({where:{id:"stats"},data:{lastSearchAt:new Date,totalSearches:{increment:m.companiesProcessed-m.companiesSkipped}}}),console.log(`[Scheduler] Completed: ${m.companiesProcessed} processed, ${m.companiesSkipped} skipped, ${m.newAnnouncementsFound} new announcements`)}finally{x=!1}}async function d(e){let{orgNumber:t,lastScraped:r}=e;if(r){let e=(Date.now()-r.getTime())/36e5;if(e<24)return console.log(`[Scheduler] Skipping ${t} - cache fresh (${e.toFixed(1)}h old)`),{skipped:!0,newAnnouncements:0}}try{let e=await a.prisma.announcement.count({where:{orgNumber:t}}),r=await Promise.race([(0,s.searchAndSaveAnnouncements)(t,{forceRefresh:!0}),new Promise((e,t)=>setTimeout(()=>t(Error("Scrape timeout")),3e5))]);await a.prisma.watchedCompany.update({where:{orgNumber:t},data:{lastScraped:new Date}});let n=Math.max(0,r.length-e);return console.log(`[Scheduler] ${t}: ${r.length} total, ${n} new`),await new Promise(e=>setTimeout(e,1500)),{skipped:!1,newAnnouncements:n}}catch(e){throw console.error(`[Scheduler] Error scraping ${t}:`,e),e}}function p(){return{cacheStaleHours:24,concurrency:3,maxRuntimeHours:8,delayBetweenCompaniesMs:1500,delayBetweenBatchesMs:3e4}}e.s(["getScheduleState",()=>o,"getSchedulerLimits",()=>p,"runScheduledScrape",()=>c,"stopScheduledRun",()=>l,"updateScheduleConfig",()=>i]),r()}catch(e){r(e)}},!1),656428,e=>e.a(async(t,r)=>{try{var a=e.i(985917),s=e.i(46092),n=e.i(235912),o=e.i(901043),i=e.i(528227),l=t([s,o,i]);async function c(){try{let t=await (0,s.auth)();if(!t?.user?.id)return a.NextResponse.json({error:"Unauthorized"},{status:401});let r=await (0,n.getScrapeStats)(),l=await (0,o.getScheduleState)(),c=(0,o.getSchedulerLimits)(),[u,d]=await Promise.all([i.prisma.announcement.count(),i.prisma.watchedCompany.count()]),p=process.env.TWOCAPTCHA_API_KEY,h={configured:!1,balance:0,error:null};if(p){h.configured=!0;try{let e=new URL("https://2captcha.com/res.php");e.searchParams.set("key",p),e.searchParams.set("action","getbalance"),e.searchParams.set("json","1");let t=await fetch(e.toString()),r=await t.json();1===r.status?h.balance=parseFloat(r.request):h.error=r.request}catch(e){h.error=e instanceof Error?e.message:"Unknown error"}}let g={available:!1,error:null};try{g.available=!!e.r(244573).chromium}catch(e){g.error=e instanceof Error?e.message:"Playwright not available"}return a.NextResponse.json({announcementCount:u,watchedCompanyCount:d,schedule:l,limits:c,stats:{totalSearches:r.totalSearches,successfulSearches:r.totalAnnouncements,failedSearches:r.errors},scraper:{...r,config:{detailDelayMs:parseInt(process.env.SCRAPER_DETAIL_DELAY_MS||"2000",10),maxCaptchaRetries:parseInt(process.env.SCRAPER_MAX_CAPTCHA_RETRIES||"10",10),navigationTimeout:parseInt(process.env.SCRAPER_NAVIGATION_TIMEOUT||"60000",10),useProxy:"true"===process.env.SCRAPER_USE_PROXY}},twocaptcha:h,browser:g,environment:{nodeEnv:"production",playwrightPath:process.env.PLAYWRIGHT_BROWSERS_PATH||"default"}})}catch(e){return console.error("Error getting kungörelser status:",e),a.NextResponse.json({error:"Failed to get status",message:e instanceof Error?e.message:"Unknown error"},{status:500})}}[s,o,i]=l.then?(await l)():l,e.s(["GET",()=>c]),r()}catch(e){r(e)}},!1),771904,e=>e.a(async(t,r)=>{try{var a=e.i(4345),s=e.i(886530),n=e.i(368549),o=e.i(437313),i=e.i(476054),l=e.i(905303),c=e.i(581143),u=e.i(175398),d=e.i(288930),p=e.i(521605),h=e.i(831917),g=e.i(571367),x=e.i(448720),f=e.i(615849),m=e.i(955298),y=e.i(193695);e.i(952391);var w=e.i(541372),v=e.i(656428),P=t([v]);[v]=P.then?(await P)():P;let R=new a.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/kungorelser/status/route",pathname:"/api/kungorelser/status",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/CLAUDE/projects/LoopDesk/src/app/api/kungorelser/status/route.ts",nextConfigOutput:"standalone",userland:v}),{workAsyncStorage:C,workUnitAsyncStorage:k,serverHooks:E}=R;function A(){return(0,n.patchFetch)({workAsyncStorage:C,workUnitAsyncStorage:k})}async function S(e,t,r){R.isDev&&(0,o.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let a="/api/kungorelser/status/route";a=a.replace(/\/index$/,"")||"/";let n=await R.prepare(e,t,{srcPage:a,multiZoneDraftMode:!1});if(!n)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:v,params:P,nextConfig:A,parsedUrl:S,isDraftMode:C,prerenderManifest:k,routerServerContext:E,isOnDemandRevalidate:T,revalidateOnlyGenerated:b,resolvedPathname:I,clientReferenceManifest:M,serverActionsManifest:_}=n,D=(0,c.normalizeAppPath)(a),O=!!(k.dynamicRoutes[D]||k.routes[I]),N=async()=>((null==E?void 0:E.render404)?await E.render404(e,t,S,!1):t.end("This page could not be found"),null);if(O&&!C){let e=!!k.routes[I],t=k.dynamicRoutes[D];if(t&&!1===t.fallback&&!e){if(A.experimental.adapterPath)return await N();throw new y.NoFallbackError}}let F=null;!O||R.isDev||C||(F=I,F="/index"===F?"/":F);let $=!0===R.isDev||!O,U=O&&!$;_&&M&&(0,l.setManifestsSingleton)({page:a,clientReferenceManifest:M,serverActionsManifest:_});let L=e.method||"GET",j=(0,i.getTracer)(),q=j.getActiveScopeSpan(),H={params:P,prerenderManifest:k,renderOpts:{experimental:{authInterrupts:!!A.experimental.authInterrupts},cacheComponents:!!A.cacheComponents,supportsDynamicResponse:$,incrementalCache:(0,o.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:A.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a,s)=>R.onRequestError(e,t,a,s,E)},sharedContext:{buildId:v}},B=new u.NodeNextRequest(e),K=new u.NodeNextResponse(t),Y=d.NextRequestAdapter.fromNodeNextRequest(B,(0,d.signalFromNodeResponse)(t));try{let n=async e=>R.handle(Y,H).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=j.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let s=r.get("next.route");if(s){let t=`${L} ${s}`;e.setAttributes({"next.route":s,"http.route":s,"next.span_name":t}),e.updateName(t)}else e.updateName(`${L} ${a}`)}),l=!!(0,o.getRequestMeta)(e,"minimalMode"),c=async o=>{var i,c;let u=async({previousCacheEntry:s})=>{try{if(!l&&T&&b&&!s)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await n(o);e.fetchMetrics=H.renderOpts.fetchMetrics;let i=H.renderOpts.pendingWaitUntil;i&&r.waitUntil&&(r.waitUntil(i),i=void 0);let c=H.renderOpts.collectedTags;if(!O)return await (0,g.sendResponse)(B,K,a,H.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,x.toNodeOutgoingHttpHeaders)(a.headers);c&&(t[m.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==H.renderOpts.collectedRevalidate&&!(H.renderOpts.collectedRevalidate>=m.INFINITE_CACHE)&&H.renderOpts.collectedRevalidate,s=void 0===H.renderOpts.collectedExpire||H.renderOpts.collectedExpire>=m.INFINITE_CACHE?void 0:H.renderOpts.collectedExpire;return{value:{kind:w.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:s}}}}catch(t){throw(null==s?void 0:s.isStale)&&await R.onRequestError(e,t,{routerKind:"App Router",routePath:a,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:T})},!1,E),t}},d=await R.handleResponse({req:e,nextConfig:A,cacheKey:F,routeKind:s.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:k,isRoutePPREnabled:!1,isOnDemandRevalidate:T,revalidateOnlyGenerated:b,responseGenerator:u,waitUntil:r.waitUntil,isMinimalMode:l});if(!O)return null;if((null==d||null==(i=d.value)?void 0:i.kind)!==w.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(c=d.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",T?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),C&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,x.fromNodeOutgoingHttpHeaders)(d.value.headers);return l&&O||p.delete(m.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,f.getCacheControlHeader)(d.cacheControl)),await (0,g.sendResponse)(B,K,new Response(d.value.body,{headers:p,status:d.value.status||200})),null};q?await c(q):await j.withPropagatedContext(e.headers,()=>j.trace(p.BaseServerSpan.handleRequest,{spanName:`${L} ${a}`,kind:i.SpanKind.SERVER,attributes:{"http.method":L,"http.target":e.url}},c))}catch(t){if(t instanceof y.NoFallbackError||await R.onRequestError(e,t,{routerKind:"App Router",routePath:D,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:T})},!1,E),O)throw t;return await (0,g.sendResponse)(B,K,new Response(null,{status:500})),null}}e.s(["handler",()=>S,"patchFetch",()=>A,"routeModule",()=>R,"serverHooks",()=>E,"workAsyncStorage",()=>C,"workUnitAsyncStorage",()=>k]),r()}catch(e){r(e)}},!1),103243,e=>{e.v(e=>Promise.resolve().then(()=>e(528227)))}];

//# debugId=37ed1311-7aef-8ffe-5078-ffcfc57c70c3
//# sourceMappingURL=%5Broot-of-the-server%5D__494fd93e._.js.map