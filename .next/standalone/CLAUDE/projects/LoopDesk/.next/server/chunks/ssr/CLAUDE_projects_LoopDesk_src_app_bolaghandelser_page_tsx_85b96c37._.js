;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="df0ebb20-3e63-53a7-37be-a8b7d7378001")}catch(e){}}();
module.exports=[817646,a=>{"use strict";var b=a.i(257640),c=a.i(200417),d=a.i(631887),e=a.i(434303),f=a.i(615214),g=a.i(332068),h=a.i(485472),i=a.i(16591),j=a.i(661616),k=a.i(661961),l=a.i(783953),m=a.i(949258);let n=(0,m.default)("merge",[["path",{d:"m8 6 4-4 4 4",key:"ybng9g"}],["path",{d:"M12 2v10.3a4 4 0 0 1-1.172 2.872L4 22",key:"1hyw0i"}],["path",{d:"m20 22-5-5",key:"1m27yz"}]]),o=(0,m.default)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),p=(0,m.default)("radio",[["path",{d:"M16.247 7.761a6 6 0 0 1 0 8.478",key:"1fwjs5"}],["path",{d:"M19.075 4.933a10 10 0 0 1 0 14.134",key:"ehdyv1"}],["path",{d:"M4.925 19.067a10 10 0 0 1 0-14.134",key:"1q22gi"}],["path",{d:"M7.753 16.239a6 6 0 0 1 0-8.478",key:"r2q7qm"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);var q=a.i(179535);let r=(0,m.default)("bell-off",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M17 17H4a1 1 0 0 1-.74-1.673C4.59 13.956 6 12.499 6 8a6 6 0 0 1 .258-1.742",key:"178tsu"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M8.668 3.01A6 6 0 0 1 18 8c0 2.687.77 4.653 1.707 6.05",key:"1hqiys"}]]),s=(0,m.default)("check-check",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]);var t=a.i(260819),u=a.i(132277),v=a.i(890717),w=a.i(272253);let x=(0,m.default)("layout-grid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);var y=a.i(311548),y=y,z=a.i(221054);let A=(0,c.createContext)({companies:{},isLoading:!0});function B({children:a}){let[d,e]=(0,c.useState)({}),[f,g]=(0,c.useState)(!0);return(0,c.useEffect)(()=>{!async function(){try{let a=await fetch("/api/bolag/company-names");if(a.ok){let b=await a.json();e(b.companies||{})}}catch(a){console.error("Failed to fetch company names:",a)}finally{g(!1)}}()},[]),(0,b.jsx)(A.Provider,{value:{companies:d,isLoading:f},children:a})}var C=a.i(172595),D=a.i(624338),E=a.i(764001),F=a.i(446817),G=a.i(221993),H=a.i(278742);let I=(0,m.default)("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);var J=a.i(202007),K=a.i(296206);let L=["bg-blue-500","bg-emerald-500","bg-amber-500","bg-purple-500","bg-rose-500","bg-cyan-500","bg-indigo-500","bg-orange-500"],M=["#3b82f6","#10b981","#f59e0b","#a855f7","#f43f5e","#06b6d4","#6366f1","#f97316"];function N(a,b,c,d){let e=(d-90)*Math.PI/180;return{x:a+c*Math.cos(e),y:b+c*Math.sin(e)}}function O({shareholders:a,previousShareholders:d,maxDisplay:e=6}){let f=(0,c.useMemo)(()=>{if(!a?.length)return[];let b=a.reduce((a,b)=>a+b.shares,0);return a.map(a=>({...a,sharePercentage:a.sharePercentage??(b>0?a.shares/b*100:0)}))},[a]),g=(0,c.useMemo)(()=>[...f].sort((a,b)=>b.shares-a.shares),[f]),h=(0,c.useMemo)(()=>{if(g.length<=e)return g;let a=g.slice(0,e-1),b=g.slice(e-1),c=b.reduce((a,b)=>a+b.shares,0),d=b.reduce((a,b)=>a+(b.sharePercentage||0),0);return[...a,{name:`${b.length} \xf6vriga`,shares:c,sharePercentage:d}]},[g,e]),i=(0,c.useMemo)(()=>{if(!d?.length)return null;let a=new Map(d.map(a=>[a.name,a.shares])),b=new Map(f.map(a=>[a.name,a.shares])),c=f.filter(b=>!a.has(b.name));return{newOwners:c,exitedOwners:d.filter(a=>!b.has(a.name)),changedOwners:f.filter(b=>{let c=a.get(b.name);return void 0!==c&&c!==b.shares})}},[f,d]),j=(0,c.useMemo)(()=>{let a=[];return h.reduce((b,c,d)=>{let e=b+(c.sharePercentage||0)/100*360;return a.push({...c,startAngle:b,endAngle:e,color:M[d%M.length]}),e},0),a},[h]);return a?.length?(0,b.jsxs)("div",{className:"p-4 bg-muted/50 rounded-xl border border-border/50",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,b.jsx)(k.Users,{className:"w-4 h-4 text-muted-foreground"}),(0,b.jsx)("span",{className:"text-sm font-semibold",children:"Ägarstruktur"}),(0,b.jsxs)("span",{className:"text-xs text-muted-foreground",children:["(",a.length," ägare)"]})]}),(0,b.jsxs)("div",{className:"flex gap-6",children:[(0,b.jsx)("div",{className:"flex-shrink-0",children:(0,b.jsxs)("svg",{width:"120",height:"120",viewBox:"0 0 120 120",children:[j.map((a,c)=>{var d,e;let f,g,h;return(0,b.jsx)("path",{d:(d=a.startAngle,f=N(60,60,55,e=a.endAngle),g=N(60,60,55,d),h=e-d<=180?"0":"1",["M 60 60 L",f.x,f.y,"A 55 55 0",h,"0",g.x,g.y,"Z"].join(" ")),fill:a.color,className:"transition-all duration-300 hover:opacity-80"},c)}),(0,b.jsx)("circle",{cx:"60",cy:"60",r:"30",fill:"var(--background)"})]})}),(0,b.jsx)("div",{className:"flex-1 min-w-0 space-y-1.5",children:h.map((a,c)=>{var d;return(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("div",{className:`w-3 h-3 rounded-sm flex-shrink-0 ${L[c%L.length]}`}),(0,b.jsx)("span",{className:"truncate flex-1",title:a.name,children:a.name}),(0,b.jsx)("span",{className:"text-muted-foreground font-mono text-xs flex-shrink-0",children:void 0===(d=a.sharePercentage)?"–":`${d.toFixed(1)}%`})]},c)})})]}),i&&(i.newOwners.length>0||i.exitedOwners.length>0)&&(0,b.jsxs)("div",{className:"mt-4 pt-3 border-t border-border/50",children:[(0,b.jsx)("div",{className:"text-xs font-medium text-muted-foreground mb-2",children:"Ägarförändringar"}),(0,b.jsxs)("div",{className:"space-y-1",children:[i.newOwners.slice(0,3).map((a,c)=>{var d;return(0,b.jsxs)("div",{className:"flex items-center gap-2 text-xs",children:[(0,b.jsx)(l.TrendingUp,{className:"w-3 h-3 text-emerald-500"}),(0,b.jsx)("span",{className:"text-emerald-600 dark:text-emerald-400",children:a.name}),(0,b.jsxs)("span",{className:"text-muted-foreground",children:["+",(d=a.shares)>=1e6?`${(d/1e6).toFixed(1)}M`:d>=1e3?`${(d/1e3).toFixed(0)}k`:d.toLocaleString("sv-SE")," aktier"]})]},`new-${c}`)}),i.exitedOwners.slice(0,3).map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center gap-2 text-xs",children:[(0,b.jsx)(J.TrendingDown,{className:"w-3 h-3 text-red-500"}),(0,b.jsx)("span",{className:"text-red-600 dark:text-red-400",children:a.name}),(0,b.jsx)("span",{className:"text-muted-foreground",children:"lämnade"})]},`exit-${c}`)),i.changedOwners.slice(0,2).map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center gap-2 text-xs",children:[(0,b.jsx)(K.Minus,{className:"w-3 h-3 text-amber-500"}),(0,b.jsx)("span",{className:"text-amber-600 dark:text-amber-400",children:a.name}),(0,b.jsx)("span",{className:"text-muted-foreground",children:"ändrade innehav"})]},`change-${c}`))]})]})]}):null}var P=a.i(953087);function Q({isOpen:a,onClose:d,pdfUrl:e,title:f}){let g=(0,c.useCallback)(a=>{"Escape"===a.key&&d()},[d]);return((0,c.useEffect)(()=>(a&&(document.addEventListener("keydown",g),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",g),document.body.style.overflow=""}),[a,g]),a)?(0,b.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,b.jsx)("div",{className:"absolute inset-0 bg-background/90 backdrop-blur-sm",onClick:d}),(0,b.jsxs)("div",{className:"relative w-full h-full max-w-5xl max-h-[90vh] mx-4 my-4 flex flex-col animate-in fade-in zoom-in-95 duration-200",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between bg-card border border-border rounded-t-xl px-4 py-3",children:[(0,b.jsx)("div",{className:"flex items-center gap-3 min-w-0",children:(0,b.jsx)("h2",{className:"text-sm font-semibold truncate",children:f||"Protokoll"})}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("a",{href:e,target:"_blank",rel:"noopener noreferrer",className:"p-2 hover:bg-secondary rounded-lg transition-colors text-muted-foreground hover:text-foreground",title:"Öppna i ny flik",children:(0,b.jsx)(C.ExternalLink,{size:18})}),(0,b.jsx)("a",{href:e,download:!0,className:"p-2 hover:bg-secondary rounded-lg transition-colors text-muted-foreground hover:text-foreground",title:"Ladda ner",children:(0,b.jsx)(P.Download,{size:18})}),(0,b.jsx)("button",{onClick:d,className:"p-2 hover:bg-secondary rounded-lg transition-colors text-muted-foreground hover:text-foreground",title:"Stäng (Esc)",children:(0,b.jsx)(v.X,{size:18})})]})]}),(0,b.jsx)("div",{className:"flex-1 bg-card border-x border-b border-border rounded-b-xl overflow-hidden",children:(0,b.jsx)("iframe",{src:`${e}#toolbar=1&navpanes=0&scrollbar=1`,className:"w-full h-full",title:f||"PDF-dokument"})})]})]}):null}var R=a.i(338584);function S({events:a,currentEventId:d,orgNumber:e,maxDisplay:f=3}){let g=(0,c.useMemo)(()=>a.filter(a=>a.id!==d).sort((a,b)=>b.date.getTime()-a.date.getTime()).slice(0,f),[a,d,f]);return 0===g.length?null:(0,b.jsxs)("div",{className:"p-4 bg-muted/50 rounded-xl border border-border/50",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(u.Calendar,{className:"w-4 h-4 text-muted-foreground"}),(0,b.jsx)("span",{className:"text-sm font-semibold",children:"Fler händelser från bolaget"})]}),(0,b.jsxs)(z.default,{href:`/bolag/${e.replace(/\D/g,"")}`,className:"text-xs text-muted-foreground hover:text-primary flex items-center gap-1 transition-colors",children:["Visa alla",(0,b.jsx)(R.ChevronRight,{size:12})]})]}),(0,b.jsx)("div",{className:"space-y-2",children:g.map(a=>(0,b.jsxs)("div",{className:"flex items-start gap-3 p-2 rounded-lg hover:bg-secondary/50 transition-colors",children:[(0,b.jsx)("div",{className:`mt-0.5 p-1.5 rounded-md ${"protocol"===a.type||"protocolSearch"===a.type?"bg-indigo-100 dark:bg-indigo-900/50 text-indigo-600 dark:text-indigo-400":"bg-secondary text-muted-foreground"}`,children:(0,b.jsx)(i.FileText,{size:12})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:"text-sm font-medium truncate",children:a.title}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mt-0.5",children:[(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:function(a){let b=Math.floor((new Date().getTime()-a.getTime())/864e5);if(0===b)return"Idag";if(1===b)return"Igår";if(b<7)return`${b} dagar sedan`;if(b<30){let a=Math.floor(b/7);return`${a} ${1===a?"vecka":"veckor"} sedan`}{if(!(b<365))return a.toLocaleDateString("sv-SE",{year:"numeric",month:"short"});let c=Math.floor(b/30);return`${c} ${1===c?"månad":"månader"} sedan`}}(a.date)}),a.eventType&&(0,b.jsx)("span",{className:"text-xs px-1.5 py-0.5 rounded bg-secondary text-muted-foreground",children:a.eventType})]})]})]},`${a.type}-${a.id}`))})]})}let T={konkurs:{keywords:["konkurs","konkursbeslut"],color:"bg-red-500",bgColor:"bg-red-50 dark:bg-red-950/30",borderColor:"border-l-red-500",gradient:"from-red-500/10 to-transparent",label:"Konkurs",icon:(0,b.jsx)(o,{className:"w-5 h-5"}),priority:1},likvidation:{keywords:["likvidation","likvidator"],color:"bg-orange-500",bgColor:"bg-orange-50 dark:bg-orange-950/30",borderColor:"border-l-orange-500",gradient:"from-orange-500/10 to-transparent",label:"Likvidation",icon:(0,b.jsx)(j.AlertTriangle,{className:"w-5 h-5"}),priority:2},fusion:{keywords:["fusion","sammanslagning"],color:"bg-purple-500",bgColor:"bg-purple-50 dark:bg-purple-950/30",borderColor:"border-l-purple-500",gradient:"from-purple-500/10 to-transparent",label:"Fusion",icon:(0,b.jsx)(n,{className:"w-5 h-5"}),priority:3},emission:{keywords:["nyemission","fondemission","riktad emission"],color:"bg-blue-500",bgColor:"bg-blue-50 dark:bg-blue-950/30",borderColor:"border-l-blue-500",gradient:"from-blue-500/10 to-transparent",label:"Emission",icon:(0,b.jsx)(l.TrendingUp,{className:"w-5 h-5"}),priority:4},styrelse:{keywords:["styrelse","ledamot","ordförande","vd","firmatecknare"],color:"bg-green-500",bgColor:"bg-green-50 dark:bg-green-950/30",borderColor:"border-l-green-500",gradient:"from-green-500/10 to-transparent",label:"Styrelse",icon:(0,b.jsx)(k.Users,{className:"w-5 h-5"}),priority:5}};function U(a,b){if(!b||b.trim().length<2)return a;let c=b.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),d=RegExp(`(${c})`,"gi");return a.replace(d,'<mark class="bg-yellow-200 dark:bg-yellow-500/30 text-inherit px-0.5 rounded">$1</mark>')}function V({event:a,date:d,isFocused:e=!1,showGradientLine:g=!0,isUnread:h=!1,onMarkAsRead:j,onBookmark:k,isBookmarked:l=!1,searchQuery:m,relatedEvents:n,layout:o="standard"}){let p,[q,r]=(0,c.useState)(!1),[s,t]=(0,c.useState)(!1),[u,v]=(0,c.useState)(!1),[w,x]=(0,c.useState)(!1),y=(0,c.useRef)(null),{time:A,day:B}=function(a){let b=new Date,c=a.toLocaleTimeString("sv-SE",{hour:"2-digit",minute:"2-digit"});if(a.toDateString()===b.toDateString())return{time:c};let d=new Date(b);if(d.setDate(d.getDate()-1),a.toDateString()===d.toDateString())return{time:c,day:"Igår"};let e=new Date(b);if(e.setDate(e.getDate()-7),a>e){let b=a.toLocaleDateString("sv-SE",{weekday:"short"});return{time:c,day:b.charAt(0).toUpperCase()+b.slice(1)}}return{time:c,day:a.toLocaleDateString("sv-SE",{day:"numeric",month:"short"})}}(d),J="protocol"===a.type||"protocolSearch"===a.type?a.data.companyName||"Okänt bolag":a.data.subject||"Okänt bolag",K=("protocol"===a.type||a.type,a.data.orgNumber),L=function(a){let b=a.toLowerCase();for(let[a,c]of Object.entries(T))if(c.keywords.some(a=>b.includes(a)))return{category:a,...c};return null}("announcement"===a.type?`${a.data.type||""} ${a.data.detailText||""}`:"protocol"===a.type&&a.data.eventType?a.data.eventType:""),M=function(a){if("protocol"===a.type){let b=a.data,c=b.companyName||"Okänt bolag";if(b.aiDetails?.notis?.titel)return b.aiDetails.notis.titel;let d=b.aiDetails?.faktaruta?.stämmoTyp;return d?`${d} i ${c}`:`Protokoll fr\xe5n ${c}`}if("protocolSearch"===a.type){let b=a.data;return`Nytt st\xe4mmoprotokoll fr\xe5n ${b.companyName}`}let b=a.data,c=b.subject||"Okänt bolag",d=`${b.type||""} ${b.detailText||""}`.toLowerCase();return d.includes("konkurs")?`Konkurs i ${c}`:d.includes("likvidation")?`Likvidation av ${c}`:d.includes("fusion")?`Fusion: ${c}`:d.includes("nyemission")||d.includes("fondemission")?`Emission i ${c}`:d.includes("styrelse")||d.includes("ledamot")||d.includes("vd")?`Styrelse\xe4ndring i ${c}`:d.includes("firmatecknare")?`\xc4ndring av firmatecknare i ${c}`:d.includes("revisor")?`Revisorsbyte i ${c}`:d.includes("bolagsordning")?`Ny bolagsordning f\xf6r ${c}`:d.includes("aktiekapital")?`\xc4ndrat aktiekapital i ${c}`:d.includes("adress")||d.includes("säte")?`Adress\xe4ndring f\xf6r ${c}`:`Registrering: ${c}`}(a),N=function(a){if("protocol"===a.type){let b=a.data;if(b.aiDetails?.notis?.sammanfattning)return b.aiDetails.notis.sammanfattning;if(b.aiSummary)return b.aiSummary;let c=[];if(b.aiDetails?.faktaruta?.stämmoTyp&&c.push(b.aiDetails.faktaruta.stämmoTyp),b.aiDetails?.faktaruta?.stämmoDatum){let a=new Date(b.aiDetails.faktaruta.stämmoDatum);c.push(`den ${a.toLocaleDateString("sv-SE",{day:"numeric",month:"long"})}`)}return c.length>0?`${c.join(" ")} inl\xe4mnad till Bolagsverket.`:"Protokoll har lämnats in till Bolagsverket."}if("protocolSearch"===a.type){let b=a.data;if(b.latestProtocolDate){let a=new Date(b.latestProtocolDate).toLocaleDateString("sv-SE",{year:"numeric",month:"2-digit",day:"2-digit"});return`Ett nytt protokoll har registrerats i Bolagsverkets databas: ${a}`}return"Ett nytt protokoll har registrerats i Bolagsverkets databas."}let b=a.data,c=`${b.type||""} ${b.detailText||""}`.match(/Ändringar har registrerats beträffande:\s*([^\n.]+)/i);if(c){let a=c[1].replace(/,\s*$/,"").trim();return`\xc4ndringar har registrerats g\xe4llande ${a}.`}let d=b.detailText||"";for(let a of[/In English/gi,/Start\s+Sök/gi,/Sök kungörelse/gi,/Bli kund/gi,/Logga in/gi,/Skriv ut/gi,/0771-670\s*670/gi,/Bolagsverket/gi,/Aktiebolagsregistret/gi,/Sökresultat/gi,/Antal träffar:\s*\d+/gi,/K\d{5,}[-/]\d{2}/gi,/\d{4}-\d{2}-\d{2}/g,/\d{6}-\d{4}/g,/Org nr:/gi,/Företagsnamn:/gi,/Säte:/gi,/Kungörelsetext/gi,/Uppgiftslämnare/gi,/Typ av kungörelse/gi,/Registreringsdatum/gi,/Publiceringsdatum/gi,/« Tillbaka/gi,/Publicerad/gi])d=d.replace(a," ");return(d=d.replace(/\s+/g," ").trim()).length>200&&(d=d.slice(0,197)+"..."),d||"Kungörelse noterad."}(a),P=function(a,b){if(!a&&!b)return null;if(b){let a=b.toLowerCase().replace(/\s*(ab|aktiebolag|hb|kb|ek\.\s*för\.?|handelsbolag)\s*$/gi,"").replace(/[^a-zåäö0-9]/gi,"").trim();if(a.length>2)return`https://logo.clearbit.com/${a}.se`}if(a){let b=a.replace(/\D/g,"");if(b.length>=10)return`/logos/${b}.png`}return null}(K,J),R=K?`/logos/${K.replace(/\D/g,"")}.png`:null,V="announcement"===a.type?`https://poit.bolagsverket.se/poit-app/kungorelse/${a.data.id.replace(/\//g,"-")}`:"protocol"===a.type?a.data.pdfUrl:null,W=!h,X=async a=>{a.stopPropagation();let b={title:M,text:N.slice(0,100),url:V||window.location.href};if(navigator.share)try{await navigator.share(b)}catch{}else await navigator.clipboard.writeText(V||window.location.href)};return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("article",{ref:y,className:`
        group relative ${"compact"===o?"py-4":"py-6 sm:py-8"} cursor-pointer
        transition-all duration-[250ms] ease-[cubic-bezier(0.4,0,0.2,1)]
        ${e?"ring-2 ring-rose-500 ring-offset-4 ring-offset-background rounded-2xl":""}
        ${q?"bg-secondary/20 -mx-4 px-4 rounded-2xl":""}
        ${W&&!q?"opacity-50":""}
        hover:opacity-100 hover:-translate-y-0.5
      `,style:{minHeight:"auto"},onClick:a=>{let b=a.target;b.closest("button")||b.closest("a")||(r(!q),!q&&j&&j())},children:[(0,b.jsxs)("div",{className:"absolute right-0 top-6 flex items-center gap-1.5 opacity-0 group-hover:opacity-100 transition-all duration-200 z-10",children:[(0,b.jsx)("button",{onClick:a=>{a.stopPropagation(),k?.()},className:"h-9 w-9 rounded-xl border border-border/50 bg-background/95 backdrop-blur-sm text-muted-foreground hover:text-rose-500 hover:border-rose-200 dark:hover:border-rose-800 transition-all duration-200 flex items-center justify-center shadow-sm hover:shadow-md",title:l?"Ta bort bokmärke":"Bokmärk",children:l?(0,b.jsx)(G.BookmarkCheck,{className:"w-4 h-4"}):(0,b.jsx)(F.Bookmark,{className:"w-4 h-4"})}),h&&(0,b.jsx)("button",{onClick:a=>{a.stopPropagation(),j?.()},className:"h-9 w-9 rounded-xl border border-border/50 bg-background/95 backdrop-blur-sm text-muted-foreground hover:text-emerald-500 hover:border-emerald-200 dark:hover:border-emerald-800 transition-all duration-200 flex items-center justify-center shadow-sm hover:shadow-md",title:"Markera som läst",children:(0,b.jsx)(I,{className:"w-4 h-4"})}),(0,b.jsx)("button",{onClick:X,className:"h-9 w-9 rounded-xl border border-border/50 bg-background/95 backdrop-blur-sm text-muted-foreground hover:text-foreground hover:border-border transition-all duration-200 flex items-center justify-center shadow-sm hover:shadow-md",title:"Dela",children:(0,b.jsx)(H.Share2,{className:"w-4 h-4"})})]}),(0,b.jsxs)("div",{className:"min-w-0 flex flex-col",children:[L&&(0,b.jsx)("span",{className:"inline-block mb-2 text-[10px] font-semibold tracking-[0.15em] uppercase text-rose-500",children:L.label}),("protocol"===a.type||"protocolSearch"===a.type)&&!L&&(0,b.jsx)("span",{className:"inline-block mb-2 text-[10px] font-semibold tracking-[0.15em] uppercase text-rose-500",children:"Protokoll"}),(0,b.jsx)("h2",{className:"font-serif text-lg sm:text-xl md:text-[22px] font-normal leading-snug text-foreground group-hover:text-rose-600 dark:group-hover:text-rose-400 transition-colors duration-200",dangerouslySetInnerHTML:{__html:U(M,m)}}),(0,b.jsxs)("div",{className:"flex items-center gap-3 mt-3 text-sm text-muted-foreground",children:[K&&(0,b.jsxs)(z.default,{href:`/bolag/${K.replace(/\D/g,"")}`,onClick:a=>a.stopPropagation(),className:"flex items-center gap-2.5 font-medium text-foreground hover:text-rose-500 transition-colors duration-200",children:[!s&&(P||R)&&(0,b.jsx)("div",{className:"relative w-7 h-7 rounded-lg overflow-hidden bg-muted/50 flex-shrink-0 shadow-sm ring-1 ring-border/30",children:(0,b.jsx)("img",{src:u?R||"":P||"",alt:"",className:"w-full h-full object-contain p-0.5",onError:()=>{!u&&P?v(!0):t(!0)}})}),(s||!P&&!R)&&(0,b.jsx)("div",{className:"w-7 h-7 rounded-lg bg-muted/50 flex items-center justify-center flex-shrink-0 shadow-sm ring-1 ring-border/30",children:(0,b.jsx)(f.Building2,{className:"w-3.5 h-3.5 text-muted-foreground/60"})}),(0,b.jsx)("span",{children:J})]}),(0,b.jsx)("span",{className:"text-muted-foreground/40",children:"·"}),(0,b.jsx)("time",{className:"tabular-nums",children:A}),B&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("span",{className:"text-muted-foreground/40",children:"·"}),(0,b.jsx)("span",{className:"text-muted-foreground/60",children:B})]}),"protocol"===a.type&&a.data.aiDetails?.score!==void 0&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("span",{className:"text-muted-foreground/40",children:"·"}),(0,b.jsxs)("span",{className:"inline-flex items-center gap-1 text-amber-600 dark:text-amber-400",children:[(0,b.jsx)(E.Star,{size:12}),a.data.aiDetails.score,"/10"]})]}),"protocol"===a.type&&a.data.aiDetails?.artikel&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("span",{className:"text-muted-foreground/40",children:"·"}),(0,b.jsxs)("span",{className:"inline-flex items-center gap-1 text-emerald-600 dark:text-emerald-400",children:[(0,b.jsx)(D.Newspaper,{size:12}),"Artikel"]})]})]}),"compact"!==o&&(0,b.jsx)("p",{className:`mt-4 font-serif text-base sm:text-[17px] italic text-muted-foreground leading-relaxed ${q?"":"line-clamp-2"}`,dangerouslySetInnerHTML:{__html:U(N,m)}}),"protocol"===a.type&&a.data.pdfUrl&&!q&&(0,b.jsxs)("button",{onClick:a=>{a.stopPropagation(),x(!0)},className:"mt-4 inline-flex items-center gap-2 text-sm font-medium text-rose-500 hover:text-rose-600 transition-colors duration-200",children:[(0,b.jsx)(i.FileText,{size:14}),"Läs protokoll"]}),q&&(0,b.jsxs)("div",{className:"mt-4 sm:mt-5 pt-4 sm:pt-5 border-t border-border/50 animate-in fade-in slide-in-from-top-2 duration-300",children:["protocol"===a.type&&a.data.aiDetails?.artikel&&(0,b.jsxs)("div",{className:"mb-6 p-4 bg-secondary/50 rounded-xl border border-border/50",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,b.jsx)(D.Newspaper,{className:"w-4 h-4 text-emerald-500"}),(0,b.jsx)("span",{className:"text-sm font-semibold",children:"Nyhetsartikel"}),(0,b.jsx)("span",{className:"text-[10px] px-2 py-0.5 rounded bg-emerald-500/20 text-emerald-600 dark:text-emerald-400",children:"AI-genererad"})]}),(0,b.jsx)("div",{className:"prose prose-sm dark:prose-invert max-w-none text-foreground/90",dangerouslySetInnerHTML:{__html:a.data.aiDetails.artikel.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>").replace(/\n\n/g,"</p><p>").replace(/^/,"<p>").replace(/$/,"</p>")}})]}),"protocol"===a.type&&a.data.aiDetails?.faktaruta&&((p=a.data.aiDetails.faktaruta).händelse||p.belopp||p.pris_per_aktie||p.nya_aktier||p.utspädning||p.investerare&&p.investerare.length>0?(0,b.jsxs)("div",{className:"mb-6 p-4 bg-muted/50 rounded-xl border border-border/50",children:[(0,b.jsx)("div",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground mb-3",children:"Faktaruta"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3 text-sm",children:[p.stämmoTyp&&(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-muted-foreground text-xs",children:"Typ"}),(0,b.jsx)("div",{className:"font-medium",children:p.stämmoTyp})]}),p.händelse&&(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-muted-foreground text-xs",children:"Händelse"}),(0,b.jsx)("div",{className:"font-medium",children:p.händelse})]}),p.belopp&&(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-muted-foreground text-xs",children:"Belopp"}),(0,b.jsx)("div",{className:"font-medium",children:p.belopp})]}),p.pris_per_aktie&&(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-muted-foreground text-xs",children:"Pris/aktie"}),(0,b.jsx)("div",{className:"font-medium",children:p.pris_per_aktie})]}),p.nya_aktier&&(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-muted-foreground text-xs",children:"Nya aktier"}),(0,b.jsx)("div",{className:"font-medium",children:p.nya_aktier})]}),p.utspädning&&(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-muted-foreground text-xs",children:"Utspädning"}),(0,b.jsx)("div",{className:"font-medium",children:p.utspädning})]}),p.investerare&&p.investerare.length>0&&(0,b.jsxs)("div",{className:"col-span-2 sm:col-span-3",children:[(0,b.jsx)("div",{className:"text-muted-foreground text-xs",children:"Investerare"}),(0,b.jsx)("div",{className:"font-medium",children:p.investerare.join(", ")})]})]})]}):null),"protocol"===a.type&&a.data.aiDetails?.shareholders&&a.data.aiDetails.shareholders.length>0&&(0,b.jsx)("div",{className:"mb-6",children:(0,b.jsx)(O,{shareholders:a.data.aiDetails.shareholders})}),n&&n.length>0&&K&&(0,b.jsx)("div",{className:"mb-6",children:(0,b.jsx)(S,{events:n,currentEventId:a.data.id,orgNumber:K})}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-2",children:["protocol"===a.type&&a.data.pdfUrl?(0,b.jsxs)("button",{onClick:a=>{a.stopPropagation(),x(!0)},className:"flex items-center gap-1.5 sm:gap-2 px-3 sm:px-4 py-2 sm:py-2.5 rounded-lg text-xs sm:text-sm font-medium bg-foreground text-background flex-1 sm:flex-none justify-center hover:-translate-y-0.5 hover:shadow-lg transition-all duration-200",children:["Visa protokoll",(0,b.jsx)(i.FileText,{className:"w-4 h-4"})]}):V&&(0,b.jsxs)("a",{href:V,target:"_blank",rel:"noopener noreferrer",onClick:a=>a.stopPropagation(),className:"flex items-center gap-1.5 sm:gap-2 px-3 sm:px-4 py-2 sm:py-2.5 rounded-lg text-xs sm:text-sm font-medium bg-foreground text-background flex-1 sm:flex-none justify-center hover:-translate-y-0.5 hover:shadow-lg transition-all duration-200",children:["announcement"===a.type?"Visa kungörelse":"Visa i Bolagsverket",(0,b.jsx)(C.ExternalLink,{className:"w-4 h-4"})]}),(0,b.jsxs)(z.default,{href:`/bolag/${K?.replace(/\D/g,"")}`,onClick:a=>a.stopPropagation(),className:"flex items-center gap-1.5 sm:gap-2 px-3 sm:px-4 py-2 sm:py-2.5 rounded-lg text-xs sm:text-sm font-medium bg-secondary border border-border text-muted-foreground hover:text-foreground hover:border-muted-foreground hover:-translate-y-0.5 hover:shadow-lg transition-all duration-200",children:[(0,b.jsx)(f.Building2,{className:"w-4 h-4"}),(0,b.jsx)("span",{className:"hidden xs:inline",children:"Visa bolag"})]})]})]})]})]}),"protocol"===a.type&&a.data.pdfUrl&&(0,b.jsx)(Q,{isOpen:w,onClose:()=>x(!1),pdfUrl:a.data.pdfUrl,title:`${a.data.companyName||"Protokoll"} - ${a.data.protocolDate}`})]})}var W=a.i(523614),X=a.i(787092);let Y="loopdesk_read_events",Z="loopdesk_notification_settings",$={enabled:!0,soundEnabled:!1,criticalOnly:!0},_=["konkurs","likvidation"],aa=["konkurs","likvidation","fusion","emission"];function ab(){try{let a=new Audio("/sounds/notification.mp3");a.volume=.3,a.play().catch(()=>{})}catch{}}var ac=a.i(361312);function ad(a,b,c){let d,e=c.initialDeps??[],f=!0;function g(){var g,h,i;let j,k;c.key&&(null==(g=c.debug)?void 0:g.call(c))&&(j=Date.now());let l=a();if(!(l.length!==e.length||l.some((a,b)=>e[b]!==a)))return d;if(e=l,c.key&&(null==(h=c.debug)?void 0:h.call(c))&&(k=Date.now()),d=b(...l),c.key&&(null==(i=c.debug)?void 0:i.call(c))){let a=Math.round((Date.now()-j)*100)/100,b=Math.round((Date.now()-k)*100)/100,d=b/16,e=(a,b)=>{for(a=String(a);a.length<b;)a=" "+a;return a};console.info(`%c⏱ ${e(b,5)} /${e(a,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*d,120))}deg 100% 31%);`,null==c?void 0:c.key)}return(null==c?void 0:c.onChange)&&!(f&&c.skipInitialOnChange)&&c.onChange(d),f=!1,d}return g.updateDeps=a=>{e=a},g}function ae(a,b){if(void 0!==a)return a;throw Error(`Unexpected undefined${b?`: ${b}`:""}`)}let af=a=>{let{offsetWidth:b,offsetHeight:c}=a;return{width:b,height:c}},ag=a=>a,ah=a=>{let b=Math.max(a.startIndex-a.overscan,0),c=Math.min(a.endIndex+a.overscan,a.count-1),d=[];for(let a=b;a<=c;a++)d.push(a);return d},ai=(a,b)=>{let c=a.scrollElement;if(!c)return;let d=a.targetWindow;if(!d)return;let e=a=>{let{width:c,height:d}=a;b({width:Math.round(c),height:Math.round(d)})};if(e(af(c)),!d.ResizeObserver)return()=>{};let f=new d.ResizeObserver(b=>{let d=()=>{let a=b[0];if(null==a?void 0:a.borderBoxSize){let b=a.borderBoxSize[0];if(b)return void e({width:b.inlineSize,height:b.blockSize})}e(af(c))};a.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(d):d()});return f.observe(c,{box:"border-box"}),()=>{f.unobserve(c)}},aj={passive:!0},ak=(a,b)=>{var c,d;let e,f=a.scrollElement;if(!f)return;let g=a.targetWindow;if(!g)return;let h=0,i=a.options.useScrollendEvent&&1?()=>void 0:(c=()=>{b(h,!1)},d=a.options.isScrollingResetDelay,function(...a){g.clearTimeout(e),e=g.setTimeout(()=>c.apply(this,a),d)}),j=c=>()=>{let{horizontal:d,isRtl:e}=a.options;h=d?f.scrollLeft*(e&&-1||1):f.scrollTop,i(),b(h,c)},k=j(!0),l=j(!1);f.addEventListener("scroll",k,aj);let m=a.options.useScrollendEvent&&!0;return m&&f.addEventListener("scrollend",l,aj),()=>{f.removeEventListener("scroll",k),m&&f.removeEventListener("scrollend",l)}},al=(a,b,c)=>{if(null==b?void 0:b.borderBoxSize){let a=b.borderBoxSize[0];if(a)return Math.round(a[c.options.horizontal?"inlineSize":"blockSize"])}return a[c.options.horizontal?"offsetWidth":"offsetHeight"]},am=(a,{adjustments:b=0,behavior:c},d)=>{var e,f;null==(f=null==(e=d.scrollElement)?void 0:e.scrollTo)||f.call(e,{[d.options.horizontal?"left":"top"]:a+b,behavior:c})};class an{constructor(a){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.currentScrollToIndex=null,this.measurementsCache=[],this.itemSizeCache=new Map,this.laneAssignments=new Map,this.pendingMeasuredCacheIndexes=[],this.prevLanes=void 0,this.lanesChangedFlag=!1,this.lanesSettling=!1,this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let a=null,b=()=>a||(this.targetWindow&&this.targetWindow.ResizeObserver?a=new this.targetWindow.ResizeObserver(a=>{a.forEach(a=>{let b=()=>{this._measureElement(a.target,a)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(b):b()})}):null);return{disconnect:()=>{var c;null==(c=b())||c.disconnect(),a=null},observe:a=>{var c;return null==(c=b())?void 0:c.observe(a,{box:"border-box"})},unobserve:a=>{var c;return null==(c=b())?void 0:c.unobserve(a)}}})(),this.range=null,this.setOptions=a=>{Object.entries(a).forEach(([b,c])=>{void 0===c&&delete a[b]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:ag,rangeExtractor:ah,onChange:()=>{},measureElement:al,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...a}},this.notify=a=>{var b,c;null==(c=(b=this.options).onChange)||c.call(b,this,a)},this.maybeNotify=ad(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),a=>{this.notify(a)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(a=>a()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var a;let b=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==b){if(this.cleanup(),!b)return void this.maybeNotify();this.scrollElement=b,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=(null==(a=this.scrollElement)?void 0:a.window)??null,this.elementsCache.forEach(a=>{this.observer.observe(a)}),this.unsubs.push(this.options.observeElementRect(this,a=>{this.scrollRect=a,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(a,b)=>{this.scrollAdjustments=0,this.scrollDirection=b?this.getScrollOffset()<a?"forward":"backward":null,this.scrollOffset=a,this.isScrolling=b,this.maybeNotify()})),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0})}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??("function"==typeof this.options.initialOffset?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(a,b)=>{let c=new Map,d=new Map;for(let e=b-1;e>=0;e--){let b=a[e];if(c.has(b.lane))continue;let f=d.get(b.lane);if(null==f||b.end>f.end?d.set(b.lane,b):b.end<f.end&&c.set(b.lane,!0),c.size===this.options.lanes)break}return d.size===this.options.lanes?Array.from(d.values()).sort((a,b)=>a.end===b.end?a.index-b.index:a.end-b.end)[0]:void 0},this.getMeasurementOptions=ad(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled,this.options.lanes],(a,b,c,d,e,f)=>(void 0!==this.prevLanes&&this.prevLanes!==f&&(this.lanesChangedFlag=!0),this.prevLanes=f,this.pendingMeasuredCacheIndexes=[],{count:a,paddingStart:b,scrollMargin:c,getItemKey:d,enabled:e,lanes:f}),{key:!1}),this.getMeasurements=ad(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:a,paddingStart:b,scrollMargin:c,getItemKey:d,enabled:e,lanes:f},g)=>{if(!e)return this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),[];if(this.laneAssignments.size>a)for(let b of this.laneAssignments.keys())b>=a&&this.laneAssignments.delete(b);this.lanesChangedFlag&&(this.lanesChangedFlag=!1,this.lanesSettling=!0,this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),this.pendingMeasuredCacheIndexes=[]),0!==this.measurementsCache.length||this.lanesSettling||(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(a=>{this.itemSizeCache.set(a.key,a.size)}));let h=this.lanesSettling?0:this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[],this.lanesSettling&&this.measurementsCache.length===a&&(this.lanesSettling=!1);let i=this.measurementsCache.slice(0,h),j=Array(f).fill(void 0);for(let a=0;a<h;a++){let b=i[a];b&&(j[b.lane]=a)}for(let e=h;e<a;e++){let a,f,h=d(e),k=this.laneAssignments.get(e);if(void 0!==k&&this.options.lanes>1){let d=j[a=k],e=void 0!==d?i[d]:void 0;f=e?e.end+this.options.gap:b+c}else{let d=1===this.options.lanes?i[e-1]:this.getFurthestMeasurement(i,e);f=d?d.end+this.options.gap:b+c,a=d?d.lane:e%this.options.lanes,this.options.lanes>1&&this.laneAssignments.set(e,a)}let l=g.get(h),m="number"==typeof l?l:this.options.estimateSize(e),n=f+m;i[e]={index:e,start:f,size:m,end:n,key:h,lane:a},j[a]=e}return this.measurementsCache=i,i},{key:!1,debug:()=>this.options.debug}),this.calculateRange=ad(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(a,b,c,d)=>this.range=a.length>0&&b>0?function({measurements:a,outerSize:b,scrollOffset:c,lanes:d}){let e=a.length-1;if(a.length<=d)return{startIndex:0,endIndex:e};let f=ao(0,e,b=>a[b].start,c),g=f;if(1===d)for(;g<e&&a[g].end<c+b;)g++;else if(d>1){let h=Array(d).fill(0);for(;g<e&&h.some(a=>a<c+b);){let b=a[g];h[b.lane]=b.end,g++}let i=Array(d).fill(c+b);for(;f>=0&&i.some(a=>a>=c);){let b=a[f];i[b.lane]=b.start,f--}f=Math.max(0,f-f%d),g=Math.min(e,g+(d-1-g%d))}return{startIndex:f,endIndex:g}}({measurements:a,outerSize:b,scrollOffset:c,lanes:d}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=ad(()=>{let a=null,b=null,c=this.calculateRange();return c&&(a=c.startIndex,b=c.endIndex),this.maybeNotify.updateDeps([this.isScrolling,a,b]),[this.options.rangeExtractor,this.options.overscan,this.options.count,a,b]},(a,b,c,d,e)=>null===d||null===e?[]:a({startIndex:d,endIndex:e,overscan:b,count:c}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=a=>{let b=this.options.indexAttribute,c=a.getAttribute(b);return c?parseInt(c,10):(console.warn(`Missing attribute name '${b}={index}' on measured element.`),-1)},this._measureElement=(a,b)=>{let c=this.indexFromElement(a),d=this.measurementsCache[c];if(!d)return;let e=d.key,f=this.elementsCache.get(e);f!==a&&(f&&this.observer.unobserve(f),this.observer.observe(a),this.elementsCache.set(e,a)),a.isConnected&&this.resizeItem(c,this.options.measureElement(a,b,this))},this.resizeItem=(a,b)=>{let c=this.measurementsCache[a];if(!c)return;let d=b-(this.itemSizeCache.get(c.key)??c.size);0!==d&&((void 0!==this.shouldAdjustScrollPositionOnItemSizeChange?this.shouldAdjustScrollPositionOnItemSizeChange(c,d,this):c.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=d,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(c.index),this.itemSizeCache=new Map(this.itemSizeCache.set(c.key,b)),this.notify(!1))},this.measureElement=a=>{a?this._measureElement(a,void 0):this.elementsCache.forEach((a,b)=>{a.isConnected||(this.observer.unobserve(a),this.elementsCache.delete(b))})},this.getVirtualItems=ad(()=>[this.getVirtualIndexes(),this.getMeasurements()],(a,b)=>{let c=[];for(let d=0,e=a.length;d<e;d++){let e=b[a[d]];c.push(e)}return c},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=a=>{let b=this.getMeasurements();if(0!==b.length)return ae(b[ao(0,b.length-1,a=>ae(b[a]).start,a)])},this.getMaxScrollOffset=()=>{if(!this.scrollElement)return 0;if("scrollHeight"in this.scrollElement)return this.options.horizontal?this.scrollElement.scrollWidth-this.scrollElement.clientWidth:this.scrollElement.scrollHeight-this.scrollElement.clientHeight;{let a=this.scrollElement.document.documentElement;return this.options.horizontal?a.scrollWidth-this.scrollElement.innerWidth:a.scrollHeight-this.scrollElement.innerHeight}},this.getOffsetForAlignment=(a,b,c=0)=>{if(!this.scrollElement)return 0;let d=this.getSize(),e=this.getScrollOffset();return"auto"===b&&(b=a>=e+d?"end":"start"),"center"===b?a+=(c-d)/2:"end"===b&&(a-=d),Math.max(Math.min(this.getMaxScrollOffset(),a),0)},this.getOffsetForIndex=(a,b="auto")=>{a=Math.max(0,Math.min(a,this.options.count-1));let c=this.measurementsCache[a];if(!c)return;let d=this.getSize(),e=this.getScrollOffset();if("auto"===b)if(c.end>=e+d-this.options.scrollPaddingEnd)b="end";else{if(!(c.start<=e+this.options.scrollPaddingStart))return[e,b];b="start"}if("end"===b&&a===this.options.count-1)return[this.getMaxScrollOffset(),b];let f="end"===b?c.end+this.options.scrollPaddingEnd:c.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(f,b,c.size),b]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(a,{align:b="start",behavior:c}={})=>{"smooth"===c&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(a,b),{adjustments:void 0,behavior:c})},this.scrollToIndex=(a,{align:b="auto",behavior:c}={})=>{"smooth"===c&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),a=Math.max(0,Math.min(a,this.options.count-1)),this.currentScrollToIndex=a;let d=0,e=b=>{if(!this.targetWindow)return;let d=this.getOffsetForIndex(a,b);if(!d)return void console.warn("Failed to get offset for index:",a);let[e,g]=d;this._scrollToOffset(e,{adjustments:void 0,behavior:c}),this.targetWindow.requestAnimationFrame(()=>{let b=()=>{if(this.currentScrollToIndex!==a)return;let b=this.getScrollOffset(),c=this.getOffsetForIndex(a,g);c?1.01>Math.abs(c[0]-b)||f(g):console.warn("Failed to get offset for index:",a)};this.isDynamicMode()?this.targetWindow.requestAnimationFrame(b):b()})},f=b=>{this.targetWindow&&this.currentScrollToIndex===a&&(++d<10?this.targetWindow.requestAnimationFrame(()=>e(b)):console.warn(`Failed to scroll to index ${a} after 10 attempts.`))};e(b)},this.scrollBy=(a,{behavior:b}={})=>{"smooth"===b&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+a,{adjustments:void 0,behavior:b})},this.getTotalSize=()=>{var a;let b,c=this.getMeasurements();if(0===c.length)b=this.options.paddingStart;else if(1===this.options.lanes)b=(null==(a=c[c.length-1])?void 0:a.end)??0;else{let a=Array(this.options.lanes).fill(null),d=c.length-1;for(;d>=0&&a.some(a=>null===a);){let b=c[d];null===a[b.lane]&&(a[b.lane]=b.end),d--}b=Math.max(...a.filter(a=>null!==a))}return Math.max(b-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(a,{adjustments:b,behavior:c})=>{this.options.scrollToFn(a,{behavior:c,adjustments:b},this)},this.measure=()=>{this.itemSizeCache=new Map,this.laneAssignments=new Map,this.notify(!1)},this.setOptions(a)}}let ao=(a,b,c,d)=>{for(;a<=b;){let e=(a+b)/2|0,f=c(e);if(f<d)a=e+1;else{if(!(f>d))return e;b=e-1}}return a>0?a-1:0},ap="undefined"!=typeof document?c.useLayoutEffect:c.useEffect,aq={konkurs:{keywords:["konkurs","konkursbeslut"],color:"text-red-600 dark:text-red-400",bgColor:"bg-red-100 dark:bg-red-900/30",borderColor:"border-l-red-500",gradientFrom:"from-red-500/10",label:"Konkurs",icon:(0,b.jsx)(o,{size:14,className:"inline mr-1"})},likvidation:{keywords:["likvidation","likvidator"],color:"text-orange-600 dark:text-orange-400",bgColor:"bg-orange-100 dark:bg-orange-900/30",borderColor:"border-l-orange-500",gradientFrom:"from-orange-500/10",label:"Likvidation",icon:(0,b.jsx)(j.AlertTriangle,{size:14,className:"inline mr-1"})},fusion:{keywords:["fusion","sammanslagning"],color:"text-purple-600 dark:text-purple-400",bgColor:"bg-purple-100 dark:bg-purple-900/30",borderColor:"border-l-purple-500",gradientFrom:"from-purple-500/10",label:"Fusion",icon:(0,b.jsx)(n,{size:14,className:"inline mr-1"})},emission:{keywords:["nyemission","fondemission","riktad emission"],color:"text-blue-600 dark:text-blue-400",bgColor:"bg-blue-100 dark:bg-blue-900/30",borderColor:"border-l-blue-500",gradientFrom:"from-blue-500/10",label:"Emission",icon:(0,b.jsx)(l.TrendingUp,{size:14,className:"inline mr-1"})},styrelse:{keywords:["styrelse","ledamot","ordförande","vd"],color:"text-green-600 dark:text-green-400",bgColor:"bg-green-100 dark:bg-green-900/30",borderColor:"border-l-green-500",gradientFrom:"from-green-500/10",label:"Styrelse",icon:(0,b.jsx)(k.Users,{size:14,className:"inline mr-1"})}},ar=[{label:"Idag",days:0},{label:"Senaste 24h",days:1},{label:"Denna vecka",days:7},{label:"Senaste månaden",days:30},{label:"Alla",days:-1}];function as(a){let b=`${a.type||""} ${a.detailText||""} ${a.subject||""}`.toLowerCase();for(let[a,c]of Object.entries(aq))if(c.keywords.some(a=>b.includes(a)))return a;return null}function at({isOpen:a,onClose:d,settings:e,onUpdateSettings:f}){let[g,h]=(0,c.useState)(e.categories||{konkurs:!0,likvidation:!0,fusion:!1,emission:!1,styrelse:!1});return a?(0,b.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,b.jsx)("div",{className:"absolute inset-0 bg-background/80 backdrop-blur-sm",onClick:d}),(0,b.jsxs)("div",{className:"relative bg-card border border-border rounded-2xl shadow-xl w-full max-w-md mx-4 p-6 animate-in fade-in zoom-in-95 duration-200",children:[(0,b.jsx)("button",{onClick:d,className:"absolute top-4 right-4 p-2 rounded-lg hover:bg-secondary transition-colors",children:(0,b.jsx)(v.X,{size:18})}),(0,b.jsx)("h2",{className:"text-lg font-semibold mb-1",children:"Notifikationsinställningar"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-6",children:"Välj vilka händelser du vill få notiser om"}),(0,b.jsxs)("div",{className:"flex items-center justify-between py-3 border-b border-border",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium",children:"Aktivera notiser"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Få push-notiser för bolagshändelser"})]}),(0,b.jsx)("button",{onClick:()=>f({enabled:!e.enabled}),className:`relative w-12 h-7 rounded-full transition-colors ${e.enabled?"bg-primary":"bg-secondary"}`,children:(0,b.jsx)("span",{className:`absolute top-1 w-5 h-5 rounded-full bg-white shadow transition-transform ${e.enabled?"translate-x-6":"translate-x-1"}`})})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between py-3 border-b border-border",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium",children:"Ljud"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Spela ljud vid nya händelser"})]}),(0,b.jsx)("button",{onClick:()=>f({soundEnabled:!e.soundEnabled}),className:`relative w-12 h-7 rounded-full transition-colors ${e.soundEnabled?"bg-primary":"bg-secondary"}`,disabled:!e.enabled,children:(0,b.jsx)("span",{className:`absolute top-1 w-5 h-5 rounded-full bg-white shadow transition-transform ${e.soundEnabled?"translate-x-6":"translate-x-1"}`})})]}),(0,b.jsxs)("div",{className:"mt-4",children:[(0,b.jsx)("p",{className:"text-sm font-medium mb-3",children:"Händelsekategorier"}),(0,b.jsx)("div",{className:"space-y-2",children:Object.entries(aq).map(([a,c])=>(0,b.jsxs)("label",{className:`flex items-center justify-between p-3 rounded-xl cursor-pointer transition-colors ${g[a]?c.bgColor:"bg-secondary/50 hover:bg-secondary"}`,children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("span",{className:`p-1.5 rounded-lg ${c.bgColor} ${c.color}`,children:c.icon}),(0,b.jsx)("span",{className:"font-medium",children:c.label})]}),(0,b.jsx)("input",{type:"checkbox",checked:g[a],onChange:()=>{let b;h(b={...g,[a]:!g[a]}),f({categories:b})},disabled:!e.enabled,className:"sr-only"}),(0,b.jsx)("div",{className:`w-5 h-5 rounded-md border-2 flex items-center justify-center transition-colors ${g[a]?"bg-primary border-primary text-primary-foreground":"border-muted-foreground/30"}`,children:g[a]&&(0,b.jsx)(s,{size:12})})]},a))})]}),(0,b.jsx)("button",{onClick:d,className:"w-full mt-6 py-2.5 bg-primary text-primary-foreground rounded-xl font-medium hover:bg-primary/90 transition-colors",children:"Spara"})]})]}):null}function au(){let a,{status:j}=(0,d.useSession)(),k=(0,e.useRouter)(),[l,m]=(0,c.useState)([]),[n,o]=(0,c.useState)([]),[z,A]=(0,c.useState)([]),[C,D]=(0,c.useState)(!0),[E,F]=(0,c.useState)(!1),[G,H]=(0,c.useState)(!1),[I,J]=(0,c.useState)(null),[K,L]=(0,c.useState)(null),[M,N]=(0,c.useState)(-1),[O,P]=(0,c.useState)(""),[Q,R]=(0,c.useState)(""),[S,T]=(0,c.useState)(!1),[U,ad]=(0,c.useState)(null),[ae,af]=(0,c.useState)(!0),ag=(0,c.useRef)(null),ah=(0,c.useRef)(null),[aj,al]=(0,c.useState)("connecting"),[ao,au]=(0,c.useState)(new Set),[av,aw]=(0,c.useState)(!1),[ax,ay]=(0,c.useState)(-1),[az,aA]=(0,c.useState)("standard"),{isRead:aB,markAsRead:aC,markAllAsRead:aD,unreadCount:aE}=function(){let[a,b]=(0,c.useState)(new Set);(0,c.useEffect)(()=>{try{let a=localStorage.getItem(Y);if(a){let c=JSON.parse(a);Array.isArray(c)&&b(new Set(c))}}catch(a){console.warn("Failed to load read status:",a)}},[]);let d=(0,c.useCallback)(a=>{try{let b=Array.from(a).slice(-1e3);localStorage.setItem(Y,JSON.stringify(b))}catch(a){console.warn("Failed to save read status:",a)}},[]),e=(0,c.useCallback)(b=>a.has(b),[a]),f=(0,c.useCallback)(a=>{b(b=>{if(b.has(a))return b;let c=new Set(b);return c.add(a),d(c),c})},[d]),g=(0,c.useCallback)(a=>{b(b=>{let c=new Set(b),e=!1;for(let b of a)c.has(b)||(c.add(b),e=!0);return e?(d(c),c):b})},[d]),h=(0,c.useCallback)(b=>b.filter(b=>!a.has(b)).length,[a]);return{readIds:a,isRead:e,markAsRead:f,markAllAsRead:g,unreadCount:h}}(),{permission:aF,settings:aG,isSupported:aH,requestPermission:aI,updateSettings:aJ,notify:aK,shouldNotify:aL}=function(){let[a,b]=(0,c.useState)("default"),[d,e]=(0,c.useState)($),[f,g]=(0,c.useState)(!1),[h,i]=(0,c.useState)(!1),j=(0,c.useRef)(null);(0,c.useEffect)(()=>{g(!1);try{let a=localStorage.getItem(Z);if(a){let b=JSON.parse(a);e({...$,...b})}}catch(a){console.warn("Failed to load notification settings:",a)}},[]);let k=(0,c.useCallback)(a=>{try{localStorage.setItem(Z,JSON.stringify(a))}catch(a){console.warn("Failed to save notification settings:",a)}},[]),l=(0,c.useCallback)(async()=>{if(!f)return!1;try{let a=await Notification.requestPermission();return b(a),"granted"===a&&console.log("[Notifications] Permission granted"),"granted"===a}catch(a){return console.error("Failed to request notification permission:",a),!1}},[f]),m=(0,c.useCallback)(a=>{e(b=>{let c={...b,...a};return k(c),c})},[k]),n=(0,c.useCallback)(a=>{if(!d.enabled||!a)return!1;let b=a.toLowerCase();return d.criticalOnly?_.includes(b):aa.includes(b)},[d]),o=(0,c.useCallback)(({title:b,body:c,category:e,url:g,icon:i})=>{if(!f||"granted"!==a||!d.enabled||e&&!n(e))return;let k=e&&_.includes(e.toLowerCase());if(h&&j.current?.active){j.current.active.postMessage({type:"SHOW_NOTIFICATION",title:b,body:c,url:g,critical:k}),d.soundEnabled&&ab();return}try{let a=new Notification(b,{body:c,icon:i||"/icon-192.png",badge:"/icon-192.png",tag:`loopdesk-${Date.now()}`,requireInteraction:k||!1});d.soundEnabled&&ab(),g&&(a.onclick=()=>{window.focus(),window.location.href=g,a.close()}),k||setTimeout(()=>a.close(),1e4)}catch(a){console.error("Failed to show notification:",a)}},[f,a,d,n,h]),p=(0,c.useCallback)(()=>{h&&j.current?.active?j.current.active.postMessage({type:"TEST_NOTIFICATION"}):"granted"===a&&new Notification("LoopDesk Test",{body:"Push-notiser fungerar!",icon:"/icon-192.png"})},[h,a]);return{permission:a,settings:d,isSupported:f,serviceWorkerReady:h,requestPermission:l,updateSettings:m,notify:o,shouldNotify:n,testNotification:p}}();(0,c.useEffect)(()=>{"unauthenticated"===j&&k.push("/login?callbackUrl=/bolaghandelser")},[j,k]);let aM=(0,c.useCallback)(async(a=!1)=>{a&&F(!0);try{let[a,b]=await Promise.all([fetch("/api/kungorelser?limit=20"),fetch("/api/protocols?limit=100")]);if(a.ok){let b=await a.json();m(b.announcements||[]),ad(b.nextCursor||null),af(b.hasMore??!1)}if(b.ok){let a=await b.json();console.log("[bolaghandelser] Protocols API response:",{protocolsCount:a.protocols?.length,protocolSearchesCount:a.protocolSearches?.length,firstProtocolSearch:a.protocolSearches?.[0]}),o(a.protocols||[]),A(a.protocolSearches||[])}else console.error("[bolaghandelser] Protocols API failed:",b.status,await b.text());J(new Date)}catch(a){console.error("Failed to load data:",a)}finally{D(!1),F(!1)}},[]),aN=(0,c.useCallback)(async()=>{if(!G&&ae&&U){H(!0);try{let a=await fetch(`/api/kungorelser?limit=20&cursor=${U}`);if(a.ok){let b=await a.json();m(a=>[...a,...b.announcements||[]]),ad(b.nextCursor||null),af(b.hasMore??!1)}}catch(a){console.error("Failed to load more announcements:",a)}finally{H(!1)}}},[G,ae,U]);(0,c.useEffect)(()=>{"authenticated"===j&&aM()},[j,aM]),(0,c.useEffect)(()=>{if("authenticated"!==j||Q||"connected"===aj)return;let a=setInterval(()=>aM(),3e4);return()=>clearInterval(a)},[j,aM,Q,aj]),(0,c.useEffect)(()=>{let a=setTimeout(()=>{R(O)},300);return()=>clearTimeout(a)},[O]),(0,c.useEffect)(()=>{"authenticated"===j&&a();async function a(){if(!Q)return void aM();T(!0);try{let a=await fetch(`/api/kungorelser?query=${encodeURIComponent(Q)}&limit=100`);if(a.ok){let b=await a.json();m(b.announcements||[]),ad(null),af(!1)}}catch(a){console.error("Search failed:",a)}finally{T(!1)}}},[Q,j,aM]),(0,c.useEffect)(()=>{let a=new IntersectionObserver(a=>{a[0].isIntersecting&&ae&&!G&&aN()},{threshold:.1});return ag.current&&a.observe(ag.current),()=>a.disconnect()},[ae,G,aN]),(0,c.useEffect)(()=>{let a=null,b=null,c=null;return async function(){(c=await (0,X.getSupabaseClient)())?(a=c.channel("announcements-realtime").on("postgres_changes",{event:"INSERT",schema:"public",table:"Announcement"},a=>{let b=a.new;m(a=>a.some(a=>a.id===b.id)?a:[b,...a]),au(a=>new Set(a).add(b.id)),setTimeout(()=>{au(a=>{let c=new Set(a);return c.delete(b.id),c})},5e3);let c=function(a){let b=a.toLowerCase();for(let[a,c]of Object.entries({konkurs:["konkurs","konkursbeslut","konkursförfarande"],likvidation:["likvidation","likvidator","upplösning"],fusion:["fusion","sammanslagning","delning"],emission:["nyemission","fondemission","riktad emission","aktiekapital"],styrelse:["styrelse","ledamot","ordförande","vd","verkställande direktör"]}))if(c.some(a=>b.includes(a)))return a;return null}(`${b.type||""} ${b.detailText||""}`);if(aL(c)){let a=b.subject||"Okänt bolag";aK({title:"konkurs"===c?`Konkurs: ${a}`:`${c?.charAt(0).toUpperCase()}${c?.slice(1)}: ${a}`,body:b.detailText?.slice(0,100)||"Ny bolagshändelse",category:c,url:"/bolaghandelser"})}}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"Announcement"},a=>{let b=a.new;m(a=>a.map(a=>a.id===b.id?b:a))}).subscribe(a=>{"SUBSCRIBED"===a?al("connected"):("CHANNEL_ERROR"===a||"TIMED_OUT"===a)&&al("error")}),b=c.channel("protocols-realtime").on("postgres_changes",{event:"INSERT",schema:"public",table:"ProtocolPurchase"},a=>{let b=a.new;if(o(a=>a.some(a=>a.id===b.id)?a:[b,...a]),(b.aiDetails?.score||0)>=7&&aG.enabled){let a=b.companyName||"Okänt bolag",c=b.eventType||"Protokoll";aK({title:`${c}: ${a}`,body:b.aiDetails?.notis?.sammanfattning||"Nytt intressant protokoll",category:"protokoll",url:"/bolaghandelser"})}}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"ProtocolPurchase"},a=>{let b=a.new;o(a=>a.map(a=>a.id===b.id?b:a))}).subscribe()):al("error")}(),()=>{a&&c&&c.removeChannel(a),b&&c&&c.removeChannel(b)}},[aK,aL,aG.enabled]);let aO=(0,c.useMemo)(()=>(function(a,b,c=[]){let d=[];for(let b of a){let a=b.publishedAt||b.pubDate;a&&d.push({type:"announcement",data:b,date:new Date(a)})}for(let a of b)d.push({type:"protocol",data:a,date:new Date(a.protocolDate)});for(let a of c)a.latestProtocolDate&&d.push({type:"protocolSearch",data:a,date:new Date(a.latestProtocolDate)});return d.sort((a,b)=>b.date.getTime()-a.date.getTime()),d})(l,n,z),[l,n,z]),aP=(0,c.useMemo)(()=>aO.map(a=>"announcement"===a.type?`a-${a.data.id}`:`p-${a.data.id}`),[aO]),aQ=(0,c.useMemo)(()=>aE(aP),[aE,aP]),aR=(0,c.useMemo)(()=>{if(-1===M)return null;let a=new Date;return 0===M?a.setHours(0,0,0,0):a.setDate(a.getDate()-M),a},[M]),aS=(0,c.useMemo)(()=>aO.filter(a=>{if(aR&&a.date<aR)return!1;if("announcement"===a.type){let b=a.data;if(K&&("protokoll"===K||as(b)!==K))return!1}else if("protocol"===a.type){let b=a.data;if(K&&"protokoll"!==K)return!1;if("protokoll"===K)return!0;if(Q){let a=Q.toLowerCase();if(!`${b.companyName||""} ${b.orgNumber||""} ${b.aiSummary||""}`.toLowerCase().includes(a))return!1}}else if("protocolSearch"===a.type){let b=a.data;if(K&&"protokoll"!==K)return!1;if("protokoll"===K)return!0;if(Q){let a=Q.toLowerCase();if(!`${b.companyName||""} ${b.orgNumber||""}`.toLowerCase().includes(a))return!1}}return!0}),[aO,K,Q,aR]),aT=(0,c.useMemo)(()=>(function(a){let b=new Date,c=b.toDateString(),d=new Date(b);d.setDate(d.getDate()-1);let e=d.toDateString(),f=new Date(b);f.setDate(f.getDate()-7);let g=new Map;for(let d of a){let a,h,i=d.date.toDateString();if(i===c)a="Idag",h=0;else if(i===e)a="Igår",h=1;else if(d.date>f)a="Denna vecka",h=2;else{let c=d.date.toLocaleDateString("sv-SE",{month:"long",year:"numeric"});a=c.charAt(0).toUpperCase()+c.slice(1),h=100-Math.floor((b.getTime()-d.date.getTime())/2592e6)}g.has(a)||g.set(a,{label:a,items:[],sortKey:h}),g.get(a).items.push(d)}return Array.from(g.values()).sort((a,b)=>a.sortKey-b.sortKey).map(({label:a,items:b})=>({label:a,items:b}))})(aS),[aS]),aU=(0,c.useMemo)(()=>{let a=[];for(let b of aT)for(let c of(a.push({type:"header",label:b.label,count:b.items.length}),b.items))a.push({type:"event",item:c});return a},[aT]),aV=function({useFlushSync:a=!0,...b}){let d=c.useReducer(()=>({}),{})[1],e={...b,onChange:(c,e)=>{var f;a&&e?(0,ac.flushSync)(d):d(),null==(f=b.onChange)||f.call(b,c,e)}},[f]=c.useState(()=>new an(e));return f.setOptions(e),ap(()=>f._didMount(),[]),ap(()=>f._willUpdate()),f}({observeElementRect:ai,observeElementOffset:ak,scrollToFn:am,...{count:aU.length,getScrollElement:()=>ah.current,estimateSize:a=>{let b=aU[a];return b?.type==="header"?40:120},overscan:5}}),aW=(0,c.useMemo)(()=>{let a=new Map;for(let b of aO){let c,d,e=null;"announcement"===b.type?(c=b.data.orgNumber?.replace(/\D/g,""),d=b.data.subject||"Kungörelse"):"protocol"===b.type?(c=b.data.orgNumber?.replace(/\D/g,""),d=b.data.aiDetails?.notis?.titel||b.data.companyName||"Protokoll",e=b.data.eventType):(c=b.data.orgNumber?.replace(/\D/g,""),d=`Protokoll fr\xe5n ${b.data.companyName||"bolag"}`),c&&(a.has(c)||a.set(c,[]),a.get(c).push({id:b.data.id,type:b.type,title:d,date:b.date,eventType:e}))}return a},[aO]),aX=(0,c.useCallback)(a=>{let b;if("announcement"===a.type||a.type,!(b=a.data.orgNumber?.replace(/\D/g,"")))return;let c=aW.get(b);if(c&&!(c.length<=1))return c},[aW]),aY=(0,c.useMemo)(()=>Object.keys(aq).reduce((a,b)=>(a[b]=l.filter(a=>as(a)===b).length,a),{}),[l]),aZ=n.length+z.length;return((0,c.useEffect)(()=>{let a=a=>{if(a.target instanceof HTMLInputElement||a.target instanceof HTMLTextAreaElement)return;let b=aS.length;if(0!==b)switch(a.key){case"ArrowDown":case"j":a.preventDefault(),ay(a=>{let c=a<b-1?a+1:a,d=document.querySelector(`[data-event-index="${c}"]`);return d?.scrollIntoView({behavior:"smooth",block:"nearest"}),c});break;case"ArrowUp":case"k":a.preventDefault(),ay(a=>{let b=a>0?a-1:0,c=document.querySelector(`[data-event-index="${b}"]`);return c?.scrollIntoView({behavior:"smooth",block:"nearest"}),b});break;case"Enter":case"o":if(ax>=0&&ax<b){a.preventDefault();let b=document.querySelector(`[data-event-index="${ax}"]`);b instanceof HTMLElement&&b.click()}break;case"r":if(ax>=0&&ax<b){a.preventDefault();let b=aS[ax];aC("announcement"===b.type?`a-${b.data.id}`:"protocol"===b.type?`p-${b.data.id}`:`ps-${b.data.id}`)}break;case"Escape":a.preventDefault(),ay(-1);break;case"Home":a.preventDefault(),ay(0),document.querySelector('[data-event-index="0"]')?.scrollIntoView({behavior:"smooth",block:"start"});break;case"End":a.preventDefault(),ay(b-1),document.querySelector(`[data-event-index="${b-1}"]`)?.scrollIntoView({behavior:"smooth",block:"end"})}};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[aS,ax,aC]),"loading"===j)?(0,b.jsx)("main",{className:"min-h-screen bg-background flex items-center justify-center",children:(0,b.jsx)("div",{className:"text-muted-foreground",children:"Laddar..."})}):"unauthenticated"===j?null:(0,b.jsx)(B,{children:(0,b.jsxs)("main",{className:"min-h-screen bg-background",children:[(0,b.jsxs)("div",{className:"max-w-2xl mx-auto px-6 py-10 sm:py-14",children:[(0,b.jsxs)("header",{className:"mb-10 sm:mb-14",children:[(0,b.jsx)("span",{className:"block mb-3 text-[11px] font-semibold tracking-[0.15em] uppercase text-rose-500",children:"Bolagshändelser"}),(0,b.jsx)("h1",{className:"font-serif text-3xl sm:text-4xl md:text-[42px] font-normal tracking-tight leading-[1.08] text-foreground",children:"Senaste händelserna"}),(0,b.jsx)("p",{className:"mt-4 text-lg sm:text-xl font-serif italic text-muted-foreground leading-relaxed",children:"Konkurser, emissioner och styrelsebeslut – samlade på ett ställe."}),(0,b.jsxs)("div",{className:"mt-6 flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsxs)("span",{className:`inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium ${"connected"===aj?"bg-emerald-50 text-emerald-600 dark:bg-emerald-950/40 dark:text-emerald-400":"error"===aj?"bg-rose-50 text-rose-600 dark:bg-rose-950/40 dark:text-rose-400":"bg-amber-50 text-amber-600 dark:bg-amber-950/40 dark:text-amber-400"}`,title:"connected"===aj?"Uppdateras i realtid":"error"===aj?"Realtidsanslutning misslyckades":"Ansluter...",children:[(0,b.jsx)(p,{size:10,className:`${"connected"===aj?"motion-safe:animate-pulse":""}`}),"connected"===aj?"Live":"error"===aj?"Offline":"..."]}),aQ>0&&(0,b.jsxs)("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium bg-rose-500 text-white",children:[aQ," olästa"]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[aQ>0&&(0,b.jsxs)("button",{onClick:()=>aD(aP),className:"hidden sm:flex items-center gap-1.5 px-3 py-1.5 text-xs text-muted-foreground hover:text-foreground hover:bg-secondary/80 rounded-xl transition-all duration-200",title:"Markera alla som lästa",children:[(0,b.jsx)(s,{size:14}),(0,b.jsx)("span",{children:"Markera lästa"})]}),aH&&(0,b.jsx)("button",{onClick:()=>{"granted"!==aF?aI().then(a=>{a&&aw(!0)}):aw(!0)},className:`p-2.5 rounded-xl transition-all duration-200 ${"granted"===aF&&aG.enabled?"text-rose-500 bg-rose-50 dark:bg-rose-950/30 hover:bg-rose-100 dark:hover:bg-rose-900/40":"text-muted-foreground hover:bg-secondary/80"}`,title:"Notifikationsinställningar",children:"granted"===aF&&aG.enabled?(0,b.jsx)(q.Bell,{size:18}):(0,b.jsx)(r,{size:18})}),(0,b.jsxs)("div",{className:"hidden sm:flex items-center border border-border/50 rounded-xl overflow-hidden",children:[(0,b.jsx)("button",{onClick:()=>aA("compact"),className:`p-2 transition-all duration-200 ${"compact"===az?"bg-foreground text-background":"text-muted-foreground hover:text-foreground hover:bg-secondary/60"}`,title:"Kompakt vy",children:(0,b.jsx)(w.LayoutList,{size:16})}),(0,b.jsx)("button",{onClick:()=>aA("standard"),className:`p-2 transition-all duration-200 ${"standard"===az?"bg-foreground text-background":"text-muted-foreground hover:text-foreground hover:bg-secondary/60"}`,title:"Standard vy",children:(0,b.jsx)(x,{size:16})}),(0,b.jsx)("button",{onClick:()=>aA("media"),className:`p-2 transition-all duration-200 ${"media"===az?"bg-foreground text-background":"text-muted-foreground hover:text-foreground hover:bg-secondary/60"}`,title:"Media vy",children:(0,b.jsx)(y.default,{size:16})})]}),(0,b.jsx)("button",{onClick:()=>aM(!0),disabled:E,className:"p-2.5 hover:bg-secondary/80 rounded-xl transition-all duration-200",title:"Uppdatera",children:(0,b.jsx)(g.RefreshCw,{size:18,className:E?"animate-spin":""})})]})]})]}),(0,b.jsxs)("div",{className:"relative mb-8",children:[(0,b.jsx)("input",{type:"text",value:O,onChange:a=>P(a.target.value),placeholder:"Sök bland händelser...",className:"w-full py-4 px-5 pr-12 text-base bg-secondary/40 border-0 rounded-2xl placeholder:text-muted-foreground/50 focus:ring-2 focus:ring-rose-500/20 focus:bg-background focus:outline-none transition-all duration-200"}),(0,b.jsx)("div",{className:"absolute right-5 top-1/2 -translate-y-1/2 text-muted-foreground/40",children:S?(0,b.jsx)(h.Loader2,{size:20,className:"animate-spin"}):(0,b.jsx)(t.Search,{size:20})})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-4 overflow-x-auto scrollbar-hide pb-1 -mx-6 px-6",children:[(0,b.jsx)(u.Calendar,{size:14,className:"text-muted-foreground/60 flex-shrink-0"}),ar.map(a=>(0,b.jsx)("button",{onClick:()=>N(a.days),className:`px-3.5 py-2 rounded-xl text-xs font-medium whitespace-nowrap transition-all duration-200 flex-shrink-0 ${M===a.days?"bg-foreground text-background shadow-sm":"bg-secondary/50 text-muted-foreground hover:text-foreground hover:bg-secondary"}`,children:a.label},a.days))]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-8 text-sm overflow-x-auto scrollbar-hide pb-1 -mx-6 px-6 snap-x snap-mandatory",children:[(0,b.jsxs)("div",{className:"px-3.5 py-2 bg-secondary/50 rounded-xl flex-shrink-0 snap-start flex items-center",children:[(0,b.jsx)("span",{className:"font-medium",children:aS.length}),(0,b.jsx)("span",{className:"text-muted-foreground ml-1.5 hidden sm:inline",children:"händelser"})]}),aZ>0&&(0,b.jsxs)("button",{className:`px-3.5 py-2 rounded-xl transition-all duration-200 flex-shrink-0 snap-start flex items-center gap-1.5 ${"protokoll"===K?"bg-rose-500 text-white shadow-sm":"bg-rose-50 dark:bg-rose-950/30 text-rose-600 dark:text-rose-400 hover:bg-rose-100 dark:hover:bg-rose-900/40"}`,onClick:()=>L("protokoll"===K?null:"protokoll"),children:[(0,b.jsx)(i.FileText,{size:14}),(0,b.jsx)("span",{className:"font-medium",children:aZ})]}),Object.entries(aY).filter(([,a])=>a>0).map(([a,c])=>(0,b.jsxs)("button",{className:`px-3.5 py-2 rounded-xl transition-all duration-200 flex-shrink-0 snap-start flex items-center gap-1.5 ${K===a?"bg-rose-500 text-white shadow-sm":"bg-rose-50 dark:bg-rose-950/30 text-rose-600 dark:text-rose-400 hover:bg-rose-100 dark:hover:bg-rose-900/40"}`,onClick:()=>L(K===a?null:a),children:[(0,b.jsx)("span",{className:"[&>svg]:w-3.5 [&>svg]:h-3.5",children:aq[a].icon}),(0,b.jsx)("span",{className:"font-medium",children:c})]},a)),(K||-1!==M)&&(0,b.jsxs)("button",{onClick:()=>{L(null),N(-1)},className:"px-3.5 py-2 bg-secondary/50 hover:bg-secondary rounded-xl text-xs font-medium flex items-center gap-1.5 flex-shrink-0 transition-all duration-200",children:[(0,b.jsx)(v.X,{size:14}),(0,b.jsx)("span",{className:"hidden sm:inline",children:"Rensa filter"})]})]}),C?(0,b.jsx)("div",{className:"flex flex-col gap-6",children:Array.from({length:4}).map((a,c)=>(0,b.jsxs)("div",{className:"bg-card rounded-2xl border p-6 space-y-4 animate-in fade-in duration-300",style:{animationDelay:`${100*c}ms`},children:[(0,b.jsxs)("div",{className:"flex items-start gap-4",children:[(0,b.jsx)(W.Skeleton,{shimmer:!0,className:"w-16 h-16 rounded-lg flex-shrink-0"}),(0,b.jsxs)("div",{className:"flex-1 space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(W.Skeleton,{shimmer:!0,className:"h-5 w-24"}),(0,b.jsx)(W.Skeleton,{shimmer:!0,className:"h-4 w-20"})]}),(0,b.jsx)(W.Skeleton,{shimmer:!0,className:"h-6 w-full"}),(0,b.jsx)(W.Skeleton,{shimmer:!0,className:"h-6 w-4/5"})]})]}),(0,b.jsx)(W.Skeleton,{shimmer:!0,className:"h-16 w-full"})]},c))}):0===aT.length?(0,b.jsxs)("div",{className:"text-center py-12 text-muted-foreground",children:[(0,b.jsx)(f.Building2,{size:48,className:"mx-auto mb-4 opacity-50"}),(0,b.jsx)("p",{className:"font-medium",children:Q?`Inga tr\xe4ffar f\xf6r "${Q}"`:"Inga händelser än"}),(0,b.jsx)("p",{className:"text-sm mt-1",children:Q?"Försök med ett annat sökord eller töm sökningen":K||-1!==M?"Inga händelser matchar valda filter":"Händelser från mac-appen visas här automatiskt"})]}):aU.length<50?(0,b.jsxs)("div",{className:"flex flex-col",children:[(a=0,aT.map(c=>(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-baseline gap-4 pt-10 pb-5 first:pt-0",children:[(0,b.jsx)("span",{className:"text-xs font-semibold tracking-[0.12em] uppercase text-rose-500",children:c.label}),(0,b.jsxs)("span",{className:"text-sm text-muted-foreground/50",children:[c.items.length," händelse",1!==c.items.length&&"r"]})]}),(0,b.jsx)("div",{className:"flex flex-col divide-y divide-border/30",children:c.items.map(c=>{let d=a++,e="announcement"===c.type?`a-${c.data.id}`:"protocol"===c.type?`p-${c.data.id}`:`ps-${c.data.id}`;return(0,b.jsx)("div",{"data-event-index":d,children:(0,b.jsx)(V,{event:"announcement"===c.type?{type:"announcement",data:c.data}:"protocol"===c.type?{type:"protocol",data:c.data}:{type:"protocolSearch",data:c.data},date:c.date,showGradientLine:!0,isUnread:!aB(e),onMarkAsRead:()=>aC(e),relatedEvents:aX(c),searchQuery:Q,isFocused:ax===d,layout:az})},e)})})]},c.label))),(0,b.jsxs)("div",{ref:ag,className:"py-8 flex justify-center",children:[G&&(0,b.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:[(0,b.jsx)(h.Loader2,{size:16,className:"animate-spin"}),(0,b.jsx)("span",{className:"text-sm",children:"Laddar fler händelser..."})]}),!ae&&aO.length>0&&(0,b.jsxs)("span",{className:"text-sm text-muted-foreground",children:["Alla ",aO.length," händelser laddade"]})]})]}):(0,b.jsxs)("div",{ref:ah,className:"h-[calc(100vh-300px)] overflow-auto",style:{contain:"strict"},children:[(0,b.jsx)("div",{style:{height:`${aV.getTotalSize()}px`,width:"100%",position:"relative"},children:aV.getVirtualItems().map(a=>{let c=aU[a.index];if("header"===c.type)return(0,b.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:`${a.size}px`,transform:`translateY(${a.start}px)`},children:(0,b.jsxs)("div",{className:"flex items-center gap-4 py-2",children:[(0,b.jsx)("span",{className:"font-mono text-[11px] font-semibold uppercase tracking-widest text-muted-foreground",children:c.label}),(0,b.jsxs)("span",{className:"text-[10px] text-muted-foreground/60",children:[c.count," ",1===c.count?"händelse":"händelser"]}),(0,b.jsx)("div",{className:"flex-1 h-px bg-gradient-to-r from-border to-transparent"})]})},a.key);let d=c.item,e="announcement"===d.type?`a-${d.data.id}`:"protocol"===d.type?`p-${d.data.id}`:`ps-${d.data.id}`;return(0,b.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:`${a.size}px`,transform:`translateY(${a.start}px)`},children:(0,b.jsx)(V,{event:"announcement"===d.type?{type:"announcement",data:d.data}:"protocol"===d.type?{type:"protocol",data:d.data}:{type:"protocolSearch",data:d.data},date:d.date,showGradientLine:!0,isUnread:!aB(e),onMarkAsRead:()=>aC(e),relatedEvents:aX(d),searchQuery:Q,layout:az})},a.key)})}),(0,b.jsxs)("div",{ref:ag,className:"py-8 flex justify-center",children:[G&&(0,b.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:[(0,b.jsx)(h.Loader2,{size:16,className:"animate-spin"}),(0,b.jsx)("span",{className:"text-sm",children:"Laddar fler händelser..."})]}),!ae&&aO.length>0&&(0,b.jsxs)("span",{className:"text-sm text-muted-foreground",children:["Alla ",aO.length," händelser laddade"]})]})]})]}),(0,b.jsx)(at,{isOpen:av,onClose:()=>aw(!1),settings:aG,onUpdateSettings:aJ})]})})}a.s(["default",()=>au],817646)}];

//# debugId=df0ebb20-3e63-53a7-37be-a8b7d7378001
//# sourceMappingURL=CLAUDE_projects_LoopDesk_src_app_bolaghandelser_page_tsx_85b96c37._.js.map