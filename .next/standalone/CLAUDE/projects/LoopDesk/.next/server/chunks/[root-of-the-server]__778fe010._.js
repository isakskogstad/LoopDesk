;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="eda22412-c290-796b-e1bd-b3de6ed3c841")}catch(e){}}();
module.exports=[918622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},556704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},832319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},324725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},120635,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},130101,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a={ActionDidNotRevalidate:function(){return n},ActionDidRevalidateDynamicOnly:function(){return i},ActionDidRevalidateStaticAndDynamic:function(){return s}};for(var o in a)Object.defineProperty(r,o,{enumerable:!0,get:a[o]});let n=0,s=1,i=2},193695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},219985,(e,t,r)=>{"use strict";t.exports=e.r(918622)},666870,(e,t,r)=>{"use strict";t.exports=e.r(219985).vendored["react-rsc"].React},179475,(e,t,r)=>{t.exports=e.x("@prisma/client-935491d6e3ada45d",()=>require("@prisma/client-935491d6e3ada45d"))},109357,e=>e.a(async(t,r)=>{try{let t=await e.y("pg-3f7efcb9b626a319");e.n(t),r()}catch(e){r(e)}},!0),254799,(e,t,r)=>{t.exports=e.x("crypto",()=>require("crypto"))},720034,e=>e.a(async(t,r)=>{try{var a=e.i(528227),o=t([a]);[a]=o.then?(await o)():o;let c=new Map;async function n(e){let t=function(e){let t=Date.now(),r=e.toLowerCase(),a=c.get(r);if(!a||t-a.windowStart>6e4)return c.set(r,{attempts:1,windowStart:t}),{allowed:!0};if(a.attempts>=5){let e=Math.ceil((a.windowStart+6e4-t)/1e3);return{allowed:!1,retryAfterSeconds:e}}return a.attempts++,{allowed:!0}}(e);if(!t.allowed)return{allowed:!1,error:"RATE_LIMITED",retryAfterSeconds:t.retryAfterSeconds};try{let t=await a.prisma.user.findUnique({where:{email:e.toLowerCase()},select:{id:!0,failedLoginAttempts:!0,lockedUntil:!0}});if(!t)return{allowed:!0};if(t.lockedUntil&&new Date(t.lockedUntil)>new Date){let e=Math.ceil((new Date(t.lockedUntil).getTime()-Date.now())/6e4);return{allowed:!1,error:"ACCOUNT_LOCKED",lockoutMinutes:e}}t.lockedUntil&&new Date(t.lockedUntil)<=new Date&&await a.prisma.user.update({where:{id:t.id},data:{failedLoginAttempts:0,lockedUntil:null}});let r=10-(t.failedLoginAttempts||0);return{allowed:!0,remainingAttempts:r}}catch(e){return console.error("[RateLimit] Error checking login attempt:",e),{allowed:!0}}}async function s(e){try{let t=await a.prisma.user.findUnique({where:{email:e.toLowerCase()},select:{id:!0,failedLoginAttempts:!0}});if(!t)return{allowed:!1,error:"ACCOUNT_NOT_FOUND"};let r=(t.failedLoginAttempts||0)+1,o=r>=10;if(await a.prisma.user.update({where:{id:t.id},data:{failedLoginAttempts:r,lockedUntil:o?new Date(Date.now()+9e5):null}}),o)return{allowed:!1,error:"ACCOUNT_LOCKED",lockoutMinutes:15};return{allowed:!1,error:"INVALID_CREDENTIALS",remainingAttempts:10-r}}catch(e){return console.error("[RateLimit] Error recording failed attempt:",e),{allowed:!1,error:"INVALID_CREDENTIALS"}}}async function i(e){c.delete(e.toLowerCase());try{await a.prisma.user.update({where:{email:e.toLowerCase()},data:{failedLoginAttempts:0,lockedUntil:null,lastLoginAt:new Date}})}catch(e){console.error("[RateLimit] Error recording successful login:",e)}}function l(e,t){switch(e){case"RATE_LIMITED":return`F\xf6r m\xe5nga f\xf6rs\xf6k. V\xe4nta ${t?.retryAfterSeconds||60} sekunder.`;case"ACCOUNT_LOCKED":return`Kontot \xe4r l\xe5st i ${t?.lockoutMinutes||15} minuter pga f\xf6r m\xe5nga misslyckade f\xf6rs\xf6k.`;case"ACCOUNT_NOT_FOUND":return"Inget konto hittades med denna e-postadress.";case"INVALID_CREDENTIALS":if(t?.remainingAttempts!==void 0&&t.remainingAttempts<=3)return`Fel l\xf6senord. ${t.remainingAttempts} f\xf6rs\xf6k kvar innan kontot l\xe5ses.`;return"Fel e-postadress eller lösenord.";default:return"Något gick fel. Försök igen."}}e.s(["checkLoginAttempt",()=>n,"getErrorMessage",()=>l,"recordFailedAttempt",()=>s,"recordSuccessfulLogin",()=>i]),r()}catch(e){r(e)}},!1),897025,e=>{"use strict";async function t(r={}){let a,{prisma:o}=await e.A(103243),n=r.limit||50,s={};s.latestProtocolDate={not:null},r.query&&(s.OR=[{companyName:{contains:r.query,mode:"insensitive"}},{orgNumber:{contains:r.query}}]),(r.fromDate||r.toDate)&&(s.latestProtocolDate={...s.latestProtocolDate},r.fromDate&&(s.latestProtocolDate.gte=r.fromDate),r.toDate&&(s.latestProtocolDate.lte=r.toDate)),r.cursor&&(a={id:parseInt(r.cursor,10)});let[i,l]=await Promise.all([o.protocolSearch.findMany({where:s,orderBy:{latestProtocolDate:"desc"},take:n+1,cursor:a,skip:+!!a,select:{id:!0,orgNumber:!0,companyName:!0,companyId:!0,latestProtocolDate:!0,protocolCount:!0,lastSearch:!0,createdAt:!0}}),o.protocolSearch.count({where:s})]),c=i.length>n,d=c?i.slice(0,n):i,u=c?String(d[d.length-1].id):null;return{protocolSearches:d.map(e=>({...e,protocolCount:e.protocolCount?Number(e.protocolCount):0})),total:l,nextCursor:u,hasMore:c}}async function r(t={}){let a,{prisma:o}=await e.A(103243),n=t.limit||50,s={};t.query&&(s.OR=[{companyName:{contains:t.query,mode:"insensitive"}},{orgNumber:{contains:t.query}},{aiSummary:{contains:t.query,mode:"insensitive"}}]),(t.fromDate||t.toDate)&&(s.protocolDate={},t.fromDate&&(s.protocolDate.gte=t.fromDate),t.toDate&&(s.protocolDate.lte=t.toDate)),t.cursor&&(a={id:parseInt(t.cursor,10)});let[i,l]=await Promise.all([o.protocolPurchase.findMany({where:s,orderBy:{protocolDate:"desc"},take:n+1,cursor:a,skip:+!!a,select:{id:!0,orgNumber:!0,companyName:!0,protocolDate:!0,purchaseDate:!0,pdfUrl:!0,eventType:!0,aiSummary:!0,aiDetails:!0}}),o.protocolPurchase.count({where:s})]),c=i.length>n,d=c?i.slice(0,n):i,u=c?String(d[d.length-1].id):null;return{protocols:d.map(e=>({...e,aiDetails:e.aiDetails})),total:l,nextCursor:u,hasMore:c}}e.s(["getProtocolPurchases",()=>r,"getProtocolSearches",()=>t])},517162,e=>e.a(async(t,r)=>{try{var a=e.i(985917),o=e.i(46092),n=e.i(897025),s=t([o]);async function i(e){try{let t=await (0,o.auth)();if(!t?.user?.id)return a.NextResponse.json({error:"Unauthorized"},{status:401});let r=e.nextUrl.searchParams,s={query:r.get("query")||void 0,fromDate:r.get("fromDate")?new Date(r.get("fromDate")):void 0,toDate:r.get("toDate")?new Date(r.get("toDate")):void 0,limit:r.get("limit")?parseInt(r.get("limit"),10):50,cursor:r.get("cursor")||void 0},[i,l]=await Promise.all([(0,n.getProtocolPurchases)(s),(0,n.getProtocolSearches)(s)]);return a.NextResponse.json({protocols:i.protocols,protocolSearches:l.protocolSearches,total:i.total+l.total,nextCursor:i.nextCursor||l.nextCursor,hasMore:i.hasMore||l.hasMore,filter:s})}catch(e){return console.error("Error fetching protocols:",e),a.NextResponse.json({error:"Failed to fetch protocols"},{status:500})}}[o]=s.then?(await s)():s,e.s(["GET",()=>i]),r()}catch(e){r(e)}},!1),472993,e=>e.a(async(t,r)=>{try{var a=e.i(4345),o=e.i(886530),n=e.i(368549),s=e.i(437313),i=e.i(476054),l=e.i(905303),c=e.i(581143),d=e.i(175398),u=e.i(288930),p=e.i(521605),m=e.i(831917),f=e.i(571367),h=e.i(448720),g=e.i(615849),w=e.i(955298),x=e.i(193695);e.i(952391);var y=e.i(541372),D=e.i(517162),v=t([D]);[D]=v.then?(await v)():v;let C=new a.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/protocols/route",pathname:"/api/protocols",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/CLAUDE/projects/LoopDesk/src/app/api/protocols/route.ts",nextConfigOutput:"standalone",userland:D}),{workAsyncStorage:E,workUnitAsyncStorage:N,serverHooks:k}=C;function R(){return(0,n.patchFetch)({workAsyncStorage:E,workUnitAsyncStorage:N})}async function A(e,t,r){C.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let a="/api/protocols/route";a=a.replace(/\/index$/,"")||"/";let n=await C.prepare(e,t,{srcPage:a,multiZoneDraftMode:!1});if(!n)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:D,params:v,nextConfig:R,parsedUrl:A,isDraftMode:E,prerenderManifest:N,routerServerContext:k,isOnDemandRevalidate:P,revalidateOnlyGenerated:S,resolvedPathname:T,clientReferenceManifest:O,serverActionsManifest:U}=n,b=(0,c.normalizeAppPath)(a),L=!!(N.dynamicRoutes[b]||N.routes[T]),_=async()=>((null==k?void 0:k.render404)?await k.render404(e,t,A,!1):t.end("This page could not be found"),null);if(L&&!E){let e=!!N.routes[T],t=N.dynamicRoutes[b];if(t&&!1===t.fallback&&!e){if(R.experimental.adapterPath)return await _();throw new x.NoFallbackError}}let q=null;!L||C.isDev||E||(q=T,q="/index"===q?"/":q);let I=!0===C.isDev||!L,M=L&&!I;U&&O&&(0,l.setManifestsSingleton)({page:a,clientReferenceManifest:O,serverActionsManifest:U});let j=e.method||"GET",H=(0,i.getTracer)(),F=H.getActiveScopeSpan(),K={params:v,prerenderManifest:N,renderOpts:{experimental:{authInterrupts:!!R.experimental.authInterrupts},cacheComponents:!!R.cacheComponents,supportsDynamicResponse:I,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:R.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a,o)=>C.onRequestError(e,t,a,o,k)},sharedContext:{buildId:D}},$=new d.NodeNextRequest(e),B=new d.NodeNextResponse(t),V=u.NextRequestAdapter.fromNodeNextRequest($,(0,u.signalFromNodeResponse)(t));try{let n=async e=>C.handle(V,K).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=H.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let o=r.get("next.route");if(o){let t=`${j} ${o}`;e.setAttributes({"next.route":o,"http.route":o,"next.span_name":t}),e.updateName(t)}else e.updateName(`${j} ${a}`)}),l=!!(0,s.getRequestMeta)(e,"minimalMode"),c=async s=>{var i,c;let d=async({previousCacheEntry:o})=>{try{if(!l&&P&&S&&!o)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await n(s);e.fetchMetrics=K.renderOpts.fetchMetrics;let i=K.renderOpts.pendingWaitUntil;i&&r.waitUntil&&(r.waitUntil(i),i=void 0);let c=K.renderOpts.collectedTags;if(!L)return await (0,f.sendResponse)($,B,a,K.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(a.headers);c&&(t[w.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==K.renderOpts.collectedRevalidate&&!(K.renderOpts.collectedRevalidate>=w.INFINITE_CACHE)&&K.renderOpts.collectedRevalidate,o=void 0===K.renderOpts.collectedExpire||K.renderOpts.collectedExpire>=w.INFINITE_CACHE?void 0:K.renderOpts.collectedExpire;return{value:{kind:y.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:o}}}}catch(t){throw(null==o?void 0:o.isStale)&&await C.onRequestError(e,t,{routerKind:"App Router",routePath:a,routeType:"route",revalidateReason:(0,m.getRevalidateReason)({isStaticGeneration:M,isOnDemandRevalidate:P})},!1,k),t}},u=await C.handleResponse({req:e,nextConfig:R,cacheKey:q,routeKind:o.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:N,isRoutePPREnabled:!1,isOnDemandRevalidate:P,revalidateOnlyGenerated:S,responseGenerator:d,waitUntil:r.waitUntil,isMinimalMode:l});if(!L)return null;if((null==u||null==(i=u.value)?void 0:i.kind)!==y.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(c=u.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",P?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),E&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let p=(0,h.fromNodeOutgoingHttpHeaders)(u.value.headers);return l&&L||p.delete(w.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||p.get("Cache-Control")||p.set("Cache-Control",(0,g.getCacheControlHeader)(u.cacheControl)),await (0,f.sendResponse)($,B,new Response(u.value.body,{headers:p,status:u.value.status||200})),null};F?await c(F):await H.withPropagatedContext(e.headers,()=>H.trace(p.BaseServerSpan.handleRequest,{spanName:`${j} ${a}`,kind:i.SpanKind.SERVER,attributes:{"http.method":j,"http.target":e.url}},c))}catch(t){if(t instanceof x.NoFallbackError||await C.onRequestError(e,t,{routerKind:"App Router",routePath:b,routeType:"route",revalidateReason:(0,m.getRevalidateReason)({isStaticGeneration:M,isOnDemandRevalidate:P})},!1,k),L)throw t;return await (0,f.sendResponse)($,B,new Response(null,{status:500})),null}}e.s(["handler",()=>A,"patchFetch",()=>R,"routeModule",()=>C,"serverHooks",()=>k,"workAsyncStorage",()=>E,"workUnitAsyncStorage",()=>N]),r()}catch(e){r(e)}},!1),103243,e=>{e.v(e=>Promise.resolve().then(()=>e(528227)))}];

//# debugId=eda22412-c290-796b-e1bd-b3de6ed3c841
//# sourceMappingURL=%5Broot-of-the-server%5D__778fe010._.js.map