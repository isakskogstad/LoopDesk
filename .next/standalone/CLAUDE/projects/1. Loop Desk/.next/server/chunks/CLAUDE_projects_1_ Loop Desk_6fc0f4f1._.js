;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="f76fe24b-1761-d672-ae1f-5efffd6f8ca9")}catch(e){}}();
module.exports=[706380,471004,913767,248187,347686,e=>{"use strict";var t,s,r,n,a,i,o,l,c,u,h,d,p,f,m,g,y,b,w,v,_,k,x,S,R,N,E,A,M,O,T,P,$,j,C,I,q,D,U,L,W,F,B,H,V,J,K,X,z,G,Y,Q,Z,ee,et,es,er,en,ea,ei,eo,el,ec,eu,eh,ed;let ep,ef,em;function eg(e,t,s,r,n){if("m"===r)throw TypeError("Private method is not writable");if("a"===r&&!n)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?n.call(e,s):n?n.value=s:t.set(e,s),s}function ey(e,t,s,r){if("a"===s&&!r)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?r:"a"===s?r.call(e):r?r.value:t.get(e)}let eb=function(){let{crypto:e}=globalThis;if(e?.randomUUID)return eb=e.randomUUID.bind(e),e.randomUUID();let t=new Uint8Array(1),s=e?()=>e.getRandomValues(t)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(e^s()&15>>e/4).toString(16))};function ew(e){return"object"==typeof e&&null!==e&&("name"in e&&"AbortError"===e.name||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}let ev=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e){try{if("[object Error]"===Object.prototype.toString.call(e)){let t=Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return Error(JSON.stringify(e))}catch{}}return Error(e)};class e_ extends Error{}class ek extends e_{constructor(e,t,s,r){super(`${ek.makeMessage(e,t,s)}`),this.status=e,this.headers=r,this.requestID=r?.get("request-id"),this.error=t}static makeMessage(e,t,s){let r=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):s;return e&&r?`${e} ${r}`:e?`${e} status code (no body)`:r||"(no status code or body)"}static generate(e,t,s,r){return e&&r?400===e?new eN(e,t,s,r):401===e?new eE(e,t,s,r):403===e?new eA(e,t,s,r):404===e?new eM(e,t,s,r):409===e?new eO(e,t,s,r):422===e?new eT(e,t,s,r):429===e?new eP(e,t,s,r):e>=500?new e$(e,t,s,r):new ek(e,t,s,r):new eS({message:s,cause:ev(t)})}}class ex extends ek{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class eS extends ek{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class eR extends eS{constructor({message:e}={}){super({message:e??"Request timed out."})}}class eN extends ek{}class eE extends ek{}class eA extends ek{}class eM extends ek{}class eO extends ek{}class eT extends ek{}class eP extends ek{}class e$ extends ek{}e.s(["APIConnectionError",()=>eS,"APIConnectionTimeoutError",()=>eR,"APIError",()=>ek,"APIUserAbortError",()=>ex,"AnthropicError",()=>e_,"AuthenticationError",()=>eE,"BadRequestError",()=>eN,"ConflictError",()=>eO,"InternalServerError",()=>e$,"NotFoundError",()=>eM,"PermissionDeniedError",()=>eA,"RateLimitError",()=>eP,"UnprocessableEntityError",()=>eT],471004);let ej=/^[a-z][a-z0-9+.-]*:/i,eC=e=>(eC=Array.isArray)(e),eI=eC;function eq(e){return"object"!=typeof e?{}:e??{}}let eD=e=>{try{return JSON.parse(e)}catch(e){return}},eU="0.71.2",eL=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",eW=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown";function eF(...e){let t=globalThis.ReadableStream;if(void 0===t)throw Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function eB(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return eF({start(){},async pull(e){let{done:s,value:r}=await t.next();s?e.close():e.enqueue(r)},async cancel(){await t.return?.()}})}function eH(e){if(e[Symbol.asyncIterator])return e;let t=e.getReader();return{async next(){try{let e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){let e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function eV(e){if(null===e||"object"!=typeof e)return;if(e[Symbol.asyncIterator])return void await e[Symbol.asyncIterator]().return?.();let t=e.getReader(),s=t.cancel();t.releaseLock(),await s}let eJ=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)});function eK(e){let t;return(ef??(ef=(t=new globalThis.TextEncoder).encode.bind(t)))(e)}function eX(e){let t;return(em??(em=(t=new globalThis.TextDecoder).decode.bind(t)))(e)}class ez{constructor(){t.set(this,void 0),s.set(this,void 0),eg(this,t,new Uint8Array,"f"),eg(this,s,null,"f")}decode(e){let r;if(null==e)return[];let n=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?eK(e):e;eg(this,t,function(e){let t=0;for(let s of e)t+=s.length;let s=new Uint8Array(t),r=0;for(let t of e)s.set(t,r),r+=t.length;return s}([ey(this,t,"f"),n]),"f");let a=[];for(;null!=(r=function(e,t){for(let s=t??0;s<e.length;s++){if(10===e[s])return{preceding:s,index:s+1,carriage:!1};if(13===e[s])return{preceding:s,index:s+1,carriage:!0}}return null}(ey(this,t,"f"),ey(this,s,"f")));){if(r.carriage&&null==ey(this,s,"f")){eg(this,s,r.index,"f");continue}if(null!=ey(this,s,"f")&&(r.index!==ey(this,s,"f")+1||r.carriage)){a.push(eX(ey(this,t,"f").subarray(0,ey(this,s,"f")-1))),eg(this,t,ey(this,t,"f").subarray(ey(this,s,"f")),"f"),eg(this,s,null,"f");continue}let e=null!==ey(this,s,"f")?r.preceding-1:r.preceding,n=eX(ey(this,t,"f").subarray(0,e));a.push(n),eg(this,t,ey(this,t,"f").subarray(r.index),"f"),eg(this,s,null,"f")}return a}flush(){return ey(this,t,"f").length?this.decode("\n"):[]}}t=new WeakMap,s=new WeakMap,ez.NEWLINE_CHARS=new Set(["\n","\r"]),ez.NEWLINE_REGEXP=/\r\n|[\n\r]/g;let eG={off:0,error:200,warn:300,info:400,debug:500},eY=(e,t,s)=>{if(e){if(Object.prototype.hasOwnProperty.call(eG,e))return e;e1(s).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(eG))}`)}};function eQ(){}function eZ(e,t,s){return!t||eG[e]>eG[s]?eQ:t[e].bind(t)}let e0={error:eQ,warn:eQ,info:eQ,debug:eQ},e2=new WeakMap;function e1(e){let t=e.logger,s=e.logLevel??"off";if(!t)return e0;let r=e2.get(t);if(r&&r[0]===s)return r[1];let n={error:eZ("error",t,s),warn:eZ("warn",t,s),info:eZ("info",t,s),debug:eZ("debug",t,s)};return e2.set(t,[s,n]),n}let e4=e=>(e.options&&(e.options={...e.options},delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([e,t])=>[e,"x-api-key"===e.toLowerCase()||"authorization"===e.toLowerCase()||"cookie"===e.toLowerCase()||"set-cookie"===e.toLowerCase()?"***":t]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);class e6{constructor(e,t,s){this.iterator=e,r.set(this,void 0),this.controller=t,eg(this,r,s,"f")}static fromSSEResponse(e,t,s){let r=!1,n=s?e1(s):console;async function*a(){if(r)throw new e_("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let s=!1;try{for await(let s of e5(e,t)){if("completion"===s.event)try{yield JSON.parse(s.data)}catch(e){throw n.error("Could not parse message into JSON:",s.data),n.error("From chunk:",s.raw),e}if("message_start"===s.event||"message_delta"===s.event||"message_stop"===s.event||"content_block_start"===s.event||"content_block_delta"===s.event||"content_block_stop"===s.event)try{yield JSON.parse(s.data)}catch(e){throw n.error("Could not parse message into JSON:",s.data),n.error("From chunk:",s.raw),e}if("ping"!==s.event&&"error"===s.event)throw new ek(void 0,eD(s.data)??s.data,void 0,e.headers)}s=!0}catch(e){if(ew(e))return;throw e}finally{s||t.abort()}}return new e6(a,t,s)}static fromReadableStream(e,t,s){let r=!1;async function*n(){let t=new ez;for await(let s of eH(e))for(let e of t.decode(s))yield e;for(let e of t.flush())yield e}return new e6(async function*(){if(r)throw new e_("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let e=!1;try{for await(let t of n())!e&&t&&(yield JSON.parse(t));e=!0}catch(e){if(ew(e))return;throw e}finally{e||t.abort()}},t,s)}[(r=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){let e=[],t=[],s=this.iterator(),n=r=>({next:()=>{if(0===r.length){let r=s.next();e.push(r),t.push(r)}return r.shift()}});return[new e6(()=>n(e),this.controller,ey(this,r,"f")),new e6(()=>n(t),this.controller,ey(this,r,"f"))]}toReadableStream(){let e,t=this;return eF({async start(){e=t[Symbol.asyncIterator]()},async pull(t){try{let{value:s,done:r}=await e.next();if(r)return t.close();let n=eK(JSON.stringify(s)+"\n");t.enqueue(n)}catch(e){t.error(e)}},async cancel(){await e.return?.()}})}}async function*e5(e,t){if(!e.body){if(t.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new e_("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new e_("Attempted to iterate over a response with no body")}let s=new e8,r=new ez;for await(let t of e3(eH(e.body)))for(let e of r.decode(t)){let t=s.decode(e);t&&(yield t)}for(let e of r.flush()){let t=s.decode(e);t&&(yield t)}}async function*e3(e){let t=new Uint8Array;for await(let s of e){let e;if(null==s)continue;let r=s instanceof ArrayBuffer?new Uint8Array(s):"string"==typeof s?eK(s):s,n=new Uint8Array(t.length+r.length);for(n.set(t),n.set(r,t.length),t=n;-1!==(e=function(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1]||13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return -1}(t));)yield t.slice(0,e),t=t.slice(e)}t.length>0&&(yield t)}class e8{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){var t;let s;if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[r,n,a]=-1!==(s=(t=e).indexOf(":"))?[t.substring(0,s),":",t.substring(s+1)]:[t,"",""];return a.startsWith(" ")&&(a=a.substring(1)),"event"===r?this.event=a:"data"===r&&this.data.push(a),null}}async function e9(e,t){let{response:s,requestLogID:r,retryOfRequestLogID:n,startTime:a}=t,i=await (async()=>{if(t.options.stream)return(e1(e).debug("response",s.status,s.url,s.headers,s.body),t.options.__streamClass)?t.options.__streamClass.fromSSEResponse(s,t.controller):e6.fromSSEResponse(s,t.controller);if(204===s.status)return null;if(t.options.__binaryResponse)return s;let r=s.headers.get("content-type"),n=r?.split(";")[0]?.trim();return n?.includes("application/json")||n?.endsWith("+json")?e7(await s.json(),s):await s.text()})();return e1(e).debug(`[${r}] response parsed`,e4({retryOfRequestLogID:n,url:s.url,status:s.status,body:i,durationMs:Date.now()-a})),i}function e7(e,t){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("request-id"),enumerable:!1})}class te extends Promise{constructor(e,t,s=e9){super(e=>{e(null)}),this.responsePromise=t,this.parseResponse=s,n.set(this,void 0),eg(this,n,e,"f")}_thenUnwrap(e){return new te(ey(this,n,"f"),this.responsePromise,async(t,s)=>e7(e(await this.parseResponse(t,s),s),s.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(ey(this,n,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}n=new WeakMap,e.s(["APIPromise",()=>te],913767);class tt{constructor(e,t,s,r){a.set(this,void 0),eg(this,a,e,"f"),this.options=r,this.response=t,this.body=s}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageRequestOptions()}async getNextPage(){let e=this.nextPageRequestOptions();if(!e)throw new e_("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await ey(this,a,"f").requestAPIList(this.constructor,e)}async *iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async *[(a=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}}class ts extends te{constructor(e,t,s){super(e,t,async(e,t)=>new s(e,t.response,await e9(e,t),t.options))}async *[Symbol.asyncIterator](){for await(let e of(await this))yield e}}class tr extends tt{constructor(e,t,s,r){super(e,t,s,r),this.data=s.data||[],this.has_more=s.has_more||!1,this.first_id=s.first_id||null,this.last_id=s.last_id||null}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){if(this.options.query?.before_id){let e=this.first_id;return e?{...this.options,query:{...eq(this.options.query),before_id:e}}:null}let e=this.last_id;return e?{...this.options,query:{...eq(this.options.query),after_id:e}}:null}}class tn extends tt{constructor(e,t,s,r){super(e,t,s,r),this.data=s.data||[],this.has_more=s.has_more||!1,this.next_page=s.next_page||null}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){let e=this.next_page;return e?{...this.options,query:{...eq(this.options.query),page:e}}:null}}e.s(["Page",()=>tr,"PageCursor",()=>tn,"PagePromise",()=>ts],248187);let ta=()=>{if("undefined"==typeof File){let{process:e}=globalThis;throw Error("`File` is not defined as a global, which is required for file uploads."+("string"==typeof e?.versions?.node&&20>parseInt(e.versions.node.split("."))?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function ti(e,t,s){return ta(),new File(e,t??"unknown_file",s)}function to(e){return("object"==typeof e&&null!==e&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||void 0}let tl=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],tc=async(e,t)=>({...e,body:await th(e.body,t)}),tu=new WeakMap,th=async(e,t)=>{if(!await function(e){let t="function"==typeof e?e:e.fetch,s=tu.get(t);if(s)return s;let r=(async()=>{try{let e="Response"in t?t.Response:(await t("data:,")).constructor,s=new FormData;if(s.toString()===await new e(s).text())return!1;return!0}catch{return!0}})();return tu.set(t,r),r}(t))throw TypeError("The provided fetch function does not support file uploads with the current global FormData class.");let s=new FormData;return await Promise.all(Object.entries(e||{}).map(([e,t])=>td(s,e,t))),s},td=async(e,t,s)=>{if(void 0!==s){if(null==s)throw TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof s||"number"==typeof s||"boolean"==typeof s)e.append(t,String(s));else if(s instanceof Response){let r={},n=s.headers.get("Content-Type");n&&(r={type:n}),e.append(t,ti([await s.blob()],to(s),r))}else if(tl(s))e.append(t,ti([await new Response(eB(s)).blob()],to(s)));else{let r;if((r=s)instanceof Blob&&"name"in r)e.append(t,ti([s],to(s),{type:s.type}));else if(Array.isArray(s))await Promise.all(s.map(s=>td(e,t+"[]",s)));else if("object"==typeof s)await Promise.all(Object.entries(s).map(([s,r])=>td(e,`${t}[${s}]`,r)));else throw TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${s} instead`)}}},tp=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer;async function tf(e,t,s){let r,n;if(ta(),e=await e,t||(t=to(e)),null!=(r=e)&&"object"==typeof r&&"string"==typeof r.name&&"number"==typeof r.lastModified&&tp(r))return e instanceof File&&null==t&&null==s?e:ti([await e.arrayBuffer()],t??e.name,{type:e.type,lastModified:e.lastModified,...s});if(null!=(n=e)&&"object"==typeof n&&"string"==typeof n.url&&"function"==typeof n.blob){let r=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),ti(await tm(r),t,s)}let a=await tm(e);if(!s?.type){let e=a.find(e=>"object"==typeof e&&"type"in e&&e.type);"string"==typeof e&&(s={...s,type:e})}return ti(a,t,s)}async function tm(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(tp(e))t.push(e instanceof Blob?e:await e.arrayBuffer());else if(tl(e))for await(let s of e)t.push(...await tm(s));else{let t=e?.constructor?.name;throw Error(`Unexpected data type: ${typeof e}${t?`; constructor: ${t}`:""}${function(e){if("object"!=typeof e||null===e)return"";let t=Object.getOwnPropertyNames(e);return`; props: [${t.map(e=>`"${e}"`).join(", ")}]`}(e)}`)}return t}e.s([],347686);class tg{constructor(e){this._client=e}}let ty=Symbol.for("brand.privateNullableHeaders"),tb=e=>{let t=new Headers,s=new Set;for(let r of e){let e=new Set;for(let[n,a]of function*(e){let t;if(!e)return;if(ty in e){let{values:t,nulls:s}=e;for(let e of(yield*t.entries(),s))yield[e,null];return}let s=!1;for(let r of(e instanceof Headers?t=e.entries():eI(e)?t=e:(s=!0,t=Object.entries(e??{})),t)){let e=r[0];if("string"!=typeof e)throw TypeError("expected header name to be a string");let t=eI(r[1])?r[1]:[r[1]],n=!1;for(let r of t)void 0!==r&&(s&&!n&&(n=!0,yield[e,null]),yield[e,r])}}(r)){let r=n.toLowerCase();e.has(r)||(t.delete(n),e.add(r)),null===a?(t.delete(n),s.add(r)):(t.append(n,a),s.delete(r))}}return{[ty]:!0,values:t,nulls:s}};function tw(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}let tv=Object.freeze(Object.create(null)),t_=((e=tw)=>function(t,...s){let r;if(1===t.length)return t[0];let n=!1,a=[],i=t.reduce((t,r,i)=>{/[?#]/.test(r)&&(n=!0);let o=s[i],l=(n?encodeURIComponent:e)(""+o);return i!==s.length&&(null==o||"object"==typeof o&&o.toString===Object.getPrototypeOf(Object.getPrototypeOf(o.hasOwnProperty??tv)??tv)?.toString)&&(l=o+"",a.push({start:t.length+r.length,length:l.length,error:`Value of type ${Object.prototype.toString.call(o).slice(8,-1)} is not a valid path parameter`})),t+r+(i===s.length?"":l)},""),o=i.split(/[?#]/,1)[0],l=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi;for(;null!==(r=l.exec(o));)a.push({start:r.index,length:r[0].length,error:`Value "${r[0]}" can't be safely passed as a path parameter`});if(a.sort((e,t)=>e.start-t.start),a.length>0){let e=0,t=a.reduce((t,s)=>{let r=" ".repeat(s.start-e),n="^".repeat(s.length);return e=s.start+s.length,t+r+n},"");throw new e_(`Path parameters result in path with invalid segments:
${a.map(e=>e.error).join("\n")}
${i}
${t}`)}return i})(tw);class tk extends tg{list(e={},t){let{betas:s,...r}=e??{};return this._client.getAPIList("/v1/files",tr,{query:r,...t,headers:tb([{"anthropic-beta":[...s??[],"files-api-2025-04-14"].toString()},t?.headers])})}delete(e,t={},s){let{betas:r}=t??{};return this._client.delete(t_`/v1/files/${e}`,{...s,headers:tb([{"anthropic-beta":[...r??[],"files-api-2025-04-14"].toString()},s?.headers])})}download(e,t={},s){let{betas:r}=t??{};return this._client.get(t_`/v1/files/${e}/content`,{...s,headers:tb([{"anthropic-beta":[...r??[],"files-api-2025-04-14"].toString(),Accept:"application/binary"},s?.headers]),__binaryResponse:!0})}retrieveMetadata(e,t={},s){let{betas:r}=t??{};return this._client.get(t_`/v1/files/${e}`,{...s,headers:tb([{"anthropic-beta":[...r??[],"files-api-2025-04-14"].toString()},s?.headers])})}upload(e,t){let{betas:s,...r}=e;return this._client.post("/v1/files",tc({body:r,...t,headers:tb([{"anthropic-beta":[...s??[],"files-api-2025-04-14"].toString()},t?.headers])},this._client))}}class tx extends tg{retrieve(e,t={},s){let{betas:r}=t??{};return this._client.get(t_`/v1/models/${e}?beta=true`,{...s,headers:tb([{...r?.toString()!=null?{"anthropic-beta":r?.toString()}:void 0},s?.headers])})}list(e={},t){let{betas:s,...r}=e??{};return this._client.getAPIList("/v1/models?beta=true",tr,{query:r,...t,headers:tb([{...s?.toString()!=null?{"anthropic-beta":s?.toString()}:void 0},t?.headers])})}}let tS={"claude-opus-4-20250514":8192,"claude-opus-4-0":8192,"claude-4-opus-20250514":8192,"anthropic.claude-opus-4-20250514-v1:0":8192,"claude-opus-4@20250514":8192,"claude-opus-4-1-20250805":8192,"anthropic.claude-opus-4-1-20250805-v1:0":8192,"claude-opus-4-1@20250805":8192};function tR(e,t,s){return t&&"parse"in(t.output_format??{})?tN(e,t,s):{...e,content:e.content.map(e=>"text"===e.type?Object.defineProperty(Object.defineProperty({...e},"parsed_output",{value:null,enumerable:!1}),"parsed",{get:()=>(s.logger.warn("The `parsed` property on `text` blocks is deprecated, please use `parsed_output` instead."),null),enumerable:!1}):e),parsed_output:null}}function tN(e,t,s){let r=null,n=e.content.map(e=>{if("text"===e.type){let n=function(e,t){if(e.output_format?.type!=="json_schema")return null;try{if("parse"in e.output_format)return e.output_format.parse(t);return JSON.parse(t)}catch(e){throw new e_(`Failed to parse structured output: ${e}`)}}(t,e.text);return null===r&&(r=n),Object.defineProperty(Object.defineProperty({...e},"parsed_output",{value:n,enumerable:!1}),"parsed",{get:()=>(s.logger.warn("The `parsed` property on `text` blocks is deprecated, please use `parsed_output` instead."),n),enumerable:!1})}return e});return{...e,content:n,parsed_output:r}}let tE=e=>{if(0===e.length)return e;let t=e[e.length-1];switch(t.type){case"separator":return tE(e=e.slice(0,e.length-1));case"number":let s=t.value[t.value.length-1];if("."===s||"-"===s)return tE(e=e.slice(0,e.length-1));case"string":let r=e[e.length-2];if(r?.type==="delimiter"||r?.type==="brace"&&"{"===r.value)return tE(e=e.slice(0,e.length-1));break;case"delimiter":return tE(e=e.slice(0,e.length-1))}return e},tA=e=>{var t;let s,r;return JSON.parse((t=tE((e=>{let t=0,s=[];for(;t<e.length;){let r=e[t];if("\\"===r){t++;continue}if("{"===r){s.push({type:"brace",value:"{"}),t++;continue}if("}"===r){s.push({type:"brace",value:"}"}),t++;continue}if("["===r){s.push({type:"paren",value:"["}),t++;continue}if("]"===r){s.push({type:"paren",value:"]"}),t++;continue}if(":"===r){s.push({type:"separator",value:":"}),t++;continue}if(","===r){s.push({type:"delimiter",value:","}),t++;continue}if('"'===r){let n="",a=!1;for(r=e[++t];'"'!==r;){if(t===e.length){a=!0;break}if("\\"===r){if(++t===e.length){a=!0;break}n+=r+e[t],r=e[++t]}else n+=r,r=e[++t]}r=e[++t],a||s.push({type:"string",value:n});continue}let n=/\s/;if(r&&n.test(r)){t++;continue}let a=/[0-9]/;if(r&&a.test(r)||"-"===r||"."===r){let n="";for("-"===r&&(n+=r,r=e[++t]);r&&a.test(r)||"."===r;)n+=r,r=e[++t];s.push({type:"number",value:n});continue}let i=/[a-z]/i;if(r&&i.test(r)){let n="";for(;r&&i.test(r)&&t!==e.length;)n+=r,r=e[++t];"true"==n||"false"==n||"null"===n?s.push({type:"name",value:n}):t++;continue}t++}return s})(e)),s=[],t.map(e=>{"brace"===e.type&&("{"===e.value?s.push("}"):s.splice(s.lastIndexOf("}"),1)),"paren"===e.type&&("["===e.value?s.push("]"):s.splice(s.lastIndexOf("]"),1))}),s.length>0&&s.reverse().map(e=>{"}"===e?t.push({type:"brace",value:"}"}):"]"===e&&t.push({type:"paren",value:"]"})}),r="",t.map(e=>{"string"===e.type?r+='"'+e.value+'"':r+=e.value}),r))},tM="__json_buf";function tO(e){return"tool_use"===e.type||"server_tool_use"===e.type||"mcp_tool_use"===e.type}class tT{constructor(e,t){i.add(this),this.messages=[],this.receivedMessages=[],o.set(this,void 0),l.set(this,null),this.controller=new AbortController,c.set(this,void 0),u.set(this,()=>{}),h.set(this,()=>{}),d.set(this,void 0),p.set(this,()=>{}),f.set(this,()=>{}),m.set(this,{}),g.set(this,!1),y.set(this,!1),b.set(this,!1),w.set(this,!1),v.set(this,void 0),_.set(this,void 0),k.set(this,void 0),R.set(this,e=>{if(eg(this,y,!0,"f"),ew(e)&&(e=new ex),e instanceof ex)return eg(this,b,!0,"f"),this._emit("abort",e);if(e instanceof e_)return this._emit("error",e);if(e instanceof Error){let t=new e_(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new e_(String(e)))}),eg(this,c,new Promise((e,t)=>{eg(this,u,e,"f"),eg(this,h,t,"f")}),"f"),eg(this,d,new Promise((e,t)=>{eg(this,p,e,"f"),eg(this,f,t,"f")}),"f"),ey(this,c,"f").catch(()=>{}),ey(this,d,"f").catch(()=>{}),eg(this,l,e,"f"),eg(this,k,t?.logger??console,"f")}get response(){return ey(this,v,"f")}get request_id(){return ey(this,_,"f")}async withResponse(){eg(this,w,!0,"f");let e=await ey(this,c,"f");if(!e)throw Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get("request-id")}}static fromReadableStream(e){let t=new tT(null);return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,s,{logger:r}={}){let n=new tT(t,{logger:r});for(let e of t.messages)n._addMessageParam(e);return eg(n,l,{...t,stream:!0},"f"),n._run(()=>n._createMessage(e,{...t,stream:!0},{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),n}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},ey(this,R,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,s){let r,n=s?.signal;n&&(n.aborted&&this.controller.abort(),r=this.controller.abort.bind(this.controller),n.addEventListener("abort",r));try{ey(this,i,"m",N).call(this);let{response:r,data:n}=await e.create({...t,stream:!0},{...s,signal:this.controller.signal}).withResponse();for await(let e of(this._connected(r),n))ey(this,i,"m",E).call(this,e);if(n.controller.signal?.aborted)throw new ex;ey(this,i,"m",A).call(this)}finally{n&&r&&n.removeEventListener("abort",r)}}_connected(e){this.ended||(eg(this,v,e,"f"),eg(this,_,e?.headers.get("request-id"),"f"),ey(this,u,"f").call(this,e),this._emit("connect"))}get ended(){return ey(this,g,"f")}get errored(){return ey(this,y,"f")}get aborted(){return ey(this,b,"f")}abort(){this.controller.abort()}on(e,t){return(ey(this,m,"f")[e]||(ey(this,m,"f")[e]=[])).push({listener:t}),this}off(e,t){let s=ey(this,m,"f")[e];if(!s)return this;let r=s.findIndex(e=>e.listener===t);return r>=0&&s.splice(r,1),this}once(e,t){return(ey(this,m,"f")[e]||(ey(this,m,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,s)=>{eg(this,w,!0,"f"),"error"!==e&&this.once("error",s),this.once(e,t)})}async done(){eg(this,w,!0,"f"),await ey(this,d,"f")}get currentMessage(){return ey(this,o,"f")}async finalMessage(){return await this.done(),ey(this,i,"m",x).call(this)}async finalText(){return await this.done(),ey(this,i,"m",S).call(this)}_emit(e,...t){if(ey(this,g,"f"))return;"end"===e&&(eg(this,g,!0,"f"),ey(this,p,"f").call(this));let s=ey(this,m,"f")[e];if(s&&(ey(this,m,"f")[e]=s.filter(e=>!e.once),s.forEach(({listener:e})=>e(...t))),"abort"===e){let e=t[0];ey(this,w,"f")||s?.length||Promise.reject(e),ey(this,h,"f").call(this,e),ey(this,f,"f").call(this,e),this._emit("end");return}if("error"===e){let e=t[0];ey(this,w,"f")||s?.length||Promise.reject(e),ey(this,h,"f").call(this,e),ey(this,f,"f").call(this,e),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",ey(this,i,"m",x).call(this))}async _fromReadableStream(e,t){let s,r=t?.signal;r&&(r.aborted&&this.controller.abort(),s=this.controller.abort.bind(this.controller),r.addEventListener("abort",s));try{ey(this,i,"m",N).call(this),this._connected(null);let t=e6.fromReadableStream(e,this.controller);for await(let e of t)ey(this,i,"m",E).call(this,e);if(t.controller.signal?.aborted)throw new ex;ey(this,i,"m",A).call(this)}finally{r&&s&&r.removeEventListener("abort",s)}}[(o=new WeakMap,l=new WeakMap,c=new WeakMap,u=new WeakMap,h=new WeakMap,d=new WeakMap,p=new WeakMap,f=new WeakMap,m=new WeakMap,g=new WeakMap,y=new WeakMap,b=new WeakMap,w=new WeakMap,v=new WeakMap,_=new WeakMap,k=new WeakMap,R=new WeakMap,i=new WeakSet,x=function(){if(0===this.receivedMessages.length)throw new e_("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},S=function(){if(0===this.receivedMessages.length)throw new e_("stream ended without producing a Message with role=assistant");let e=this.receivedMessages.at(-1).content.filter(e=>"text"===e.type).map(e=>e.text);if(0===e.length)throw new e_("stream ended without producing a content block with type=text");return e.join(" ")},N=function(){this.ended||eg(this,o,void 0,"f")},E=function(e){if(this.ended)return;let t=ey(this,i,"m",M).call(this,e);switch(this._emit("streamEvent",e,t),e.type){case"content_block_delta":{let s=t.content.at(-1);switch(e.delta.type){case"text_delta":"text"===s.type&&this._emit("text",e.delta.text,s.text||"");break;case"citations_delta":"text"===s.type&&this._emit("citation",e.delta.citation,s.citations??[]);break;case"input_json_delta":tO(s)&&s.input&&this._emit("inputJson",e.delta.partial_json,s.input);break;case"thinking_delta":"thinking"===s.type&&this._emit("thinking",e.delta.thinking,s.thinking);break;case"signature_delta":"thinking"===s.type&&this._emit("signature",s.signature);break;default:tP(e.delta)}break}case"message_stop":this._addMessageParam(t),this._addMessage(tR(t,ey(this,l,"f"),{logger:ey(this,k,"f")}),!0);break;case"content_block_stop":this._emit("contentBlock",t.content.at(-1));break;case"message_start":eg(this,o,t,"f")}},A=function(){if(this.ended)throw new e_("stream has ended, this shouldn't happen");let e=ey(this,o,"f");if(!e)throw new e_("request ended without sending any chunks");return eg(this,o,void 0,"f"),tR(e,ey(this,l,"f"),{logger:ey(this,k,"f")})},M=function(e){let t=ey(this,o,"f");if("message_start"===e.type){if(t)throw new e_(`Unexpected event order, got ${e.type} before receiving "message_stop"`);return e.message}if(!t)throw new e_(`Unexpected event order, got ${e.type} before "message_start"`);switch(e.type){case"message_stop":case"content_block_stop":return t;case"message_delta":return t.container=e.delta.container,t.stop_reason=e.delta.stop_reason,t.stop_sequence=e.delta.stop_sequence,t.usage.output_tokens=e.usage.output_tokens,t.context_management=e.context_management,null!=e.usage.input_tokens&&(t.usage.input_tokens=e.usage.input_tokens),null!=e.usage.cache_creation_input_tokens&&(t.usage.cache_creation_input_tokens=e.usage.cache_creation_input_tokens),null!=e.usage.cache_read_input_tokens&&(t.usage.cache_read_input_tokens=e.usage.cache_read_input_tokens),null!=e.usage.server_tool_use&&(t.usage.server_tool_use=e.usage.server_tool_use),t;case"content_block_start":return t.content.push(e.content_block),t;case"content_block_delta":{let s=t.content.at(e.index);switch(e.delta.type){case"text_delta":s?.type==="text"&&(t.content[e.index]={...s,text:(s.text||"")+e.delta.text});break;case"citations_delta":s?.type==="text"&&(t.content[e.index]={...s,citations:[...s.citations??[],e.delta.citation]});break;case"input_json_delta":if(s&&tO(s)){let r=s[tM]||"";r+=e.delta.partial_json;let n={...s};if(Object.defineProperty(n,tM,{value:r,enumerable:!1,writable:!0}),r)try{n.input=tA(r)}catch(t){let e=new e_(`Unable to parse tool parameter JSON from model. Please retry your request or adjust your prompt. Error: ${t}. JSON: ${r}`);ey(this,R,"f").call(this,e)}t.content[e.index]=n}break;case"thinking_delta":s?.type==="thinking"&&(t.content[e.index]={...s,thinking:s.thinking+e.delta.thinking});break;case"signature_delta":s?.type==="thinking"&&(t.content[e.index]={...s,signature:e.delta.signature});break;default:tP(e.delta)}return t}}},Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("streamEvent",s=>{let r=t.shift();r?r.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let r of(s=!0,t))r.reject(e);t.length=0}),this.on("error",e=>{for(let r of(s=!0,t))r.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new e6(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function tP(e){}let t$=`You have been working on the task described above but have not yet completed it. Write a continuation summary that will allow you (or another instance of yourself) to resume work efficiently in a future context window where the conversation history will be replaced with this summary. Your summary should be structured, concise, and actionable. Include:
1. Task Overview
The user's core request and success criteria
Any clarifications or constraints they specified
2. Current State
What has been completed so far
Files created, modified, or analyzed (with paths if relevant)
Key outputs or artifacts produced
3. Important Discoveries
Technical constraints or requirements uncovered
Decisions made and their rationale
Errors encountered and how they were resolved
What approaches were tried that didn't work (and why)
4. Next Steps
Specific actions needed to complete the task
Any blockers or open questions to resolve
Priority order if multiple steps remain
5. Context to Preserve
User preferences or style requirements
Domain-specific details that aren't obvious
Any promises made to the user
Be concise but completeâ€”err on the side of including information that would prevent duplicate work or repeated mistakes. Write in a way that enables immediate resumption of the task.
Wrap your summary in <summary></summary> tags.`;function tj(){let e,t;return{promise:new Promise((s,r)=>{e=s,t=r}),resolve:e,reject:t}}class tC{constructor(e,t,s){O.add(this),this.client=e,T.set(this,!1),P.set(this,!1),$.set(this,void 0),j.set(this,void 0),C.set(this,void 0),I.set(this,void 0),q.set(this,void 0),D.set(this,0),eg(this,$,{params:{...t,messages:structuredClone(t.messages)}},"f"),eg(this,j,{...s,headers:tb([{"x-stainless-helper":"BetaToolRunner"},s?.headers])},"f"),eg(this,q,tj(),"f")}async *[(T=new WeakMap,P=new WeakMap,$=new WeakMap,j=new WeakMap,C=new WeakMap,I=new WeakMap,q=new WeakMap,D=new WeakMap,O=new WeakSet,U=async function(){let e=ey(this,$,"f").params.compactionControl;if(!e||!e.enabled)return!1;let t=0;if(void 0!==ey(this,C,"f"))try{let e=await ey(this,C,"f");t=e.usage.input_tokens+(e.usage.cache_creation_input_tokens??0)+(e.usage.cache_read_input_tokens??0)+e.usage.output_tokens}catch{return!1}if(t<(e.contextTokenThreshold??1e5))return!1;let s=e.model??ey(this,$,"f").params.model,r=e.summaryPrompt??t$,n=ey(this,$,"f").params.messages;if("assistant"===n[n.length-1].role){let e=n[n.length-1];if(Array.isArray(e.content)){let t=e.content.filter(e=>"tool_use"!==e.type);0===t.length?n.pop():e.content=t}}let a=await this.client.beta.messages.create({model:s,messages:[...n,{role:"user",content:[{type:"text",text:r}]}],max_tokens:ey(this,$,"f").params.max_tokens},{headers:{"x-stainless-helper":"compaction"}});if(a.content[0]?.type!=="text")throw new e_("Expected text response for compaction");return ey(this,$,"f").params.messages=[{role:"user",content:a.content}],!0},Symbol.asyncIterator)](){var e;if(ey(this,T,"f"))throw new e_("Cannot iterate over a consumed stream");eg(this,T,!0,"f"),eg(this,P,!0,"f"),eg(this,I,void 0,"f");try{for(;;){let t;try{if(ey(this,$,"f").params.max_iterations&&ey(this,D,"f")>=ey(this,$,"f").params.max_iterations)break;eg(this,P,!1,"f"),eg(this,I,void 0,"f"),eg(this,D,(e=ey(this,D,"f"),++e),"f"),eg(this,C,void 0,"f");let{max_iterations:s,compactionControl:r,...n}=ey(this,$,"f").params;if(n.stream?(t=this.client.beta.messages.stream({...n},ey(this,j,"f")),eg(this,C,t.finalMessage(),"f"),ey(this,C,"f").catch(()=>{}),yield t):(eg(this,C,this.client.beta.messages.create({...n,stream:!1},ey(this,j,"f")),"f"),yield ey(this,C,"f")),!await ey(this,O,"m",U).call(this)){if(!ey(this,P,"f")){let{role:e,content:t}=await ey(this,C,"f");ey(this,$,"f").params.messages.push({role:e,content:t})}let e=await ey(this,O,"m",L).call(this,ey(this,$,"f").params.messages.at(-1));if(e)ey(this,$,"f").params.messages.push(e);else if(!ey(this,P,"f"))break}}finally{t&&t.abort()}}if(!ey(this,C,"f"))throw new e_("ToolRunner concluded without a message from the server");ey(this,q,"f").resolve(await ey(this,C,"f"))}catch(e){throw eg(this,T,!1,"f"),ey(this,q,"f").promise.catch(()=>{}),ey(this,q,"f").reject(e),eg(this,q,tj(),"f"),e}}setMessagesParams(e){"function"==typeof e?ey(this,$,"f").params=e(ey(this,$,"f").params):ey(this,$,"f").params=e,eg(this,P,!0,"f"),eg(this,I,void 0,"f")}async generateToolResponse(){let e=await ey(this,C,"f")??this.params.messages.at(-1);return e?ey(this,O,"m",L).call(this,e):null}done(){return ey(this,q,"f").promise}async runUntilDone(){if(!ey(this,T,"f"))for await(let e of this);return this.done()}get params(){return ey(this,$,"f").params}pushMessages(...e){this.setMessagesParams(t=>({...t,messages:[...t.messages,...e]}))}then(e,t){return this.runUntilDone().then(e,t)}}async function tI(e,t=e.messages.at(-1)){if(!t||"assistant"!==t.role||!t.content||"string"==typeof t.content)return null;let s=t.content.filter(e=>"tool_use"===e.type);return 0===s.length?null:{role:"user",content:await Promise.all(s.map(async t=>{let s=e.tools.find(e=>("name"in e?e.name:e.mcp_server_name)===t.name);if(!s||!("run"in s))return{type:"tool_result",tool_use_id:t.id,content:`Error: Tool '${t.name}' not found`,is_error:!0};try{let e=t.input;"parse"in s&&s.parse&&(e=s.parse(e));let r=await s.run(e);return{type:"tool_result",tool_use_id:t.id,content:r}}catch(e){return{type:"tool_result",tool_use_id:t.id,content:`Error: ${e instanceof Error?e.message:String(e)}`,is_error:!0}}}))}}L=async function(e){return void 0!==ey(this,I,"f")||eg(this,I,tI(ey(this,$,"f").params,e),"f"),ey(this,I,"f")};class tq{constructor(e,t){this.iterator=e,this.controller=t}async *decoder(){let e=new ez;for await(let t of this.iterator)for(let s of e.decode(t))yield JSON.parse(s);for(let t of e.flush())yield JSON.parse(t)}[Symbol.asyncIterator](){return this.decoder()}static fromResponse(e,t){if(!e.body){if(t.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new e_("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new e_("Attempted to iterate over a response with no body")}return new tq(eH(e.body),t)}}class tD extends tg{create(e,t){let{betas:s,...r}=e;return this._client.post("/v1/messages/batches?beta=true",{body:r,...t,headers:tb([{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString()},t?.headers])})}retrieve(e,t={},s){let{betas:r}=t??{};return this._client.get(t_`/v1/messages/batches/${e}?beta=true`,{...s,headers:tb([{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString()},s?.headers])})}list(e={},t){let{betas:s,...r}=e??{};return this._client.getAPIList("/v1/messages/batches?beta=true",tr,{query:r,...t,headers:tb([{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString()},t?.headers])})}delete(e,t={},s){let{betas:r}=t??{};return this._client.delete(t_`/v1/messages/batches/${e}?beta=true`,{...s,headers:tb([{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString()},s?.headers])})}cancel(e,t={},s){let{betas:r}=t??{};return this._client.post(t_`/v1/messages/batches/${e}/cancel?beta=true`,{...s,headers:tb([{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString()},s?.headers])})}async results(e,t={},s){let r=await this.retrieve(e);if(!r.results_url)throw new e_(`No batch \`results_url\`; Has it finished processing? ${r.processing_status} - ${r.id}`);let{betas:n}=t??{};return this._client.get(r.results_url,{...s,headers:tb([{"anthropic-beta":[...n??[],"message-batches-2024-09-24"].toString(),Accept:"application/binary"},s?.headers]),stream:!0,__binaryResponse:!0})._thenUnwrap((e,t)=>tq.fromResponse(t.response,t.controller))}}let tU={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-3-opus-20240229":"January 5th, 2026","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025","claude-3-7-sonnet-latest":"February 19th, 2026","claude-3-7-sonnet-20250219":"February 19th, 2026"};class tL extends tg{constructor(){super(...arguments),this.batches=new tD(this._client)}create(e,t){let{betas:s,...r}=e;r.model in tU&&console.warn(`The model '${r.model}' is deprecated and will reach end-of-life on ${tU[r.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`);let n=this._client._options.timeout;if(!r.stream&&null==n){let e=tS[r.model]??void 0;n=this._client.calculateNonstreamingTimeout(r.max_tokens,e)}return this._client.post("/v1/messages?beta=true",{body:r,timeout:n??6e5,...t,headers:tb([{...s?.toString()!=null?{"anthropic-beta":s?.toString()}:void 0},t?.headers]),stream:e.stream??!1})}parse(e,t){return t={...t,headers:tb([{"anthropic-beta":[...e.betas??[],"structured-outputs-2025-11-13"].toString()},t?.headers])},this.create(e,t).then(t=>tN(t,e,{logger:this._client.logger??console}))}stream(e,t){return tT.createMessage(this,e,t)}countTokens(e,t){let{betas:s,...r}=e;return this._client.post("/v1/messages/count_tokens?beta=true",{body:r,...t,headers:tb([{"anthropic-beta":[...s??[],"token-counting-2024-11-01"].toString()},t?.headers])})}toolRunner(e,t){return new tC(this._client,e,t)}}tL.Batches=tD,tL.BetaToolRunner=tC;class tW extends tg{create(e,t={},s){let{betas:r,...n}=t??{};return this._client.post(t_`/v1/skills/${e}/versions?beta=true`,tc({body:n,...s,headers:tb([{"anthropic-beta":[...r??[],"skills-2025-10-02"].toString()},s?.headers])},this._client))}retrieve(e,t,s){let{skill_id:r,betas:n}=t;return this._client.get(t_`/v1/skills/${r}/versions/${e}?beta=true`,{...s,headers:tb([{"anthropic-beta":[...n??[],"skills-2025-10-02"].toString()},s?.headers])})}list(e,t={},s){let{betas:r,...n}=t??{};return this._client.getAPIList(t_`/v1/skills/${e}/versions?beta=true`,tn,{query:n,...s,headers:tb([{"anthropic-beta":[...r??[],"skills-2025-10-02"].toString()},s?.headers])})}delete(e,t,s){let{skill_id:r,betas:n}=t;return this._client.delete(t_`/v1/skills/${r}/versions/${e}?beta=true`,{...s,headers:tb([{"anthropic-beta":[...n??[],"skills-2025-10-02"].toString()},s?.headers])})}}class tF extends tg{constructor(){super(...arguments),this.versions=new tW(this._client)}create(e={},t){let{betas:s,...r}=e??{};return this._client.post("/v1/skills?beta=true",tc({body:r,...t,headers:tb([{"anthropic-beta":[...s??[],"skills-2025-10-02"].toString()},t?.headers])},this._client))}retrieve(e,t={},s){let{betas:r}=t??{};return this._client.get(t_`/v1/skills/${e}?beta=true`,{...s,headers:tb([{"anthropic-beta":[...r??[],"skills-2025-10-02"].toString()},s?.headers])})}list(e={},t){let{betas:s,...r}=e??{};return this._client.getAPIList("/v1/skills?beta=true",tn,{query:r,...t,headers:tb([{"anthropic-beta":[...s??[],"skills-2025-10-02"].toString()},t?.headers])})}delete(e,t={},s){let{betas:r}=t??{};return this._client.delete(t_`/v1/skills/${e}?beta=true`,{...s,headers:tb([{"anthropic-beta":[...r??[],"skills-2025-10-02"].toString()},s?.headers])})}}tF.Versions=tW;class tB extends tg{constructor(){super(...arguments),this.models=new tx(this._client),this.messages=new tL(this._client),this.files=new tk(this._client),this.skills=new tF(this._client)}}tB.Models=tx,tB.Messages=tL,tB.Files=tk,tB.Skills=tF;class tH extends tg{create(e,t){let{betas:s,...r}=e;return this._client.post("/v1/complete",{body:r,timeout:this._client._options.timeout??6e5,...t,headers:tb([{...s?.toString()!=null?{"anthropic-beta":s?.toString()}:void 0},t?.headers]),stream:e.stream??!1})}}let tV="__json_buf";function tJ(e){return"tool_use"===e.type||"server_tool_use"===e.type}class tK{constructor(){W.add(this),this.messages=[],this.receivedMessages=[],F.set(this,void 0),this.controller=new AbortController,B.set(this,void 0),H.set(this,()=>{}),V.set(this,()=>{}),J.set(this,void 0),K.set(this,()=>{}),X.set(this,()=>{}),z.set(this,{}),G.set(this,!1),Y.set(this,!1),Q.set(this,!1),Z.set(this,!1),ee.set(this,void 0),et.set(this,void 0),en.set(this,e=>{if(eg(this,Y,!0,"f"),ew(e)&&(e=new ex),e instanceof ex)return eg(this,Q,!0,"f"),this._emit("abort",e);if(e instanceof e_)return this._emit("error",e);if(e instanceof Error){let t=new e_(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new e_(String(e)))}),eg(this,B,new Promise((e,t)=>{eg(this,H,e,"f"),eg(this,V,t,"f")}),"f"),eg(this,J,new Promise((e,t)=>{eg(this,K,e,"f"),eg(this,X,t,"f")}),"f"),ey(this,B,"f").catch(()=>{}),ey(this,J,"f").catch(()=>{})}get response(){return ey(this,ee,"f")}get request_id(){return ey(this,et,"f")}async withResponse(){eg(this,Z,!0,"f");let e=await ey(this,B,"f");if(!e)throw Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get("request-id")}}static fromReadableStream(e){let t=new tK;return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,s){let r=new tK;for(let e of t.messages)r._addMessageParam(e);return r._run(()=>r._createMessage(e,{...t,stream:!0},{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),r}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},ey(this,en,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,s){let r,n=s?.signal;n&&(n.aborted&&this.controller.abort(),r=this.controller.abort.bind(this.controller),n.addEventListener("abort",r));try{ey(this,W,"m",ea).call(this);let{response:r,data:n}=await e.create({...t,stream:!0},{...s,signal:this.controller.signal}).withResponse();for await(let e of(this._connected(r),n))ey(this,W,"m",ei).call(this,e);if(n.controller.signal?.aborted)throw new ex;ey(this,W,"m",eo).call(this)}finally{n&&r&&n.removeEventListener("abort",r)}}_connected(e){this.ended||(eg(this,ee,e,"f"),eg(this,et,e?.headers.get("request-id"),"f"),ey(this,H,"f").call(this,e),this._emit("connect"))}get ended(){return ey(this,G,"f")}get errored(){return ey(this,Y,"f")}get aborted(){return ey(this,Q,"f")}abort(){this.controller.abort()}on(e,t){return(ey(this,z,"f")[e]||(ey(this,z,"f")[e]=[])).push({listener:t}),this}off(e,t){let s=ey(this,z,"f")[e];if(!s)return this;let r=s.findIndex(e=>e.listener===t);return r>=0&&s.splice(r,1),this}once(e,t){return(ey(this,z,"f")[e]||(ey(this,z,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,s)=>{eg(this,Z,!0,"f"),"error"!==e&&this.once("error",s),this.once(e,t)})}async done(){eg(this,Z,!0,"f"),await ey(this,J,"f")}get currentMessage(){return ey(this,F,"f")}async finalMessage(){return await this.done(),ey(this,W,"m",es).call(this)}async finalText(){return await this.done(),ey(this,W,"m",er).call(this)}_emit(e,...t){if(ey(this,G,"f"))return;"end"===e&&(eg(this,G,!0,"f"),ey(this,K,"f").call(this));let s=ey(this,z,"f")[e];if(s&&(ey(this,z,"f")[e]=s.filter(e=>!e.once),s.forEach(({listener:e})=>e(...t))),"abort"===e){let e=t[0];ey(this,Z,"f")||s?.length||Promise.reject(e),ey(this,V,"f").call(this,e),ey(this,X,"f").call(this,e),this._emit("end");return}if("error"===e){let e=t[0];ey(this,Z,"f")||s?.length||Promise.reject(e),ey(this,V,"f").call(this,e),ey(this,X,"f").call(this,e),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",ey(this,W,"m",es).call(this))}async _fromReadableStream(e,t){let s,r=t?.signal;r&&(r.aborted&&this.controller.abort(),s=this.controller.abort.bind(this.controller),r.addEventListener("abort",s));try{ey(this,W,"m",ea).call(this),this._connected(null);let t=e6.fromReadableStream(e,this.controller);for await(let e of t)ey(this,W,"m",ei).call(this,e);if(t.controller.signal?.aborted)throw new ex;ey(this,W,"m",eo).call(this)}finally{r&&s&&r.removeEventListener("abort",s)}}[(F=new WeakMap,B=new WeakMap,H=new WeakMap,V=new WeakMap,J=new WeakMap,K=new WeakMap,X=new WeakMap,z=new WeakMap,G=new WeakMap,Y=new WeakMap,Q=new WeakMap,Z=new WeakMap,ee=new WeakMap,et=new WeakMap,en=new WeakMap,W=new WeakSet,es=function(){if(0===this.receivedMessages.length)throw new e_("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},er=function(){if(0===this.receivedMessages.length)throw new e_("stream ended without producing a Message with role=assistant");let e=this.receivedMessages.at(-1).content.filter(e=>"text"===e.type).map(e=>e.text);if(0===e.length)throw new e_("stream ended without producing a content block with type=text");return e.join(" ")},ea=function(){this.ended||eg(this,F,void 0,"f")},ei=function(e){if(this.ended)return;let t=ey(this,W,"m",el).call(this,e);switch(this._emit("streamEvent",e,t),e.type){case"content_block_delta":{let s=t.content.at(-1);switch(e.delta.type){case"text_delta":"text"===s.type&&this._emit("text",e.delta.text,s.text||"");break;case"citations_delta":"text"===s.type&&this._emit("citation",e.delta.citation,s.citations??[]);break;case"input_json_delta":tJ(s)&&s.input&&this._emit("inputJson",e.delta.partial_json,s.input);break;case"thinking_delta":"thinking"===s.type&&this._emit("thinking",e.delta.thinking,s.thinking);break;case"signature_delta":"thinking"===s.type&&this._emit("signature",s.signature);break;default:tX(e.delta)}break}case"message_stop":this._addMessageParam(t),this._addMessage(t,!0);break;case"content_block_stop":this._emit("contentBlock",t.content.at(-1));break;case"message_start":eg(this,F,t,"f")}},eo=function(){if(this.ended)throw new e_("stream has ended, this shouldn't happen");let e=ey(this,F,"f");if(!e)throw new e_("request ended without sending any chunks");return eg(this,F,void 0,"f"),e},el=function(e){let t=ey(this,F,"f");if("message_start"===e.type){if(t)throw new e_(`Unexpected event order, got ${e.type} before receiving "message_stop"`);return e.message}if(!t)throw new e_(`Unexpected event order, got ${e.type} before "message_start"`);switch(e.type){case"message_stop":case"content_block_stop":return t;case"message_delta":return t.stop_reason=e.delta.stop_reason,t.stop_sequence=e.delta.stop_sequence,t.usage.output_tokens=e.usage.output_tokens,null!=e.usage.input_tokens&&(t.usage.input_tokens=e.usage.input_tokens),null!=e.usage.cache_creation_input_tokens&&(t.usage.cache_creation_input_tokens=e.usage.cache_creation_input_tokens),null!=e.usage.cache_read_input_tokens&&(t.usage.cache_read_input_tokens=e.usage.cache_read_input_tokens),null!=e.usage.server_tool_use&&(t.usage.server_tool_use=e.usage.server_tool_use),t;case"content_block_start":return t.content.push({...e.content_block}),t;case"content_block_delta":{let s=t.content.at(e.index);switch(e.delta.type){case"text_delta":s?.type==="text"&&(t.content[e.index]={...s,text:(s.text||"")+e.delta.text});break;case"citations_delta":s?.type==="text"&&(t.content[e.index]={...s,citations:[...s.citations??[],e.delta.citation]});break;case"input_json_delta":if(s&&tJ(s)){let r=s[tV]||"";r+=e.delta.partial_json;let n={...s};Object.defineProperty(n,tV,{value:r,enumerable:!1,writable:!0}),r&&(n.input=tA(r)),t.content[e.index]=n}break;case"thinking_delta":s?.type==="thinking"&&(t.content[e.index]={...s,thinking:s.thinking+e.delta.thinking});break;case"signature_delta":s?.type==="thinking"&&(t.content[e.index]={...s,signature:e.delta.signature});break;default:tX(e.delta)}return t}}},Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("streamEvent",s=>{let r=t.shift();r?r.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let r of(s=!0,t))r.reject(e);t.length=0}),this.on("error",e=>{for(let r of(s=!0,t))r.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new e6(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function tX(e){}class tz extends tg{create(e,t){return this._client.post("/v1/messages/batches",{body:e,...t})}retrieve(e,t){return this._client.get(t_`/v1/messages/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/v1/messages/batches",tr,{query:e,...t})}delete(e,t){return this._client.delete(t_`/v1/messages/batches/${e}`,t)}cancel(e,t){return this._client.post(t_`/v1/messages/batches/${e}/cancel`,t)}async results(e,t){let s=await this.retrieve(e);if(!s.results_url)throw new e_(`No batch \`results_url\`; Has it finished processing? ${s.processing_status} - ${s.id}`);return this._client.get(s.results_url,{...t,headers:tb([{Accept:"application/binary"},t?.headers]),stream:!0,__binaryResponse:!0})._thenUnwrap((e,t)=>tq.fromResponse(t.response,t.controller))}}class tG extends tg{constructor(){super(...arguments),this.batches=new tz(this._client)}create(e,t){e.model in tY&&console.warn(`The model '${e.model}' is deprecated and will reach end-of-life on ${tY[e.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`);let s=this._client._options.timeout;if(!e.stream&&null==s){let t=tS[e.model]??void 0;s=this._client.calculateNonstreamingTimeout(e.max_tokens,t)}return this._client.post("/v1/messages",{body:e,timeout:s??6e5,...t,stream:e.stream??!1})}stream(e,t){return tK.createMessage(this,e,t)}countTokens(e,t){return this._client.post("/v1/messages/count_tokens",{body:e,...t})}}let tY={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-3-opus-20240229":"January 5th, 2026","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025","claude-3-7-sonnet-latest":"February 19th, 2026","claude-3-7-sonnet-20250219":"February 19th, 2026"};tG.Batches=tz;class tQ extends tg{retrieve(e,t={},s){let{betas:r}=t??{};return this._client.get(t_`/v1/models/${e}`,{...s,headers:tb([{...r?.toString()!=null?{"anthropic-beta":r?.toString()}:void 0},s?.headers])})}list(e={},t){let{betas:s,...r}=e??{};return this._client.getAPIList("/v1/models",tr,{query:r,...t,headers:tb([{...s?.toString()!=null?{"anthropic-beta":s?.toString()}:void 0},t?.headers])})}}let tZ=e=>void 0!==globalThis.process?globalThis.process.env?.[e]?.trim()??void 0:void 0!==globalThis.Deno?globalThis.Deno.env?.get?.(e)?.trim():void 0;class t0{constructor({baseURL:e=tZ("ANTHROPIC_BASE_URL"),apiKey:t=tZ("ANTHROPIC_API_KEY")??null,authToken:s=tZ("ANTHROPIC_AUTH_TOKEN")??null,...r}={}){ec.add(this),eh.set(this,void 0);const n={apiKey:t,authToken:s,...r,baseURL:e||"https://api.anthropic.com"};n.dangerouslyAllowBrowser,this.baseURL=n.baseURL,this.timeout=n.timeout??eu.DEFAULT_TIMEOUT,this.logger=n.logger??console;const a="warn";this.logLevel=a,this.logLevel=eY(n.logLevel,"ClientOptions.logLevel",this)??eY(tZ("ANTHROPIC_LOG"),"process.env['ANTHROPIC_LOG']",this)??a,this.fetchOptions=n.fetchOptions,this.maxRetries=n.maxRetries??2,this.fetch=n.fetch??function(){if("undefined"!=typeof fetch)return fetch;throw Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new Anthropic({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}(),eg(this,eh,eJ,"f"),this._options=n,this.apiKey="string"==typeof t?t:null,this.authToken=s}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,authToken:this.authToken,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){if(!(e.get("x-api-key")||e.get("authorization")||this.apiKey&&e.get("x-api-key")||t.has("x-api-key")||this.authToken&&e.get("authorization"))&&!t.has("authorization"))throw Error('Could not resolve authentication method. Expected either apiKey or authToken to be set. Or for one of the "X-Api-Key" or "Authorization" headers to be explicitly omitted')}async authHeaders(e){return tb([await this.apiKeyAuth(e),await this.bearerAuth(e)])}async apiKeyAuth(e){if(null!=this.apiKey)return tb([{"X-Api-Key":this.apiKey}])}async bearerAuth(e){if(null!=this.authToken)return tb([{Authorization:`Bearer ${this.authToken}`}])}stringifyQuery(e){return Object.entries(e).filter(([e,t])=>void 0!==t).map(([e,t])=>{if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;if(null===t)return`${encodeURIComponent(e)}=`;throw new e_(`Cannot stringify type ${typeof t}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${eU}`}defaultIdempotencyKey(){return`stainless-node-retry-${eb()}`}makeStatusError(e,t,s,r){return ek.generate(e,t,s,r)}buildURL(e,t,s){let r=!ey(this,ec,"m",ed).call(this)&&s||this.baseURL,n=new URL(ej.test(e)?e:r+(r.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),a=this.defaultQuery();return!function(e){if(!e)return!0;for(let t in e)return!1;return!0}(a)&&(t={...a,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}_calculateNonstreamingTimeout(e){if(3600*e/128e3>600)throw new e_("Streaming is required for operations that may take longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-typescript#streaming-responses for more details");return 6e5}async prepareOptions(e){}async prepareRequest(e,{url:t,options:s}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,s){return this.request(Promise.resolve(s).then(s=>({method:e,path:t,...s})))}request(e,t=null){return new te(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,s){let r=await e,n=r.maxRetries??this.maxRetries;null==t&&(t=n),await this.prepareOptions(r);let{req:a,url:i,timeout:o}=await this.buildRequest(r,{retryCount:n-t});await this.prepareRequest(a,{url:i,options:r});let l="log_"+(0x1000000*Math.random()|0).toString(16).padStart(6,"0"),c=void 0===s?"":`, retryOf: ${s}`,u=Date.now();if(e1(this).debug(`[${l}] sending request`,e4({retryOfRequestLogID:s,method:r.method,url:i,options:r,headers:a.headers})),r.signal?.aborted)throw new ex;let h=new AbortController,d=await this.fetchWithTimeout(i,a,o,h).catch(ev),p=Date.now();if(d instanceof globalThis.Error){let e=`retrying, ${t} attempts remaining`;if(r.signal?.aborted)throw new ex;let n=ew(d)||/timed? ?out/i.test(String(d)+("cause"in d?String(d.cause):""));if(t)return e1(this).info(`[${l}] connection ${n?"timed out":"failed"} - ${e}`),e1(this).debug(`[${l}] connection ${n?"timed out":"failed"} (${e})`,e4({retryOfRequestLogID:s,url:i,durationMs:p-u,message:d.message})),this.retryRequest(r,t,s??l);if(e1(this).info(`[${l}] connection ${n?"timed out":"failed"} - error; no more retries left`),e1(this).debug(`[${l}] connection ${n?"timed out":"failed"} (error; no more retries left)`,e4({retryOfRequestLogID:s,url:i,durationMs:p-u,message:d.message})),n)throw new eR;throw new eS({cause:d})}let f=[...d.headers.entries()].filter(([e])=>"request-id"===e).map(([e,t])=>", "+e+": "+JSON.stringify(t)).join(""),m=`[${l}${c}${f}] ${a.method} ${i} ${d.ok?"succeeded":"failed"} with status ${d.status} in ${p-u}ms`;if(!d.ok){let e=await this.shouldRetry(d);if(t&&e){let e=`retrying, ${t} attempts remaining`;return await eV(d.body),e1(this).info(`${m} - ${e}`),e1(this).debug(`[${l}] response error (${e})`,e4({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,durationMs:p-u})),this.retryRequest(r,t,s??l,d.headers)}let n=e?"error; no more retries left":"error; not retryable";e1(this).info(`${m} - ${n}`);let a=await d.text().catch(e=>ev(e).message),i=eD(a),o=i?void 0:a;throw e1(this).debug(`[${l}] response error (${n})`,e4({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,message:o,durationMs:Date.now()-u})),this.makeStatusError(d.status,i,o,d.headers)}return e1(this).info(m),e1(this).debug(`[${l}] response start`,e4({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,durationMs:p-u})),{response:d,options:r,controller:h,requestLogID:l,retryOfRequestLogID:s,startTime:u}}getAPIList(e,t,s){return this.requestAPIList(t,{method:"get",path:e,...s})}requestAPIList(e,t){return new ts(this,this.makeRequest(t,null,void 0),e)}async fetchWithTimeout(e,t,s,r){let{signal:n,method:a,...i}=t||{};n&&n.addEventListener("abort",()=>r.abort());let o=setTimeout(()=>r.abort(),s),l=globalThis.ReadableStream&&i.body instanceof globalThis.ReadableStream||"object"==typeof i.body&&null!==i.body&&Symbol.asyncIterator in i.body,c={signal:r.signal,...l?{duplex:"half"}:{},method:"GET",...i};a&&(c.method=a.toUpperCase());try{return await this.fetch.call(void 0,e,c)}finally{clearTimeout(o)}}async shouldRetry(e){let t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||!!(e.status>=500))}async retryRequest(e,t,s,r){let n,a,i=r?.get("retry-after-ms");if(i){let e=parseFloat(i);Number.isNaN(e)||(n=e)}let o=r?.get("retry-after");if(o&&!n){let e=parseFloat(o);n=Number.isNaN(e)?Date.parse(o)-Date.now():1e3*e}if(!(n&&0<=n&&n<6e4)){let s=e.maxRetries??this.maxRetries;n=this.calculateDefaultRetryTimeoutMillis(t,s)}return await (a=n,new Promise(e=>setTimeout(e,a))),this.makeRequest(e,t-1,s)}calculateDefaultRetryTimeoutMillis(e,t){return Math.min(.5*Math.pow(2,t-e),8)*(1-.25*Math.random())*1e3}calculateNonstreamingTimeout(e,t){if(36e5*e/128e3>6e5||null!=t&&e>t)throw new e_("Streaming is required for operations that may take longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-typescript#long-requests for more details");return 6e5}async buildRequest(e,{retryCount:t=0}={}){let s={...e},{method:r,path:n,query:a,defaultBaseURL:i}=s,o=this.buildURL(n,a,i);"timeout"in s&&((e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new e_(`${e} must be an integer`);if(t<0)throw new e_(`${e} must be a positive integer`)})("timeout",s.timeout),s.timeout=s.timeout??this.timeout;let{bodyHeaders:l,body:c}=this.buildBody({options:s}),u=await this.buildHeaders({options:e,method:r,bodyHeaders:l,retryCount:t});return{req:{method:r,headers:u,...s.signal&&{signal:s.signal},...globalThis.ReadableStream&&c instanceof globalThis.ReadableStream&&{duplex:"half"},...c&&{body:c},...this.fetchOptions??{},...s.fetchOptions??{}},url:o,timeout:s.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:s,retryCount:r}){let n={};this.idempotencyHeader&&"get"!==t&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),n[this.idempotencyHeader]=e.idempotencyKey);let a=tb([n,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(r),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...ep??(ep=(()=>{let e="undefined"!=typeof Deno&&null!=Deno.build?"deno":"undefined"!=typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call(void 0!==globalThis.process?globalThis.process:0)?"node":"unknown";if("deno"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":eU,"X-Stainless-OS":eW(Deno.build.os),"X-Stainless-Arch":eL(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":eU,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":eU,"X-Stainless-OS":eW(globalThis.process.platform??"unknown"),"X-Stainless-Arch":eL(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};let t=function(){if("undefined"==typeof navigator||!navigator)return null;for(let{key:e,pattern:t}of[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let s=t.exec(navigator.userAgent);if(s){let t=s[1]||0,r=s[2]||0,n=s[3]||0;return{browser:e,version:`${t}.${r}.${n}`}}}return null}();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":eU,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":eU,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}})()),...this._options.dangerouslyAllowBrowser?{"anthropic-dangerous-direct-browser-access":"true"}:void 0,"anthropic-version":"2023-06-01"},await this.authHeaders(e),this._options.defaultHeaders,s,e.headers]);return this.validateHeaders(a),a.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let s=tb([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||"string"==typeof e&&s.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:"object"==typeof e&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&"function"==typeof e.next)?{bodyHeaders:void 0,body:eB(e)}:ey(this,eh,"f").call(this,{body:e,headers:s})}}eu=t0,eh=new WeakMap,ec=new WeakSet,ed=function(){return"https://api.anthropic.com"!==this.baseURL},t0.Anthropic=eu,t0.HUMAN_PROMPT="\\n\\nHuman:",t0.AI_PROMPT="\\n\\nAssistant:",t0.DEFAULT_TIMEOUT=6e5,t0.AnthropicError=e_,t0.APIError=ek,t0.APIConnectionError=eS,t0.APIConnectionTimeoutError=eR,t0.APIUserAbortError=ex,t0.NotFoundError=eM,t0.ConflictError=eO,t0.RateLimitError=eP,t0.BadRequestError=eN,t0.AuthenticationError=eE,t0.InternalServerError=e$,t0.PermissionDeniedError=eA,t0.UnprocessableEntityError=eT,t0.toFile=tf;class t2 extends t0{constructor(){super(...arguments),this.completions=new tH(this),this.messages=new tG(this),this.models=new tQ(this),this.beta=new tB(this)}}t2.Completions=tH,t2.Messages=tG,t2.Models=tQ,t2.Beta=tB,e.s(["Anthropic",()=>t2],706380)},468488,e=>{"use strict";e.i(706380),e.i(347686),e.i(913767),e.i(248187),e.i(471004),e.s([])},40265,e=>{"use strict";var t=e.i(706380);e.s(["default",()=>t.Anthropic])},495014,e=>e.a(async(t,s)=>{try{e.i(468488);var r=e.i(40265),n=e.i(333203),a=t([n]);[n]=a.then?(await a)():a;let w=[{type:"web_search_20250305",name:"web_search",max_uses:5,allowed_domains:["di.se","svd.se","dn.se","breakit.se","realtid.se","affarsvarlden.se","va.se","nyteknik.se","omni.se","linkedin.com","wikipedia.org"]},{name:"search_companies",description:"SÃ¶k efter fÃ¶retag i LoopDesk:s bevakningslista eller i externa databaser. Returnerar fÃ¶retagsnamn, organisationsnummer, bransch och nyckeltal.",input_schema:{type:"object",properties:{query:{type:"string",description:"SÃ¶kterm - kan vara fÃ¶retagsnamn, del av namn, eller organisationsnummer"},limit:{type:"number",description:"Max antal resultat (default 10)"}},required:["query"]}},{name:"get_company_details",description:"HÃ¤mta detaljerad information om ett specifikt fÃ¶retag baserat pÃ¥ organisationsnummer. Inkluderar ekonomisk data, ledning, adress och status.",input_schema:{type:"object",properties:{orgNumber:{type:"string",description:"Organisationsnummer (10 siffror, t.ex. 5591234567)"}},required:["orgNumber"]}},{name:"search_announcements",description:"SÃ¶k kungÃ¶relser frÃ¥n Bolagsverket fÃ¶r ett fÃ¶retag. Visar registreringsÃ¤ndringar, styrelseÃ¤ndringar, konkurser, likvidationer mm.",input_schema:{type:"object",properties:{query:{type:"string",description:"FÃ¶retagsnamn eller organisationsnummer"},limit:{type:"number",description:"Max antal kungÃ¶relser (default 10)"}},required:["query"]}},{name:"get_news",description:"HÃ¤mta senaste nyheter frÃ¥n LoopDesk:s nyhetsflÃ¶de. Kan filtrera pÃ¥ sÃ¶kord eller kÃ¤lla.",input_schema:{type:"object",properties:{query:{type:"string",description:"SÃ¶kord fÃ¶r att filtrera nyheter (valfritt)"},sourceId:{type:"string",description:"Filtrera pÃ¥ nyhetskÃ¤lla (valfritt)"},limit:{type:"number",description:"Max antal nyheter (default 10)"}}}},{name:"get_investors",description:"SÃ¶k efter investerare - VC-bolag eller family offices. Visar portfÃ¶ljbolag, investeringsfokus och kontaktinfo.",input_schema:{type:"object",properties:{type:{type:"string",enum:["vc","family_office","all"],description:"Typ av investerare att sÃ¶ka"},query:{type:"string",description:"SÃ¶kterm fÃ¶r namn eller investeringsfokus (valfritt)"},limit:{type:"number",description:"Max antal resultat (default 10)"}},required:["type"]}},{name:"search_persons",description:"SÃ¶k efter personer - VD:ar, styrelsemedlemmar, grundare, investerare. Visar roller, fÃ¶retagskopplingar och kontaktinfo.",input_schema:{type:"object",properties:{query:{type:"string",description:"Namn eller del av namn att sÃ¶ka efter"},roleType:{type:"string",enum:["CEO","CHAIRMAN","BOARD_MEMBER","FOUNDER","INVESTOR","all"],description:"Filtrera pÃ¥ rolltyp (valfritt)"},limit:{type:"number",description:"Max antal resultat (default 10)"}},required:["query"]}},{name:"compare_companies",description:"JÃ¤mfÃ¶r nyckeltal mellan 2-5 fÃ¶retag sida vid sida. Visar omsÃ¤ttning, resultat, anstÃ¤llda, tillvÃ¤xt och finansiering.",input_schema:{type:"object",properties:{orgNumbers:{type:"array",items:{type:"string"},description:"Lista med organisationsnummer (2-5 stycken)"},metrics:{type:"array",items:{type:"string",enum:["revenue","profit","employees","funding","growth"]},description:"Vilka nyckeltal att jÃ¤mfÃ¶ra (valfritt, default alla)"}},required:["orgNumbers"]}},{name:"analyze_industry",description:"Analysera en bransch/nisch - antal bolag, total omsÃ¤ttning, genomsnittlig tillvÃ¤xt, top performers.",input_schema:{type:"object",properties:{industry:{type:"string",description:"Bransch/nisch att analysera (t.ex. 'cleantech', 'fintech', 'carbon removal', 'foodtech')"},limit:{type:"number",description:"Max antal top performers att visa (default 5)"}},required:["industry"]}},{name:"search_protocols",description:"SÃ¶k i kÃ¶pta protokoll frÃ¥n Bolagsverket. Visar AI-analyserad information om nyemissioner, styrelseÃ¤ndringar mm.",input_schema:{type:"object",properties:{query:{type:"string",description:"FÃ¶retagsnamn eller organisationsnummer (valfritt)"},eventType:{type:"string",enum:["nyemission","styrelseÃ¤ndring","fusion","likvidation","all"],description:"Filtrera pÃ¥ typ av hÃ¤ndelse (valfritt)"},limit:{type:"number",description:"Max antal protokoll (default 10)"}}}},{name:"match_investors",description:"Hitta investerare som matchar ett fÃ¶retags profil baserat pÃ¥ bransch och fas.",input_schema:{type:"object",properties:{orgNumber:{type:"string",description:"Organisationsnummer fÃ¶r fÃ¶retaget att matcha"},investorType:{type:"string",enum:["vc","family_office","all"],description:"Typ av investerare (default 'all')"}},required:["orgNumber"]}},{name:"manage_watchlist",description:"Hantera bevakningslistan - visa, lÃ¤gg till eller sÃ¶k fÃ¶retag.",input_schema:{type:"object",properties:{action:{type:"string",enum:["list","search","stats"],description:"Ã…tgÃ¤rd: 'list' visar alla, 'search' sÃ¶ker, 'stats' visar statistik"},query:{type:"string",description:"SÃ¶kterm fÃ¶r 'search' action (valfritt)"},limit:{type:"number",description:"Max antal resultat (default 20)"}},required:["action"]}}];async function i(e,t=10){let s=await n.prisma.watchedCompany.findMany({where:{OR:[{name:{contains:e,mode:"insensitive"}},{orgNumber:{contains:e}},{impactNiche:{contains:e,mode:"insensitive"}},{city:{contains:e,mode:"insensitive"}}]},select:{orgNumber:!0,name:!0,impactNiche:!0,city:!0,status:!0,employees:!0,turnover2024:!0,profit2024:!0,website:!0},take:t,orderBy:{name:"asc"}});return 0===s.length?{message:`Inga f\xf6retag hittades f\xf6r s\xf6kningen "${e}"`,results:[]}:{message:`Hittade ${s.length} f\xf6retag`,results:s.map(e=>({namn:e.name,orgNr:e.orgNumber,bransch:e.impactNiche||"Ej angiven",stad:e.city||"Ej angiven",status:e.status||"Aktiv",anstÃ¤llda:e.employees||"OkÃ¤nt",omsÃ¤ttning2024:e.turnover2024||"Ej tillgÃ¤ngligt",resultat2024:e.profit2024||"Ej tillgÃ¤ngligt",hemsida:e.website||null}))}}async function o(e){let t=await n.prisma.watchedCompany.findUnique({where:{orgNumber:e.replace(/[^0-9]/g,"")},include:{articleMatches:{include:{article:!0},take:5,orderBy:{createdAt:"desc"}}}});if(!t)return{error:`Inget f\xf6retag hittat med organisationsnummer ${e}`};let s=await n.prisma.announcement.findMany({where:{orgNumber:t.orgNumber},take:5,orderBy:{publishedAt:"desc"}});return{grundinfo:{namn:t.name,legalNamn:t.legalName,orgNr:t.orgNumber,bolagsform:t.companyType,status:t.status,registreringsdatum:t.registrationDate,bransch:t.sniDescription||t.impactNiche},kontakt:{adress:t.address,postnummer:t.postalCode,kommun:t.municipality,stad:t.city,telefon:t.phone,email:t.email,hemsida:t.website},ledning:{vd:t.ceo,styrelseordfÃ¶rande:t.chairman},ekonomi:{anstÃ¤llda:t.employees,omsÃ¤ttning2024:t.turnover2024,resultat2024:t.profit2024,omsÃ¤ttning2023:t.turnover2023,resultat2023:t.profit2023,tillvÃ¤xt:t.growth2023to2024,aktiekapital:t.shareCapital?`${t.shareCapital} SEK`:null},finansiering:{totalFinansiering:t.totalFunding,senasteRunda:t.latestFundingRound,senasteDatum:t.latestFundingDate,vÃ¤rdering:t.latestValuation,stÃ¶rstaÃ„gare:t.largestOwners},flaggor:{fSkatt:t.fSkatt,momsRegistrerad:t.momsRegistered,betalningsanmÃ¤rkningar:t.paymentRemarks},senastKungÃ¶relser:s.map(e=>({typ:e.type,datum:e.publishedAt?.toISOString().split("T")[0],text:e.detailText?.substring(0,200)})),senastNyheter:t.articleMatches.map(e=>({rubrik:e.article.title,datum:e.article.publishedAt?.toISOString().split("T")[0],kÃ¤lla:e.article.sourceName}))}}async function l(e,t=10){let s=await n.prisma.announcement.findMany({where:{OR:[{subject:{contains:e,mode:"insensitive"}},{orgNumber:{contains:e}},{type:{contains:e,mode:"insensitive"}}]},select:{id:!0,subject:!0,type:!0,pubDate:!0,publishedAt:!0,detailText:!0,orgNumber:!0},take:t,orderBy:{publishedAt:"desc"}});return 0===s.length?{message:`Inga kung\xf6relser hittades f\xf6r "${e}"`,results:[]}:{message:`Hittade ${s.length} kung\xf6relser`,results:s.map(e=>({id:e.id,fÃ¶retag:e.subject,orgNr:e.orgNumber,typ:e.type,datum:e.publishedAt?.toISOString().split("T")[0]||e.pubDate,sammanfattning:e.detailText?.substring(0,300)||"Ingen text tillgÃ¤nglig"}))}}async function c(e,t,s=10){let r=await n.prisma.article.findMany({where:{AND:[e?{OR:[{title:{contains:e,mode:"insensitive"}},{description:{contains:e,mode:"insensitive"}}]}:{},t?{sourceId:t}:{}]},select:{id:!0,title:!0,description:!0,url:!0,sourceName:!0,publishedAt:!0,imageUrl:!0},take:s,orderBy:{publishedAt:"desc"}});return 0===r.length?{message:e?`Inga nyheter hittades f\xf6r "${e}"`:"Inga nyheter tillgÃ¤ngliga",results:[]}:{message:`Hittade ${r.length} nyheter`,results:r.map(e=>({rubrik:e.title,beskrivning:e.description?.substring(0,200),kÃ¤lla:e.sourceName,datum:e.publishedAt?.toISOString().split("T")[0],lÃ¤nk:e.url}))}}async function u(e,t,s=10){let r={};("vc"===e||"all"===e)&&(r.vc=(await n.prisma.vCCompany.findMany({where:t?{OR:[{name:{contains:t,mode:"insensitive"}},{impactNiche:{contains:t,mode:"insensitive"}},{portfolioCompanies:{contains:t,mode:"insensitive"}}]}:{},select:{name:!0,type:!0,impactNiche:!0,description:!0,portfolioCompanies:!0,website:!0,office:!0,aum:!0},take:s,orderBy:{name:"asc"}})).map(e=>({namn:e.name,typ:e.type,fokus:e.impactNiche,beskrivning:e.description?.substring(0,200),portfÃ¶lj:e.portfolioCompanies?.substring(0,200),hemsida:e.website,kontor:e.office,aum:e.aum?`${(Number(e.aum)/1e9).toFixed(1)} mdkr`:null}))),("family_office"===e||"all"===e)&&(r.familyOffices=(await n.prisma.familyOffice.findMany({where:t?{OR:[{name:{contains:t,mode:"insensitive"}},{family:{contains:t,mode:"insensitive"}},{impactNiche:{contains:t,mode:"insensitive"}}]}:{},select:{name:!0,family:!0,impactNiche:!0,description:!0,portfolioCompanies:!0,website:!0,region:!0,assets:!0},take:s,orderBy:{name:"asc"}})).map(e=>({namn:e.name,familj:e.family,fokus:e.impactNiche,beskrivning:e.description?.substring(0,200),portfÃ¶lj:e.portfolioCompanies?.substring(0,200),hemsida:e.website,region:e.region,tillgÃ¥ngar:e.assets?`${(Number(e.assets)/1e9).toFixed(1)} mdkr`:null})));let a=(r.vc?.length||0)+(r.familyOffices?.length||0);return{message:`Hittade ${a} investerare`,...r}}async function h(e,t,s=10){let r=await n.prisma.person.findMany({where:{AND:[{OR:[{name:{contains:e,mode:"insensitive"}},{title:{contains:e,mode:"insensitive"}}]},t&&"all"!==t?{roles:{some:{roleType:t}}}:{}]},select:{id:!0,name:!0,title:!0,personType:!0,location:!0,totalCompanies:!0,activeCompanies:!0,totalBoardSeats:!0,roles:{where:{isActive:!0},select:{roleType:!0,roleTitle:!0,companyName:!0,orgNumber:!0},take:5,orderBy:{startDate:"desc"}}},take:s,orderBy:{totalCompanies:"desc"}});return 0===r.length?{message:`Inga personer hittades f\xf6r "${e}"`,results:[]}:{message:`Hittade ${r.length} personer`,results:r.map(e=>({namn:e.name,titel:e.title||"Ej angiven",typ:e.personType,plats:e.location||"Ej angiven",antalBolag:e.totalCompanies,aktivaBolag:e.activeCompanies,styrelseposter:e.totalBoardSeats,nuvarandeRoller:e.roles.map(e=>({roll:e.roleTitle||e.roleType,bolag:e.companyName,orgNr:e.orgNumber}))}))}}async function d(e,t){if(e.length<2||e.length>5)return{error:"Ange mellan 2 och 5 organisationsnummer fÃ¶r jÃ¤mfÃ¶relse"};let s=e.map(e=>e.replace(/[^0-9]/g,"")),r=await n.prisma.watchedCompany.findMany({where:{orgNumber:{in:s}},select:{orgNumber:!0,name:!0,impactNiche:!0,employees:!0,turnover2024:!0,profit2024:!0,turnover2023:!0,profit2023:!0,growth2023to2024:!0,totalFunding:!0,latestFundingRound:!0,latestValuation:!0,city:!0,status:!0}});if(0===r.length)return{error:"Inga av de angivna fÃ¶retagen hittades"};let a=r.map(e=>{let s={namn:e.name,orgNr:e.orgNumber,bransch:e.impactNiche||"Ej angiven",stad:e.city||"Ej angiven",status:e.status||"Aktiv"},r=!t||0===t.length;return(r||t?.includes("employees"))&&(s.anstÃ¤llda=e.employees||"OkÃ¤nt"),(r||t?.includes("revenue"))&&(s.omsÃ¤ttning2024=e.turnover2024||"Ej tillgÃ¤ngligt",s.omsÃ¤ttning2023=e.turnover2023||"Ej tillgÃ¤ngligt"),(r||t?.includes("profit"))&&(s.resultat2024=e.profit2024||"Ej tillgÃ¤ngligt",s.resultat2023=e.profit2023||"Ej tillgÃ¤ngligt"),(r||t?.includes("growth"))&&(s.tillvÃ¤xt=e.growth2023to2024||"Ej tillgÃ¤ngligt"),(r||t?.includes("funding"))&&(s.totalFinansiering=e.totalFunding||"Ej tillgÃ¤ngligt",s.senasteRunda=e.latestFundingRound||"Ej tillgÃ¤ngligt",s.vÃ¤rdering=e.latestValuation||"Ej tillgÃ¤ngligt"),s});return{message:`J\xe4mf\xf6relse av ${r.length} f\xf6retag`,jÃ¤mfÃ¶relse:a,saknade:s.filter(e=>!r.find(t=>t.orgNumber===e)).length>0?`${s.filter(e=>!r.find(t=>t.orgNumber===e)).length} f\xf6retag hittades inte`:null}}async function p(e,t=5){let s=await n.prisma.watchedCompany.findMany({where:{OR:[{impactNiche:{contains:e,mode:"insensitive"}},{sniDescription:{contains:e,mode:"insensitive"}}]},select:{orgNumber:!0,name:!0,impactNiche:!0,city:!0,employees:!0,turnover2024:!0,profit2024:!0,growth2023to2024:!0,totalFunding:!0,status:!0},orderBy:{turnover2024:{sort:"desc",nulls:"last"}}});if(0===s.length)return{message:`Inga f\xf6retag hittades inom "${e}"`,results:[],tips:"Prova bredare sÃ¶ktermer som 'cleantech', 'fintech', 'foodtech', 'impact'"};let r=s.filter(e=>e.turnover2024&&"string"==typeof e.turnover2024);s.filter(e=>e.profit2024&&"string"==typeof e.profit2024);let a=s.filter(e=>null!=e.employees),i=s.filter(e=>e.growth2023to2024&&"string"==typeof e.growth2023to2024),o=r.reduce((e,t)=>e+(e=>{let t=e.match(/([\d,.]+)\s*(MSEK|MDSEK|TSEK)/i);if(!t)return 0;let s=parseFloat(t[1].replace(",",".")),r=t[2].toUpperCase();return"MDSEK"===r?1e3*s:"TSEK"===r?s/1e3:s})(t.turnover2024),0),l=a.reduce((e,t)=>e+(t.employees||0),0),c=i.length>0?i.reduce((e,t)=>{let s;return e+((s=t.growth2023to2024.match(/([-\d,.]+)\s*%/))?parseFloat(s[1].replace(",",".")):0)},0)/i.length:0,u=s.reduce((e,t)=>{let s=t.city||"OkÃ¤nd";return e[s]=(e[s]||0)+1,e},{}),h=Object.entries(u).sort((e,t)=>t[1]-e[1]).slice(0,5).map(([e,t])=>({stad:e,antal:t})),d=s.slice(0,t).map(e=>({namn:e.name,orgNr:e.orgNumber,bransch:e.impactNiche,omsÃ¤ttning:e.turnover2024||"OkÃ¤nt",tillvÃ¤xt:e.growth2023to2024||"OkÃ¤nt",anstÃ¤llda:e.employees||"OkÃ¤nt"}));return{bransch:e,sammanfattning:{antalBolag:s.length,totalOmsÃ¤ttning:`${Math.round(o)} MSEK`,totaltAnstÃ¤llda:l,genomsnittligTillvÃ¤xt:`${c.toFixed(1)}%`,aktivaBolag:s.filter(e=>"active"===e.status||!e.status).length},geografiskSpridning:h,topPerformers:d}}async function f(e,t,s=10){let r={};e&&(r.OR=[{companyName:{contains:e,mode:"insensitive"}},{orgNumber:{contains:e}}]),t&&"all"!==t&&(r.eventType={contains:t,mode:"insensitive"});let a=await n.prisma.protocolPurchase.findMany({where:r,select:{id:!0,orgNumber:!0,companyName:!0,protocolDate:!0,purchaseDate:!0,eventType:!0,aiSummary:!0,aiDetails:!0,extractedText:!0,pdfUrl:!0},take:s,orderBy:{protocolDate:"desc"}});return 0===a.length?{message:e?`Inga protokoll hittades f\xf6r "${e}"`:"Inga protokoll tillgÃ¤ngliga",results:[],tips:"Protokoll kÃ¶ps frÃ¥n Bolagsverket och lagras med AI-analys"}:{message:`Hittade ${a.length} protokoll`,results:a.map(e=>({id:e.id,fÃ¶retag:e.companyName,orgNr:e.orgNumber,protokollDatum:e.protocolDate?.toISOString().split("T")[0],kÃ¶ptDatum:e.purchaseDate?.toISOString().split("T")[0],hÃ¤ndelseTyp:e.eventType||"OkÃ¤nd",aiSammanfattning:e.aiSummary||"Ingen sammanfattning tillgÃ¤nglig",aiDetaljer:e.aiDetails||null,harPDF:!!e.pdfUrl,textUtdrag:e.extractedText?.substring(0,500)||null}))}}async function m(e,t="all"){let s=await n.prisma.watchedCompany.findUnique({where:{orgNumber:e.replace(/[^0-9]/g,"")},select:{name:!0,orgNumber:!0,impactNiche:!0,city:!0,totalFunding:!0,latestFundingRound:!0,employees:!0,turnover2024:!0}});if(!s)return{error:`Inget f\xf6retag hittat med organisationsnummer ${e}`};let r=(s.impactNiche?.toLowerCase()||"").split(/[,\s]+/).filter(e=>e.length>3),a={};("vc"===t||"all"===t)&&(a.vc=(await n.prisma.vCCompany.findMany({where:r.length>0?{OR:r.map(e=>({OR:[{impactNiche:{contains:e,mode:"insensitive"}},{portfolioCompanies:{contains:e,mode:"insensitive"}},{description:{contains:e,mode:"insensitive"}}]}))}:{},select:{name:!0,type:!0,impactNiche:!0,description:!0,portfolioCompanies:!0,website:!0,office:!0,aum:!0},take:10,orderBy:{aum:{sort:"desc",nulls:"last"}}})).map(e=>({namn:e.name,typ:e.type,fokus:e.impactNiche,matchAnledning:`Fokuserar p\xe5 ${e.impactNiche||"liknande branscher"}`,portfÃ¶ljExempel:e.portfolioCompanies?.substring(0,150),hemsida:e.website,aum:e.aum?`${(Number(e.aum)/1e9).toFixed(1)} mdkr`:null}))),("family_office"===t||"all"===t)&&(a.familyOffices=(await n.prisma.familyOffice.findMany({where:r.length>0?{OR:r.map(e=>({OR:[{impactNiche:{contains:e,mode:"insensitive"}},{portfolioCompanies:{contains:e,mode:"insensitive"}},{description:{contains:e,mode:"insensitive"}}]}))}:{},select:{name:!0,family:!0,impactNiche:!0,description:!0,portfolioCompanies:!0,website:!0,region:!0,assets:!0},take:10,orderBy:{assets:{sort:"desc",nulls:"last"}}})).map(e=>({namn:e.name,familj:e.family,fokus:e.impactNiche,matchAnledning:`Investerar i ${e.impactNiche||"liknande branscher"}`,portfÃ¶ljExempel:e.portfolioCompanies?.substring(0,150),hemsida:e.website,region:e.region,tillgÃ¥ngar:e.assets?`${(Number(e.assets)/1e9).toFixed(1)} mdkr`:null})));let i=(a.vc?.length||0)+(a.familyOffices?.length||0);return{fÃ¶retag:{namn:s.name,orgNr:s.orgNumber,bransch:s.impactNiche,stad:s.city,finansiering:s.totalFunding,senasteRunda:s.latestFundingRound},matchadeInvesterare:{totalt:i,sÃ¶kordAnvÃ¤nda:r,...a},tips:0===i?"Prova att bredda sÃ¶kningen eller kontrollera att fÃ¶retaget har rÃ¤tt branschkategori":null}}async function g(e,t,s=20){switch(e){case"list":{let e=await n.prisma.watchedCompany.findMany({select:{orgNumber:!0,name:!0,impactNiche:!0,city:!0,employees:!0,turnover2024:!0},take:s,orderBy:{name:"asc"}});return{message:`Bevakningslistan inneh\xe5ller ${e.length} f\xf6retag (visar ${Math.min(s,e.length)})`,fÃ¶retag:e.map(e=>({namn:e.name,orgNr:e.orgNumber,bransch:e.impactNiche||"Ej angiven",stad:e.city||"Ej angiven"}))}}case"search":{if(!t)return{error:"SÃ¶kterm krÃ¤vs fÃ¶r 'search' action"};let e=await n.prisma.watchedCompany.findMany({where:{OR:[{name:{contains:t,mode:"insensitive"}},{orgNumber:{contains:t}},{impactNiche:{contains:t,mode:"insensitive"}},{city:{contains:t,mode:"insensitive"}},{ceo:{contains:t,mode:"insensitive"}}]},select:{orgNumber:!0,name:!0,impactNiche:!0,city:!0,ceo:!0,employees:!0,turnover2024:!0},take:s,orderBy:{name:"asc"}});return{message:`Hittade ${e.length} f\xf6retag f\xf6r "${t}"`,fÃ¶retag:e.map(e=>({namn:e.name,orgNr:e.orgNumber,bransch:e.impactNiche||"Ej angiven",stad:e.city||"Ej angiven",vd:e.ceo||"Ej angiven"}))}}case"stats":{let[e,t,s]=await Promise.all([n.prisma.watchedCompany.count(),n.prisma.watchedCompany.groupBy({by:["impactNiche"],_count:{id:!0},orderBy:{_count:{id:"desc"}},take:10}),n.prisma.watchedCompany.groupBy({by:["city"],_count:{id:!0},orderBy:{_count:{id:"desc"}},take:10})]);return{statistik:{totaltAntalFÃ¶retag:e,fÃ¶rdelningPerBransch:t.map(e=>({bransch:e.impactNiche||"Ej angiven",antal:e._count.id})),fÃ¶rdelningPerStad:s.map(e=>({stad:e.city||"Ej angiven",antal:e._count.id}))}}}default:return{error:`Ok\xe4nd action: ${e}`}}}async function y(e,t){try{let s;switch(e){case"search_companies":s=await i(t.query,t.limit||10);break;case"get_company_details":s=await o(t.orgNumber);break;case"search_announcements":s=await l(t.query,t.limit||10);break;case"get_news":s=await c(t.query,t.sourceId,t.limit||10);break;case"get_investors":s=await u(t.type,t.query,t.limit||10);break;case"search_persons":s=await h(t.query,t.roleType,t.limit||10);break;case"compare_companies":s=await d(t.orgNumbers,t.metrics);break;case"analyze_industry":s=await p(t.industry,t.limit||5);break;case"search_protocols":s=await f(t.query,t.eventType,t.limit||10);break;case"match_investors":s=await m(t.orgNumber,t.investorType||"all");break;case"manage_watchlist":s=await g(t.action,t.query,t.limit||20);break;default:s={error:`Ok\xe4nt verktyg: ${e}`}}return JSON.stringify(s,null,2)}catch(t){return console.error(`Tool execution error (${e}):`,t),JSON.stringify({error:`Fel vid k\xf6rning av ${e}`,details:t instanceof Error?t.message:"OkÃ¤nt fel"})}}async function b(e){try{let{messages:t,systemPrompt:s}=await e.json();if(!t||!Array.isArray(t))return new Response(JSON.stringify({error:"Messages array is required"}),{status:400,headers:{"Content-Type":"application/json"}});let n=process.env.ANTHROPIC_API_KEY?.trim();if(!n)return new Response(JSON.stringify({error:"ANTHROPIC_API_KEY not configured"}),{status:500,headers:{"Content-Type":"application/json"}});let a=new r.default({apiKey:n}),i=`Du \xe4r LoopDesk Assistant, en AI-assistent f\xf6r den svenska business intelligence-plattformen LoopDesk.

Du har tillg\xe5ng till f\xf6ljande verktyg:

**Databasverktyg:**
- **search_companies**: S\xf6k f\xf6retag i bevakningslistan (1200+ svenska impactbolag). S\xf6kbar p\xe5 namn, stad, bransch.
- **get_company_details**: H\xe4mta fullst\xe4ndig info om ett f\xf6retag (ekonomi, ledning, finansiering, kung\xf6relser, nyheter).
- **search_announcements**: S\xf6k kung\xf6relser fr\xe5n Bolagsverket (styrelse\xe4ndringar, konkurser, nyemissioner mm).
- **get_news**: H\xe4mta nyheter fr\xe5n RSS-fl\xf6det. Kan filtrera p\xe5 s\xf6kord.
- **get_investors**: S\xf6k VC-bolag och family offices i Sverige.
- **search_persons**: S\xf6k efter personer - VD:ar, styrelsemedlemmar, grundare. Visa roller och f\xf6retagskopplingar.
- **compare_companies**: J\xe4mf\xf6r nyckeltal mellan 2-5 f\xf6retag sida vid sida.
- **analyze_industry**: Analysera en bransch - antal bolag, total oms\xe4ttning, tillv\xe4xt, top performers.
- **search_protocols**: S\xf6k i k\xf6pta protokoll fr\xe5n Bolagsverket med AI-analys (nyemissioner, styrelse\xe4ndringar mm).
- **match_investors**: Hitta investerare som matchar ett f\xf6retags bransch och profil.
- **manage_watchlist**: Hantera och s\xf6k i bevakningslistan, visa statistik.

**Webbs\xf6kning:**
- **web_search**: S\xf6k p\xe5 webben efter aktuella nyheter och information (begr\xe4nsat till svenska aff\xe4rstidningar).

**Arbetsfl\xf6de:**
1. Vid f\xf6retagsfr\xe5gor: B\xf6rja med search_companies, anv\xe4nd sedan get_company_details f\xf6r mer info.
2. Vid nyhetsfr\xe5gor: Anv\xe4nd get_news eller web_search f\xf6r aktuella nyheter.
3. Vid investerar-fr\xe5gor: Anv\xe4nd get_investors eller match_investors f\xf6r att hitta passande investerare.
4. Vid persons\xf6kning: Anv\xe4nd search_persons med namn och eventuell rolltyp.
5. Vid j\xe4mf\xf6relser: Anv\xe4nd compare_companies med organisationsnummer.
6. Vid branschanalys: Anv\xe4nd analyze_industry med branschnamn (t.ex. "cleantech", "fintech").
7. Vid protokollfr\xe5gor: Anv\xe4nd search_protocols f\xf6r att hitta k\xf6pta protokoll med AI-analys.
8. F\xf6r bevakningslistan: Anv\xe4nd manage_watchlist f\xf6r statistik och s\xf6kning.
9. Kombinera verktyg vid behov f\xf6r att ge ett komplett svar.

**Format:**
- Svara alltid p\xe5 svenska
- Var koncis men informativ
- Anv\xe4nd punktlistor f\xf6r listor med data
- Presentera ekonomiska data tydligt
- Ange organisationsnummer n\xe4r du n\xe4mner specifika f\xf6retag
- Vid webbs\xf6kningar, ange alltid k\xe4lla och datum`,o=t.map(e=>({role:e.role,content:e.content})),l=new TextEncoder,c=new ReadableStream({async start(e){try{let t=!0;for(;t;){let r=await a.messages.create({model:"claude-sonnet-4-5-20250929",max_tokens:2048,system:s||i,messages:o,tools:w});for(let t of r.content)if("text"===t.type){let s=JSON.stringify({text:t.text});e.enqueue(l.encode(`data: ${s}

`))}else if("tool_use"===t.type){let s=JSON.stringify({tool:t.name,status:"executing"});e.enqueue(l.encode(`data: ${s}

`));let n=await y(t.name,t.input);o.push({role:"assistant",content:r.content}),o.push({role:"user",content:[{type:"tool_result",tool_use_id:t.id,content:n}]})}"end_turn"===r.stop_reason||"stop_sequence"===r.stop_reason?t=!1:"tool_use"!==r.stop_reason&&(t=!1)}e.enqueue(l.encode(`data: [DONE]

`)),e.close()}catch(s){console.error("Streaming error:",s);let t=s instanceof Error?s.message:"Unknown error";e.enqueue(l.encode(`data: ${JSON.stringify({error:t})}

`)),e.close()}}});return new Response(c,{headers:{"Content-Type":"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive"}})}catch(t){console.error("Chat API error:",t);let e=t instanceof Error?t.message:"Unknown error";return new Response(JSON.stringify({error:"Failed to process chat request",details:e}),{status:500,headers:{"Content-Type":"application/json"}})}}e.s(["POST",()=>b]),s()}catch(e){s(e)}},!1),562301,e=>e.a(async(t,s)=>{try{var r=e.i(594236),n=e.i(731205),a=e.i(299044),i=e.i(789986),o=e.i(372874),l=e.i(96846),c=e.i(887304),u=e.i(879328),h=e.i(361547),d=e.i(70569),p=e.i(143981),f=e.i(443147),m=e.i(773331),g=e.i(716859),y=e.i(13751),b=e.i(193695);e.i(882560);var w=e.i(851855),v=e.i(495014),_=t([v]);[v]=_.then?(await _)():_;let S=new r.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/chat/route",pathname:"/api/chat",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/CLAUDE/projects/1. Loop Desk/src/app/api/chat/route.ts",nextConfigOutput:"standalone",userland:v}),{workAsyncStorage:R,workUnitAsyncStorage:N,serverHooks:E}=S;function k(){return(0,a.patchFetch)({workAsyncStorage:R,workUnitAsyncStorage:N})}async function x(e,t,s){S.isDev&&(0,i.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let r="/api/chat/route";r=r.replace(/\/index$/,"")||"/";let a=await S.prepare(e,t,{srcPage:r,multiZoneDraftMode:!1});if(!a)return t.statusCode=400,t.end("Bad Request"),null==s.waitUntil||s.waitUntil.call(s,Promise.resolve()),null;let{buildId:v,params:_,nextConfig:k,parsedUrl:x,isDraftMode:R,prerenderManifest:N,routerServerContext:E,isOnDemandRevalidate:A,revalidateOnlyGenerated:M,resolvedPathname:O,clientReferenceManifest:T,serverActionsManifest:P}=a,$=(0,c.normalizeAppPath)(r),j=!!(N.dynamicRoutes[$]||N.routes[O]),C=async()=>((null==E?void 0:E.render404)?await E.render404(e,t,x,!1):t.end("This page could not be found"),null);if(j&&!R){let e=!!N.routes[O],t=N.dynamicRoutes[$];if(t&&!1===t.fallback&&!e){if(k.experimental.adapterPath)return await C();throw new b.NoFallbackError}}let I=null;!j||S.isDev||R||(I=O,I="/index"===I?"/":I);let q=!0===S.isDev||!j,D=j&&!q;P&&T&&(0,l.setManifestsSingleton)({page:r,clientReferenceManifest:T,serverActionsManifest:P});let U=e.method||"GET",L=(0,o.getTracer)(),W=L.getActiveScopeSpan(),F={params:_,prerenderManifest:N,renderOpts:{experimental:{authInterrupts:!!k.experimental.authInterrupts},cacheComponents:!!k.cacheComponents,supportsDynamicResponse:q,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:k.cacheLife,waitUntil:s.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,s,r,n)=>S.onRequestError(e,t,r,n,E)},sharedContext:{buildId:v}},B=new u.NodeNextRequest(e),H=new u.NodeNextResponse(t),V=h.NextRequestAdapter.fromNodeNextRequest(B,(0,h.signalFromNodeResponse)(t));try{let a=async e=>S.handle(V,F).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let s=L.getRootSpanAttributes();if(!s)return;if(s.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${s.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=s.get("next.route");if(n){let t=`${U} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${U} ${r}`)}),l=!!(0,i.getRequestMeta)(e,"minimalMode"),c=async i=>{var o,c;let u=async({previousCacheEntry:n})=>{try{if(!l&&A&&M&&!n)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let r=await a(i);e.fetchMetrics=F.renderOpts.fetchMetrics;let o=F.renderOpts.pendingWaitUntil;o&&s.waitUntil&&(s.waitUntil(o),o=void 0);let c=F.renderOpts.collectedTags;if(!j)return await (0,f.sendResponse)(B,H,r,F.renderOpts.pendingWaitUntil),null;{let e=await r.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(r.headers);c&&(t[y.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let s=void 0!==F.renderOpts.collectedRevalidate&&!(F.renderOpts.collectedRevalidate>=y.INFINITE_CACHE)&&F.renderOpts.collectedRevalidate,n=void 0===F.renderOpts.collectedExpire||F.renderOpts.collectedExpire>=y.INFINITE_CACHE?void 0:F.renderOpts.collectedExpire;return{value:{kind:w.CachedRouteKind.APP_ROUTE,status:r.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:s,expire:n}}}}catch(t){throw(null==n?void 0:n.isStale)&&await S.onRequestError(e,t,{routerKind:"App Router",routePath:r,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:D,isOnDemandRevalidate:A})},!1,E),t}},h=await S.handleResponse({req:e,nextConfig:k,cacheKey:I,routeKind:n.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:N,isRoutePPREnabled:!1,isOnDemandRevalidate:A,revalidateOnlyGenerated:M,responseGenerator:u,waitUntil:s.waitUntil,isMinimalMode:l});if(!j)return null;if((null==h||null==(o=h.value)?void 0:o.kind)!==w.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==h||null==(c=h.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",A?"REVALIDATED":h.isMiss?"MISS":h.isStale?"STALE":"HIT"),R&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let d=(0,m.fromNodeOutgoingHttpHeaders)(h.value.headers);return l&&j||d.delete(y.NEXT_CACHE_TAGS_HEADER),!h.cacheControl||t.getHeader("Cache-Control")||d.get("Cache-Control")||d.set("Cache-Control",(0,g.getCacheControlHeader)(h.cacheControl)),await (0,f.sendResponse)(B,H,new Response(h.value.body,{headers:d,status:h.value.status||200})),null};W?await c(W):await L.withPropagatedContext(e.headers,()=>L.trace(d.BaseServerSpan.handleRequest,{spanName:`${U} ${r}`,kind:o.SpanKind.SERVER,attributes:{"http.method":U,"http.target":e.url}},c))}catch(t){if(t instanceof b.NoFallbackError||await S.onRequestError(e,t,{routerKind:"App Router",routePath:$,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:D,isOnDemandRevalidate:A})},!1,E),j)throw t;return await (0,f.sendResponse)(B,H,new Response(null,{status:500})),null}}e.s(["handler",()=>x,"patchFetch",()=>k,"routeModule",()=>S,"serverHooks",()=>E,"workAsyncStorage",()=>R,"workUnitAsyncStorage",()=>N]),s()}catch(e){s(e)}},!1)];

//# debugId=f76fe24b-1761-d672-ae1f-5efffd6f8ca9
//# sourceMappingURL=CLAUDE_projects_1_%20Loop%20Desk_6fc0f4f1._.js.map