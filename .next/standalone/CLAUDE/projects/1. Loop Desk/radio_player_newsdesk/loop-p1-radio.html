<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Loop P1</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: 'Inter', -apple-system, system-ui, sans-serif;
      background: #fafafa;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .player {
      background: #fff;
      border: 1px solid rgba(0,0,0,0.08);
      border-radius: 14px;
      padding: 16px 20px;
      display: flex;
      align-items: center;
      gap: 16px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.04);
    }

    .brand {
      font-size: 13px;
      font-weight: 700;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      color: #18181b;
      padding-left: 12px;
      border-left: 3px solid #18181b;
      line-height: 1.2;
    }

    .divider {
      width: 1px;
      height: 40px;
      background: rgba(0,0,0,0.08);
    }

    .controls {
      display: flex;
      gap: 12px;
    }

    .channel {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }

    .channel-label {
      font-size: 10px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: #a1a1aa;
    }

    .channel.active .channel-label {
      color: #18181b;
    }

    .btn {
      width: 48px;
      height: 48px;
      border: 2px solid rgba(0,0,0,0.08);
      border-radius: 10px;
      background: #fff;
      cursor: pointer;
      transition: all 0.15s ease;
      padding: 0;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .btn img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .btn:hover {
      border-color: rgba(0,0,0,0.2);
      transform: scale(1.05);
    }

    .btn.active {
      border-color: #18181b;
      box-shadow: 0 0 0 2px rgba(24,24,27,0.1);
    }

    .status {
      font-size: 11px;
      color: #a1a1aa;
      min-width: 60px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .status.playing {
      color: #18181b;
    }

    .status .dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: #ef4444;
      animation: pulse 1.5s ease infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.4; }
    }
  </style>
</head>
<body>
  <div class="player">
    <div class="brand">Loop P1</div>
    <div class="divider"></div>
    <div class="controls">
      <div class="channel" id="liveChannel">
        <span class="channel-label">Live</span>
        <button class="btn" id="liveBtn" onclick="toggleLive()">
          <img src="sverigesp1.png" alt="P1">
        </button>
      </div>
      <div class="channel" id="newsChannel">
        <span class="channel-label">Senaste</span>
        <button class="btn" id="newsBtn" onclick="toggleNews()">
          <img src="ekot.jpg" alt="Ekot">
        </button>
      </div>
    </div>
    <div class="status" id="status"></div>
  </div>

  <audio id="audioPlayer"></audio>

  <script>
    const audio = document.getElementById('audioPlayer');
    const liveBtn = document.getElementById('liveBtn');
    const newsBtn = document.getElementById('newsBtn');
    const liveChannel = document.getElementById('liveChannel');
    const newsChannel = document.getElementById('newsChannel');
    const status = document.getElementById('status');

    const P1_LIVE = 'https://sverigesradio.se/topsy/direkt/srapi/132.mp3';
    let currentMode = null;
    let newsUrl = null;

    async function fetchLatestNews() {
      try {
        const res = await fetch('https://api.sr.se/api/v2/news/episodes?format=json');
        const data = await res.json();
        const ekot = data.episodes.find(ep => 
          ep.program.name.toLowerCase().includes('ekot')
        ) || data.episodes[0];
        
        if (ekot?.listenpodfile?.url) {
          newsUrl = ekot.listenpodfile.url;
        }
      } catch (e) {
        console.error('Kunde inte hämta nyheter:', e);
      }
    }

    function toggleLive() {
      if (currentMode === 'live') {
        stop();
      } else {
        play('live', P1_LIVE);
      }
    }

    function toggleNews() {
      if (currentMode === 'news') {
        stop();
      } else if (newsUrl) {
        play('news', newsUrl);
      } else {
        status.innerHTML = 'Laddar...';
        fetchLatestNews().then(() => {
          if (newsUrl) play('news', newsUrl);
          else status.innerHTML = 'Ej tillgänglig';
        });
      }
    }

    function play(mode, url) {
      audio.src = url;
      audio.play();
      currentMode = mode;
      updateUI();
    }

    function stop() {
      audio.pause();
      audio.src = '';
      currentMode = null;
      updateUI();
    }

    function updateUI() {
      liveBtn.classList.toggle('active', currentMode === 'live');
      newsBtn.classList.toggle('active', currentMode === 'news');
      liveChannel.classList.toggle('active', currentMode === 'live');
      newsChannel.classList.toggle('active', currentMode === 'news');
      
      if (currentMode === 'live') {
        status.innerHTML = '<span class="dot"></span> P1';
        status.classList.add('playing');
      } else if (currentMode === 'news') {
        status.innerHTML = '<span class="dot"></span> Ekot';
        status.classList.add('playing');
      } else {
        status.innerHTML = '';
        status.classList.remove('playing');
      }
    }

    audio.addEventListener('ended', () => {
      if (currentMode === 'news') stop();
    });

    audio.addEventListener('error', () => {
      status.innerHTML = 'Fel';
      setTimeout(() => stop(), 2000);
    });

    fetchLatestNews();
  </script>
</body>
</html>
