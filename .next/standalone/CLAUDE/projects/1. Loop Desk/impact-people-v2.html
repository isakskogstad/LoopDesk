<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Impact People | Loop Desk</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600&family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;1,400&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    :root {
      --font-display: 'Playfair Display', Georgia, serif;
      --font-serif: 'Cormorant Garamond', Georgia, serif;
      --font-body: 'DM Sans', -apple-system, system-ui, sans-serif;

      --text-6xl: 72px;
      --text-5xl: 56px;
      --text-4xl: 44px;
      --text-3xl: 36px;
      --text-2xl: 28px;
      --text-xl: 22px;
      --text-lg: 18px;
      --text-base: 16px;
      --text-sm: 14px;
      --text-xs: 12px;
      --text-xxs: 11px;

      --bg-primary: #faf9f7;
      --bg-secondary: #f5f4f1;
      --bg-card: #ffffff;
      --bg-muted: #f0eeea;
      --text-primary: #1a1a1a;
      --text-secondary: #3d3d3d;
      --text-muted: #666666;
      --text-subtle: #999999;

      --accent: #c41e3a;
      --accent-hover: #a31830;
      --accent-soft: rgba(196, 30, 58, 0.06);
      --accent-gold: #b8860b;
      --accent-gold-soft: rgba(184, 134, 11, 0.08);
      --green: #22c55e;
      --green-soft: rgba(34, 197, 94, 0.08);
      --blue: #3b82f6;
      --blue-soft: rgba(59, 130, 246, 0.08);
      --purple: #8b5cf6;
      --purple-soft: rgba(139, 92, 246, 0.08);

      --border-subtle: #f0eeea;
      --border-default: #e8e5df;
      --border-strong: #d4d0c8;

      --space-1: 4px;
      --space-2: 8px;
      --space-3: 12px;
      --space-4: 16px;
      --space-5: 20px;
      --space-6: 24px;
      --space-8: 32px;
      --space-10: 40px;
      --space-12: 48px;
      --space-16: 64px;

      --radius-sm: 4px;
      --radius-md: 8px;
      --radius-lg: 12px;
      --radius-xl: 16px;
      --radius-2xl: 24px;
      --radius-full: 9999px;

      --shadow-subtle: 0 1px 2px rgba(26, 26, 26, 0.03);
      --shadow-sm: 0 2px 8px rgba(26, 26, 26, 0.04);
      --shadow-md: 0 4px 16px rgba(26, 26, 26, 0.06);
      --shadow-lg: 0 12px 32px rgba(26, 26, 26, 0.08);
      --shadow-xl: 0 24px 56px rgba(26, 26, 26, 0.12);

      --ease-out-expo: cubic-bezier(0.19, 1, 0.22, 1);
      --ease-out-back: cubic-bezier(0.34, 1.56, 0.64, 1);
      --transition-fast: 120ms var(--ease-out-expo);
      --transition-base: 280ms var(--ease-out-expo);
      --transition-slow: 450ms var(--ease-out-expo);
    }

    [data-theme="dark"] {
      --bg-primary: #0d0d0d;
      --bg-secondary: #141414;
      --bg-card: #1a1a1a;
      --bg-muted: #222222;
      --text-primary: #f5f5f5;
      --text-secondary: #cccccc;
      --text-muted: #888888;
      --text-subtle: #666666;
      --accent: #e8344f;
      --accent-soft: rgba(232, 52, 79, 0.1);
      --border-subtle: #222222;
      --border-default: #2d2d2d;
      --border-strong: #404040;
      --green-soft: rgba(34, 197, 94, 0.15);
      --blue-soft: rgba(59, 130, 246, 0.15);
      --purple-soft: rgba(139, 92, 246, 0.15);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: var(--font-body);
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
      min-height: 100vh;
    }

    /* Header */
    .header {
      position: sticky;
      top: 0;
      z-index: 100;
      background: rgba(250, 249, 247, 0.9);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border-subtle);
      padding: var(--space-4) var(--space-8);
      display: flex;
      align-items: center;
      gap: var(--space-8);
    }

    [data-theme="dark"] .header {
      background: rgba(13, 13, 13, 0.9);
    }

    .logo {
      font-family: var(--font-body);
      font-size: 13px;
      font-weight: 700;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      text-decoration: none;
      color: var(--text-primary);
      padding-left: 14px;
      position: relative;
    }

    .logo::before {
      content: '';
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      width: 3px;
      height: 28px;
      background: var(--accent);
      border-radius: 2px;
    }

    .logo span { display: block; }

    .header-nav {
      display: flex;
      gap: var(--space-1);
    }

    .nav-link {
      padding: var(--space-2) var(--space-4);
      color: var(--text-muted);
      text-decoration: none;
      font-size: var(--text-sm);
      font-weight: 500;
      border-radius: var(--radius-md);
      transition: all var(--transition-fast);
      position: relative;
    }

    .nav-link:hover {
      color: var(--text-primary);
      background: var(--bg-muted);
    }

    .nav-link.active {
      color: var(--text-primary);
      font-weight: 600;
    }

    .nav-link.active::after {
      content: '';
      position: absolute;
      bottom: 4px;
      left: 50%;
      transform: translateX(-50%);
      width: 20px;
      height: 2px;
      background: var(--accent);
      border-radius: 1px;
    }

    .header-spacer { flex: 1; }
    .header-actions { display: flex; gap: var(--space-2); }

    .icon-btn {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg-muted);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-md);
      cursor: pointer;
      color: var(--text-muted);
      transition: all var(--transition-fast);
    }

    .icon-btn:hover {
      background: var(--bg-secondary);
      color: var(--text-primary);
      transform: translateY(-1px);
    }

    /* Hero Section */
    .hero {
      max-width: 1400px;
      margin: 0 auto;
      padding: var(--space-12) var(--space-10) var(--space-8);
    }

    .hero-content { max-width: 720px; }

    .hero-label {
      display: inline-flex;
      align-items: center;
      gap: var(--space-2);
      font-size: var(--text-xs);
      font-weight: 700;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: var(--accent);
      margin-bottom: var(--space-5);
    }

    .hero-label::before {
      content: '';
      width: 24px;
      height: 2px;
      background: var(--accent);
      border-radius: 1px;
    }

    .hero-title {
      font-family: var(--font-display);
      font-size: var(--text-5xl);
      font-weight: 400;
      line-height: 1.1;
      color: var(--text-primary);
      margin-bottom: var(--space-5);
      letter-spacing: -0.02em;
    }

    .hero-subtitle {
      font-family: var(--font-serif);
      font-size: var(--text-xl);
      font-style: italic;
      color: var(--text-muted);
      line-height: 1.6;
    }

    /* Stats Dashboard */
    .stats-dashboard {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 var(--space-10) var(--space-8);
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: var(--space-4);
    }

    .stat-card {
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-xl);
      padding: var(--space-5);
      text-align: center;
      transition: all var(--transition-base);
      cursor: default;
    }

    .stat-card:hover {
      border-color: var(--border-default);
      box-shadow: var(--shadow-md);
      transform: translateY(-3px);
    }

    .stat-icon {
      width: 44px;
      height: 44px;
      margin: 0 auto var(--space-3);
      border-radius: var(--radius-lg);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .stat-icon.total { background: var(--accent-soft); color: var(--accent); }
    .stat-icon.ceo { background: var(--blue-soft); color: var(--blue); }
    .stat-icon.board { background: var(--accent-gold-soft); color: var(--accent-gold); }
    .stat-icon.investor { background: var(--green-soft); color: var(--green); }
    .stat-icon.company { background: var(--purple-soft); color: var(--purple); }

    .stat-value {
      font-family: var(--font-display);
      font-size: var(--text-2xl);
      font-weight: 400;
      color: var(--text-primary);
      line-height: 1.1;
      margin-bottom: var(--space-1);
    }

    .stat-label {
      font-size: var(--text-xs);
      font-weight: 600;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      color: var(--text-muted);
    }

    /* Animated counter */
    .stat-value[data-target] {
      transition: color 0.3s;
    }

    /* Search & Filter Section */
    .controls {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 var(--space-10) var(--space-6);
    }

    .controls-row {
      display: flex;
      align-items: center;
      gap: var(--space-4);
      flex-wrap: wrap;
      margin-bottom: var(--space-4);
    }

    .search-box {
      flex: 1;
      min-width: 280px;
      position: relative;
    }

    .search-input {
      width: 100%;
      padding: var(--space-4) var(--space-5);
      padding-left: 48px;
      background: var(--bg-card);
      border: 1px solid var(--border-default);
      border-radius: var(--radius-lg);
      font-family: inherit;
      font-size: var(--text-base);
      color: var(--text-primary);
      transition: all var(--transition-fast);
    }

    .search-input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px var(--accent-soft);
    }

    .search-input::placeholder { color: var(--text-subtle); }

    .search-icon {
      position: absolute;
      left: var(--space-4);
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-subtle);
      pointer-events: none;
    }

    /* Advanced Filters */
    .advanced-filters {
      display: flex;
      gap: var(--space-3);
      flex-wrap: wrap;
    }

    .filter-dropdown {
      position: relative;
    }

    .filter-btn {
      display: inline-flex;
      align-items: center;
      gap: var(--space-2);
      padding: var(--space-3) var(--space-4);
      background: var(--bg-card);
      border: 1px solid var(--border-default);
      border-radius: var(--radius-md);
      font-family: inherit;
      font-size: var(--text-sm);
      font-weight: 500;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all var(--transition-fast);
    }

    .filter-btn:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    .filter-btn.active {
      background: var(--accent-soft);
      border-color: var(--accent);
      color: var(--accent);
    }

    .filter-btn svg {
      transition: transform var(--transition-fast);
    }

    .filter-btn.open svg {
      transform: rotate(180deg);
    }

    .filter-menu {
      position: absolute;
      top: calc(100% + var(--space-2));
      left: 0;
      min-width: 220px;
      max-height: 300px;
      overflow-y: auto;
      background: var(--bg-card);
      border: 1px solid var(--border-default);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-lg);
      padding: var(--space-2);
      z-index: 50;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-8px);
      transition: all var(--transition-fast);
    }

    .filter-dropdown.open .filter-menu {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .filter-option {
      display: flex;
      align-items: center;
      gap: var(--space-3);
      padding: var(--space-3) var(--space-4);
      border-radius: var(--radius-md);
      font-size: var(--text-sm);
      color: var(--text-secondary);
      cursor: pointer;
      transition: all var(--transition-fast);
    }

    .filter-option:hover {
      background: var(--bg-muted);
    }

    .filter-option.selected {
      background: var(--accent-soft);
      color: var(--accent);
    }

    .filter-option input {
      width: 16px;
      height: 16px;
      accent-color: var(--accent);
    }

    .clear-filters {
      padding: var(--space-2) var(--space-4);
      background: none;
      border: none;
      font-size: var(--text-sm);
      font-weight: 500;
      color: var(--text-muted);
      cursor: pointer;
      transition: color var(--transition-fast);
    }

    .clear-filters:hover {
      color: var(--accent);
    }

    /* View Toggle & Sort */
    .view-controls {
      display: flex;
      align-items: center;
      gap: var(--space-4);
      margin-left: auto;
    }

    .view-toggle {
      display: flex;
      background: var(--bg-muted);
      border-radius: var(--radius-md);
      padding: var(--space-1);
    }

    .view-btn {
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: transparent;
      border: none;
      border-radius: var(--radius-sm);
      color: var(--text-muted);
      cursor: pointer;
      transition: all var(--transition-fast);
    }

    .view-btn:hover {
      color: var(--text-primary);
    }

    .view-btn.active {
      background: var(--bg-card);
      color: var(--text-primary);
      box-shadow: var(--shadow-sm);
    }

    /* Filter tabs */
    .filter-tabs {
      display: flex;
      gap: var(--space-2);
      background: var(--bg-muted);
      padding: var(--space-1);
      border-radius: var(--radius-lg);
      overflow-x: auto;
    }

    .filter-tab {
      padding: var(--space-3) var(--space-5);
      background: transparent;
      border: none;
      border-radius: var(--radius-md);
      font-family: inherit;
      font-size: var(--text-sm);
      font-weight: 500;
      color: var(--text-muted);
      cursor: pointer;
      transition: all var(--transition-fast);
      white-space: nowrap;
    }

    .filter-tab:hover { color: var(--text-primary); }

    .filter-tab.active {
      background: var(--bg-card);
      color: var(--text-primary);
      box-shadow: var(--shadow-sm);
    }

    .filter-tab .count {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 20px;
      height: 20px;
      padding: 0 6px;
      margin-left: var(--space-2);
      background: var(--bg-muted);
      border-radius: var(--radius-full);
      font-size: var(--text-xxs);
      font-weight: 700;
      color: var(--text-muted);
    }

    .filter-tab.active .count {
      background: var(--accent-soft);
      color: var(--accent);
    }

    .sort-select {
      padding: var(--space-3) var(--space-5);
      padding-right: var(--space-10);
      background: var(--bg-card);
      border: 1px solid var(--border-default);
      border-radius: var(--radius-md);
      font-family: inherit;
      font-size: var(--text-sm);
      color: var(--text-primary);
      cursor: pointer;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 12px center;
    }

    /* Network View Toggle */
    .network-toggle {
      display: inline-flex;
      align-items: center;
      gap: var(--space-2);
      padding: var(--space-3) var(--space-4);
      background: var(--bg-card);
      border: 1px solid var(--border-default);
      border-radius: var(--radius-md);
      font-size: var(--text-sm);
      font-weight: 500;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all var(--transition-fast);
    }

    .network-toggle:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    .network-toggle.active {
      background: var(--accent);
      border-color: var(--accent);
      color: white;
    }

    /* People Grid */
    .people-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 var(--space-10) var(--space-16);
      min-height: 400px;
    }

    .people-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: var(--space-6);
    }

    .people-grid.list-view {
      grid-template-columns: 1fr;
      gap: var(--space-3);
    }

    @media (max-width: 1200px) {
      .people-grid { grid-template-columns: repeat(3, 1fr); }
    }

    @media (max-width: 900px) {
      .people-grid { grid-template-columns: repeat(2, 1fr); }
    }

    @media (max-width: 600px) {
      .people-grid { grid-template-columns: 1fr; }
    }

    /* Person Card */
    .person-card {
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-xl);
      overflow: hidden;
      transition: all var(--transition-base);
      cursor: pointer;
      position: relative;
      outline: none;
    }

    .person-card:hover,
    .person-card:focus {
      border-color: var(--border-default);
      box-shadow: var(--shadow-lg);
      transform: translateY(-6px);
    }

    .person-card:focus {
      box-shadow: var(--shadow-lg), 0 0 0 3px var(--accent-soft);
    }

    .person-card.selected {
      border-color: var(--accent);
      box-shadow: 0 0 0 2px var(--accent);
    }

    .person-card::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, var(--accent-soft), transparent 50%);
      opacity: 0;
      transition: opacity var(--transition-slow);
      pointer-events: none;
      z-index: 1;
    }

    .person-card:hover::before { opacity: 1; }

    /* Card Actions */
    .card-actions {
      position: absolute;
      top: var(--space-3);
      right: var(--space-3);
      display: flex;
      gap: var(--space-1);
      opacity: 0;
      transform: translateY(-8px);
      transition: all var(--transition-fast);
      z-index: 10;
    }

    .person-card:hover .card-actions,
    .person-card:focus .card-actions {
      opacity: 1;
      transform: translateY(0);
    }

    .card-action-btn {
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255, 255, 255, 0.95);
      border: none;
      border-radius: var(--radius-md);
      cursor: pointer;
      color: var(--text-muted);
      box-shadow: var(--shadow-sm);
      transition: all var(--transition-fast);
    }

    [data-theme="dark"] .card-action-btn {
      background: rgba(26, 26, 26, 0.95);
    }

    .card-action-btn:hover {
      background: var(--accent);
      color: white;
      transform: scale(1.1);
    }

    /* Avatar Section */
    .person-avatar-section {
      position: relative;
      padding: var(--space-8) var(--space-6) var(--space-5);
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
    }

    .person-avatar {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--bg-muted), var(--border-default));
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: var(--space-4);
      position: relative;
      overflow: hidden;
      transition: all var(--transition-base);
    }

    .person-card:hover .person-avatar {
      transform: scale(1.05);
    }

    .person-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .person-avatar .initials {
      font-family: var(--font-serif);
      font-size: var(--text-2xl);
      font-weight: 500;
      color: var(--text-muted);
      letter-spacing: 0.05em;
    }

    .person-type-badge {
      position: absolute;
      bottom: -4px;
      right: -4px;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow-sm);
      border: 2px solid var(--bg-card);
      transition: transform var(--transition-fast);
    }

    .person-card:hover .person-type-badge {
      transform: scale(1.1);
    }

    .person-type-badge.ceo { background: var(--accent); color: white; }
    .person-type-badge.board { background: var(--accent-gold); color: white; }
    .person-type-badge.founder { background: #8b5cf6; color: white; }
    .person-type-badge.investor { background: #10b981; color: white; }
    .person-type-badge.owner { background: #6366f1; color: white; }

    .person-name {
      font-family: var(--font-display);
      font-size: var(--text-xl);
      font-weight: 500;
      color: var(--text-primary);
      margin-bottom: var(--space-1);
      line-height: 1.3;
      transition: color var(--transition-fast);
    }

    .person-card:hover .person-name {
      color: var(--accent);
    }

    .person-title {
      font-family: var(--font-serif);
      font-size: var(--text-base);
      font-style: italic;
      color: var(--text-muted);
      margin-bottom: var(--space-3);
    }

    .person-location {
      display: inline-flex;
      align-items: center;
      gap: var(--space-1);
      font-size: var(--text-xs);
      color: var(--text-subtle);
    }

    /* Stats Section */
    .person-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      border-top: 1px solid var(--border-subtle);
      background: var(--bg-secondary);
    }

    .person-stat {
      padding: var(--space-4);
      text-align: center;
      border-right: 1px solid var(--border-subtle);
      transition: background var(--transition-fast);
    }

    .person-stat:last-child { border-right: none; }

    .person-card:hover .person-stat {
      background: var(--bg-muted);
    }

    .person-stat-value {
      font-family: var(--font-display);
      font-size: var(--text-xl);
      font-weight: 500;
      color: var(--text-primary);
      line-height: 1;
      margin-bottom: var(--space-1);
    }

    .person-stat-label {
      font-size: var(--text-xxs);
      font-weight: 500;
      color: var(--text-subtle);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    /* Companies List */
    .person-companies {
      padding: var(--space-4) var(--space-5);
      border-top: 1px solid var(--border-subtle);
    }

    .person-company-tag {
      display: inline-flex;
      align-items: center;
      gap: var(--space-2);
      padding: var(--space-1) var(--space-3);
      background: var(--bg-muted);
      border-radius: var(--radius-full);
      font-size: var(--text-xs);
      font-weight: 500;
      color: var(--text-secondary);
      margin-right: var(--space-2);
      margin-bottom: var(--space-2);
      transition: all var(--transition-fast);
    }

    .person-company-tag:hover {
      background: var(--accent-soft);
      color: var(--accent);
      transform: translateY(-1px);
    }

    .person-company-tag.ceo-role {
      background: var(--accent-soft);
      color: var(--accent);
    }

    .person-company-tag .role-indicator {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: currentColor;
    }

    /* List View Card */
    .person-card.list-item {
      display: grid;
      grid-template-columns: auto 1fr auto;
      align-items: center;
      gap: var(--space-5);
      padding: var(--space-4) var(--space-5);
      border-radius: var(--radius-lg);
    }

    .person-card.list-item:hover {
      transform: translateX(4px);
    }

    .person-card.list-item .person-avatar-section {
      padding: 0;
    }

    .person-card.list-item .person-avatar {
      width: 56px;
      height: 56px;
      margin-bottom: 0;
    }

    .person-card.list-item .person-avatar .initials {
      font-size: var(--text-lg);
    }

    .person-card.list-item .person-info {
      display: flex;
      flex-direction: column;
      gap: var(--space-1);
    }

    .person-card.list-item .person-name {
      font-size: var(--text-base);
      margin-bottom: 0;
    }

    .person-card.list-item .person-title {
      font-size: var(--text-sm);
      margin-bottom: 0;
    }

    .person-card.list-item .person-stats {
      display: flex;
      gap: var(--space-4);
      border: none;
      background: none;
    }

    .person-card.list-item .person-stat {
      padding: 0;
      border: none;
      text-align: left;
    }

    .person-card.list-item .person-stat-value {
      font-size: var(--text-base);
    }

    /* Skeleton Loading */
    .skeleton-card {
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-xl);
      overflow: hidden;
    }

    .skeleton-avatar-section {
      padding: var(--space-8) var(--space-6) var(--space-5);
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .skeleton {
      background: linear-gradient(90deg, var(--bg-muted) 25%, var(--bg-secondary) 50%, var(--bg-muted) 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
      border-radius: var(--radius-md);
    }

    .skeleton-avatar {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      margin-bottom: var(--space-4);
    }

    .skeleton-name {
      height: 24px;
      width: 140px;
      margin-bottom: var(--space-2);
    }

    .skeleton-title {
      height: 18px;
      width: 100px;
      margin-bottom: var(--space-3);
    }

    .skeleton-location {
      height: 14px;
      width: 80px;
    }

    .skeleton-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      border-top: 1px solid var(--border-subtle);
      background: var(--bg-secondary);
      padding: var(--space-4);
      gap: var(--space-4);
    }

    .skeleton-stat {
      height: 40px;
    }

    @keyframes shimmer {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    /* Network Graph */
    .network-container {
      display: none;
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 var(--space-10) var(--space-16);
    }

    .network-container.active {
      display: block;
    }

    .network-graph {
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-xl);
      overflow: hidden;
      min-height: 600px;
    }

    .network-graph svg {
      width: 100%;
      height: 600px;
    }

    .network-node {
      cursor: pointer;
    }

    .network-node circle {
      transition: all var(--transition-fast);
    }

    .network-node:hover circle {
      stroke-width: 3;
    }

    .network-node text {
      font-family: var(--font-body);
      font-size: 11px;
      fill: var(--text-secondary);
      pointer-events: none;
    }

    .network-link {
      stroke: var(--border-default);
      stroke-opacity: 0.6;
    }

    .network-legend {
      display: flex;
      justify-content: center;
      gap: var(--space-6);
      padding: var(--space-4);
      border-top: 1px solid var(--border-subtle);
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: var(--space-2);
      font-size: var(--text-xs);
      color: var(--text-muted);
    }

    .legend-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
    }

    /* Load indicator for infinite scroll */
    .scroll-loader {
      display: flex;
      justify-content: center;
      padding: var(--space-8);
      opacity: 0;
      transition: opacity var(--transition-fast);
    }

    .scroll-loader.visible {
      opacity: 1;
    }

    .scroll-spinner {
      width: 32px;
      height: 32px;
      border: 3px solid var(--border-default);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Theme Toggle */
    .theme-toggle {
      position: fixed;
      bottom: var(--space-6);
      left: var(--space-6);
      width: 52px;
      height: 52px;
      border-radius: var(--radius-full);
      background: var(--text-primary);
      color: var(--bg-primary);
      border: none;
      cursor: pointer;
      box-shadow: var(--shadow-lg);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all var(--transition-base);
      z-index: 100;
    }

    .theme-toggle:hover {
      transform: scale(1.1) translateY(-3px);
    }

    :root .icon-moon { display: none; }
    [data-theme="dark"] .icon-sun { display: none; }
    [data-theme="dark"] .icon-moon { display: block; }

    /* Keyboard navigation indicator */
    .keyboard-hint {
      position: fixed;
      bottom: var(--space-6);
      right: var(--space-6);
      display: flex;
      gap: var(--space-2);
      padding: var(--space-3) var(--space-4);
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-md);
      font-size: var(--text-xs);
      color: var(--text-muted);
      opacity: 0;
      transform: translateY(10px);
      transition: all var(--transition-base);
      z-index: 50;
    }

    .keyboard-hint.visible {
      opacity: 1;
      transform: translateY(0);
    }

    .key {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 24px;
      height: 24px;
      padding: 0 var(--space-2);
      background: var(--bg-muted);
      border-radius: var(--radius-sm);
      font-weight: 600;
      color: var(--text-primary);
    }

    /* Responsive */
    @media (max-width: 1200px) {
      .stats-grid { grid-template-columns: repeat(3, 1fr); }
    }

    @media (max-width: 768px) {
      .hero { padding: var(--space-10) var(--space-5); }
      .hero-title { font-size: var(--text-3xl); }
      .stats-dashboard { padding: 0 var(--space-5) var(--space-6); }
      .stats-grid { grid-template-columns: repeat(2, 1fr); }
      .controls { padding: 0 var(--space-5) var(--space-6); }
      .controls-row { gap: var(--space-3); }
      .advanced-filters { width: 100%; }
      .people-container { padding: 0 var(--space-5) var(--space-10); }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <a href="#" class="logo">
      <span>Loop</span>
      <span>Desk</span>
    </a>

    <nav class="header-nav">
      <a href="#" class="nav-link">Flodet</a>
      <a href="#" class="nav-link">Bolag</a>
      <a href="#" class="nav-link active">Personer</a>
      <a href="#" class="nav-link">Databaser</a>
    </nav>

    <div class="header-spacer"></div>

    <div class="header-actions">
      <button class="icon-btn" title="Sok">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.3-4.3"></path>
        </svg>
      </button>
      <button class="icon-btn" title="Notifikationer">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
          <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
        </svg>
      </button>
    </div>
  </header>

  <!-- Hero Section -->
  <section class="hero">
    <div class="hero-content">
      <span class="hero-label">Person Databas</span>
      <h1 class="hero-title">Impact People</h1>
      <p class="hero-subtitle">Nyckelpersoner inom svensk impact-industri. VD:ar, grundare, styrelseproffs och investerare som formar framtidens hallbara naringsliv.</p>
    </div>
  </section>

  <!-- Stats Dashboard -->
  <section class="stats-dashboard">
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon total">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
            <circle cx="9" cy="7" r="4"></circle>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
          </svg>
        </div>
        <div class="stat-value" data-target="4646" data-suffix="">0</div>
        <div class="stat-label">Personer totalt</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon ceo">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20 7h-9M14 17H5M17 17l-3-3 3-3M7 7l3 3-3 3"/>
          </svg>
        </div>
        <div class="stat-value" data-target="935" data-suffix="">0</div>
        <div class="stat-label">VD:ar</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon board">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="18" height="18" rx="2"/>
            <path d="M3 9h18M9 21V9"/>
          </svg>
        </div>
        <div class="stat-value" data-target="3711" data-suffix="">0</div>
        <div class="stat-label">Styrelseledamoter</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon investor">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="1" x2="12" y2="23"></line>
            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
          </svg>
        </div>
        <div class="stat-value" data-target="75" data-suffix="">0</div>
        <div class="stat-label">Investerare</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon company">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
            <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
          </svg>
        </div>
        <div class="stat-value" data-target="287" data-suffix="+">0</div>
        <div class="stat-label">Impact-bolag</div>
      </div>
    </div>
  </section>

  <!-- Search & Filter -->
  <div class="controls">
    <div class="controls-row">
      <div class="search-box">
        <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.3-4.3"></path>
        </svg>
        <input type="text" class="search-input" placeholder="Sok person, bolag eller roll..." id="searchInput">
      </div>

      <div class="advanced-filters">
        <div class="filter-dropdown" id="locationFilter">
          <button class="filter-btn" onclick="toggleFilterDropdown('locationFilter')">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
              <circle cx="12" cy="10" r="3"></circle>
            </svg>
            Ort
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M6 9l6 6 6-6"/>
            </svg>
          </button>
          <div class="filter-menu" id="locationMenu">
            <!-- Populated by JS -->
          </div>
        </div>

        <div class="filter-dropdown" id="industryFilter">
          <button class="filter-btn" onclick="toggleFilterDropdown('industryFilter')">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
              <path d="M2 17l10 5 10-5"></path>
              <path d="M2 12l10 5 10-5"></path>
            </svg>
            Bransch
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M6 9l6 6 6-6"/>
            </svg>
          </button>
          <div class="filter-menu" id="industryMenu">
            <!-- Populated by JS -->
          </div>
        </div>

        <div class="filter-dropdown" id="companiesFilter">
          <button class="filter-btn" onclick="toggleFilterDropdown('companiesFilter')">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
              <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
            </svg>
            Bolag
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M6 9l6 6 6-6"/>
            </svg>
          </button>
          <div class="filter-menu" id="companiesMenu">
            <label class="filter-option">
              <input type="radio" name="companies" value="any" checked> Alla
            </label>
            <label class="filter-option">
              <input type="radio" name="companies" value="1-3"> 1-3 bolag
            </label>
            <label class="filter-option">
              <input type="radio" name="companies" value="4-10"> 4-10 bolag
            </label>
            <label class="filter-option">
              <input type="radio" name="companies" value="10+"> 10+ bolag
            </label>
          </div>
        </div>

        <button class="clear-filters" onclick="clearAllFilters()" style="display: none;" id="clearFiltersBtn">
          Rensa filter
        </button>
      </div>

      <div class="view-controls">
        <button class="network-toggle" onclick="toggleNetworkView()" id="networkToggle" title="Natverksvy">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="18" cy="5" r="3"></circle>
            <circle cx="6" cy="12" r="3"></circle>
            <circle cx="18" cy="19" r="3"></circle>
            <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
            <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
          </svg>
        </button>

        <div class="view-toggle">
          <button class="view-btn active" onclick="setViewMode('grid')" id="gridViewBtn" title="Rutnatsvy">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="7" height="7"></rect>
              <rect x="14" y="3" width="7" height="7"></rect>
              <rect x="14" y="14" width="7" height="7"></rect>
              <rect x="3" y="14" width="7" height="7"></rect>
            </svg>
          </button>
          <button class="view-btn" onclick="setViewMode('list')" id="listViewBtn" title="Listvy">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="8" y1="6" x2="21" y2="6"></line>
              <line x1="8" y1="12" x2="21" y2="12"></line>
              <line x1="8" y1="18" x2="21" y2="18"></line>
              <line x1="3" y1="6" x2="3.01" y2="6"></line>
              <line x1="3" y1="12" x2="3.01" y2="12"></line>
              <line x1="3" y1="18" x2="3.01" y2="18"></line>
            </svg>
          </button>
        </div>

        <select class="sort-select" id="sortSelect">
          <option value="companies">Flest bolag</option>
          <option value="board">Flest styrelseuppdrag</option>
          <option value="name">Namn A-O</option>
        </select>
      </div>
    </div>

    <div class="controls-row">
      <div class="filter-tabs" id="filterTabs">
        <button class="filter-tab active" data-filter="all">
          Alla
          <span class="count" data-count="total">4,646</span>
        </button>
        <button class="filter-tab" data-filter="CEO">
          VD
          <span class="count" data-count="ceo">935</span>
        </button>
        <button class="filter-tab" data-filter="CHAIRMAN">
          Ordforande
          <span class="count" data-count="chairman">287</span>
        </button>
        <button class="filter-tab" data-filter="BOARD_MEMBER">
          Styrelse
          <span class="count" data-count="board">3,424</span>
        </button>
        <button class="filter-tab" data-filter="INVESTOR">
          Investerare
          <span class="count" data-count="investor">75</span>
        </button>
        <button class="filter-tab" data-filter="OWNER">
          Agare
          <span class="count" data-count="owner">746</span>
        </button>
      </div>
    </div>
  </div>

  <!-- People Grid -->
  <div class="people-container">
    <div class="people-grid" id="peopleGrid">
      <!-- Cards populated by JavaScript -->
    </div>
    <div class="scroll-loader" id="scrollLoader">
      <div class="scroll-spinner"></div>
    </div>
  </div>

  <!-- Network View -->
  <div class="network-container" id="networkContainer">
    <div class="network-graph" id="networkGraph">
      <svg></svg>
      <div class="network-legend">
        <div class="legend-item">
          <div class="legend-dot" style="background: var(--accent)"></div>
          <span>Person</span>
        </div>
        <div class="legend-item">
          <div class="legend-dot" style="background: var(--blue)"></div>
          <span>Bolag</span>
        </div>
        <div class="legend-item">
          <div class="legend-dot" style="background: var(--green)"></div>
          <span>Investerare</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Keyboard navigation hint -->
  <div class="keyboard-hint" id="keyboardHint">
    <span><span class="key">↑</span><span class="key">↓</span> Navigera</span>
    <span><span class="key">Enter</span> Oppna</span>
    <span><span class="key">Esc</span> Stang</span>
  </div>

  <!-- Theme Toggle -->
  <button class="theme-toggle" onclick="toggleTheme()">
    <svg class="icon-sun" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="12" cy="12" r="4"></circle>
      <path d="M12 2v2m0 16v2M4.93 4.93l1.41 1.41m11.32 11.32l1.41 1.41M2 12h2m16 0h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41"></path>
    </svg>
    <svg class="icon-moon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
    </svg>
  </button>

  <script>
    // ==========================================
    // Configuration
    // ==========================================
    const SUPABASE_URL = 'https://rpjmsncjnhtnjnycabys.supabase.co';
    const SUPABASE_KEY = 'sb_secret_S_N55IE9sL2m1PS_8yqhdg_8FoDs2wP';

    let currentPage = 0;
    const PAGE_SIZE = 12;
    let currentFilter = 'all';
    let currentSort = 'companies';
    let searchQuery = '';
    let viewMode = 'grid';
    let networkMode = false;
    let allPersons = [];
    let personRoles = {};
    let investors = [];
    let investorsLoaded = false;
    let owners = [];
    let ownersLoaded = false;
    let isLoading = false;
    let hasMore = true;
    let selectedCardIndex = -1;
    let keyboardNavigating = false;

    // Advanced filters
    let locationFilters = [];
    let industryFilters = [];
    let companiesFilter = 'any';

    // Available filter options
    const locations = ['Stockholm', 'Goteborg', 'Malmo', 'Uppsala', 'Linkoping', 'Lund', 'Orebro', 'Vasteras'];
    const industries = ['CleanTech', 'HealthTech', 'EdTech', 'FinTech', 'AgriTech', 'PropTech', 'Social Impact', 'Circular Economy'];

    // ==========================================
    // Animated Counters
    // ==========================================
    function animateCounters() {
      const counters = document.querySelectorAll('.stat-value[data-target]');

      counters.forEach(counter => {
        const target = parseInt(counter.dataset.target);
        const suffix = counter.dataset.suffix || '';
        const duration = 1500;
        const start = 0;
        const startTime = performance.now();

        function update(currentTime) {
          const elapsed = currentTime - startTime;
          const progress = Math.min(elapsed / duration, 1);

          // Easing function
          const easeOutQuart = 1 - Math.pow(1 - progress, 4);
          const current = Math.floor(start + (target - start) * easeOutQuart);

          counter.textContent = current.toLocaleString('sv-SE') + suffix;

          if (progress < 1) {
            requestAnimationFrame(update);
          }
        }

        requestAnimationFrame(update);
      });
    }

    // ==========================================
    // Skeleton Loading
    // ==========================================
    function showSkeletons(count = 8) {
      const grid = document.getElementById('peopleGrid');
      grid.innerHTML = '';

      for (let i = 0; i < count; i++) {
        const skeleton = document.createElement('div');
        skeleton.className = 'skeleton-card';
        skeleton.innerHTML = `
          <div class="skeleton-avatar-section">
            <div class="skeleton skeleton-avatar"></div>
            <div class="skeleton skeleton-name"></div>
            <div class="skeleton skeleton-title"></div>
            <div class="skeleton skeleton-location"></div>
          </div>
          <div class="skeleton-stats">
            <div class="skeleton skeleton-stat"></div>
            <div class="skeleton skeleton-stat"></div>
            <div class="skeleton skeleton-stat"></div>
          </div>
        `;
        grid.appendChild(skeleton);
      }
    }

    // ==========================================
    // Advanced Filters
    // ==========================================
    function initializeFilters() {
      // Populate location filter
      const locationMenu = document.getElementById('locationMenu');
      locationMenu.innerHTML = locations.map(loc => `
        <label class="filter-option">
          <input type="checkbox" value="${loc}" onchange="updateLocationFilter(this)"> ${loc}
        </label>
      `).join('');

      // Populate industry filter
      const industryMenu = document.getElementById('industryMenu');
      industryMenu.innerHTML = industries.map(ind => `
        <label class="filter-option">
          <input type="checkbox" value="${ind}" onchange="updateIndustryFilter(this)"> ${ind}
        </label>
      `).join('');

      // Companies filter change handler
      document.querySelectorAll('input[name="companies"]').forEach(radio => {
        radio.addEventListener('change', (e) => {
          companiesFilter = e.target.value;
          updateClearButton();
          reloadPersons();
        });
      });
    }

    function toggleFilterDropdown(id) {
      const dropdown = document.getElementById(id);
      const wasOpen = dropdown.classList.contains('open');

      // Close all dropdowns
      document.querySelectorAll('.filter-dropdown').forEach(d => {
        d.classList.remove('open');
        d.querySelector('.filter-btn').classList.remove('open');
      });

      if (!wasOpen) {
        dropdown.classList.add('open');
        dropdown.querySelector('.filter-btn').classList.add('open');
      }
    }

    function updateLocationFilter(checkbox) {
      if (checkbox.checked) {
        locationFilters.push(checkbox.value);
      } else {
        locationFilters = locationFilters.filter(l => l !== checkbox.value);
      }
      updateFilterButton('locationFilter', locationFilters.length > 0);
      updateClearButton();
      reloadPersons();
    }

    function updateIndustryFilter(checkbox) {
      if (checkbox.checked) {
        industryFilters.push(checkbox.value);
      } else {
        industryFilters = industryFilters.filter(i => i !== checkbox.value);
      }
      updateFilterButton('industryFilter', industryFilters.length > 0);
      updateClearButton();
      reloadPersons();
    }

    function updateFilterButton(filterId, hasSelection) {
      const btn = document.querySelector(`#${filterId} .filter-btn`);
      btn.classList.toggle('active', hasSelection);
    }

    function updateClearButton() {
      const hasFilters = locationFilters.length > 0 || industryFilters.length > 0 || companiesFilter !== 'any';
      document.getElementById('clearFiltersBtn').style.display = hasFilters ? 'block' : 'none';
    }

    function clearAllFilters() {
      locationFilters = [];
      industryFilters = [];
      companiesFilter = 'any';

      document.querySelectorAll('.filter-menu input[type="checkbox"]').forEach(cb => cb.checked = false);
      document.querySelector('input[name="companies"][value="any"]').checked = true;
      document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
      document.getElementById('clearFiltersBtn').style.display = 'none';

      reloadPersons();
    }

    // Close dropdowns on outside click
    document.addEventListener('click', (e) => {
      if (!e.target.closest('.filter-dropdown')) {
        document.querySelectorAll('.filter-dropdown').forEach(d => {
          d.classList.remove('open');
          d.querySelector('.filter-btn').classList.remove('open');
        });
      }
    });

    // ==========================================
    // View Mode
    // ==========================================
    function setViewMode(mode) {
      viewMode = mode;
      const grid = document.getElementById('peopleGrid');

      document.getElementById('gridViewBtn').classList.toggle('active', mode === 'grid');
      document.getElementById('listViewBtn').classList.toggle('active', mode === 'list');

      grid.classList.toggle('list-view', mode === 'list');

      // Re-render cards with new view
      reloadPersons();
    }

    // ==========================================
    // Network View
    // ==========================================
    function toggleNetworkView() {
      networkMode = !networkMode;

      document.getElementById('networkToggle').classList.toggle('active', networkMode);
      document.querySelector('.people-container').style.display = networkMode ? 'none' : 'block';
      document.getElementById('networkContainer').classList.toggle('active', networkMode);

      if (networkMode) {
        renderNetworkGraph();
      }
    }

    function renderNetworkGraph() {
      const container = document.getElementById('networkGraph');
      const svg = d3.select(container).select('svg');
      const width = container.clientWidth;
      const height = 600;

      svg.selectAll('*').remove();

      // Create sample network data
      const nodes = [];
      const links = [];

      // Add some sample persons
      const samplePersons = allPersons.slice(0, 20);
      samplePersons.forEach((person, i) => {
        nodes.push({
          id: person.id,
          name: person.name,
          type: 'person',
          radius: 12 + (person.totalCompanies || 0) * 2
        });

        // Add company nodes
        const roles = personRoles[person.id] || [];
        roles.slice(0, 3).forEach(role => {
          const companyId = `company-${role.companyName.replace(/\s/g, '-')}`;
          if (!nodes.find(n => n.id === companyId)) {
            nodes.push({
              id: companyId,
              name: role.companyName,
              type: 'company',
              radius: 8
            });
          }
          links.push({
            source: person.id,
            target: companyId
          });
        });
      });

      // Create simulation
      const simulation = d3.forceSimulation(nodes)
        .force('link', d3.forceLink(links).id(d => d.id).distance(80))
        .force('charge', d3.forceManyBody().strength(-200))
        .force('center', d3.forceCenter(width / 2, height / 2))
        .force('collision', d3.forceCollide().radius(d => d.radius + 5));

      // Draw links
      const link = svg.append('g')
        .selectAll('line')
        .data(links)
        .join('line')
        .attr('class', 'network-link')
        .attr('stroke-width', 1);

      // Draw nodes
      const node = svg.append('g')
        .selectAll('g')
        .data(nodes)
        .join('g')
        .attr('class', 'network-node')
        .call(d3.drag()
          .on('start', dragstarted)
          .on('drag', dragged)
          .on('end', dragended));

      node.append('circle')
        .attr('r', d => d.radius)
        .attr('fill', d => d.type === 'person' ? 'var(--accent)' : 'var(--blue)')
        .attr('stroke', 'var(--bg-card)')
        .attr('stroke-width', 2);

      node.append('text')
        .attr('dy', d => d.radius + 12)
        .attr('text-anchor', 'middle')
        .text(d => d.name.length > 15 ? d.name.substring(0, 15) + '...' : d.name);

      simulation.on('tick', () => {
        link
          .attr('x1', d => d.source.x)
          .attr('y1', d => d.source.y)
          .attr('x2', d => d.target.x)
          .attr('y2', d => d.target.y);

        node.attr('transform', d => `translate(${d.x},${d.y})`);
      });

      function dragstarted(event) {
        if (!event.active) simulation.alphaTarget(0.3).restart();
        event.subject.fx = event.subject.x;
        event.subject.fy = event.subject.y;
      }

      function dragged(event) {
        event.subject.fx = event.x;
        event.subject.fy = event.y;
      }

      function dragended(event) {
        if (!event.active) simulation.alphaTarget(0);
        event.subject.fx = null;
        event.subject.fy = null;
      }
    }

    // ==========================================
    // Keyboard Navigation
    // ==========================================
    function initKeyboardNavigation() {
      document.addEventListener('keydown', (e) => {
        const cards = document.querySelectorAll('.person-card');
        if (cards.length === 0) return;

        if (e.key === 'ArrowDown' || e.key === 'ArrowUp' || e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
          e.preventDefault();
          keyboardNavigating = true;
          showKeyboardHint();

          const cols = viewMode === 'list' ? 1 : getGridColumns();

          if (e.key === 'ArrowDown') {
            selectedCardIndex = Math.min(selectedCardIndex + cols, cards.length - 1);
          } else if (e.key === 'ArrowUp') {
            selectedCardIndex = Math.max(selectedCardIndex - cols, 0);
          } else if (e.key === 'ArrowRight') {
            selectedCardIndex = Math.min(selectedCardIndex + 1, cards.length - 1);
          } else if (e.key === 'ArrowLeft') {
            selectedCardIndex = Math.max(selectedCardIndex - 1, 0);
          }

          if (selectedCardIndex < 0) selectedCardIndex = 0;

          updateSelectedCard(cards);
        }

        if (e.key === 'Enter' && selectedCardIndex >= 0) {
          e.preventDefault();
          cards[selectedCardIndex].click();
        }

        if (e.key === 'Escape') {
          selectedCardIndex = -1;
          cards.forEach(c => c.classList.remove('selected'));
          hideKeyboardHint();
        }
      });
    }

    function getGridColumns() {
      const width = window.innerWidth;
      if (width <= 600) return 1;
      if (width <= 900) return 2;
      if (width <= 1200) return 3;
      return 4;
    }

    function updateSelectedCard(cards) {
      cards.forEach((c, i) => {
        c.classList.toggle('selected', i === selectedCardIndex);
        if (i === selectedCardIndex) {
          c.focus();
          c.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
      });
    }

    function showKeyboardHint() {
      document.getElementById('keyboardHint').classList.add('visible');
    }

    function hideKeyboardHint() {
      document.getElementById('keyboardHint').classList.remove('visible');
    }

    // ==========================================
    // Infinite Scroll
    // ==========================================
    function initInfiniteScroll() {
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting && !isLoading && hasMore && !networkMode) {
            loadPersons();
          }
        });
      }, { threshold: 0.1 });

      observer.observe(document.getElementById('scrollLoader'));
    }

    function showScrollLoader() {
      document.getElementById('scrollLoader').classList.add('visible');
    }

    function hideScrollLoader() {
      document.getElementById('scrollLoader').classList.remove('visible');
    }

    // ==========================================
    // API Functions
    // ==========================================
    async function fetchPersons(offset = 0, limit = PAGE_SIZE) {
      let url = `${SUPABASE_URL}/rest/v1/Person?select=id,name,firstName,lastName,title,personType,location,totalCompanies,totalBoardSeats,activeCompanies,totalInvestments,bio,imageUrl`;

      // Sorting
      if (currentSort === 'companies') {
        url += '&order=totalCompanies.desc';
      } else if (currentSort === 'board') {
        url += '&order=totalBoardSeats.desc';
      } else if (currentSort === 'name') {
        url += '&order=lastName.asc';
      }

      // Search
      if (searchQuery) {
        url += `&name=ilike.*${encodeURIComponent(searchQuery)}*`;
      }

      url += `&offset=${offset}&limit=${limit}`;

      const response = await fetch(url, {
        headers: {
          'apikey': SUPABASE_KEY,
          'Authorization': `Bearer ${SUPABASE_KEY}`
        }
      });

      return response.json();
    }

    async function fetchPersonRoles(personIds) {
      if (!personIds.length) return [];

      const url = `${SUPABASE_URL}/rest/v1/PersonRole?select=personId,roleType,roleTitle,companyName,isActive&personId=in.(${personIds.join(',')})&isActive=eq.true`;

      const response = await fetch(url, {
        headers: {
          'apikey': SUPABASE_KEY,
          'Authorization': `Bearer ${SUPABASE_KEY}`
        }
      });

      return response.json();
    }

    async function fetchInvestors() {
      if (investorsLoaded) return investors;

      try {
        const foResponse = await fetch(
          `${SUPABASE_URL}/rest/v1/FamilyOffice?select=id,name,keyPeople,impactNiche,region,website&limit=100`,
          {
            headers: {
              'apikey': SUPABASE_KEY,
              'Authorization': `Bearer ${SUPABASE_KEY}`
            }
          }
        );
        const familyOffices = await foResponse.json();

        const investorMap = new Map();

        familyOffices.forEach(fo => {
          if (fo.keyPeople) {
            const people = fo.keyPeople.split(',').map(p => p.trim());
            people.forEach(personName => {
              const cleanName = personName.replace(/\s*\([^)]*\)\s*/g, '').trim();
              if (!cleanName) return;

              const key = cleanName.toLowerCase();
              if (!investorMap.has(key)) {
                const nameParts = cleanName.split(' ');
                const firstName = nameParts.slice(0, -1).join(' ') || nameParts[0];
                const lastName = nameParts[nameParts.length - 1];

                investorMap.set(key, {
                  id: `inv-${key.replace(/\s/g, '-')}`,
                  name: cleanName,
                  firstName: firstName,
                  lastName: lastName,
                  personType: 'INVESTOR',
                  title: 'Investerare',
                  location: fo.region || null,
                  totalCompanies: 0,
                  totalBoardSeats: 0,
                  activeCompanies: 0,
                  bio: null,
                  imageUrl: null,
                  investorOrgs: [],
                  impactNiche: fo.impactNiche
                });
              }

              const investor = investorMap.get(key);
              investor.investorOrgs.push({
                name: fo.name,
                type: 'Family Office',
                impactNiche: fo.impactNiche
              });
              investor.totalCompanies++;
            });
          }
        });

        investors = Array.from(investorMap.values());
        investorsLoaded = true;

        return investors;
      } catch (error) {
        console.error('Error fetching investors:', error);
        return [];
      }
    }

    async function fetchOwners() {
      if (ownersLoaded) return owners;

      try {
        const boResponse = await fetch(
          `${SUPABASE_URL}/rest/v1/BeneficialOwner?select=entityName,percentageVotesMin,percentageVotesMax,orgNumber&entityType=eq.person&limit=2000`,
          {
            headers: {
              'apikey': SUPABASE_KEY,
              'Authorization': `Bearer ${SUPABASE_KEY}`
            }
          }
        );
        const beneficialOwners = await boResponse.json();

        const wcResponse = await fetch(
          `${SUPABASE_URL}/rest/v1/WatchedCompany?select=orgNumber,name,impactNiche,municipality&limit=2000`,
          {
            headers: {
              'apikey': SUPABASE_KEY,
              'Authorization': `Bearer ${SUPABASE_KEY}`
            }
          }
        );
        const watchedCompanies = await wcResponse.json();

        const companyMap = new Map();
        watchedCompanies.forEach(wc => {
          companyMap.set(wc.orgNumber, wc);
        });

        const ownerMap = new Map();

        beneficialOwners.forEach(bo => {
          const company = companyMap.get(bo.orgNumber);
          if (!company) return;

          const key = bo.entityName.toLowerCase();

          let ownershipLevel;
          if (bo.percentageVotesMax === 100) {
            ownershipLevel = '100%';
          } else if (bo.percentageVotesMin >= 75) {
            ownershipLevel = '75-100%';
          } else if (bo.percentageVotesMin >= 50) {
            ownershipLevel = '50-75%';
          } else {
            ownershipLevel = '25-50%';
          }

          if (!ownerMap.has(key)) {
            const nameParts = bo.entityName.split(' ');
            const firstName = nameParts.slice(0, -1).join(' ') || nameParts[0];
            const lastName = nameParts[nameParts.length - 1];

            ownerMap.set(key, {
              id: `owner-${key.replace(/\s/g, '-')}`,
              name: bo.entityName,
              firstName: firstName,
              lastName: lastName,
              personType: 'OWNER',
              title: 'Agare & Grundare',
              location: company.municipality || null,
              totalCompanies: 0,
              totalBoardSeats: 0,
              activeCompanies: 0,
              bio: null,
              imageUrl: null,
              ownerHoldings: [],
              impactNiches: new Set()
            });
          }

          const owner = ownerMap.get(key);
          owner.ownerHoldings.push({
            companyName: company.name,
            orgNumber: company.orgNumber,
            impactNiche: company.impactNiche,
            ownershipLevel: ownershipLevel,
            percentageMin: bo.percentageVotesMin,
            percentageMax: bo.percentageVotesMax
          });
          owner.totalCompanies++;

          if (company.impactNiche) {
            company.impactNiche.split(', ').forEach(niche => {
              owner.impactNiches.add(niche);
            });
          }
        });

        owners = Array.from(ownerMap.values()).map(owner => ({
          ...owner,
          impactNiche: Array.from(owner.impactNiches).slice(0, 3).join(', '),
          title: owner.ownerHoldings.some(h => h.ownershipLevel === '100%')
            ? 'Grundare & Ensam Agare'
            : owner.ownerHoldings.some(h => h.ownershipLevel === '75-100%')
            ? 'Majoritetsagare'
            : 'Betydande Agare'
        }));

        ownersLoaded = true;
        return owners;

      } catch (error) {
        console.error('Error fetching owners:', error);
        return [];
      }
    }

    // ==========================================
    // UI Functions
    // ==========================================
    function getInitials(name) {
      if (!name) return '??';
      const parts = name.split(' ');
      if (parts.length >= 2) {
        return (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();
      }
      return name.substring(0, 2).toUpperCase();
    }

    function getTypeIcon(personType) {
      switch (personType) {
        case 'EXECUTIVE':
          return `<div class="person-type-badge ceo" title="VD">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20 7h-9M14 17H5M17 17l-3-3 3-3M7 7l3 3-3 3"/>
            </svg>
          </div>`;
        case 'BOARD_MEMBER':
          return `<div class="person-type-badge board" title="Styrelseledamot">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="18" height="18" rx="2"/>
              <path d="M3 9h18M9 21V9"/>
            </svg>
          </div>`;
        case 'INVESTOR':
          return `<div class="person-type-badge investor" title="Investerare">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="1" x2="12" y2="23"></line>
              <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
            </svg>
          </div>`;
        case 'OWNER':
          return `<div class="person-type-badge owner" title="Agare">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
              <path d="M2 17l10 5 10-5"></path>
              <path d="M2 12l10 5 10-5"></path>
            </svg>
          </div>`;
        default:
          return '';
      }
    }

    function createPersonCard(person, isFeatured = false) {
      const roles = personRoles[person.id] || [];
      const mainRoles = roles.slice(0, 3);

      const card = document.createElement('article');
      card.className = `person-card${viewMode === 'list' ? ' list-item' : ''}`;
      card.tabIndex = 0;
      card.onclick = () => openPersonPage(person);

      if (viewMode === 'list') {
        card.innerHTML = `
          <div class="person-avatar-section">
            <div class="person-avatar">
              ${person.imageUrl
                ? `<img src="${person.imageUrl}" alt="${person.name}">`
                : `<span class="initials">${getInitials(person.name)}</span>`
              }
              ${getTypeIcon(person.personType)}
            </div>
          </div>
          <div class="person-info">
            <h3 class="person-name">${person.name}</h3>
            <p class="person-title">${person.title || getRoleTitle(roles) || 'Impact-professional'}</p>
            ${person.location ? `
              <p class="person-location">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                  <circle cx="12" cy="10" r="3"></circle>
                </svg>
                ${person.location}
              </p>
            ` : ''}
          </div>
          <div class="person-stats">
            <div class="person-stat">
              <div class="person-stat-value">${person.totalCompanies || 0}</div>
              <div class="person-stat-label">Bolag</div>
            </div>
            <div class="person-stat">
              <div class="person-stat-value">${person.totalBoardSeats || 0}</div>
              <div class="person-stat-label">Styrelser</div>
            </div>
            <div class="person-stat">
              <div class="person-stat-value">${person.activeCompanies || 0}</div>
              <div class="person-stat-label">Aktiva</div>
            </div>
          </div>
        `;
      } else {
        card.innerHTML = `
          <div class="card-actions">
            <button class="card-action-btn" onclick="event.stopPropagation()" title="Spara">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
              </svg>
            </button>
          </div>
          <div class="person-avatar-section">
            <div class="person-avatar">
              ${person.imageUrl
                ? `<img src="${person.imageUrl}" alt="${person.name}">`
                : `<span class="initials">${getInitials(person.name)}</span>`
              }
              ${getTypeIcon(person.personType)}
            </div>
            <h3 class="person-name">${person.name}</h3>
            <p class="person-title">${person.title || getRoleTitle(roles) || 'Impact-professional'}</p>
            ${person.location ? `
              <p class="person-location">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                  <circle cx="12" cy="10" r="3"></circle>
                </svg>
                ${person.location}
              </p>
            ` : ''}
          </div>
          <div class="person-stats">
            <div class="person-stat">
              <div class="person-stat-value">${person.totalCompanies || 0}</div>
              <div class="person-stat-label">Bolag</div>
            </div>
            <div class="person-stat">
              <div class="person-stat-value">${person.totalBoardSeats || 0}</div>
              <div class="person-stat-label">Styrelser</div>
            </div>
            <div class="person-stat">
              <div class="person-stat-value">${person.activeCompanies || 0}</div>
              <div class="person-stat-label">Aktiva</div>
            </div>
          </div>
          ${mainRoles.length > 0 ? `
            <div class="person-companies">
              ${mainRoles.map(role => `
                <span class="person-company-tag ${role.roleType === 'CEO' ? 'ceo-role' : ''}">
                  <span class="role-indicator"></span>
                  ${role.companyName}
                </span>
              `).join('')}
            </div>
          ` : ''}
        `;
      }

      return card;
    }

    function getRoleTitle(roles) {
      if (!roles.length) return null;
      const ceoRole = roles.find(r => r.roleType === 'CEO');
      if (ceoRole) return ceoRole.roleTitle || 'VD';
      const chairmanRole = roles.find(r => r.roleType === 'CHAIRMAN');
      if (chairmanRole) return chairmanRole.roleTitle || 'Ordforande';
      return roles[0].roleTitle;
    }

    function openPersonPage(person) {
      // Create URL-friendly name slug
      const slug = person.name.toLowerCase()
        .replace(/[aoaeoe]/g, c => ({ 'a': 'a', 'o': 'o', 'ae': 'a', 'oe': 'o' }[c] || c))
        .replace(/\s+/g, '-')
        .replace(/[^a-z0-9-]/g, '');

      // In production, this would navigate to person-{slug}.html
      // For now, show alert with person info
      console.log(`Opening profile page for: ${person.name} (${slug})`);
      alert(`Oppnar profilsida for ${person.name}\n\nI produktionsversion: /personer/${slug}`);
    }

    async function reloadPersons() {
      currentPage = 0;
      personRoles = {};
      allPersons = [];
      hasMore = true;
      selectedCardIndex = -1;
      showSkeletons();
      await loadPersons(true);
    }

    async function loadPersons(reset = false) {
      if (isLoading) return;
      isLoading = true;
      showScrollLoader();

      if (reset) {
        currentPage = 0;
        document.getElementById('peopleGrid').innerHTML = '';
      }

      try {
        const grid = document.getElementById('peopleGrid');

        // Special handling for INVESTOR filter
        if (currentFilter === 'INVESTOR') {
          const allInvestors = await fetchInvestors();

          let filteredInvestors = allInvestors;
          if (searchQuery) {
            const query = searchQuery.toLowerCase();
            filteredInvestors = allInvestors.filter(inv =>
              inv.name.toLowerCase().includes(query) ||
              inv.investorOrgs.some(org => org.name.toLowerCase().includes(query))
            );
          }

          if (currentSort === 'companies') {
            filteredInvestors.sort((a, b) => b.totalCompanies - a.totalCompanies);
          } else if (currentSort === 'name') {
            filteredInvestors.sort((a, b) => a.lastName.localeCompare(b.lastName, 'sv'));
          }

          const start = currentPage * PAGE_SIZE;
          const pageInvestors = filteredInvestors.slice(start, start + PAGE_SIZE);

          if (pageInvestors.length === 0) {
            hasMore = false;
            if (currentPage === 0) {
              grid.innerHTML = `
                <div class="empty-state" style="grid-column: 1/-1; text-align: center; padding: var(--space-16);">
                  <h3 style="font-family: var(--font-display); margin-bottom: var(--space-2);">Inga investerare hittades</h3>
                  <p style="color: var(--text-muted);">Prova att andra din sokning</p>
                </div>
              `;
            }
          } else {
            pageInvestors.forEach((investor, index) => {
              personRoles[investor.id] = investor.investorOrgs.map(org => ({
                personId: investor.id,
                roleType: 'INVESTOR',
                roleTitle: org.type,
                companyName: org.name,
                isActive: true
              }));

              const card = createPersonCard(investor, false);
              card.style.animationDelay = `${index * 0.05}s`;
              grid.appendChild(card);
              allPersons.push(investor);
            });

            currentPage++;
            hasMore = pageInvestors.length === PAGE_SIZE;
          }

          isLoading = false;
          hideScrollLoader();
          return;
        }

        // Special handling for OWNER filter
        if (currentFilter === 'OWNER') {
          const allOwners = await fetchOwners();

          let filteredOwners = allOwners;
          if (searchQuery) {
            const query = searchQuery.toLowerCase();
            filteredOwners = allOwners.filter(owner =>
              owner.name.toLowerCase().includes(query) ||
              owner.ownerHoldings.some(h => h.companyName.toLowerCase().includes(query))
            );
          }

          if (currentSort === 'companies') {
            filteredOwners.sort((a, b) => b.totalCompanies - a.totalCompanies);
          } else if (currentSort === 'name') {
            filteredOwners.sort((a, b) => a.lastName.localeCompare(b.lastName, 'sv'));
          }

          const start = currentPage * PAGE_SIZE;
          const pageOwners = filteredOwners.slice(start, start + PAGE_SIZE);

          if (pageOwners.length === 0) {
            hasMore = false;
            if (currentPage === 0) {
              grid.innerHTML = `
                <div class="empty-state" style="grid-column: 1/-1; text-align: center; padding: var(--space-16);">
                  <h3 style="font-family: var(--font-display); margin-bottom: var(--space-2);">Inga agare hittades</h3>
                  <p style="color: var(--text-muted);">Prova att andra din sokning</p>
                </div>
              `;
            }
          } else {
            pageOwners.forEach((owner, index) => {
              personRoles[owner.id] = owner.ownerHoldings.map(h => ({
                personId: owner.id,
                roleType: 'OWNER',
                roleTitle: h.ownershipLevel,
                companyName: h.companyName,
                isActive: true
              }));

              const card = createPersonCard(owner, false);
              card.style.animationDelay = `${index * 0.05}s`;
              grid.appendChild(card);
              allPersons.push(owner);
            });

            currentPage++;
            hasMore = pageOwners.length === PAGE_SIZE;
          }

          isLoading = false;
          hideScrollLoader();
          return;
        }

        // Standard person loading
        const persons = await fetchPersons(currentPage * PAGE_SIZE, PAGE_SIZE);

        if (persons.length === 0) {
          hasMore = false;
          isLoading = false;
          hideScrollLoader();
          return;
        }

        const personIds = persons.map(p => p.id);
        const roles = await fetchPersonRoles(personIds);

        roles.forEach(role => {
          if (!personRoles[role.personId]) {
            personRoles[role.personId] = [];
          }
          personRoles[role.personId].push(role);
        });

        persons.forEach((person, index) => {
          const card = createPersonCard(person, false);
          card.style.animationDelay = `${index * 0.05}s`;
          grid.appendChild(card);
        });

        currentPage++;
        allPersons = allPersons.concat(persons);
        hasMore = persons.length === PAGE_SIZE;

      } catch (error) {
        console.error('Error loading persons:', error);
      }

      isLoading = false;
      hideScrollLoader();
    }

    // ==========================================
    // Event Handlers
    // ==========================================
    let searchTimeout;
    document.getElementById('searchInput').addEventListener('input', (e) => {
      clearTimeout(searchTimeout);
      searchTimeout = setTimeout(() => {
        searchQuery = e.target.value.trim();
        reloadPersons();
      }, 300);
    });

    document.getElementById('filterTabs').addEventListener('click', (e) => {
      const tab = e.target.closest('.filter-tab');
      if (!tab) return;

      document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
      tab.classList.add('active');

      currentFilter = tab.dataset.filter;
      reloadPersons();
    });

    document.getElementById('sortSelect').addEventListener('change', (e) => {
      currentSort = e.target.value;
      reloadPersons();
    });

    // ==========================================
    // Theme
    // ==========================================
    function toggleTheme() {
      const html = document.documentElement;
      const next = html.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
      html.setAttribute('data-theme', next);
      localStorage.setItem('theme', next);
    }

    function initTheme() {
      const saved = localStorage.getItem('theme');
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      if (saved) {
        document.documentElement.setAttribute('data-theme', saved);
      } else if (prefersDark) {
        document.documentElement.setAttribute('data-theme', 'dark');
      }
    }

    // ==========================================
    // Init
    // ==========================================
    initTheme();
    initializeFilters();
    initKeyboardNavigation();
    initInfiniteScroll();
    showSkeletons();

    // Animate counters after a short delay
    setTimeout(animateCounters, 500);

    // Load initial data
    loadPersons(true);
  </script>
</body>
</html>
