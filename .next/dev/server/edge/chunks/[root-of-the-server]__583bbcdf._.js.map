{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/CLAUDE/projects/1. Loop Desk/src/middleware.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport type { NextRequest } from \"next/server\";\n\n// Routes that are accessible without authentication\nconst publicPaths = [\"/login\", \"/register\", \"/person\", \"/bolag\", \"/auth\", \"/forgot-password\", \"/reset-password\", \"/auth/callback\", \"/auth/reset-complete\"];\n\n// Routes that logged-in users should be redirected away from\nconst authPaths = [\"/login\", \"/register\"];\n\nexport function middleware(request: NextRequest) {\n  const { pathname } = request.nextUrl;\n\n  // Check for session cookie (Auth.js uses these cookie names)\n  const sessionCookie = request.cookies.get(\"authjs.session-token\") ||\n    request.cookies.get(\"__Secure-authjs.session-token\");\n  const isLoggedIn = !!sessionCookie;\n\n  // Always allow auth API routes, health check, and public endpoints\n  if (\n    pathname.startsWith(\"/api/auth\") ||\n    pathname === \"/api/health\" ||\n    pathname.startsWith(\"/api/debug\") ||\n    pathname === \"/api/bevakning/seed\" ||\n    pathname.startsWith(\"/api/bevakning/enrich\") ||\n    pathname.startsWith(\"/api/investors\") ||\n    pathname === \"/api/cron/refresh\" ||\n    pathname === \"/api/feed/global\" ||\n    pathname === \"/api/sources\" ||\n    pathname === \"/api/article\" ||\n    pathname === \"/api/person/names\" ||\n    pathname.startsWith(\"/api/person/\") ||\n    pathname === \"/api/bolag/company-names\" ||\n    pathname.startsWith(\"/api/bolag/\") ||\n    pathname.startsWith(\"/api/media/\") ||\n    pathname === \"/api/chat\" ||\n    pathname === \"/api/config/supabase\"\n  ) {\n    return NextResponse.next();\n  }\n\n  // Protect all other API routes\n  if (pathname.startsWith(\"/api\")) {\n    if (!isLoggedIn) {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n    }\n    return NextResponse.next();\n  }\n\n  // Check path types\n  const isPublicPath = publicPaths.some(path => pathname === path || pathname.startsWith(path + \"/\"));\n  const isAuthPath = authPaths.some(path => pathname === path || pathname.startsWith(path + \"/\"));\n\n  // Redirect logged-in users away from auth pages (login/register)\n  if (isLoggedIn && isAuthPath) {\n    return NextResponse.redirect(new URL(\"/nyheter\", request.url));\n  }\n\n  // Redirect non-logged-in users to login for protected routes\n  if (!isLoggedIn && !isPublicPath) {\n    const loginUrl = new URL(\"/login\", request.url);\n    if (pathname !== \"/\") {\n      loginUrl.searchParams.set(\"callbackUrl\", pathname);\n    }\n    return NextResponse.redirect(loginUrl);\n  }\n\n  const response = NextResponse.next();\n  response.headers.set(\"X-Middleware-Active\", \"true\");\n  return response;\n}\n\nexport const config = {\n  matcher: [\n    /*\n     * Match all request paths except static files\n     */\n    \"/((?!_next/static|_next/image|favicon.ico|sitemap.xml|robots.txt|avatars/|logos/).*)\",\n  ],\n};\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;;AAGA,oDAAoD;AACpD,MAAM,cAAc;IAAC;IAAU;IAAa;IAAW;IAAU;IAAS;IAAoB;IAAmB;IAAkB;CAAuB;AAE1J,6DAA6D;AAC7D,MAAM,YAAY;IAAC;IAAU;CAAY;AAElC,SAAS,WAAW,OAAoB;IAC7C,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ,OAAO;IAEpC,6DAA6D;IAC7D,MAAM,gBAAgB,QAAQ,OAAO,CAAC,GAAG,CAAC,2BACxC,QAAQ,OAAO,CAAC,GAAG,CAAC;IACtB,MAAM,aAAa,CAAC,CAAC;IAErB,mEAAmE;IACnE,IACE,SAAS,UAAU,CAAC,gBACpB,aAAa,iBACb,SAAS,UAAU,CAAC,iBACpB,aAAa,yBACb,SAAS,UAAU,CAAC,4BACpB,SAAS,UAAU,CAAC,qBACpB,aAAa,uBACb,aAAa,sBACb,aAAa,kBACb,aAAa,kBACb,aAAa,uBACb,SAAS,UAAU,CAAC,mBACpB,aAAa,8BACb,SAAS,UAAU,CAAC,kBACpB,SAAS,UAAU,CAAC,kBACpB,aAAa,eACb,aAAa,wBACb;QACA,OAAO,2OAAY,CAAC,IAAI;IAC1B;IAEA,+BAA+B;IAC/B,IAAI,SAAS,UAAU,CAAC,SAAS;QAC/B,IAAI,CAAC,YAAY;YACf,OAAO,2OAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QACA,OAAO,2OAAY,CAAC,IAAI;IAC1B;IAEA,mBAAmB;IACnB,MAAM,eAAe,YAAY,IAAI,CAAC,CAAA,OAAQ,aAAa,QAAQ,SAAS,UAAU,CAAC,OAAO;IAC9F,MAAM,aAAa,UAAU,IAAI,CAAC,CAAA,OAAQ,aAAa,QAAQ,SAAS,UAAU,CAAC,OAAO;IAE1F,iEAAiE;IACjE,IAAI,cAAc,YAAY;QAC5B,OAAO,2OAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,YAAY,QAAQ,GAAG;IAC9D;IAEA,6DAA6D;IAC7D,IAAI,CAAC,cAAc,CAAC,cAAc;QAChC,MAAM,WAAW,IAAI,IAAI,UAAU,QAAQ,GAAG;QAC9C,IAAI,aAAa,KAAK;YACpB,SAAS,YAAY,CAAC,GAAG,CAAC,eAAe;QAC3C;QACA,OAAO,2OAAY,CAAC,QAAQ,CAAC;IAC/B;IAEA,MAAM,WAAW,2OAAY,CAAC,IAAI;IAClC,SAAS,OAAO,CAAC,GAAG,CAAC,uBAAuB;IAC5C,OAAO;AACT;AAEO,MAAM,SAAS;IACpB,SAAS;QACP;;KAEC,GACD;KACD;AACH"}}]
}