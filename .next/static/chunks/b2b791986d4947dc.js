;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="e5713a3a-5190-8530-8a93-437494345d80")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,113778,e=>{"use strict";var t=e.i(206266),s=e.i(247032),r=e.i(672332),n=e.i(176480),a=e.i(569394),l=e.i(959968),i=e.i(212298),o=e.i(862759),d=e.i(970177),c=e.i(55410),u=e.i(530698),m=e.i(690972);let h=(0,m.default)("merge",[["path",{d:"m8 6 4-4 4 4",key:"ybng9g"}],["path",{d:"M12 2v10.3a4 4 0 0 1-1.172 2.872L4 22",key:"1hyw0i"}],["path",{d:"m20 22-5-5",key:"1m27yz"}]]),g=(0,m.default)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),p=(0,m.default)("radio",[["path",{d:"M16.247 7.761a6 6 0 0 1 0 8.478",key:"1fwjs5"}],["path",{d:"M19.075 4.933a10 10 0 0 1 0 14.134",key:"ehdyv1"}],["path",{d:"M4.925 19.067a10 10 0 0 1 0-14.134",key:"1q22gi"}],["path",{d:"M7.753 16.239a6 6 0 0 1 0-8.478",key:"r2q7qm"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);var x=e.i(488069);let f=(0,m.default)("bell-off",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M17 17H4a1 1 0 0 1-.74-1.673C4.59 13.956 6 12.499 6 8a6 6 0 0 1 .258-1.742",key:"178tsu"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M8.668 3.01A6 6 0 0 1 18 8c0 2.687.77 4.653 1.707 6.05",key:"1hqiys"}]]),b=(0,m.default)("check-check",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]);var v=e.i(154349),y=e.i(374644),k=e.i(731846),j=e.i(214634);let w=(0,m.default)("layout-grid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);var N=e.i(805680),N=N,S=e.i(715795);let C=(0,s.createContext)({companies:{},isLoading:!0});function $({children:e}){let[r,n]=(0,s.useState)({}),[a,l]=(0,s.useState)(!0);return(0,s.useEffect)(()=>{!async function(){try{let e=await fetch("/api/bolag/company-names");if(e.ok){let t=await e.json();n(t.companies||{})}}catch(e){console.error("Failed to fetch company names:",e)}finally{l(!1)}}()},[]),(0,t.jsx)(C.Provider,{value:{companies:r,isLoading:a},children:e})}var E=e.i(954434),D=e.i(703712),M=e.i(284488),z=e.i(213571),O=e.i(505265),T=e.i(917171);let I=(0,m.default)("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);var A=e.i(877144),L=e.i(357210);let F=["bg-blue-500","bg-emerald-500","bg-amber-500","bg-purple-500","bg-rose-500","bg-cyan-500","bg-indigo-500","bg-orange-500"],P=["#3b82f6","#10b981","#f59e0b","#a855f7","#f43f5e","#06b6d4","#6366f1","#f97316"];function R(e,t,s,r){let n=(r-90)*Math.PI/180;return{x:e+s*Math.cos(n),y:t+s*Math.sin(n)}}function _({shareholders:e,previousShareholders:r,maxDisplay:n=6}){let a=(0,s.useMemo)(()=>{if(!e?.length)return[];let t=e.reduce((e,t)=>e+t.shares,0);return e.map(e=>({...e,sharePercentage:e.sharePercentage??(t>0?e.shares/t*100:0)}))},[e]),l=(0,s.useMemo)(()=>[...a].sort((e,t)=>t.shares-e.shares),[a]),i=(0,s.useMemo)(()=>{if(l.length<=n)return l;let e=l.slice(0,n-1),t=l.slice(n-1),s=t.reduce((e,t)=>e+t.shares,0),r=t.reduce((e,t)=>e+(t.sharePercentage||0),0);return[...e,{name:`${t.length} \xf6vriga`,shares:s,sharePercentage:r}]},[l,n]),o=(0,s.useMemo)(()=>{if(!r?.length)return null;let e=new Map(r.map(e=>[e.name,e.shares])),t=new Map(a.map(e=>[e.name,e.shares])),s=a.filter(t=>!e.has(t.name));return{newOwners:s,exitedOwners:r.filter(e=>!t.has(e.name)),changedOwners:a.filter(t=>{let s=e.get(t.name);return void 0!==s&&s!==t.shares})}},[a,r]),d=(0,s.useMemo)(()=>{let e=[];return i.reduce((t,s,r)=>{let n=t+(s.sharePercentage||0)/100*360;return e.push({...s,startAngle:t,endAngle:n,color:P[r%P.length]}),n},0),e},[i]);return e?.length?(0,t.jsxs)("div",{className:"p-4 bg-muted/50 rounded-xl border border-border/50",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,t.jsx)(c.Users,{className:"w-4 h-4 text-muted-foreground"}),(0,t.jsx)("span",{className:"text-sm font-semibold",children:"Ägarstruktur"}),(0,t.jsxs)("span",{className:"text-xs text-muted-foreground",children:["(",e.length," ägare)"]})]}),(0,t.jsxs)("div",{className:"flex gap-6",children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:(0,t.jsxs)("svg",{width:"120",height:"120",viewBox:"0 0 120 120",children:[d.map((e,s)=>{var r,n;let a,l,i;return(0,t.jsx)("path",{d:(r=e.startAngle,a=R(60,60,55,n=e.endAngle),l=R(60,60,55,r),i=n-r<=180?"0":"1",["M 60 60 L",a.x,a.y,"A 55 55 0",i,"0",l.x,l.y,"Z"].join(" ")),fill:e.color,className:"transition-all duration-300 hover:opacity-80"},s)}),(0,t.jsx)("circle",{cx:"60",cy:"60",r:"30",fill:"var(--background)"})]})}),(0,t.jsx)("div",{className:"flex-1 min-w-0 space-y-1.5",children:i.map((e,s)=>{var r;return(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,t.jsx)("div",{className:`w-3 h-3 rounded-sm flex-shrink-0 ${F[s%F.length]}`}),(0,t.jsx)("span",{className:"truncate flex-1",title:e.name,children:e.name}),(0,t.jsx)("span",{className:"text-muted-foreground font-mono text-xs flex-shrink-0",children:void 0===(r=e.sharePercentage)?"–":`${r.toFixed(1)}%`})]},s)})})]}),o&&(o.newOwners.length>0||o.exitedOwners.length>0)&&(0,t.jsxs)("div",{className:"mt-4 pt-3 border-t border-border/50",children:[(0,t.jsx)("div",{className:"text-xs font-medium text-muted-foreground mb-2",children:"Ägarförändringar"}),(0,t.jsxs)("div",{className:"space-y-1",children:[o.newOwners.slice(0,3).map((e,s)=>{var r;return(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs",children:[(0,t.jsx)(u.TrendingUp,{className:"w-3 h-3 text-emerald-500"}),(0,t.jsx)("span",{className:"text-emerald-600 dark:text-emerald-400",children:e.name}),(0,t.jsxs)("span",{className:"text-muted-foreground",children:["+",(r=e.shares)>=1e6?`${(r/1e6).toFixed(1)}M`:r>=1e3?`${(r/1e3).toFixed(0)}k`:r.toLocaleString("sv-SE")," aktier"]})]},`new-${s}`)}),o.exitedOwners.slice(0,3).map((e,s)=>(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs",children:[(0,t.jsx)(A.TrendingDown,{className:"w-3 h-3 text-red-500"}),(0,t.jsx)("span",{className:"text-red-600 dark:text-red-400",children:e.name}),(0,t.jsx)("span",{className:"text-muted-foreground",children:"lämnade"})]},`exit-${s}`)),o.changedOwners.slice(0,2).map((e,s)=>(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs",children:[(0,t.jsx)(L.Minus,{className:"w-3 h-3 text-amber-500"}),(0,t.jsx)("span",{className:"text-amber-600 dark:text-amber-400",children:e.name}),(0,t.jsx)("span",{className:"text-muted-foreground",children:"ändrade innehav"})]},`change-${s}`))]})]})]}):null}var U=e.i(520932);function B({isOpen:e,onClose:r,pdfUrl:n,title:a}){let l=(0,s.useCallback)(e=>{"Escape"===e.key&&r()},[r]);return((0,s.useEffect)(()=>(e&&(document.addEventListener("keydown",l),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",l),document.body.style.overflow=""}),[e,l]),e)?(0,t.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-background/90 backdrop-blur-sm",onClick:r}),(0,t.jsxs)("div",{className:"relative w-full h-full max-w-5xl max-h-[90vh] mx-4 my-4 flex flex-col animate-in fade-in zoom-in-95 duration-200",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between bg-card border border-border rounded-t-xl px-4 py-3",children:[(0,t.jsx)("div",{className:"flex items-center gap-3 min-w-0",children:(0,t.jsx)("h2",{className:"text-sm font-semibold truncate",children:a||"Protokoll"})}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("a",{href:n,target:"_blank",rel:"noopener noreferrer",className:"p-2 hover:bg-secondary rounded-lg transition-colors text-muted-foreground hover:text-foreground",title:"Öppna i ny flik",children:(0,t.jsx)(E.ExternalLink,{size:18})}),(0,t.jsx)("a",{href:n,download:!0,className:"p-2 hover:bg-secondary rounded-lg transition-colors text-muted-foreground hover:text-foreground",title:"Ladda ner",children:(0,t.jsx)(U.Download,{size:18})}),(0,t.jsx)("button",{onClick:r,className:"p-2 hover:bg-secondary rounded-lg transition-colors text-muted-foreground hover:text-foreground",title:"Stäng (Esc)",children:(0,t.jsx)(k.X,{size:18})})]})]}),(0,t.jsx)("div",{className:"flex-1 bg-card border-x border-b border-border rounded-b-xl overflow-hidden",children:(0,t.jsx)("iframe",{src:`${n}#toolbar=1&navpanes=0&scrollbar=1`,className:"w-full h-full",title:a||"PDF-dokument"})})]})]}):null}var W=e.i(693794);function q({events:e,currentEventId:r,orgNumber:n,maxDisplay:a=3}){let l=(0,s.useMemo)(()=>e.filter(e=>e.id!==r).sort((e,t)=>t.date.getTime()-e.date.getTime()).slice(0,a),[e,r,a]);return 0===l.length?null:(0,t.jsxs)("div",{className:"p-4 bg-muted/50 rounded-xl border border-border/50",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(y.Calendar,{className:"w-4 h-4 text-muted-foreground"}),(0,t.jsx)("span",{className:"text-sm font-semibold",children:"Fler händelser från bolaget"})]}),(0,t.jsxs)(S.default,{href:`/bolag/${n.replace(/\D/g,"")}`,className:"text-xs text-muted-foreground hover:text-primary flex items-center gap-1 transition-colors",children:["Visa alla",(0,t.jsx)(W.ChevronRight,{size:12})]})]}),(0,t.jsx)("div",{className:"space-y-2",children:l.map(e=>(0,t.jsxs)("div",{className:"flex items-start gap-3 p-2 rounded-lg hover:bg-secondary/50 transition-colors",children:[(0,t.jsx)("div",{className:`mt-0.5 p-1.5 rounded-md ${"protocol"===e.type||"protocolSearch"===e.type?"bg-indigo-100 dark:bg-indigo-900/50 text-indigo-600 dark:text-indigo-400":"bg-secondary text-muted-foreground"}`,children:(0,t.jsx)(o.FileText,{size:12})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"text-sm font-medium truncate",children:e.title}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mt-0.5",children:[(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:function(e){let t=Math.floor((new Date().getTime()-e.getTime())/864e5);if(0===t)return"Idag";if(1===t)return"Igår";if(t<7)return`${t} dagar sedan`;if(t<30){let e=Math.floor(t/7);return`${e} ${1===e?"vecka":"veckor"} sedan`}{if(!(t<365))return e.toLocaleDateString("sv-SE",{year:"numeric",month:"short"});let s=Math.floor(t/30);return`${s} ${1===s?"månad":"månader"} sedan`}}(e.date)}),e.eventType&&(0,t.jsx)("span",{className:"text-xs px-1.5 py-0.5 rounded bg-secondary text-muted-foreground",children:e.eventType})]})]})]},`${e.type}-${e.id}`))})]})}let H={konkurs:{keywords:["konkurs","konkursbeslut"],color:"bg-red-500",bgColor:"bg-red-50 dark:bg-red-950/30",borderColor:"border-l-red-500",gradient:"from-red-500/10 to-transparent",label:"Konkurs",icon:(0,t.jsx)(g,{className:"w-5 h-5"}),priority:1},likvidation:{keywords:["likvidation","likvidator"],color:"bg-orange-500",bgColor:"bg-orange-50 dark:bg-orange-950/30",borderColor:"border-l-orange-500",gradient:"from-orange-500/10 to-transparent",label:"Likvidation",icon:(0,t.jsx)(d.AlertTriangle,{className:"w-5 h-5"}),priority:2},fusion:{keywords:["fusion","sammanslagning"],color:"bg-purple-500",bgColor:"bg-purple-50 dark:bg-purple-950/30",borderColor:"border-l-purple-500",gradient:"from-purple-500/10 to-transparent",label:"Fusion",icon:(0,t.jsx)(h,{className:"w-5 h-5"}),priority:3},emission:{keywords:["nyemission","fondemission","riktad emission"],color:"bg-blue-500",bgColor:"bg-blue-50 dark:bg-blue-950/30",borderColor:"border-l-blue-500",gradient:"from-blue-500/10 to-transparent",label:"Emission",icon:(0,t.jsx)(u.TrendingUp,{className:"w-5 h-5"}),priority:4},styrelse:{keywords:["styrelse","ledamot","ordförande","vd","firmatecknare"],color:"bg-green-500",bgColor:"bg-green-50 dark:bg-green-950/30",borderColor:"border-l-green-500",gradient:"from-green-500/10 to-transparent",label:"Styrelse",icon:(0,t.jsx)(c.Users,{className:"w-5 h-5"}),priority:5}};function K(e,t){if(!t||t.trim().length<2)return e;let s=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),r=RegExp(`(${s})`,"gi");return e.replace(r,'<mark class="bg-yellow-200 dark:bg-yellow-500/30 text-inherit px-0.5 rounded">$1</mark>')}function V({event:e,date:r,isFocused:n=!1,showGradientLine:l=!0,isUnread:i=!1,onMarkAsRead:d,onBookmark:c,isBookmarked:u=!1,searchQuery:m,relatedEvents:h,layout:g="standard"}){let p,[x,f]=(0,s.useState)(!1),[b,v]=(0,s.useState)(!1),[y,k]=(0,s.useState)(!1),[j,w]=(0,s.useState)(!1),N=(0,s.useRef)(null),{time:C,day:$}=function(e){let t=new Date,s=e.toLocaleTimeString("sv-SE",{hour:"2-digit",minute:"2-digit"});if(e.toDateString()===t.toDateString())return{time:s};let r=new Date(t);if(r.setDate(r.getDate()-1),e.toDateString()===r.toDateString())return{time:s,day:"Igår"};let n=new Date(t);if(n.setDate(n.getDate()-7),e>n){let t=e.toLocaleDateString("sv-SE",{weekday:"short"});return{time:s,day:t.charAt(0).toUpperCase()+t.slice(1)}}return{time:s,day:e.toLocaleDateString("sv-SE",{day:"numeric",month:"short"})}}(r),A="protocol"===e.type||"protocolSearch"===e.type?e.data.companyName||"Okänt bolag":e.data.subject||"Okänt bolag",L=("protocol"===e.type||e.type,e.data.orgNumber),F=function(e){let t=e.toLowerCase();for(let[e,s]of Object.entries(H))if(s.keywords.some(e=>t.includes(e)))return{category:e,...s};return null}("announcement"===e.type?`${e.data.type||""} ${e.data.detailText||""}`:"protocol"===e.type&&e.data.eventType?e.data.eventType:""),P=function(e){if("protocol"===e.type){let t=e.data,s=t.companyName||"Okänt bolag";if(t.aiDetails?.notis?.titel)return t.aiDetails.notis.titel;let r=t.aiDetails?.faktaruta?.stämmoTyp;return r?`${r} i ${s}`:`Protokoll fr\xe5n ${s}`}if("protocolSearch"===e.type){let t=e.data;return`Nytt st\xe4mmoprotokoll fr\xe5n ${t.companyName}`}let t=e.data,s=t.subject||"Okänt bolag",r=`${t.type||""} ${t.detailText||""}`.toLowerCase();return r.includes("konkurs")?`Konkurs i ${s}`:r.includes("likvidation")?`Likvidation av ${s}`:r.includes("fusion")?`Fusion: ${s}`:r.includes("nyemission")||r.includes("fondemission")?`Emission i ${s}`:r.includes("styrelse")||r.includes("ledamot")||r.includes("vd")?`Styrelse\xe4ndring i ${s}`:r.includes("firmatecknare")?`\xc4ndring av firmatecknare i ${s}`:r.includes("revisor")?`Revisorsbyte i ${s}`:r.includes("bolagsordning")?`Ny bolagsordning f\xf6r ${s}`:r.includes("aktiekapital")?`\xc4ndrat aktiekapital i ${s}`:r.includes("adress")||r.includes("säte")?`Adress\xe4ndring f\xf6r ${s}`:`Registrering: ${s}`}(e),R=function(e){if("protocol"===e.type){let t=e.data;if(t.aiDetails?.notis?.sammanfattning)return t.aiDetails.notis.sammanfattning;if(t.aiSummary)return t.aiSummary;let s=[];if(t.aiDetails?.faktaruta?.stämmoTyp&&s.push(t.aiDetails.faktaruta.stämmoTyp),t.aiDetails?.faktaruta?.stämmoDatum){let e=new Date(t.aiDetails.faktaruta.stämmoDatum);s.push(`den ${e.toLocaleDateString("sv-SE",{day:"numeric",month:"long"})}`)}return s.length>0?`${s.join(" ")} inl\xe4mnad till Bolagsverket.`:"Protokoll har lämnats in till Bolagsverket."}if("protocolSearch"===e.type){let t=e.data;if(t.latestProtocolDate){let e=new Date(t.latestProtocolDate).toLocaleDateString("sv-SE",{year:"numeric",month:"2-digit",day:"2-digit"});return`Ett nytt protokoll har registrerats i Bolagsverkets databas: ${e}`}return"Ett nytt protokoll har registrerats i Bolagsverkets databas."}let t=e.data,s=`${t.type||""} ${t.detailText||""}`.match(/Ändringar har registrerats beträffande:\s*([^\n.]+)/i);if(s){let e=s[1].replace(/,\s*$/,"").trim();return`\xc4ndringar har registrerats g\xe4llande ${e}.`}let r=t.detailText||"";for(let e of[/In English/gi,/Start\s+Sök/gi,/Sök kungörelse/gi,/Bli kund/gi,/Logga in/gi,/Skriv ut/gi,/0771-670\s*670/gi,/Bolagsverket/gi,/Aktiebolagsregistret/gi,/Sökresultat/gi,/Antal träffar:\s*\d+/gi,/K\d{5,}[-/]\d{2}/gi,/\d{4}-\d{2}-\d{2}/g,/\d{6}-\d{4}/g,/Org nr:/gi,/Företagsnamn:/gi,/Säte:/gi,/Kungörelsetext/gi,/Uppgiftslämnare/gi,/Typ av kungörelse/gi,/Registreringsdatum/gi,/Publiceringsdatum/gi,/« Tillbaka/gi,/Publicerad/gi])r=r.replace(e," ");return(r=r.replace(/\s+/g," ").trim()).length>200&&(r=r.slice(0,197)+"..."),r||"Kungörelse noterad."}(e),U=function(e,t){if(!e&&!t)return null;if(t){let e=t.toLowerCase().replace(/\s*(ab|aktiebolag|hb|kb|ek\.\s*för\.?|handelsbolag)\s*$/gi,"").replace(/[^a-zåäö0-9]/gi,"").trim();if(e.length>2)return`https://logo.clearbit.com/${e}.se`}if(e){let t=e.replace(/\D/g,"");if(t.length>=10)return`/logos/${t}.png`}return null}(L,A),W=L?`/logos/${L.replace(/\D/g,"")}.png`:null,V="announcement"===e.type?`https://poit.bolagsverket.se/poit-app/kungorelse/${e.data.id.replace(/\//g,"-")}`:"protocol"===e.type?e.data.pdfUrl:null,J=!i,X=async e=>{e.stopPropagation();let t={title:P,text:R.slice(0,100),url:V||window.location.href};if(navigator.share)try{await navigator.share(t)}catch{}else await navigator.clipboard.writeText(V||window.location.href)};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("article",{ref:N,className:`
        group relative ${"compact"===g?"py-4":"py-6 sm:py-8"} cursor-pointer
        transition-all duration-[250ms] ease-[cubic-bezier(0.4,0,0.2,1)]
        ${n?"ring-2 ring-rose-500 ring-offset-4 ring-offset-background rounded-2xl":""}
        ${x?"bg-secondary/20 -mx-4 px-4 rounded-2xl":""}
        ${J&&!x?"opacity-50":""}
        hover:opacity-100 hover:-translate-y-0.5
      `,style:{minHeight:"auto"},onClick:e=>{let t=e.target;t.closest("button")||t.closest("a")||(f(!x),!x&&d&&d())},children:[(0,t.jsxs)("div",{className:"absolute right-0 top-6 flex items-center gap-1.5 opacity-0 group-hover:opacity-100 transition-all duration-200 z-10",children:[(0,t.jsx)("button",{onClick:e=>{e.stopPropagation(),c?.()},className:"h-9 w-9 rounded-xl border border-border/50 bg-background/95 backdrop-blur-sm text-muted-foreground hover:text-rose-500 hover:border-rose-200 dark:hover:border-rose-800 transition-all duration-200 flex items-center justify-center shadow-sm hover:shadow-md",title:u?"Ta bort bokmärke":"Bokmärk",children:u?(0,t.jsx)(O.BookmarkCheck,{className:"w-4 h-4"}):(0,t.jsx)(z.Bookmark,{className:"w-4 h-4"})}),i&&(0,t.jsx)("button",{onClick:e=>{e.stopPropagation(),d?.()},className:"h-9 w-9 rounded-xl border border-border/50 bg-background/95 backdrop-blur-sm text-muted-foreground hover:text-emerald-500 hover:border-emerald-200 dark:hover:border-emerald-800 transition-all duration-200 flex items-center justify-center shadow-sm hover:shadow-md",title:"Markera som läst",children:(0,t.jsx)(I,{className:"w-4 h-4"})}),(0,t.jsx)("button",{onClick:X,className:"h-9 w-9 rounded-xl border border-border/50 bg-background/95 backdrop-blur-sm text-muted-foreground hover:text-foreground hover:border-border transition-all duration-200 flex items-center justify-center shadow-sm hover:shadow-md",title:"Dela",children:(0,t.jsx)(T.Share2,{className:"w-4 h-4"})})]}),(0,t.jsxs)("div",{className:"min-w-0 flex flex-col",children:[F&&(0,t.jsx)("span",{className:"inline-block mb-2 text-[10px] font-semibold tracking-[0.15em] uppercase text-rose-500",children:F.label}),("protocol"===e.type||"protocolSearch"===e.type)&&!F&&(0,t.jsx)("span",{className:"inline-block mb-2 text-[10px] font-semibold tracking-[0.15em] uppercase text-rose-500",children:"Protokoll"}),(0,t.jsx)("h2",{className:"font-serif text-lg sm:text-xl md:text-[22px] font-normal leading-snug text-foreground group-hover:text-rose-600 dark:group-hover:text-rose-400 transition-colors duration-200",dangerouslySetInnerHTML:{__html:K(P,m)}}),(0,t.jsxs)("div",{className:"flex items-center gap-3 mt-3 text-sm text-muted-foreground",children:[L&&(0,t.jsxs)(S.default,{href:`/bolag/${L.replace(/\D/g,"")}`,onClick:e=>e.stopPropagation(),className:"flex items-center gap-2.5 font-medium text-foreground hover:text-rose-500 transition-colors duration-200",children:[!b&&(U||W)&&(0,t.jsx)("div",{className:"relative w-7 h-7 rounded-lg overflow-hidden bg-muted/50 flex-shrink-0 shadow-sm ring-1 ring-border/30",children:(0,t.jsx)("img",{src:y?W||"":U||"",alt:"",className:"w-full h-full object-contain p-0.5",onError:()=>{!y&&U?k(!0):v(!0)}})}),(b||!U&&!W)&&(0,t.jsx)("div",{className:"w-7 h-7 rounded-lg bg-muted/50 flex items-center justify-center flex-shrink-0 shadow-sm ring-1 ring-border/30",children:(0,t.jsx)(a.Building2,{className:"w-3.5 h-3.5 text-muted-foreground/60"})}),(0,t.jsx)("span",{children:A})]}),(0,t.jsx)("span",{className:"text-muted-foreground/40",children:"·"}),(0,t.jsx)("time",{className:"tabular-nums",children:C}),$&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"text-muted-foreground/40",children:"·"}),(0,t.jsx)("span",{className:"text-muted-foreground/60",children:$})]}),"protocol"===e.type&&e.data.aiDetails?.score!==void 0&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"text-muted-foreground/40",children:"·"}),(0,t.jsxs)("span",{className:"inline-flex items-center gap-1 text-amber-600 dark:text-amber-400",children:[(0,t.jsx)(M.Star,{size:12}),e.data.aiDetails.score,"/10"]})]}),"protocol"===e.type&&e.data.aiDetails?.artikel&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"text-muted-foreground/40",children:"·"}),(0,t.jsxs)("span",{className:"inline-flex items-center gap-1 text-emerald-600 dark:text-emerald-400",children:[(0,t.jsx)(D.Newspaper,{size:12}),"Artikel"]})]})]}),"compact"!==g&&(0,t.jsx)("p",{className:`mt-4 font-serif text-base sm:text-[17px] italic text-muted-foreground leading-relaxed ${x?"":"line-clamp-2"}`,dangerouslySetInnerHTML:{__html:K(R,m)}}),"protocol"===e.type&&e.data.pdfUrl&&!x&&(0,t.jsxs)("button",{onClick:e=>{e.stopPropagation(),w(!0)},className:"mt-4 inline-flex items-center gap-2 text-sm font-medium text-rose-500 hover:text-rose-600 transition-colors duration-200",children:[(0,t.jsx)(o.FileText,{size:14}),"Läs protokoll"]}),x&&(0,t.jsxs)("div",{className:"mt-4 sm:mt-5 pt-4 sm:pt-5 border-t border-border/50 animate-in fade-in slide-in-from-top-2 duration-300",children:["protocol"===e.type&&e.data.aiDetails?.artikel&&(0,t.jsxs)("div",{className:"mb-6 p-4 bg-secondary/50 rounded-xl border border-border/50",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,t.jsx)(D.Newspaper,{className:"w-4 h-4 text-emerald-500"}),(0,t.jsx)("span",{className:"text-sm font-semibold",children:"Nyhetsartikel"}),(0,t.jsx)("span",{className:"text-[10px] px-2 py-0.5 rounded bg-emerald-500/20 text-emerald-600 dark:text-emerald-400",children:"AI-genererad"})]}),(0,t.jsx)("div",{className:"prose prose-sm dark:prose-invert max-w-none text-foreground/90",dangerouslySetInnerHTML:{__html:e.data.aiDetails.artikel.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>").replace(/\n\n/g,"</p><p>").replace(/^/,"<p>").replace(/$/,"</p>")}})]}),"protocol"===e.type&&e.data.aiDetails?.faktaruta&&((p=e.data.aiDetails.faktaruta).händelse||p.belopp||p.pris_per_aktie||p.nya_aktier||p.utspädning||p.investerare&&p.investerare.length>0?(0,t.jsxs)("div",{className:"mb-6 p-4 bg-muted/50 rounded-xl border border-border/50",children:[(0,t.jsx)("div",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground mb-3",children:"Faktaruta"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3 text-sm",children:[p.stämmoTyp&&(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-muted-foreground text-xs",children:"Typ"}),(0,t.jsx)("div",{className:"font-medium",children:p.stämmoTyp})]}),p.händelse&&(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-muted-foreground text-xs",children:"Händelse"}),(0,t.jsx)("div",{className:"font-medium",children:p.händelse})]}),p.belopp&&(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-muted-foreground text-xs",children:"Belopp"}),(0,t.jsx)("div",{className:"font-medium",children:p.belopp})]}),p.pris_per_aktie&&(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-muted-foreground text-xs",children:"Pris/aktie"}),(0,t.jsx)("div",{className:"font-medium",children:p.pris_per_aktie})]}),p.nya_aktier&&(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-muted-foreground text-xs",children:"Nya aktier"}),(0,t.jsx)("div",{className:"font-medium",children:p.nya_aktier})]}),p.utspädning&&(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-muted-foreground text-xs",children:"Utspädning"}),(0,t.jsx)("div",{className:"font-medium",children:p.utspädning})]}),p.investerare&&p.investerare.length>0&&(0,t.jsxs)("div",{className:"col-span-2 sm:col-span-3",children:[(0,t.jsx)("div",{className:"text-muted-foreground text-xs",children:"Investerare"}),(0,t.jsx)("div",{className:"font-medium",children:p.investerare.join(", ")})]})]})]}):null),"protocol"===e.type&&e.data.aiDetails?.shareholders&&e.data.aiDetails.shareholders.length>0&&(0,t.jsx)("div",{className:"mb-6",children:(0,t.jsx)(_,{shareholders:e.data.aiDetails.shareholders})}),h&&h.length>0&&L&&(0,t.jsx)("div",{className:"mb-6",children:(0,t.jsx)(q,{events:h,currentEventId:e.data.id,orgNumber:L})}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2",children:["protocol"===e.type&&e.data.pdfUrl?(0,t.jsxs)("button",{onClick:e=>{e.stopPropagation(),w(!0)},className:"flex items-center gap-1.5 sm:gap-2 px-3 sm:px-4 py-2 sm:py-2.5 rounded-lg text-xs sm:text-sm font-medium bg-foreground text-background flex-1 sm:flex-none justify-center hover:-translate-y-0.5 hover:shadow-lg transition-all duration-200",children:["Visa protokoll",(0,t.jsx)(o.FileText,{className:"w-4 h-4"})]}):V&&(0,t.jsxs)("a",{href:V,target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),className:"flex items-center gap-1.5 sm:gap-2 px-3 sm:px-4 py-2 sm:py-2.5 rounded-lg text-xs sm:text-sm font-medium bg-foreground text-background flex-1 sm:flex-none justify-center hover:-translate-y-0.5 hover:shadow-lg transition-all duration-200",children:["announcement"===e.type?"Visa kungörelse":"Visa i Bolagsverket",(0,t.jsx)(E.ExternalLink,{className:"w-4 h-4"})]}),(0,t.jsxs)(S.default,{href:`/bolag/${L?.replace(/\D/g,"")}`,onClick:e=>e.stopPropagation(),className:"flex items-center gap-1.5 sm:gap-2 px-3 sm:px-4 py-2 sm:py-2.5 rounded-lg text-xs sm:text-sm font-medium bg-secondary border border-border text-muted-foreground hover:text-foreground hover:border-muted-foreground hover:-translate-y-0.5 hover:shadow-lg transition-all duration-200",children:[(0,t.jsx)(a.Building2,{className:"w-4 h-4"}),(0,t.jsx)("span",{className:"hidden xs:inline",children:"Visa bolag"})]})]})]})]})]}),"protocol"===e.type&&e.data.pdfUrl&&(0,t.jsx)(B,{isOpen:j,onClose:()=>w(!1),pdfUrl:e.data.pdfUrl,title:`${e.data.companyName||"Protokoll"} - ${e.data.protocolDate}`})]})}var J=e.i(751987),X=e.i(275740);let G="loopdesk_read_events",Q="loopdesk_notification_settings",Y={enabled:!0,soundEnabled:!1,criticalOnly:!0},Z=["konkurs","likvidation"],ee=["konkurs","likvidation","fusion","emission"];function et(){try{let e=new Audio("/sounds/notification.mp3");e.volume=.3,e.play().catch(()=>{})}catch{}}var es=e.i(390447);function er(e,t,s){let r,n=s.initialDeps??[],a=!0;function l(){var l,i,o;let d,c;s.key&&(null==(l=s.debug)?void 0:l.call(s))&&(d=Date.now());let u=e();if(!(u.length!==n.length||u.some((e,t)=>n[t]!==e)))return r;if(n=u,s.key&&(null==(i=s.debug)?void 0:i.call(s))&&(c=Date.now()),r=t(...u),s.key&&(null==(o=s.debug)?void 0:o.call(s))){let e=Math.round((Date.now()-d)*100)/100,t=Math.round((Date.now()-c)*100)/100,r=t/16,n=(e,t)=>{for(e=String(e);e.length<t;)e=" "+e;return e};console.info(`%c⏱ ${n(t,5)} /${n(e,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*r,120))}deg 100% 31%);`,null==s?void 0:s.key)}return(null==s?void 0:s.onChange)&&!(a&&s.skipInitialOnChange)&&s.onChange(r),a=!1,r}return l.updateDeps=e=>{n=e},l}function en(e,t){if(void 0!==e)return e;throw Error(`Unexpected undefined${t?`: ${t}`:""}`)}e.i(7302);let ea=e=>{let{offsetWidth:t,offsetHeight:s}=e;return{width:t,height:s}},el=e=>e,ei=e=>{let t=Math.max(e.startIndex-e.overscan,0),s=Math.min(e.endIndex+e.overscan,e.count-1),r=[];for(let e=t;e<=s;e++)r.push(e);return r},eo=(e,t)=>{let s=e.scrollElement;if(!s)return;let r=e.targetWindow;if(!r)return;let n=e=>{let{width:s,height:r}=e;t({width:Math.round(s),height:Math.round(r)})};if(n(ea(s)),!r.ResizeObserver)return()=>{};let a=new r.ResizeObserver(t=>{let r=()=>{let e=t[0];if(null==e?void 0:e.borderBoxSize){let t=e.borderBoxSize[0];if(t)return void n({width:t.inlineSize,height:t.blockSize})}n(ea(s))};e.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(r):r()});return a.observe(s,{box:"border-box"}),()=>{a.unobserve(s)}},ed={passive:!0},ec="undefined"==typeof window||"onscrollend"in window,eu=(e,t)=>{var s,r;let n,a=e.scrollElement;if(!a)return;let l=e.targetWindow;if(!l)return;let i=0,o=e.options.useScrollendEvent&&ec?()=>void 0:(s=()=>{t(i,!1)},r=e.options.isScrollingResetDelay,function(...e){l.clearTimeout(n),n=l.setTimeout(()=>s.apply(this,e),r)}),d=s=>()=>{let{horizontal:r,isRtl:n}=e.options;i=r?a.scrollLeft*(n&&-1||1):a.scrollTop,o(),t(i,s)},c=d(!0),u=d(!1);a.addEventListener("scroll",c,ed);let m=e.options.useScrollendEvent&&ec;return m&&a.addEventListener("scrollend",u,ed),()=>{a.removeEventListener("scroll",c),m&&a.removeEventListener("scrollend",u)}},em=(e,t,s)=>{if(null==t?void 0:t.borderBoxSize){let e=t.borderBoxSize[0];if(e)return Math.round(e[s.options.horizontal?"inlineSize":"blockSize"])}return e[s.options.horizontal?"offsetWidth":"offsetHeight"]},eh=(e,{adjustments:t=0,behavior:s},r)=>{var n,a;null==(a=null==(n=r.scrollElement)?void 0:n.scrollTo)||a.call(n,{[r.options.horizontal?"left":"top"]:e+t,behavior:s})};class eg{constructor(e){this.unsubs=[],this.scrollElement=null,this.targetWindow=null,this.isScrolling=!1,this.currentScrollToIndex=null,this.measurementsCache=[],this.itemSizeCache=new Map,this.laneAssignments=new Map,this.pendingMeasuredCacheIndexes=[],this.prevLanes=void 0,this.lanesChangedFlag=!1,this.lanesSettling=!1,this.scrollRect=null,this.scrollOffset=null,this.scrollDirection=null,this.scrollAdjustments=0,this.elementsCache=new Map,this.observer=(()=>{let e=null,t=()=>e||(this.targetWindow&&this.targetWindow.ResizeObserver?e=new this.targetWindow.ResizeObserver(e=>{e.forEach(e=>{let t=()=>{this._measureElement(e.target,e)};this.options.useAnimationFrameWithResizeObserver?requestAnimationFrame(t):t()})}):null);return{disconnect:()=>{var s;null==(s=t())||s.disconnect(),e=null},observe:e=>{var s;return null==(s=t())?void 0:s.observe(e,{box:"border-box"})},unobserve:e=>{var s;return null==(s=t())?void 0:s.unobserve(e)}}})(),this.range=null,this.setOptions=e=>{Object.entries(e).forEach(([t,s])=>{void 0===s&&delete e[t]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:el,rangeExtractor:ei,onChange:()=>{},measureElement:em,initialRect:{width:0,height:0},scrollMargin:0,gap:0,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,isScrollingResetDelay:150,enabled:!0,isRtl:!1,useScrollendEvent:!1,useAnimationFrameWithResizeObserver:!1,...e}},this.notify=e=>{var t,s;null==(s=(t=this.options).onChange)||s.call(t,this,e)},this.maybeNotify=er(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),e=>{this.notify(e)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(e=>e()),this.unsubs=[],this.observer.disconnect(),this.scrollElement=null,this.targetWindow=null},this._didMount=()=>()=>{this.cleanup()},this._willUpdate=()=>{var e;let t=this.options.enabled?this.options.getScrollElement():null;if(this.scrollElement!==t){if(this.cleanup(),!t)return void this.maybeNotify();this.scrollElement=t,this.scrollElement&&"ownerDocument"in this.scrollElement?this.targetWindow=this.scrollElement.ownerDocument.defaultView:this.targetWindow=(null==(e=this.scrollElement)?void 0:e.window)??null,this.elementsCache.forEach(e=>{this.observer.observe(e)}),this.unsubs.push(this.options.observeElementRect(this,e=>{this.scrollRect=e,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,(e,t)=>{this.scrollAdjustments=0,this.scrollDirection=t?this.getScrollOffset()<e?"forward":"backward":null,this.scrollOffset=e,this.isScrolling=t,this.maybeNotify()})),this._scrollToOffset(this.getScrollOffset(),{adjustments:void 0,behavior:void 0})}},this.getSize=()=>this.options.enabled?(this.scrollRect=this.scrollRect??this.options.initialRect,this.scrollRect[this.options.horizontal?"width":"height"]):(this.scrollRect=null,0),this.getScrollOffset=()=>this.options.enabled?(this.scrollOffset=this.scrollOffset??("function"==typeof this.options.initialOffset?this.options.initialOffset():this.options.initialOffset),this.scrollOffset):(this.scrollOffset=null,0),this.getFurthestMeasurement=(e,t)=>{let s=new Map,r=new Map;for(let n=t-1;n>=0;n--){let t=e[n];if(s.has(t.lane))continue;let a=r.get(t.lane);if(null==a||t.end>a.end?r.set(t.lane,t):t.end<a.end&&s.set(t.lane,!0),s.size===this.options.lanes)break}return r.size===this.options.lanes?Array.from(r.values()).sort((e,t)=>e.end===t.end?e.index-t.index:e.end-t.end)[0]:void 0},this.getMeasurementOptions=er(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey,this.options.enabled,this.options.lanes],(e,t,s,r,n,a)=>(void 0!==this.prevLanes&&this.prevLanes!==a&&(this.lanesChangedFlag=!0),this.prevLanes=a,this.pendingMeasuredCacheIndexes=[],{count:e,paddingStart:t,scrollMargin:s,getItemKey:r,enabled:n,lanes:a}),{key:!1}),this.getMeasurements=er(()=>[this.getMeasurementOptions(),this.itemSizeCache],({count:e,paddingStart:t,scrollMargin:s,getItemKey:r,enabled:n,lanes:a},l)=>{if(!n)return this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),[];if(this.laneAssignments.size>e)for(let t of this.laneAssignments.keys())t>=e&&this.laneAssignments.delete(t);this.lanesChangedFlag&&(this.lanesChangedFlag=!1,this.lanesSettling=!0,this.measurementsCache=[],this.itemSizeCache.clear(),this.laneAssignments.clear(),this.pendingMeasuredCacheIndexes=[]),0!==this.measurementsCache.length||this.lanesSettling||(this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(e=>{this.itemSizeCache.set(e.key,e.size)}));let i=this.lanesSettling?0:this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[],this.lanesSettling&&this.measurementsCache.length===e&&(this.lanesSettling=!1);let o=this.measurementsCache.slice(0,i),d=Array(a).fill(void 0);for(let e=0;e<i;e++){let t=o[e];t&&(d[t.lane]=e)}for(let n=i;n<e;n++){let e,a,i=r(n),c=this.laneAssignments.get(n);if(void 0!==c&&this.options.lanes>1){let r=d[e=c],n=void 0!==r?o[r]:void 0;a=n?n.end+this.options.gap:t+s}else{let r=1===this.options.lanes?o[n-1]:this.getFurthestMeasurement(o,n);a=r?r.end+this.options.gap:t+s,e=r?r.lane:n%this.options.lanes,this.options.lanes>1&&this.laneAssignments.set(n,e)}let u=l.get(i),m="number"==typeof u?u:this.options.estimateSize(n),h=a+m;o[n]={index:n,start:a,size:m,end:h,key:i,lane:e},d[e]=n}return this.measurementsCache=o,o},{key:!1,debug:()=>this.options.debug}),this.calculateRange=er(()=>[this.getMeasurements(),this.getSize(),this.getScrollOffset(),this.options.lanes],(e,t,s,r)=>this.range=e.length>0&&t>0?function({measurements:e,outerSize:t,scrollOffset:s,lanes:r}){let n=e.length-1;if(e.length<=r)return{startIndex:0,endIndex:n};let a=ep(0,n,t=>e[t].start,s),l=a;if(1===r)for(;l<n&&e[l].end<s+t;)l++;else if(r>1){let i=Array(r).fill(0);for(;l<n&&i.some(e=>e<s+t);){let t=e[l];i[t.lane]=t.end,l++}let o=Array(r).fill(s+t);for(;a>=0&&o.some(e=>e>=s);){let t=e[a];o[t.lane]=t.start,a--}a=Math.max(0,a-a%r),l=Math.min(n,l+(r-1-l%r))}return{startIndex:a,endIndex:l}}({measurements:e,outerSize:t,scrollOffset:s,lanes:r}):null,{key:!1,debug:()=>this.options.debug}),this.getVirtualIndexes=er(()=>{let e=null,t=null,s=this.calculateRange();return s&&(e=s.startIndex,t=s.endIndex),this.maybeNotify.updateDeps([this.isScrolling,e,t]),[this.options.rangeExtractor,this.options.overscan,this.options.count,e,t]},(e,t,s,r,n)=>null===r||null===n?[]:e({startIndex:r,endIndex:n,overscan:t,count:s}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=e=>{let t=this.options.indexAttribute,s=e.getAttribute(t);return s?parseInt(s,10):(console.warn(`Missing attribute name '${t}={index}' on measured element.`),-1)},this._measureElement=(e,t)=>{let s=this.indexFromElement(e),r=this.measurementsCache[s];if(!r)return;let n=r.key,a=this.elementsCache.get(n);a!==e&&(a&&this.observer.unobserve(a),this.observer.observe(e),this.elementsCache.set(n,e)),e.isConnected&&this.resizeItem(s,this.options.measureElement(e,t,this))},this.resizeItem=(e,t)=>{let s=this.measurementsCache[e];if(!s)return;let r=t-(this.itemSizeCache.get(s.key)??s.size);0!==r&&((void 0!==this.shouldAdjustScrollPositionOnItemSizeChange?this.shouldAdjustScrollPositionOnItemSizeChange(s,r,this):s.start<this.getScrollOffset()+this.scrollAdjustments)&&this._scrollToOffset(this.getScrollOffset(),{adjustments:this.scrollAdjustments+=r,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(s.index),this.itemSizeCache=new Map(this.itemSizeCache.set(s.key,t)),this.notify(!1))},this.measureElement=e=>{e?this._measureElement(e,void 0):this.elementsCache.forEach((e,t)=>{e.isConnected||(this.observer.unobserve(e),this.elementsCache.delete(t))})},this.getVirtualItems=er(()=>[this.getVirtualIndexes(),this.getMeasurements()],(e,t)=>{let s=[];for(let r=0,n=e.length;r<n;r++){let n=t[e[r]];s.push(n)}return s},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=e=>{let t=this.getMeasurements();if(0!==t.length)return en(t[ep(0,t.length-1,e=>en(t[e]).start,e)])},this.getMaxScrollOffset=()=>{if(!this.scrollElement)return 0;if("scrollHeight"in this.scrollElement)return this.options.horizontal?this.scrollElement.scrollWidth-this.scrollElement.clientWidth:this.scrollElement.scrollHeight-this.scrollElement.clientHeight;{let e=this.scrollElement.document.documentElement;return this.options.horizontal?e.scrollWidth-this.scrollElement.innerWidth:e.scrollHeight-this.scrollElement.innerHeight}},this.getOffsetForAlignment=(e,t,s=0)=>{if(!this.scrollElement)return 0;let r=this.getSize(),n=this.getScrollOffset();return"auto"===t&&(t=e>=n+r?"end":"start"),"center"===t?e+=(s-r)/2:"end"===t&&(e-=r),Math.max(Math.min(this.getMaxScrollOffset(),e),0)},this.getOffsetForIndex=(e,t="auto")=>{e=Math.max(0,Math.min(e,this.options.count-1));let s=this.measurementsCache[e];if(!s)return;let r=this.getSize(),n=this.getScrollOffset();if("auto"===t)if(s.end>=n+r-this.options.scrollPaddingEnd)t="end";else{if(!(s.start<=n+this.options.scrollPaddingStart))return[n,t];t="start"}if("end"===t&&e===this.options.count-1)return[this.getMaxScrollOffset(),t];let a="end"===t?s.end+this.options.scrollPaddingEnd:s.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(a,t,s.size),t]},this.isDynamicMode=()=>this.elementsCache.size>0,this.scrollToOffset=(e,{align:t="start",behavior:s}={})=>{"smooth"===s&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(e,t),{adjustments:void 0,behavior:s})},this.scrollToIndex=(e,{align:t="auto",behavior:s}={})=>{"smooth"===s&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),e=Math.max(0,Math.min(e,this.options.count-1)),this.currentScrollToIndex=e;let r=0,n=t=>{if(!this.targetWindow)return;let r=this.getOffsetForIndex(e,t);if(!r)return void console.warn("Failed to get offset for index:",e);let[n,l]=r;this._scrollToOffset(n,{adjustments:void 0,behavior:s}),this.targetWindow.requestAnimationFrame(()=>{let t=()=>{if(this.currentScrollToIndex!==e)return;let t=this.getScrollOffset(),s=this.getOffsetForIndex(e,l);s?1.01>Math.abs(s[0]-t)||a(l):console.warn("Failed to get offset for index:",e)};this.isDynamicMode()?this.targetWindow.requestAnimationFrame(t):t()})},a=t=>{this.targetWindow&&this.currentScrollToIndex===e&&(++r<10?this.targetWindow.requestAnimationFrame(()=>n(t)):console.warn(`Failed to scroll to index ${e} after 10 attempts.`))};n(t)},this.scrollBy=(e,{behavior:t}={})=>{"smooth"===t&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getScrollOffset()+e,{adjustments:void 0,behavior:t})},this.getTotalSize=()=>{var e;let t,s=this.getMeasurements();if(0===s.length)t=this.options.paddingStart;else if(1===this.options.lanes)t=(null==(e=s[s.length-1])?void 0:e.end)??0;else{let e=Array(this.options.lanes).fill(null),r=s.length-1;for(;r>=0&&e.some(e=>null===e);){let t=s[r];null===e[t.lane]&&(e[t.lane]=t.end),r--}t=Math.max(...e.filter(e=>null!==e))}return Math.max(t-this.options.scrollMargin+this.options.paddingEnd,0)},this._scrollToOffset=(e,{adjustments:t,behavior:s})=>{this.options.scrollToFn(e,{behavior:s,adjustments:t},this)},this.measure=()=>{this.itemSizeCache=new Map,this.laneAssignments=new Map,this.notify(!1)},this.setOptions(e)}}let ep=(e,t,s,r)=>{for(;e<=t;){let n=(e+t)/2|0,a=s(n);if(a<r)e=n+1;else{if(!(a>r))return n;t=n-1}}return e>0?e-1:0},ex="undefined"!=typeof document?s.useLayoutEffect:s.useEffect,ef={konkurs:{keywords:["konkurs","konkursbeslut"],color:"text-red-600 dark:text-red-400",bgColor:"bg-red-100 dark:bg-red-900/30",borderColor:"border-l-red-500",gradientFrom:"from-red-500/10",label:"Konkurs",icon:(0,t.jsx)(g,{size:14,className:"inline mr-1"})},likvidation:{keywords:["likvidation","likvidator"],color:"text-orange-600 dark:text-orange-400",bgColor:"bg-orange-100 dark:bg-orange-900/30",borderColor:"border-l-orange-500",gradientFrom:"from-orange-500/10",label:"Likvidation",icon:(0,t.jsx)(d.AlertTriangle,{size:14,className:"inline mr-1"})},fusion:{keywords:["fusion","sammanslagning"],color:"text-purple-600 dark:text-purple-400",bgColor:"bg-purple-100 dark:bg-purple-900/30",borderColor:"border-l-purple-500",gradientFrom:"from-purple-500/10",label:"Fusion",icon:(0,t.jsx)(h,{size:14,className:"inline mr-1"})},emission:{keywords:["nyemission","fondemission","riktad emission"],color:"text-blue-600 dark:text-blue-400",bgColor:"bg-blue-100 dark:bg-blue-900/30",borderColor:"border-l-blue-500",gradientFrom:"from-blue-500/10",label:"Emission",icon:(0,t.jsx)(u.TrendingUp,{size:14,className:"inline mr-1"})},styrelse:{keywords:["styrelse","ledamot","ordförande","vd"],color:"text-green-600 dark:text-green-400",bgColor:"bg-green-100 dark:bg-green-900/30",borderColor:"border-l-green-500",gradientFrom:"from-green-500/10",label:"Styrelse",icon:(0,t.jsx)(c.Users,{size:14,className:"inline mr-1"})}},eb=[{label:"Idag",days:0},{label:"Senaste 24h",days:1},{label:"Denna vecka",days:7},{label:"Senaste månaden",days:30},{label:"Alla",days:-1}];function ev(e){let t=`${e.type||""} ${e.detailText||""} ${e.subject||""}`.toLowerCase();for(let[e,s]of Object.entries(ef))if(s.keywords.some(e=>t.includes(e)))return e;return null}function ey({isOpen:e,onClose:r,settings:n,onUpdateSettings:a}){let[l,i]=(0,s.useState)(n.categories||{konkurs:!0,likvidation:!0,fusion:!1,emission:!1,styrelse:!1});return e?(0,t.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-background/80 backdrop-blur-sm",onClick:r}),(0,t.jsxs)("div",{className:"relative bg-card border border-border rounded-2xl shadow-xl w-full max-w-md mx-4 p-6 animate-in fade-in zoom-in-95 duration-200",children:[(0,t.jsx)("button",{onClick:r,className:"absolute top-4 right-4 p-2 rounded-lg hover:bg-secondary transition-colors",children:(0,t.jsx)(k.X,{size:18})}),(0,t.jsx)("h2",{className:"text-lg font-semibold mb-1",children:"Notifikationsinställningar"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mb-6",children:"Välj vilka händelser du vill få notiser om"}),(0,t.jsxs)("div",{className:"flex items-center justify-between py-3 border-b border-border",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:"Aktivera notiser"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Få push-notiser för bolagshändelser"})]}),(0,t.jsx)("button",{onClick:()=>a({enabled:!n.enabled}),className:`relative w-12 h-7 rounded-full transition-colors ${n.enabled?"bg-primary":"bg-secondary"}`,children:(0,t.jsx)("span",{className:`absolute top-1 w-5 h-5 rounded-full bg-white shadow transition-transform ${n.enabled?"translate-x-6":"translate-x-1"}`})})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between py-3 border-b border-border",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:"Ljud"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"Spela ljud vid nya händelser"})]}),(0,t.jsx)("button",{onClick:()=>a({soundEnabled:!n.soundEnabled}),className:`relative w-12 h-7 rounded-full transition-colors ${n.soundEnabled?"bg-primary":"bg-secondary"}`,disabled:!n.enabled,children:(0,t.jsx)("span",{className:`absolute top-1 w-5 h-5 rounded-full bg-white shadow transition-transform ${n.soundEnabled?"translate-x-6":"translate-x-1"}`})})]}),(0,t.jsxs)("div",{className:"mt-4",children:[(0,t.jsx)("p",{className:"text-sm font-medium mb-3",children:"Händelsekategorier"}),(0,t.jsx)("div",{className:"space-y-2",children:Object.entries(ef).map(([e,s])=>(0,t.jsxs)("label",{className:`flex items-center justify-between p-3 rounded-xl cursor-pointer transition-colors ${l[e]?s.bgColor:"bg-secondary/50 hover:bg-secondary"}`,children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("span",{className:`p-1.5 rounded-lg ${s.bgColor} ${s.color}`,children:s.icon}),(0,t.jsx)("span",{className:"font-medium",children:s.label})]}),(0,t.jsx)("input",{type:"checkbox",checked:l[e],onChange:()=>{let t;i(t={...l,[e]:!l[e]}),a({categories:t})},disabled:!n.enabled,className:"sr-only"}),(0,t.jsx)("div",{className:`w-5 h-5 rounded-md border-2 flex items-center justify-center transition-colors ${l[e]?"bg-primary border-primary text-primary-foreground":"border-muted-foreground/30"}`,children:l[e]&&(0,t.jsx)(b,{size:12})})]},e))})]}),(0,t.jsx)("button",{onClick:r,className:"w-full mt-6 py-2.5 bg-primary text-primary-foreground rounded-xl font-medium hover:bg-primary/90 transition-colors",children:"Spara"})]})]}):null}function ek(){let e,{status:d}=(0,r.useSession)(),c=(0,n.useRouter)(),[u,m]=(0,s.useState)([]),[h,g]=(0,s.useState)([]),[S,C]=(0,s.useState)([]),[E,D]=(0,s.useState)(!0),[M,z]=(0,s.useState)(!1),[O,T]=(0,s.useState)(!1),[I,A]=(0,s.useState)(null),[L,F]=(0,s.useState)(null),[P,R]=(0,s.useState)(-1),[_,U]=(0,s.useState)(""),[B,W]=(0,s.useState)(""),[q,H]=(0,s.useState)(!1),[K,er]=(0,s.useState)(null),[en,ea]=(0,s.useState)(!0),el=(0,s.useRef)(null),ei=(0,s.useRef)(null),[ed,ec]=(0,s.useState)("connecting"),[em,ep]=(0,s.useState)(new Set),[ek,ej]=(0,s.useState)(!1),[ew,eN]=(0,s.useState)(-1),[eS,eC]=(0,s.useState)("standard"),{isRead:e$,markAsRead:eE,markAllAsRead:eD,unreadCount:eM}=function(){let[e,t]=(0,s.useState)(new Set);(0,s.useEffect)(()=>{try{let e=localStorage.getItem(G);if(e){let s=JSON.parse(e);Array.isArray(s)&&t(new Set(s))}}catch(e){console.warn("Failed to load read status:",e)}},[]);let r=(0,s.useCallback)(e=>{try{let t=Array.from(e).slice(-1e3);localStorage.setItem(G,JSON.stringify(t))}catch(e){console.warn("Failed to save read status:",e)}},[]),n=(0,s.useCallback)(t=>e.has(t),[e]),a=(0,s.useCallback)(e=>{t(t=>{if(t.has(e))return t;let s=new Set(t);return s.add(e),r(s),s})},[r]),l=(0,s.useCallback)(e=>{t(t=>{let s=new Set(t),n=!1;for(let t of e)s.has(t)||(s.add(t),n=!0);return n?(r(s),s):t})},[r]),i=(0,s.useCallback)(t=>t.filter(t=>!e.has(t)).length,[e]);return{readIds:e,isRead:n,markAsRead:a,markAllAsRead:l,unreadCount:i}}(),{permission:ez,settings:eO,isSupported:eT,requestPermission:eI,updateSettings:eA,notify:eL,shouldNotify:eF}=function(){let[e,t]=(0,s.useState)("default"),[r,n]=(0,s.useState)(Y),[a,l]=(0,s.useState)(!1),[i,o]=(0,s.useState)(!1),d=(0,s.useRef)(null);(0,s.useEffect)(()=>{let e="Notification"in window;l(e),e&&t(Notification.permission);try{let e=localStorage.getItem(Q);if(e){let t=JSON.parse(e);n({...Y,...t})}}catch(e){console.warn("Failed to load notification settings:",e)}"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then(e=>{console.log("[Notifications] Service worker registered:",e.scope),d.current=e,o(!0),e.addEventListener("updatefound",()=>{let t=e.installing;t&&t.addEventListener("statechange",()=>{"installed"===t.state&&navigator.serviceWorker.controller&&console.log("[Notifications] New service worker available")})})}).catch(e=>{console.warn("[Notifications] Service worker registration failed:",e)})},[]);let c=(0,s.useCallback)(e=>{try{localStorage.setItem(Q,JSON.stringify(e))}catch(e){console.warn("Failed to save notification settings:",e)}},[]),u=(0,s.useCallback)(async()=>{if(!a)return!1;try{let e=await Notification.requestPermission();return t(e),"granted"===e&&console.log("[Notifications] Permission granted"),"granted"===e}catch(e){return console.error("Failed to request notification permission:",e),!1}},[a]),m=(0,s.useCallback)(e=>{n(t=>{let s={...t,...e};return c(s),s})},[c]),h=(0,s.useCallback)(e=>{if(!r.enabled||!e)return!1;let t=e.toLowerCase();return r.criticalOnly?Z.includes(t):ee.includes(t)},[r]),g=(0,s.useCallback)(({title:t,body:s,category:n,url:l,icon:o})=>{if(!a||"granted"!==e||!r.enabled||n&&!h(n))return;let c=n&&Z.includes(n.toLowerCase());if(i&&d.current?.active){d.current.active.postMessage({type:"SHOW_NOTIFICATION",title:t,body:s,url:l,critical:c}),r.soundEnabled&&et();return}try{let e=new Notification(t,{body:s,icon:o||"/icon-192.png",badge:"/icon-192.png",tag:`loopdesk-${Date.now()}`,requireInteraction:c||!1});r.soundEnabled&&et(),l&&(e.onclick=()=>{window.focus(),window.location.href=l,e.close()}),c||setTimeout(()=>e.close(),1e4)}catch(e){console.error("Failed to show notification:",e)}},[a,e,r,h,i]),p=(0,s.useCallback)(()=>{i&&d.current?.active?d.current.active.postMessage({type:"TEST_NOTIFICATION"}):"granted"===e&&new Notification("LoopDesk Test",{body:"Push-notiser fungerar!",icon:"/icon-192.png"})},[i,e]);return{permission:e,settings:r,isSupported:a,serviceWorkerReady:i,requestPermission:u,updateSettings:m,notify:g,shouldNotify:h,testNotification:p}}();(0,s.useEffect)(()=>{"unauthenticated"===d&&c.push("/login?callbackUrl=/bolaghandelser")},[d,c]);let eP=(0,s.useCallback)(async(e=!1)=>{e&&z(!0);try{let[e,t]=await Promise.all([fetch("/api/kungorelser?limit=20"),fetch("/api/protocols?limit=100")]);if(e.ok){let t=await e.json();m(t.announcements||[]),er(t.nextCursor||null),ea(t.hasMore??!1)}if(t.ok){let e=await t.json();console.log("[bolaghandelser] Protocols API response:",{protocolsCount:e.protocols?.length,protocolSearchesCount:e.protocolSearches?.length,firstProtocolSearch:e.protocolSearches?.[0]}),g(e.protocols||[]),C(e.protocolSearches||[])}else console.error("[bolaghandelser] Protocols API failed:",t.status,await t.text());A(new Date)}catch(e){console.error("Failed to load data:",e)}finally{D(!1),z(!1)}},[]),eR=(0,s.useCallback)(async()=>{if(!O&&en&&K){T(!0);try{let e=await fetch(`/api/kungorelser?limit=20&cursor=${K}`);if(e.ok){let t=await e.json();m(e=>[...e,...t.announcements||[]]),er(t.nextCursor||null),ea(t.hasMore??!1)}}catch(e){console.error("Failed to load more announcements:",e)}finally{T(!1)}}},[O,en,K]);(0,s.useEffect)(()=>{"authenticated"===d&&eP()},[d,eP]),(0,s.useEffect)(()=>{if("authenticated"!==d||B||"connected"===ed)return;let e=setInterval(()=>eP(),3e4);return()=>clearInterval(e)},[d,eP,B,ed]),(0,s.useEffect)(()=>{let e=setTimeout(()=>{W(_)},300);return()=>clearTimeout(e)},[_]),(0,s.useEffect)(()=>{"authenticated"===d&&e();async function e(){if(!B)return void eP();H(!0);try{let e=await fetch(`/api/kungorelser?query=${encodeURIComponent(B)}&limit=100`);if(e.ok){let t=await e.json();m(t.announcements||[]),er(null),ea(!1)}}catch(e){console.error("Search failed:",e)}finally{H(!1)}}},[B,d,eP]),(0,s.useEffect)(()=>{let e=new IntersectionObserver(e=>{e[0].isIntersecting&&en&&!O&&eR()},{threshold:.1});return el.current&&e.observe(el.current),()=>e.disconnect()},[en,O,eR]),(0,s.useEffect)(()=>{let e=null,t=null,s=null;return async function(){(s=await (0,X.getSupabaseClient)())?(e=s.channel("announcements-realtime").on("postgres_changes",{event:"INSERT",schema:"public",table:"Announcement"},e=>{let t=e.new;m(e=>e.some(e=>e.id===t.id)?e:[t,...e]),ep(e=>new Set(e).add(t.id)),setTimeout(()=>{ep(e=>{let s=new Set(e);return s.delete(t.id),s})},5e3);let s=function(e){let t=e.toLowerCase();for(let[e,s]of Object.entries({konkurs:["konkurs","konkursbeslut","konkursförfarande"],likvidation:["likvidation","likvidator","upplösning"],fusion:["fusion","sammanslagning","delning"],emission:["nyemission","fondemission","riktad emission","aktiekapital"],styrelse:["styrelse","ledamot","ordförande","vd","verkställande direktör"]}))if(s.some(e=>t.includes(e)))return e;return null}(`${t.type||""} ${t.detailText||""}`);if(eF(s)){let e=t.subject||"Okänt bolag";eL({title:"konkurs"===s?`Konkurs: ${e}`:`${s?.charAt(0).toUpperCase()}${s?.slice(1)}: ${e}`,body:t.detailText?.slice(0,100)||"Ny bolagshändelse",category:s,url:"/bolaghandelser"})}}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"Announcement"},e=>{let t=e.new;m(e=>e.map(e=>e.id===t.id?t:e))}).subscribe(e=>{"SUBSCRIBED"===e?ec("connected"):("CHANNEL_ERROR"===e||"TIMED_OUT"===e)&&ec("error")}),t=s.channel("protocols-realtime").on("postgres_changes",{event:"INSERT",schema:"public",table:"ProtocolPurchase"},e=>{let t=e.new;if(g(e=>e.some(e=>e.id===t.id)?e:[t,...e]),(t.aiDetails?.score||0)>=7&&eO.enabled){let e=t.companyName||"Okänt bolag",s=t.eventType||"Protokoll";eL({title:`${s}: ${e}`,body:t.aiDetails?.notis?.sammanfattning||"Nytt intressant protokoll",category:"protokoll",url:"/bolaghandelser"})}}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"ProtocolPurchase"},e=>{let t=e.new;g(e=>e.map(e=>e.id===t.id?t:e))}).subscribe()):ec("error")}(),()=>{e&&s&&s.removeChannel(e),t&&s&&s.removeChannel(t)}},[eL,eF,eO.enabled]);let e_=(0,s.useMemo)(()=>(function(e,t,s=[]){let r=[];for(let t of e){let e=t.publishedAt||t.pubDate;e&&r.push({type:"announcement",data:t,date:new Date(e)})}for(let e of t)r.push({type:"protocol",data:e,date:new Date(e.protocolDate)});for(let e of s)e.latestProtocolDate&&r.push({type:"protocolSearch",data:e,date:new Date(e.latestProtocolDate)});return r.sort((e,t)=>t.date.getTime()-e.date.getTime()),r})(u,h,S),[u,h,S]),eU=(0,s.useMemo)(()=>e_.map(e=>"announcement"===e.type?`a-${e.data.id}`:`p-${e.data.id}`),[e_]),eB=(0,s.useMemo)(()=>eM(eU),[eM,eU]),eW=(0,s.useMemo)(()=>{if(-1===P)return null;let e=new Date;return 0===P?e.setHours(0,0,0,0):e.setDate(e.getDate()-P),e},[P]),eq=(0,s.useMemo)(()=>e_.filter(e=>{if(eW&&e.date<eW)return!1;if("announcement"===e.type){let t=e.data;if(L&&("protokoll"===L||ev(t)!==L))return!1}else if("protocol"===e.type){let t=e.data;if(L&&"protokoll"!==L)return!1;if("protokoll"===L)return!0;if(B){let e=B.toLowerCase();if(!`${t.companyName||""} ${t.orgNumber||""} ${t.aiSummary||""}`.toLowerCase().includes(e))return!1}}else if("protocolSearch"===e.type){let t=e.data;if(L&&"protokoll"!==L)return!1;if("protokoll"===L)return!0;if(B){let e=B.toLowerCase();if(!`${t.companyName||""} ${t.orgNumber||""}`.toLowerCase().includes(e))return!1}}return!0}),[e_,L,B,eW]),eH=(0,s.useMemo)(()=>(function(e){let t=new Date,s=t.toDateString(),r=new Date(t);r.setDate(r.getDate()-1);let n=r.toDateString(),a=new Date(t);a.setDate(a.getDate()-7);let l=new Map;for(let r of e){let e,i,o=r.date.toDateString();if(o===s)e="Idag",i=0;else if(o===n)e="Igår",i=1;else if(r.date>a)e="Denna vecka",i=2;else{let s=r.date.toLocaleDateString("sv-SE",{month:"long",year:"numeric"});e=s.charAt(0).toUpperCase()+s.slice(1),i=100-Math.floor((t.getTime()-r.date.getTime())/2592e6)}l.has(e)||l.set(e,{label:e,items:[],sortKey:i}),l.get(e).items.push(r)}return Array.from(l.values()).sort((e,t)=>e.sortKey-t.sortKey).map(({label:e,items:t})=>({label:e,items:t}))})(eq),[eq]),eK=(0,s.useMemo)(()=>{let e=[];for(let t of eH)for(let s of(e.push({type:"header",label:t.label,count:t.items.length}),t.items))e.push({type:"event",item:s});return e},[eH]),eV=function({useFlushSync:e=!0,...t}){let r=s.useReducer(()=>({}),{})[1],n={...t,onChange:(s,n)=>{var a;e&&n?(0,es.flushSync)(r):r(),null==(a=t.onChange)||a.call(t,s,n)}},[a]=s.useState(()=>new eg(n));return a.setOptions(n),ex(()=>a._didMount(),[]),ex(()=>a._willUpdate()),a}({observeElementRect:eo,observeElementOffset:eu,scrollToFn:eh,...{count:eK.length,getScrollElement:()=>ei.current,estimateSize:e=>{let t=eK[e];return t?.type==="header"?40:120},overscan:5}}),eJ=(0,s.useMemo)(()=>{let e=new Map;for(let t of e_){let s,r,n=null;"announcement"===t.type?(s=t.data.orgNumber?.replace(/\D/g,""),r=t.data.subject||"Kungörelse"):"protocol"===t.type?(s=t.data.orgNumber?.replace(/\D/g,""),r=t.data.aiDetails?.notis?.titel||t.data.companyName||"Protokoll",n=t.data.eventType):(s=t.data.orgNumber?.replace(/\D/g,""),r=`Protokoll fr\xe5n ${t.data.companyName||"bolag"}`),s&&(e.has(s)||e.set(s,[]),e.get(s).push({id:t.data.id,type:t.type,title:r,date:t.date,eventType:n}))}return e},[e_]),eX=(0,s.useCallback)(e=>{let t;if("announcement"===e.type||e.type,!(t=e.data.orgNumber?.replace(/\D/g,"")))return;let s=eJ.get(t);if(s&&!(s.length<=1))return s},[eJ]),eG=(0,s.useMemo)(()=>Object.keys(ef).reduce((e,t)=>(e[t]=u.filter(e=>ev(e)===t).length,e),{}),[u]),eQ=h.length+S.length;return((0,s.useEffect)(()=>{let e=e=>{if(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)return;let t=eq.length;if(0!==t)switch(e.key){case"ArrowDown":case"j":e.preventDefault(),eN(e=>{let s=e<t-1?e+1:e,r=document.querySelector(`[data-event-index="${s}"]`);return r?.scrollIntoView({behavior:"smooth",block:"nearest"}),s});break;case"ArrowUp":case"k":e.preventDefault(),eN(e=>{let t=e>0?e-1:0,s=document.querySelector(`[data-event-index="${t}"]`);return s?.scrollIntoView({behavior:"smooth",block:"nearest"}),t});break;case"Enter":case"o":if(ew>=0&&ew<t){e.preventDefault();let t=document.querySelector(`[data-event-index="${ew}"]`);t instanceof HTMLElement&&t.click()}break;case"r":if(ew>=0&&ew<t){e.preventDefault();let t=eq[ew];eE("announcement"===t.type?`a-${t.data.id}`:"protocol"===t.type?`p-${t.data.id}`:`ps-${t.data.id}`)}break;case"Escape":e.preventDefault(),eN(-1);break;case"Home":e.preventDefault(),eN(0),document.querySelector('[data-event-index="0"]')?.scrollIntoView({behavior:"smooth",block:"start"});break;case"End":e.preventDefault(),eN(t-1),document.querySelector(`[data-event-index="${t-1}"]`)?.scrollIntoView({behavior:"smooth",block:"end"})}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[eq,ew,eE]),"loading"===d)?(0,t.jsx)("main",{className:"min-h-screen bg-background flex items-center justify-center",children:(0,t.jsx)("div",{className:"text-muted-foreground",children:"Laddar..."})}):"unauthenticated"===d?null:(0,t.jsx)($,{children:(0,t.jsxs)("main",{className:"min-h-screen bg-background",children:[(0,t.jsxs)("div",{className:"max-w-2xl mx-auto px-6 py-10 sm:py-14",children:[(0,t.jsxs)("header",{className:"mb-10 sm:mb-14",children:[(0,t.jsx)("span",{className:"block mb-3 text-[11px] font-semibold tracking-[0.15em] uppercase text-rose-500",children:"Bolagshändelser"}),(0,t.jsx)("h1",{className:"font-serif text-3xl sm:text-4xl md:text-[42px] font-normal tracking-tight leading-[1.08] text-foreground",children:"Senaste händelserna"}),(0,t.jsx)("p",{className:"mt-4 text-lg sm:text-xl font-serif italic text-muted-foreground leading-relaxed",children:"Konkurser, emissioner och styrelsebeslut – samlade på ett ställe."}),(0,t.jsxs)("div",{className:"mt-6 flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)("span",{className:`inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium ${"connected"===ed?"bg-emerald-50 text-emerald-600 dark:bg-emerald-950/40 dark:text-emerald-400":"error"===ed?"bg-rose-50 text-rose-600 dark:bg-rose-950/40 dark:text-rose-400":"bg-amber-50 text-amber-600 dark:bg-amber-950/40 dark:text-amber-400"}`,title:"connected"===ed?"Uppdateras i realtid":"error"===ed?"Realtidsanslutning misslyckades":"Ansluter...",children:[(0,t.jsx)(p,{size:10,className:`${"connected"===ed?"motion-safe:animate-pulse":""}`}),"connected"===ed?"Live":"error"===ed?"Offline":"..."]}),eB>0&&(0,t.jsxs)("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium bg-rose-500 text-white",children:[eB," olästa"]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[eB>0&&(0,t.jsxs)("button",{onClick:()=>eD(eU),className:"hidden sm:flex items-center gap-1.5 px-3 py-1.5 text-xs text-muted-foreground hover:text-foreground hover:bg-secondary/80 rounded-xl transition-all duration-200",title:"Markera alla som lästa",children:[(0,t.jsx)(b,{size:14}),(0,t.jsx)("span",{children:"Markera lästa"})]}),eT&&(0,t.jsx)("button",{onClick:()=>{"granted"!==ez?eI().then(e=>{e&&ej(!0)}):ej(!0)},className:`p-2.5 rounded-xl transition-all duration-200 ${"granted"===ez&&eO.enabled?"text-rose-500 bg-rose-50 dark:bg-rose-950/30 hover:bg-rose-100 dark:hover:bg-rose-900/40":"text-muted-foreground hover:bg-secondary/80"}`,title:"Notifikationsinställningar",children:"granted"===ez&&eO.enabled?(0,t.jsx)(x.Bell,{size:18}):(0,t.jsx)(f,{size:18})}),(0,t.jsxs)("div",{className:"hidden sm:flex items-center border border-border/50 rounded-xl overflow-hidden",children:[(0,t.jsx)("button",{onClick:()=>eC("compact"),className:`p-2 transition-all duration-200 ${"compact"===eS?"bg-foreground text-background":"text-muted-foreground hover:text-foreground hover:bg-secondary/60"}`,title:"Kompakt vy",children:(0,t.jsx)(j.LayoutList,{size:16})}),(0,t.jsx)("button",{onClick:()=>eC("standard"),className:`p-2 transition-all duration-200 ${"standard"===eS?"bg-foreground text-background":"text-muted-foreground hover:text-foreground hover:bg-secondary/60"}`,title:"Standard vy",children:(0,t.jsx)(w,{size:16})}),(0,t.jsx)("button",{onClick:()=>eC("media"),className:`p-2 transition-all duration-200 ${"media"===eS?"bg-foreground text-background":"text-muted-foreground hover:text-foreground hover:bg-secondary/60"}`,title:"Media vy",children:(0,t.jsx)(N.default,{size:16})})]}),(0,t.jsx)("button",{onClick:()=>eP(!0),disabled:M,className:"p-2.5 hover:bg-secondary/80 rounded-xl transition-all duration-200",title:"Uppdatera",children:(0,t.jsx)(l.RefreshCw,{size:18,className:M?"animate-spin":""})})]})]})]}),(0,t.jsxs)("div",{className:"relative mb-8",children:[(0,t.jsx)("input",{type:"text",value:_,onChange:e=>U(e.target.value),placeholder:"Sök bland händelser...",className:"w-full py-4 px-5 pr-12 text-base bg-secondary/40 border-0 rounded-2xl placeholder:text-muted-foreground/50 focus:ring-2 focus:ring-rose-500/20 focus:bg-background focus:outline-none transition-all duration-200"}),(0,t.jsx)("div",{className:"absolute right-5 top-1/2 -translate-y-1/2 text-muted-foreground/40",children:q?(0,t.jsx)(i.Loader2,{size:20,className:"animate-spin"}):(0,t.jsx)(v.Search,{size:20})})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-4 overflow-x-auto scrollbar-hide pb-1 -mx-6 px-6",children:[(0,t.jsx)(y.Calendar,{size:14,className:"text-muted-foreground/60 flex-shrink-0"}),eb.map(e=>(0,t.jsx)("button",{onClick:()=>R(e.days),className:`px-3.5 py-2 rounded-xl text-xs font-medium whitespace-nowrap transition-all duration-200 flex-shrink-0 ${P===e.days?"bg-foreground text-background shadow-sm":"bg-secondary/50 text-muted-foreground hover:text-foreground hover:bg-secondary"}`,children:e.label},e.days))]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-8 text-sm overflow-x-auto scrollbar-hide pb-1 -mx-6 px-6 snap-x snap-mandatory",children:[(0,t.jsxs)("div",{className:"px-3.5 py-2 bg-secondary/50 rounded-xl flex-shrink-0 snap-start flex items-center",children:[(0,t.jsx)("span",{className:"font-medium",children:eq.length}),(0,t.jsx)("span",{className:"text-muted-foreground ml-1.5 hidden sm:inline",children:"händelser"})]}),eQ>0&&(0,t.jsxs)("button",{className:`px-3.5 py-2 rounded-xl transition-all duration-200 flex-shrink-0 snap-start flex items-center gap-1.5 ${"protokoll"===L?"bg-rose-500 text-white shadow-sm":"bg-rose-50 dark:bg-rose-950/30 text-rose-600 dark:text-rose-400 hover:bg-rose-100 dark:hover:bg-rose-900/40"}`,onClick:()=>F("protokoll"===L?null:"protokoll"),children:[(0,t.jsx)(o.FileText,{size:14}),(0,t.jsx)("span",{className:"font-medium",children:eQ})]}),Object.entries(eG).filter(([,e])=>e>0).map(([e,s])=>(0,t.jsxs)("button",{className:`px-3.5 py-2 rounded-xl transition-all duration-200 flex-shrink-0 snap-start flex items-center gap-1.5 ${L===e?"bg-rose-500 text-white shadow-sm":"bg-rose-50 dark:bg-rose-950/30 text-rose-600 dark:text-rose-400 hover:bg-rose-100 dark:hover:bg-rose-900/40"}`,onClick:()=>F(L===e?null:e),children:[(0,t.jsx)("span",{className:"[&>svg]:w-3.5 [&>svg]:h-3.5",children:ef[e].icon}),(0,t.jsx)("span",{className:"font-medium",children:s})]},e)),(L||-1!==P)&&(0,t.jsxs)("button",{onClick:()=>{F(null),R(-1)},className:"px-3.5 py-2 bg-secondary/50 hover:bg-secondary rounded-xl text-xs font-medium flex items-center gap-1.5 flex-shrink-0 transition-all duration-200",children:[(0,t.jsx)(k.X,{size:14}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"Rensa filter"})]})]}),E?(0,t.jsx)("div",{className:"flex flex-col gap-6",children:Array.from({length:4}).map((e,s)=>(0,t.jsxs)("div",{className:"bg-card rounded-2xl border p-6 space-y-4 animate-in fade-in duration-300",style:{animationDelay:`${100*s}ms`},children:[(0,t.jsxs)("div",{className:"flex items-start gap-4",children:[(0,t.jsx)(J.Skeleton,{shimmer:!0,className:"w-16 h-16 rounded-lg flex-shrink-0"}),(0,t.jsxs)("div",{className:"flex-1 space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(J.Skeleton,{shimmer:!0,className:"h-5 w-24"}),(0,t.jsx)(J.Skeleton,{shimmer:!0,className:"h-4 w-20"})]}),(0,t.jsx)(J.Skeleton,{shimmer:!0,className:"h-6 w-full"}),(0,t.jsx)(J.Skeleton,{shimmer:!0,className:"h-6 w-4/5"})]})]}),(0,t.jsx)(J.Skeleton,{shimmer:!0,className:"h-16 w-full"})]},s))}):0===eH.length?(0,t.jsxs)("div",{className:"text-center py-12 text-muted-foreground",children:[(0,t.jsx)(a.Building2,{size:48,className:"mx-auto mb-4 opacity-50"}),(0,t.jsx)("p",{className:"font-medium",children:B?`Inga tr\xe4ffar f\xf6r "${B}"`:"Inga händelser än"}),(0,t.jsx)("p",{className:"text-sm mt-1",children:B?"Försök med ett annat sökord eller töm sökningen":L||-1!==P?"Inga händelser matchar valda filter":"Händelser från mac-appen visas här automatiskt"})]}):eK.length<50?(0,t.jsxs)("div",{className:"flex flex-col",children:[(e=0,eH.map(s=>(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-baseline gap-4 pt-10 pb-5 first:pt-0",children:[(0,t.jsx)("span",{className:"text-xs font-semibold tracking-[0.12em] uppercase text-rose-500",children:s.label}),(0,t.jsxs)("span",{className:"text-sm text-muted-foreground/50",children:[s.items.length," händelse",1!==s.items.length&&"r"]})]}),(0,t.jsx)("div",{className:"flex flex-col divide-y divide-border/30",children:s.items.map(s=>{let r=e++,n="announcement"===s.type?`a-${s.data.id}`:"protocol"===s.type?`p-${s.data.id}`:`ps-${s.data.id}`;return(0,t.jsx)("div",{"data-event-index":r,children:(0,t.jsx)(V,{event:"announcement"===s.type?{type:"announcement",data:s.data}:"protocol"===s.type?{type:"protocol",data:s.data}:{type:"protocolSearch",data:s.data},date:s.date,showGradientLine:!0,isUnread:!e$(n),onMarkAsRead:()=>eE(n),relatedEvents:eX(s),searchQuery:B,isFocused:ew===r,layout:eS})},n)})})]},s.label))),(0,t.jsxs)("div",{ref:el,className:"py-8 flex justify-center",children:[O&&(0,t.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:[(0,t.jsx)(i.Loader2,{size:16,className:"animate-spin"}),(0,t.jsx)("span",{className:"text-sm",children:"Laddar fler händelser..."})]}),!en&&e_.length>0&&(0,t.jsxs)("span",{className:"text-sm text-muted-foreground",children:["Alla ",e_.length," händelser laddade"]})]})]}):(0,t.jsxs)("div",{ref:ei,className:"h-[calc(100vh-300px)] overflow-auto",style:{contain:"strict"},children:[(0,t.jsx)("div",{style:{height:`${eV.getTotalSize()}px`,width:"100%",position:"relative"},children:eV.getVirtualItems().map(e=>{let s=eK[e.index];if("header"===s.type)return(0,t.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:`${e.size}px`,transform:`translateY(${e.start}px)`},children:(0,t.jsxs)("div",{className:"flex items-center gap-4 py-2",children:[(0,t.jsx)("span",{className:"font-mono text-[11px] font-semibold uppercase tracking-widest text-muted-foreground",children:s.label}),(0,t.jsxs)("span",{className:"text-[10px] text-muted-foreground/60",children:[s.count," ",1===s.count?"händelse":"händelser"]}),(0,t.jsx)("div",{className:"flex-1 h-px bg-gradient-to-r from-border to-transparent"})]})},e.key);let r=s.item,n="announcement"===r.type?`a-${r.data.id}`:"protocol"===r.type?`p-${r.data.id}`:`ps-${r.data.id}`;return(0,t.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:`${e.size}px`,transform:`translateY(${e.start}px)`},children:(0,t.jsx)(V,{event:"announcement"===r.type?{type:"announcement",data:r.data}:"protocol"===r.type?{type:"protocol",data:r.data}:{type:"protocolSearch",data:r.data},date:r.date,showGradientLine:!0,isUnread:!e$(n),onMarkAsRead:()=>eE(n),relatedEvents:eX(r),searchQuery:B,layout:eS})},e.key)})}),(0,t.jsxs)("div",{ref:el,className:"py-8 flex justify-center",children:[O&&(0,t.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:[(0,t.jsx)(i.Loader2,{size:16,className:"animate-spin"}),(0,t.jsx)("span",{className:"text-sm",children:"Laddar fler händelser..."})]}),!en&&e_.length>0&&(0,t.jsxs)("span",{className:"text-sm text-muted-foreground",children:["Alla ",e_.length," händelser laddade"]})]})]})]}),(0,t.jsx)(ey,{isOpen:ek,onClose:()=>ej(!1),settings:eO,onUpdateSettings:eA})]})})}e.s(["default",()=>ek],113778)}]);

//# debugId=e5713a3a-5190-8530-8a93-437494345d80
//# sourceMappingURL=d75b0dc12eed6151.js.map