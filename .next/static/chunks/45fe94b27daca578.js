;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="28a54478-0488-6c2c-f99a-1d308ff708f0")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,677330,e=>{e.v({actionRow:"widget-styles-module__kEbKra__actionRow",addBtn:"widget-styles-module__kEbKra__addBtn",btn:"widget-styles-module__kEbKra__btn",btnDanger:"widget-styles-module__kEbKra__btnDanger",btnGhost:"widget-styles-module__kEbKra__btnGhost",btnLogo:"widget-styles-module__kEbKra__btnLogo",btnPrimary:"widget-styles-module__kEbKra__btnPrimary",btnPrimaryBlue:"widget-styles-module__kEbKra__btnPrimaryBlue",btnSubtitle:"widget-styles-module__kEbKra__btnSubtitle",btnSuccess:"widget-styles-module__kEbKra__btnSuccess",btnText:"widget-styles-module__kEbKra__btnText",btnTitle:"widget-styles-module__kEbKra__btnTitle",button:"widget-styles-module__kEbKra__button",chevron:"widget-styles-module__kEbKra__chevron",companyCheckbox:"widget-styles-module__kEbKra__companyCheckbox",companyCheckboxChecked:"widget-styles-module__kEbKra__companyCheckboxChecked",companyFilter:"widget-styles-module__kEbKra__companyFilter",companyFilterAction:"widget-styles-module__kEbKra__companyFilterAction",companyFilterActions:"widget-styles-module__kEbKra__companyFilterActions",companyFilterHeader:"widget-styles-module__kEbKra__companyFilterHeader",companyFilterTitle:"widget-styles-module__kEbKra__companyFilterTitle",companyItem:"widget-styles-module__kEbKra__companyItem",companyItemSelected:"widget-styles-module__kEbKra__companyItemSelected",companyList:"widget-styles-module__kEbKra__companyList",companyName:"widget-styles-module__kEbKra__companyName",companyOrgNr:"widget-styles-module__kEbKra__companyOrgNr",confirmActions:"widget-styles-module__kEbKra__confirmActions",confirmDialog:"widget-styles-module__kEbKra__confirmDialog",confirmMessage:"widget-styles-module__kEbKra__confirmMessage",confirmOverlay:"widget-styles-module__kEbKra__confirmOverlay",confirmTitle:"widget-styles-module__kEbKra__confirmTitle",detailLabel:"widget-styles-module__kEbKra__detailLabel",detailRow:"widget-styles-module__kEbKra__detailRow",detailValue:"widget-styles-module__kEbKra__detailValue",detailValueHighlight:"widget-styles-module__kEbKra__detailValueHighlight",expanded:"widget-styles-module__kEbKra__expanded",expandedBody:"widget-styles-module__kEbKra__expandedBody",expandedHeader:"widget-styles-module__kEbKra__expandedHeader",expandedTitle:"widget-styles-module__kEbKra__expandedTitle",expandedVisible:"widget-styles-module__kEbKra__expandedVisible",fadeIn:"widget-styles-module__kEbKra__fadeIn",formActions:"widget-styles-module__kEbKra__formActions",formLabel:"widget-styles-module__kEbKra__formLabel",formRow:"widget-styles-module__kEbKra__formRow",headerActions:"widget-styles-module__kEbKra__headerActions",headerBtn:"widget-styles-module__kEbKra__headerBtn",input:"widget-styles-module__kEbKra__input",inputGroup:"widget-styles-module__kEbKra__inputGroup",loadingSpinner:"widget-styles-module__kEbKra__loadingSpinner",loadingSpinnerBlue:"widget-styles-module__kEbKra__loadingSpinnerBlue",logClear:"widget-styles-module__kEbKra__logClear",logContent:"widget-styles-module__kEbKra__logContent",logEmpty:"widget-styles-module__kEbKra__logEmpty",logHeader:"widget-styles-module__kEbKra__logHeader",logIn:"widget-styles-module__kEbKra__logIn",logLine:"widget-styles-module__kEbKra__logLine",logLineError:"widget-styles-module__kEbKra__logLineError",logLineInfo:"widget-styles-module__kEbKra__logLineInfo",logLineStep:"widget-styles-module__kEbKra__logLineStep",logLineSuccess:"widget-styles-module__kEbKra__logLineSuccess",logLineWarning:"widget-styles-module__kEbKra__logLineWarning",logMsg:"widget-styles-module__kEbKra__logMsg",logPanel:"widget-styles-module__kEbKra__logPanel",logTime:"widget-styles-module__kEbKra__logTime",logTitle:"widget-styles-module__kEbKra__logTitle",menu:"widget-styles-module__kEbKra__menu",menuClose:"widget-styles-module__kEbKra__menuClose",menuDesc:"widget-styles-module__kEbKra__menuDesc",menuHeader:"widget-styles-module__kEbKra__menuHeader",menuIcon:"widget-styles-module__kEbKra__menuIcon",menuIconBlue:"widget-styles-module__kEbKra__menuIconBlue",menuItem:"widget-styles-module__kEbKra__menuItem",menuItems:"widget-styles-module__kEbKra__menuItems",menuLabel:"widget-styles-module__kEbKra__menuLabel",menuTitle:"widget-styles-module__kEbKra__menuTitle",menuTitleIcon:"widget-styles-module__kEbKra__menuTitleIcon",menuTitleIconBlue:"widget-styles-module__kEbKra__menuTitleIconBlue",menuTitleIconGreen:"widget-styles-module__kEbKra__menuTitleIconGreen",menuVisible:"widget-styles-module__kEbKra__menuVisible",newSchedule:"widget-styles-module__kEbKra__newSchedule",progress:"widget-styles-module__kEbKra__progress",progressBar:"widget-styles-module__kEbKra__progressBar",progressFill:"widget-styles-module__kEbKra__progressFill",progressFillBlue:"widget-styles-module__kEbKra__progressFillBlue",progressText:"widget-styles-module__kEbKra__progressText",progressWithText:"widget-styles-module__kEbKra__progressWithText",project:"widget-styles-module__kEbKra__project",projectDetails:"widget-styles-module__kEbKra__projectDetails",projectExpanded:"widget-styles-module__kEbKra__projectExpanded",projectHeader:"widget-styles-module__kEbKra__projectHeader",projectId:"widget-styles-module__kEbKra__projectId",projectTitle:"widget-styles-module__kEbKra__projectTitle",projects:"widget-styles-module__kEbKra__projects",pulse:"widget-styles-module__kEbKra__pulse",rateLimitWarning:"widget-styles-module__kEbKra__rateLimitWarning",retryBtn:"widget-styles-module__kEbKra__retryBtn",scheduleItem:"widget-styles-module__kEbKra__scheduleItem",scheduleList:"widget-styles-module__kEbKra__scheduleList",scheduleName:"widget-styles-module__kEbKra__scheduleName",scheduleTime:"widget-styles-module__kEbKra__scheduleTime",sectionTitle:"widget-styles-module__kEbKra__sectionTitle",select:"widget-styles-module__kEbKra__select",slideDown:"widget-styles-module__kEbKra__slideDown",spin:"widget-styles-module__kEbKra__spin",statCard:"widget-styles-module__kEbKra__statCard",statContent:"widget-styles-module__kEbKra__statContent",statLabel:"widget-styles-module__kEbKra__statLabel",statValue:"widget-styles-module__kEbKra__statValue",statValueOnline:"widget-styles-module__kEbKra__statValueOnline",statValueSuccess:"widget-styles-module__kEbKra__statValueSuccess",statsGrid:"widget-styles-module__kEbKra__statsGrid",statusDot:"widget-styles-module__kEbKra__statusDot",statusDotOnline:"widget-styles-module__kEbKra__statusDotOnline",statusDotWorking:"widget-styles-module__kEbKra__statusDotWorking",statusDotWorkingBlue:"widget-styles-module__kEbKra__statusDotWorkingBlue",summary:"widget-styles-module__kEbKra__summary",summaryItem:"widget-styles-module__kEbKra__summaryItem",summaryItemError:"widget-styles-module__kEbKra__summaryItemError",summaryItemSuccess:"widget-styles-module__kEbKra__summaryItemSuccess",toggle:"widget-styles-module__kEbKra__toggle",toggleActive:"widget-styles-module__kEbKra__toggleActive",view:"widget-styles-module__kEbKra__view",widget:"widget-styles-module__kEbKra__widget",widgetContainer:"widget-styles-module__kEbKra__widgetContainer"})},194179,e=>{"use strict";var a=e.i(221390),s=e.i(31810),t=e.i(906140),l=e.i(333601),n=e.i(835604),i=e.i(692621);function r(){let{data:e,status:r}=(0,l.useSession)(),[d,c]=(0,t.useState)([]),[o,u]=(0,t.useState)(!1),m=(0,t.useRef)(!1);return((0,t.useEffect)(()=>{(async()=>{if(c((0,i.getLocalFavorites)()),"authenticated"===r&&e?.user&&!m.current)try{let e=await fetch("/api/bolag/favorites");if(e.ok){let a=await e.json();a.favorites&&(c(a.favorites),function(e){try{localStorage.setItem("bolagsinfo_favorites",JSON.stringify(e))}catch{}}(a.favorites),m.current=!0)}}catch{}u(!0)})()},[e?.user,r]),(0,t.useEffect)(()=>{(async()=>{if("authenticated"!==r||!e?.user||m.current)return;let a=(0,i.getLocalFavorites)();if(0!==a.length)try{let e=await fetch("/api/bolag/favorites");if(e.ok){let a=await e.json();if(a.favorites&&a.favorites.length>0)return}for(let e of a)await fetch("/api/bolag/favorites",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orgNumber:e.orgNumber,name:e.name})})}catch{}})()},[e?.user,r]),o&&0!==d.length)?(0,a.jsxs)(s.Card,{children:[(0,a.jsx)(s.CardHeader,{className:"pb-3",children:(0,a.jsx)(s.CardTitle,{className:"text-lg",children:"Bevakade bolag"})}),(0,a.jsx)(s.CardContent,{children:(0,a.jsx)("div",{className:"space-y-2",children:d.map(e=>{var s;let t;return(0,a.jsxs)(n.default,{href:`/bolag/${e.orgNumber}`,className:"block p-2 rounded hover:bg-secondary dark:hover:bg-gray-800 transition-colors",children:[(0,a.jsx)("p",{className:"font-medium text-sm",children:e.name}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:10===(t=(s=e.orgNumber).replace(/\D/g,"")).length?`${t.slice(0,6)}-${t.slice(6)}`:s})]},e.orgNumber)})})})]}):null}let d="bolagsinfo-search-history";function c(){try{let e=localStorage.getItem(d);return e?JSON.parse(e):[]}catch{return[]}}function o(e){try{localStorage.setItem(d,JSON.stringify(e))}catch{}}function u({history:e,onClear:s}){return 0===e.length?null:(0,a.jsxs)("div",{className:"mt-4 pt-4 border-t",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Senaste sökningar"}),(0,a.jsx)("button",{onClick:s,className:"text-xs text-muted-foreground/70 hover:text-muted-foreground",children:"Rensa"})]}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:e.map(e=>{var s;let t;return(0,a.jsxs)(n.default,{href:`/bolag/${e.orgNr}`,className:"inline-flex items-center px-3 py-1.5 text-sm bg-secondary rounded-full hover:bg-secondary dark:hover:bg-gray-700 transition-colors",children:[(0,a.jsx)("span",{className:"font-medium truncate max-w-[150px]",children:e.name}),(0,a.jsx)("span",{className:"ml-2 text-muted-foreground/70 text-xs",children:10===(t=(s=e.orgNr).replace(/\D/g,"")).length?`${t.slice(0,6)}-${t.slice(6)}`:s})]},e.orgNr)})})]})}var m=e.i(529276),h=e.i(293836),g=e.i(948861),f=e.i(813329),x=e.i(584629),p=e.i(33087),j=e.i(963310),N=e.i(352144),b=e.i(202888);function v({placeholder:e="Sök företag...",recentSearches:s=[],onSelectResult:l,className:n}){let[i,r]=(0,t.useState)(""),[d,c]=(0,t.useState)([]),[o,u]=(0,t.useState)(!1),[v,k]=(0,t.useState)(!1),[y,_]=(0,t.useState)(-1),[w,S]=(0,t.useState)(null),$=(0,t.useRef)(null),E=(0,t.useRef)(null),C=(0,m.useRouter)();(0,t.useEffect)(()=>{let e=e=>{E.current&&!E.current.contains(e.target)&&k(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,t.useEffect)(()=>{if(i.length<2){c([]),S(null);return}let e=new AbortController,a=setTimeout(async()=>{u(!0),S(null);try{let a=await fetch(`/api/bolag/search?q=${encodeURIComponent(i)}`,{signal:e.signal}),s=await a.json();a.ok?(c(s.results||[]),s.results?.length===0&&S("Inga företag hittades")):S(s.error||"Ett fel uppstod")}catch(e){"AbortError"!==e.name&&S("Ett fel uppstod vid sökning")}finally{u(!1)}},250);return()=>{e.abort(),clearTimeout(a)}},[i]);let L=(0,t.useCallback)(e=>{let a=i.length>=2?d:s;if("ArrowDown"===e.key)e.preventDefault(),_(e=>Math.min(e+1,a.length-1));else if("ArrowUp"===e.key)e.preventDefault(),_(e=>Math.max(e-1,-1));else if("Enter"===e.key){if(e.preventDefault(),y>=0&&a[y])T(a[y]);else if(i.length>=2){let e=i.replace(/\D/g,"");(10===e.length||12===e.length)&&(C.push(`/bolag/${e}`),k(!1))}}else"Escape"===e.key&&(k(!1),$.current?.blur())},[i,d,s,y,C]),T=e=>{l&&l(e),C.push(`/bolag/${e.orgNr}`),k(!1),r("")},I=v&&(i.length>=2||s.length>0),K=i.length>=2,A=K?d:s.slice(0,5);return(0,a.jsxs)("div",{ref:E,className:(0,j.cn)("relative",n),children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(h.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground pointer-events-none"}),(0,a.jsx)("input",{ref:$,type:"text",value:i,onChange:e=>{r(e.target.value),_(-1),k(!0)},onFocus:()=>k(!0),onKeyDown:L,placeholder:e,className:(0,j.cn)("w-full h-11 pl-10 pr-4 rounded-xl border border-border bg-background","text-sm placeholder:text-muted-foreground","focus:outline-none focus:ring-2 focus:ring-ring focus:border-transparent","transition-all duration-200",v&&"ring-2 ring-ring border-transparent")}),o&&(0,a.jsx)(f.Loader2,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground animate-spin"})]}),(0,a.jsx)(b.AnimatePresence,{children:I&&(0,a.jsxs)(N.motion.div,{initial:{opacity:0,y:-8,scale:.98},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-8,scale:.98},transition:{duration:.15,ease:[.25,.1,.25,1]},className:(0,j.cn)("absolute top-full left-0 right-0 mt-2 z-50","rounded-xl border border-border/50 shadow-xl overflow-hidden","bg-background/95 backdrop-blur-xl"),children:[(0,a.jsx)("div",{className:"px-3 py-2 border-b border-border/50",children:(0,a.jsx)("p",{className:"text-xs font-medium text-muted-foreground",children:K?o?"Söker...":w||`${d.length} tr\xe4ffar`:(0,a.jsxs)("span",{className:"flex items-center gap-1.5",children:[(0,a.jsx)(x.Clock,{className:"h-3 w-3"}),"Senaste sökningar"]})})}),(0,a.jsx)("div",{className:"max-h-80 overflow-y-auto",children:A.length>0?(0,a.jsx)("div",{className:"py-1",children:A.map((e,s)=>{var t;let l;return(0,a.jsxs)("button",{onClick:()=>T(e),onMouseEnter:()=>_(s),className:(0,j.cn)("w-full px-3 py-2.5 flex items-center gap-3 text-left transition-colors",y===s?"bg-secondary":"hover:bg-secondary/50"),children:[(0,a.jsx)("div",{className:(0,j.cn)("w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0",y===s?"bg-foreground text-background":"bg-secondary"),children:(0,a.jsx)(g.Building2,{className:"h-4 w-4"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"font-medium text-sm truncate",children:e.name}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:[10===(l=(t=e.orgNr).replace(/\D/g,"")).length?`${l.slice(0,6)}-${l.slice(6)}`:t,"location"in e&&e.location&&` • ${e.location}`]})]}),y===s&&(0,a.jsx)(p.ArrowRight,{className:"h-4 w-4 text-muted-foreground flex-shrink-0"})]},e.orgNr)})}):!K||o||w?null:(0,a.jsx)("div",{className:"px-3 py-6 text-center text-sm text-muted-foreground",children:"Inga resultat"})}),(0,a.jsx)("div",{className:"px-3 py-2 border-t border-border/50 bg-secondary/30",children:(0,a.jsxs)("p",{className:"text-[11px] text-muted-foreground",children:[(0,a.jsx)("kbd",{className:"px-1.5 py-0.5 bg-background rounded text-[10px] font-mono",children:"↑↓"})," ","navigera",(0,a.jsx)("span",{className:"mx-2",children:"•"}),(0,a.jsx)("kbd",{className:"px-1.5 py-0.5 bg-background rounded text-[10px] font-mono",children:"↵"})," ","välj",(0,a.jsx)("span",{className:"mx-2",children:"•"}),(0,a.jsx)("kbd",{className:"px-1.5 py-0.5 bg-background rounded text-[10px] font-mono",children:"esc"})," ","stäng"]})})]})})]})}var k=e.i(363368),y=e.i(37805),_=e.i(820505),w=e.i(193958);function S(e,a,s=!0){(0,t.useEffect)(()=>{if(!s)return;function t(s){e.current&&!e.current.contains(s.target)&&a()}let l=setTimeout(()=>{document.addEventListener("mousedown",t)},10);return()=>{clearTimeout(l),document.removeEventListener("mousedown",t)}},[e,a,s])}var $=e.i(677330);function E(){let e=(0,m.useRouter)(),[s,l]=(0,t.useState)("button"),[n,i]=(0,t.useState)("search"),[r,d]=(0,t.useState)("online"),[c,o]=(0,t.useState)(!1),[u,f]=(0,t.useState)(!1),[p,j]=(0,t.useState)(""),[N,b]=(0,t.useState)([]),[v,E]=(0,t.useState)(!1),[C,L]=(0,t.useState)([]),[T,I]=(0,t.useState)([]),[K,A]=(0,t.useState)([]),[B,R]=(0,t.useState)(!1),[D,F]=(0,t.useState)(!1),H=(0,t.useRef)(0),P=(0,t.useRef)(null),V=(0,t.useRef)(null),O=(0,t.useRef)(null);S(V,()=>{"menu"===s&&U(),"expanded"===s&&X()},"button"!==s);let G=(0,t.useCallback)((e,a="info")=>{let s=new Date().toLocaleTimeString("sv-SE",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),t={id:`log-${++H.current}`,time:s,message:e,type:a};L(e=>[...e.slice(-50),t])},[]);(0,t.useEffect)(()=>{P.current&&(P.current.scrollTop=P.current.scrollHeight)},[C]),(0,t.useEffect)(()=>{try{let e=localStorage.getItem("bolagsverket-recent-searches");if(e){let a=JSON.parse(e);I(a.slice(0,5))}}catch{}},[]),(0,t.useEffect)(()=>{F(v)},[v]);let W=(e,a)=>{let s={orgNr:e,name:a,timestamp:Date.now()};I(a=>{let t=[s,...a.filter(a=>a.orgNr!==e)].slice(0,5);try{localStorage.setItem("bolagsverket-recent-searches",JSON.stringify(t))}catch{}return t})},M=()=>L([]),U=()=>{o(!1),setTimeout(()=>l("button"),250)},z=e=>{o(!1),i(e),setTimeout(()=>{l("expanded"),setTimeout(()=>f(!0),10)},180),d("online")},J=(0,t.useCallback)(async()=>{R(!0);try{let e=await fetch("/api/bevakning");if(e.ok){let a=await e.json();A(a.companies||[])}}catch{}R(!1)},[]);(0,t.useEffect)(()=>{"expanded"===s&&"fetched"===n&&J()},[s,n,J]);let q=async()=>{G("Testar anslutning...","step"),d("working");try{let e=await fetch("/api/health");if(e.ok){let a=await e.json();G("API: OK","success"),G(`Databas: ${"connected"===a.database?"OK":"Fel"}`,"connected"===a.database?"success":"error"),a.proxy&&G(`Proxy: ${"active"===a.proxy.status?"OK":"Inaktiv"}`,"active"===a.proxy.status?"success":"warning"),G("Anslutning verifierad","success")}else G("Anslutning misslyckades","error")}catch{G("Kunde inte nå servern","error")}d("online")},X=()=>{f(!1),setTimeout(()=>l("button"),220)},Q=(0,t.useCallback)(async(e,a=0)=>{if(!e.trim()||e.length<2)return void b([]);E(!0),d("working"),G(`S\xf6ker: "${e}"...`,"step");try{let a=await fetch(`/api/bolag/search?q=${encodeURIComponent(e.trim())}`);if(!a.ok)throw Error(`API error: ${a.status}`);let s=await a.json();s.results&&s.results.length>0?(b(s.results.slice(0,8)),G(`Hittade ${s.results.length} bolag`,"success")):(b([]),G("Inga bolag hittades","warning"))}catch(t){let s=t instanceof Error?t.message:"Okänt fel";if(a<2)return G(`Fel: ${s}. F\xf6rs\xf6ker igen...`,"warning"),await new Promise(e=>setTimeout(e,1e3)),Q(e,a+1);G(`Fel: ${s}`,"error"),b([])}d("online"),E(!1)},[G]);return(0,a.jsxs)("div",{className:$.default.widget,ref:V,children:["button"===s&&(0,a.jsxs)("button",{className:$.default.button,onClick:()=>{l("menu"),setTimeout(()=>o(!0),10)},disabled:D,children:[(0,a.jsx)("div",{className:$.default.btnLogo,children:(0,a.jsx)("img",{src:"/logos/bolagsverket.png",alt:"Bolagsverket"})}),(0,a.jsx)("span",{className:$.default.btnSubtitle,children:"Bolagssök"}),(0,a.jsx)(k.ChevronRight,{className:`${$.default.chevron} w-4 h-4`}),D&&(0,a.jsx)("div",{className:$.default.loadingSpinner})]}),"menu"===s&&(0,a.jsxs)("div",{className:`${$.default.menu} ${c?$.default.menuVisible:""}`,children:[(0,a.jsxs)("div",{className:$.default.menuHeader,children:[(0,a.jsxs)("div",{className:$.default.menuTitle,children:[(0,a.jsx)("div",{className:`${$.default.menuTitleIcon} ${$.default.menuTitleIconGreen}`,children:(0,a.jsx)(g.Building2,{className:"w-3 h-3"})}),"Bolagsverket"]}),(0,a.jsx)("button",{className:$.default.menuClose,onClick:U,children:(0,a.jsx)(_.X,{className:"w-3.5 h-3.5"})})]}),(0,a.jsxs)("div",{className:$.default.menuItems,children:[(0,a.jsxs)("div",{className:$.default.menuItem,onClick:()=>z("search"),children:[(0,a.jsx)("div",{className:$.default.menuIcon,children:(0,a.jsx)(h.Search,{className:"w-4 h-4"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:$.default.menuLabel,children:"Sök bolag"}),(0,a.jsx)("div",{className:$.default.menuDesc,children:"Sök på namn eller org.nr"})]})]}),(0,a.jsxs)("div",{className:$.default.menuItem,onClick:()=>z("fetched"),children:[(0,a.jsx)("div",{className:$.default.menuIcon,children:(0,a.jsx)(g.Building2,{className:"w-4 h-4"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:$.default.menuLabel,children:"Hämtade bolag"}),(0,a.jsx)("div",{className:$.default.menuDesc,children:"Visa bevakade bolag"})]})]}),(0,a.jsxs)("div",{className:$.default.menuItem,onClick:()=>z("status"),children:[(0,a.jsx)("div",{className:$.default.menuIcon,children:(0,a.jsx)(w.Activity,{className:"w-4 h-4"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:$.default.menuLabel,children:"Status"}),(0,a.jsx)("div",{className:$.default.menuDesc,children:"Anslutning och hälsa"})]})]})]})]}),"expanded"===s&&(0,a.jsxs)("div",{className:`${$.default.expanded} ${u?$.default.expandedVisible:""}`,children:[(0,a.jsxs)("div",{className:$.default.expandedHeader,children:[(0,a.jsxs)("div",{className:$.default.expandedTitle,children:[(0,a.jsx)("div",{className:`${$.default.statusDot} ${"online"===r?$.default.statusDotOnline:"working"===r?$.default.statusDotWorking:""}`}),(0,a.jsx)("span",{children:"search"===n?"Sök bolag":"fetched"===n?"Hämtade bolag":"Status"})]}),(0,a.jsxs)("div",{className:$.default.headerActions,children:[(0,a.jsx)("button",{className:$.default.headerBtn,onClick:()=>{f(!1),setTimeout(()=>{l("menu"),setTimeout(()=>o(!0),10)},220)},children:(0,a.jsx)(y.ChevronLeft,{className:"w-3.5 h-3.5"})}),(0,a.jsx)("button",{className:$.default.headerBtn,onClick:X,children:(0,a.jsx)(_.X,{className:"w-3.5 h-3.5"})})]})]}),(0,a.jsxs)("div",{className:$.default.expandedBody,children:["search"===n&&(0,a.jsxs)("div",{className:$.default.view,children:[(0,a.jsxs)("div",{className:$.default.inputGroup,children:[(0,a.jsx)("input",{type:"text",className:$.default.input,placeholder:"Företagsnamn eller org.nr...",value:p,onChange:e=>{var a;j(a=e.target.value),O.current&&clearTimeout(O.current),a.length>=2?O.current=setTimeout(()=>{Q(a)},300):b([])},onKeyDown:e=>"Enter"===e.key&&Q(p),autoFocus:!0}),(0,a.jsx)("button",{className:`${$.default.btn} ${$.default.btnPrimary}`,onClick:()=>Q(p),disabled:v||p.length<2,children:v?"...":"Sök"})]}),N.length>0&&(0,a.jsxs)("div",{className:$.default.projects,children:[(0,a.jsxs)("div",{className:$.default.sectionTitle,children:[(0,a.jsx)(g.Building2,{className:"w-3.5 h-3.5"}),"Resultat (",N.length,")"]}),N.map(s=>(0,a.jsx)("div",{className:$.default.project,onClick:()=>{W(s.orgNr,s.name),G(`\xd6ppnar: ${s.name}`,"success"),X(),e.push(`/bolag/${s.orgNr}`)},children:(0,a.jsxs)("div",{className:$.default.projectHeader,children:[(0,a.jsx)("div",{className:$.default.projectTitle,children:s.name}),(0,a.jsx)("div",{className:$.default.projectId,children:s.orgNr})]})},s.orgNr))]}),0===N.length&&T.length>0&&!p&&(0,a.jsxs)("div",{className:$.default.projects,children:[(0,a.jsxs)("div",{className:$.default.sectionTitle,children:[(0,a.jsx)(x.Clock,{className:"w-3.5 h-3.5"}),"Senaste sökningar"]}),T.map(s=>(0,a.jsx)("div",{className:$.default.project,onClick:()=>{W(s.orgNr,s.name),X(),e.push(`/bolag/${s.orgNr}`)},children:(0,a.jsxs)("div",{className:$.default.projectHeader,children:[(0,a.jsx)("div",{className:$.default.projectTitle,children:s.name}),(0,a.jsx)("div",{className:$.default.projectId,children:s.orgNr})]})},s.orgNr))]}),(0,a.jsxs)("div",{className:$.default.logPanel,children:[(0,a.jsxs)("div",{className:$.default.logHeader,children:[(0,a.jsx)("span",{className:$.default.logTitle,children:"Aktivitet"}),C.length>0&&(0,a.jsx)("button",{className:$.default.logClear,onClick:M,children:"Rensa"})]}),(0,a.jsx)("div",{className:$.default.logContent,ref:P,children:0===C.length?(0,a.jsx)("div",{className:$.default.logEmpty,children:"Sök efter ett företag för att se aktivitet"}):C.map(e=>(0,a.jsxs)("div",{className:`${$.default.logLine} ${"success"===e.type?$.default.logLineSuccess:"warning"===e.type?$.default.logLineWarning:"error"===e.type?$.default.logLineError:"step"===e.type?$.default.logLineStep:$.default.logLineInfo}`,children:[(0,a.jsx)("span",{className:$.default.logTime,children:e.time}),(0,a.jsx)("span",{className:$.default.logMsg,children:e.message})]},e.id))})]})]}),"fetched"===n&&(0,a.jsxs)("div",{className:$.default.view,children:[B?(0,a.jsx)("div",{className:$.default.logEmpty,children:"Laddar bolag..."}):0===K.length?(0,a.jsx)("div",{className:$.default.logEmpty,children:"Inga bevakade bolag ännu"}):(0,a.jsxs)("div",{className:$.default.projects,children:[(0,a.jsxs)("div",{className:$.default.sectionTitle,children:[(0,a.jsx)(g.Building2,{className:"w-3.5 h-3.5"}),"Bevakade bolag (",K.length,")"]}),K.map(s=>(0,a.jsx)("div",{className:$.default.project,onClick:()=>{X(),e.push(`/bolag/${s.orgNumber}`)},children:(0,a.jsxs)("div",{className:$.default.projectHeader,children:[(0,a.jsx)("div",{className:$.default.projectTitle,children:s.name}),(0,a.jsx)("div",{className:$.default.projectId,children:s.orgNumber})]})},s.id))]}),(0,a.jsxs)("div",{className:$.default.logPanel,children:[(0,a.jsxs)("div",{className:$.default.logHeader,children:[(0,a.jsx)("span",{className:$.default.logTitle,children:"Aktivitet"}),C.length>0&&(0,a.jsx)("button",{className:$.default.logClear,onClick:M,children:"Rensa"})]}),(0,a.jsx)("div",{className:$.default.logContent,ref:P,children:0===C.length?(0,a.jsx)("div",{className:$.default.logEmpty,children:"Ingen aktivitet"}):C.map(e=>(0,a.jsxs)("div",{className:`${$.default.logLine} ${"success"===e.type?$.default.logLineSuccess:"warning"===e.type?$.default.logLineWarning:"error"===e.type?$.default.logLineError:"step"===e.type?$.default.logLineStep:$.default.logLineInfo}`,children:[(0,a.jsx)("span",{className:$.default.logTime,children:e.time}),(0,a.jsx)("span",{className:$.default.logMsg,children:e.message})]},e.id))})]})]}),"status"===n&&(0,a.jsxs)("div",{className:$.default.view,children:[(0,a.jsxs)("div",{className:$.default.statsGrid,children:[(0,a.jsxs)("div",{className:$.default.statCard,children:[(0,a.jsx)(w.Activity,{className:"w-4 h-4"}),(0,a.jsxs)("div",{className:$.default.statContent,children:[(0,a.jsx)("div",{className:$.default.statLabel,children:"API"}),(0,a.jsx)("div",{className:`${$.default.statValue} ${$.default.statValueOnline}`,children:"Ansluten"})]})]}),(0,a.jsxs)("div",{className:$.default.statCard,children:[(0,a.jsx)(g.Building2,{className:"w-4 h-4"}),(0,a.jsxs)("div",{className:$.default.statContent,children:[(0,a.jsx)("div",{className:$.default.statLabel,children:"Bevakade"}),(0,a.jsx)("div",{className:$.default.statValue,children:K.length})]})]})]}),(0,a.jsx)("div",{className:$.default.actionRow,children:(0,a.jsx)("button",{className:`${$.default.btn} ${$.default.btnGhost}`,onClick:q,children:"Testa anslutning"})}),(0,a.jsxs)("div",{className:$.default.logPanel,children:[(0,a.jsxs)("div",{className:$.default.logHeader,children:[(0,a.jsx)("span",{className:$.default.logTitle,children:"Aktivitet"}),C.length>0&&(0,a.jsx)("button",{className:$.default.logClear,onClick:M,children:"Rensa"})]}),(0,a.jsx)("div",{className:$.default.logContent,ref:P,children:0===C.length?(0,a.jsx)("div",{className:$.default.logEmpty,children:"Ingen aktivitet"}):C.map(e=>(0,a.jsxs)("div",{className:`${$.default.logLine} ${"success"===e.type?$.default.logLineSuccess:"warning"===e.type?$.default.logLineWarning:"error"===e.type?$.default.logLineError:"step"===e.type?$.default.logLineStep:$.default.logLineInfo}`,children:[(0,a.jsx)("span",{className:$.default.logTime,children:e.time}),(0,a.jsx)("span",{className:$.default.logMsg,children:e.message})]},e.id))})]})]})]})]})]})}var C=e.i(282109);let L=(0,e.i(672276).default)("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);var T=e.i(637704),I=e.i(873829),K=e.i(782938);function A(){let[e,s]=(0,t.useState)("button"),[l,n]=(0,t.useState)("search"),[i,r]=(0,t.useState)("online"),[d,c]=(0,t.useState)(!1),[o,u]=(0,t.useState)(!1),[m,f]=(0,t.useState)(""),[p,j]=(0,t.useState)([]),[N,b]=(0,t.useState)(0),[v,E]=(0,t.useState)(!1),[A,B]=(0,t.useState)([]),[R,D]=(0,t.useState)(null),[F,H]=(0,t.useState)(null),[P,V]=(0,t.useState)([]),[O,G]=(0,t.useState)(!1),[W,M]=(0,t.useState)(0),[U,z]=(0,t.useState)("--:--"),[J,q]=(0,t.useState)([]),[X,Q]=(0,t.useState)([]),[Z,Y]=(0,t.useState)(!1),ee=(0,t.useRef)(0),ea=(0,t.useRef)(null),es=(0,t.useRef)(null),et=(0,t.useRef)(!1);S(es,()=>{"menu"===e&&er(),"expanded"===e&&ec()},"button"!==e);let el=(0,t.useCallback)((e,a,s="info")=>{let t=new Date().toLocaleTimeString("sv-SE",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),l={id:`log-${++ee.current}`,time:t,message:a,type:s};"search"===e?B(e=>[...e.slice(-50),l]):"batch"===e?V(e=>[...e.slice(-50),l]):Q(e=>[...e.slice(-50),l])},[]);(0,t.useEffect)(()=>{ea.current&&(ea.current.scrollTop=ea.current.scrollHeight)},[A,P,X]);let en=(0,t.useCallback)(async()=>{try{let e=await fetch("/api/bevakning");if(e.ok){let a=await e.json();q(a.companies||[])}}catch(e){console.error("Failed to fetch watched companies:",e)}},[]);(0,t.useEffect)(()=>{"expanded"===e&&"batch"===l&&en()},[e,l,en]),(0,t.useEffect)(()=>{Y(v||O)},[v,O]);let ei=e=>{"search"===e?B([]):"batch"===e?V([]):Q([])},er=()=>{c(!1),setTimeout(()=>s("button"),250)},ed=e=>{c(!1),n(e),setTimeout(()=>{s("expanded"),setTimeout(()=>u(!0),10)},180),r("online")},ec=()=>{u(!1),setTimeout(()=>s("button"),220)},eo=async(e=0)=>{if(m.trim()){E(!0),r("working"),j([]),D(null),b(0),H(null),el("search",`Initierar s\xf6kning...`,"step"),await eu(200),b(10),el("search","Ansluter till Vinnova API...","step"),await eu(300),b(25),el("search",`S\xf6ker: "${m}"`,"info"),b(40);try{let e=new URLSearchParams;e.set("company",m.trim()),el("search",`H\xe4mtar projektdata...`,"step");let a=await fetch(`/api/bolag/vinnova?${e.toString()}`);if(b(70),!a.ok)throw Error(`API error: ${a.status}`);el("search","Bearbetar resultat...","step");let s=await a.json();if(b(90),await eu(200),s.projects&&s.projects.length>0){let e=s.projects.slice(0,10);j(e);let a=e.reduce((e,a)=>e+(a.vinnovaBidrag||0),0);el("search",`Hittade ${s.projects.length} projekt`,"success"),a>0&&el("search",`Total finansiering: ${em(a)}`,"info")}else el("search","Inga Vinnova-projekt hittades för detta bolag","warning");b(100)}catch(s){let a=s instanceof Error?s.message:"Okänt fel";if(e<2)return el("search",`Fel: ${a}. F\xf6rs\xf6ker igen...`,"warning"),await eu(1e3),eo(e+1);el("search",`Fel: ${a}`,"error"),H(a)}await eu(300),r("online"),E(!1),setTimeout(()=>b(0),500)}},eu=e=>new Promise(a=>setTimeout(a,e)),em=e=>e>=1e6?`${(e/1e6).toFixed(1)} MSEK`:new Intl.NumberFormat("sv-SE",{style:"currency",currency:"SEK",maximumFractionDigits:0}).format(e),eh=async()=>{el("status","Testar anslutning...","step"),r("working"),await eu(500);try{(await fetch("/api/health")).ok?(el("status","API: OK","success"),el("status","Databas: OK","success"),el("status","Anslutning verifierad","success")):el("status","Anslutning misslyckades","error")}catch{el("status","Kunde inte nå servern","error")}r("online")},eg=async()=>{if(O){et.current=!1,G(!1),el("batch","Avbruten av användare","warning"),r("online"),M(0);return}let e=J;if(0===e.length){el("batch","Hämtar bevakade bolag...","step");try{let a=await fetch("/api/bevakning");a.ok&&(e=(await a.json()).companies||[],q(e))}catch{el("batch","Kunde inte hämta bevakade bolag","error");return}}if(0===e.length)return void el("batch","Inga bevakade bolag att söka","warning");et.current=!0,G(!0),el("batch",`Startar s\xf6kning f\xf6r ${e.length} bolag...`,"step"),r("working"),M(0);let a=0,s=0;for(let t=0;t<e.length&&et.current;t++){let l=e[t],n=(t+1)/e.length*100;el("batch",`S\xf6ker: ${l.name}...`,"info"),M(n-5);try{let e=await fetch(`/api/bolag/vinnova?company=${encodeURIComponent(l.name)}`);if(!et.current)break;if(e.ok){let t=await e.json(),n=t.projects?.length||0;n>0?(el("batch",`${l.name}: ${n} projekt`,"success"),s+=n):el("batch",`${l.name}: Inga projekt`,"info"),a++}else el("batch",`${l.name}: API-fel`,"warning")}catch{el("batch",`${l.name}: Misslyckades`,"error")}M(n),et.current&&t<e.length-1&&await eu(500)}et.current&&(el("batch",`K\xf6rning slutf\xf6rd: ${a}/${e.length} bolag, ${s} projekt`,"success"),z(new Date().toLocaleTimeString("sv-SE",{hour:"2-digit",minute:"2-digit"}))),et.current=!1,G(!1),r("online"),setTimeout(()=>M(0),1e3)};return(0,t.useEffect)(()=>()=>{et.current=!1},[]),(0,a.jsxs)("div",{className:$.default.widget,ref:es,children:["button"===e&&(0,a.jsxs)("button",{className:$.default.button,onClick:()=>{s("menu"),setTimeout(()=>c(!0),10)},disabled:Z,children:[(0,a.jsx)("div",{className:$.default.btnLogo,children:(0,a.jsx)("img",{src:"/logos/vinnova.png",alt:"Vinnova"})}),(0,a.jsx)("span",{className:$.default.btnSubtitle,children:"Innovationsprojekt"}),(0,a.jsx)(k.ChevronRight,{className:`${$.default.chevron} w-4 h-4`}),Z&&(0,a.jsx)("div",{className:$.default.loadingSpinner})]}),"menu"===e&&(0,a.jsxs)("div",{className:`${$.default.menu} ${d?$.default.menuVisible:""}`,children:[(0,a.jsxs)("div",{className:$.default.menuHeader,children:[(0,a.jsxs)("div",{className:$.default.menuTitle,children:[(0,a.jsx)("div",{className:`${$.default.menuTitleIcon} ${$.default.menuTitleIconGreen}`,children:(0,a.jsx)(T.Zap,{className:"w-3 h-3"})}),"Vinnova Scraper"]}),(0,a.jsx)("button",{className:$.default.menuClose,onClick:er,children:(0,a.jsx)(_.X,{className:"w-3.5 h-3.5"})})]}),(0,a.jsxs)("div",{className:$.default.menuItems,children:[(0,a.jsxs)("div",{className:$.default.menuItem,onClick:()=>ed("search"),children:[(0,a.jsx)("div",{className:$.default.menuIcon,children:(0,a.jsx)(h.Search,{className:"w-4 h-4"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:$.default.menuLabel,children:"Sök projekt"}),(0,a.jsx)("div",{className:$.default.menuDesc,children:"Hitta Vinnova-projekt för företag"})]})]}),(0,a.jsxs)("div",{className:$.default.menuItem,onClick:()=>ed("batch"),children:[(0,a.jsx)("div",{className:$.default.menuIcon,children:(0,a.jsx)(K.RefreshCw,{className:"w-4 h-4"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:$.default.menuLabel,children:"Sök alla bevakade"}),(0,a.jsx)("div",{className:$.default.menuDesc,children:"Kör sökning för alla bevakade bolag"})]})]}),(0,a.jsxs)("div",{className:$.default.menuItem,onClick:()=>ed("status"),children:[(0,a.jsx)("div",{className:$.default.menuIcon,children:(0,a.jsx)(w.Activity,{className:"w-4 h-4"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:$.default.menuLabel,children:"Status"}),(0,a.jsx)("div",{className:$.default.menuDesc,children:"Anslutning och hälsa"})]})]})]})]}),"expanded"===e&&(0,a.jsxs)("div",{className:`${$.default.expanded} ${o?$.default.expandedVisible:""}`,children:[(0,a.jsxs)("div",{className:$.default.expandedHeader,children:[(0,a.jsxs)("div",{className:$.default.expandedTitle,children:[(0,a.jsx)("div",{className:`${$.default.statusDot} ${"online"===i?$.default.statusDotOnline:"working"===i?$.default.statusDotWorking:""}`}),(0,a.jsx)("span",{children:{search:"Sök projekt",batch:"Sök alla bevakade",status:"Status"}[l]})]}),(0,a.jsxs)("div",{className:$.default.headerActions,children:[(0,a.jsx)("button",{className:$.default.headerBtn,onClick:()=>{u(!1),setTimeout(()=>{s("menu"),setTimeout(()=>c(!0),10)},220)},children:(0,a.jsx)(y.ChevronLeft,{className:"w-3.5 h-3.5"})}),(0,a.jsx)("button",{className:$.default.headerBtn,onClick:ec,children:(0,a.jsx)(_.X,{className:"w-3.5 h-3.5"})})]})]}),(0,a.jsxs)("div",{className:$.default.expandedBody,children:["search"===l&&(0,a.jsxs)("div",{className:$.default.view,children:[(0,a.jsxs)("div",{className:$.default.inputGroup,children:[(0,a.jsx)("input",{type:"text",className:$.default.input,placeholder:"Sök bolagsnamn...",value:m,onChange:e=>f(e.target.value),onKeyDown:e=>"Enter"===e.key&&eo()}),(0,a.jsx)("button",{className:`${$.default.btn} ${$.default.btnPrimary}`,onClick:()=>eo(),disabled:v,children:v?"...":"Sök"})]}),F&&(0,a.jsxs)("button",{className:$.default.retryBtn,onClick:()=>{H(null),eo()},children:[(0,a.jsx)(K.RefreshCw,{className:"w-3.5 h-3.5"}),"Försök igen"]}),N>0&&(0,a.jsx)("div",{className:$.default.progress,children:(0,a.jsx)("div",{className:$.default.progressBar,children:(0,a.jsx)("div",{className:$.default.progressFill,style:{width:`${N}%`}})})}),p.length>0&&(0,a.jsxs)("div",{className:$.default.projects,children:[(0,a.jsxs)("div",{className:$.default.sectionTitle,children:[(0,a.jsx)(I.FileText,{className:"w-3.5 h-3.5"}),"Projekt (",p.length,")"]}),p.map(e=>(0,a.jsxs)("div",{className:`${$.default.project} ${R===e.diarienummer?$.default.projectExpanded:""}`,onClick:()=>D(R===e.diarienummer?null:e.diarienummer),children:[(0,a.jsxs)("div",{className:$.default.projectHeader,children:[(0,a.jsx)("div",{className:$.default.projectTitle,children:e.titel||e.diarienummer}),(0,a.jsx)("div",{className:$.default.projectId,children:e.diarienummer})]}),R===e.diarienummer&&(0,a.jsxs)("div",{className:$.default.projectDetails,children:[e.programnamn&&(0,a.jsxs)("div",{className:$.default.detailRow,children:[(0,a.jsx)("span",{className:$.default.detailLabel,children:"Program"}),(0,a.jsx)("span",{className:$.default.detailValue,children:e.programnamn})]}),e.koordinator&&(0,a.jsxs)("div",{className:$.default.detailRow,children:[(0,a.jsx)("span",{className:$.default.detailLabel,children:"Koordinator"}),(0,a.jsx)("span",{className:$.default.detailValue,children:e.koordinator})]}),e.vinnovaBidrag&&(0,a.jsxs)("div",{className:$.default.detailRow,children:[(0,a.jsx)("span",{className:$.default.detailLabel,children:"Bidrag"}),(0,a.jsx)("span",{className:`${$.default.detailValue} ${$.default.detailValueHighlight}`,children:em(e.vinnovaBidrag)})]}),e.totalbudget&&(0,a.jsxs)("div",{className:$.default.detailRow,children:[(0,a.jsx)("span",{className:$.default.detailLabel,children:"Total budget"}),(0,a.jsx)("span",{className:$.default.detailValue,children:em(e.totalbudget)})]})]})]},e.diarienummer))]}),(0,a.jsxs)("div",{className:$.default.logPanel,children:[(0,a.jsxs)("div",{className:$.default.logHeader,children:[(0,a.jsx)("span",{className:$.default.logTitle,children:"Aktivitet"}),A.length>0&&(0,a.jsx)("button",{className:$.default.logClear,onClick:()=>ei("search"),children:"Rensa"})]}),(0,a.jsx)("div",{className:$.default.logContent,ref:ea,children:0===A.length?(0,a.jsx)("div",{className:$.default.logEmpty,children:"Sök efter ett bolag för att se aktivitet"}):A.map(e=>(0,a.jsxs)("div",{className:`${$.default.logLine} ${"success"===e.type?$.default.logLineSuccess:"warning"===e.type?$.default.logLineWarning:"error"===e.type?$.default.logLineError:"step"===e.type?$.default.logLineStep:$.default.logLineInfo}`,children:[(0,a.jsx)("span",{className:$.default.logTime,children:e.time}),(0,a.jsx)("span",{className:$.default.logMsg,children:e.message})]},e.id))})]})]}),"batch"===l&&(0,a.jsxs)("div",{className:$.default.view,children:[(0,a.jsxs)("div",{className:$.default.statsGrid,children:[(0,a.jsxs)("div",{className:$.default.statCard,children:[(0,a.jsx)(g.Building2,{className:"w-4 h-4"}),(0,a.jsxs)("div",{className:$.default.statContent,children:[(0,a.jsx)("div",{className:$.default.statLabel,children:"Bevakade"}),(0,a.jsx)("div",{className:$.default.statValue,children:J.length||"..."})]})]}),(0,a.jsxs)("div",{className:$.default.statCard,children:[(0,a.jsx)(x.Clock,{className:"w-4 h-4"}),(0,a.jsxs)("div",{className:$.default.statContent,children:[(0,a.jsx)("div",{className:$.default.statLabel,children:"Senaste"}),(0,a.jsx)("div",{className:$.default.statValue,children:U})]})]})]}),(0,a.jsx)("div",{className:$.default.actionRow,children:(0,a.jsx)("button",{className:`${$.default.btn} ${O?$.default.btnDanger:$.default.btnSuccess}`,onClick:eg,style:{flex:1},children:O?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(L,{className:"w-3.5 h-3.5"}),"Stoppa"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(C.Play,{className:"w-3.5 h-3.5"}),"Starta sökning"]})})}),W>0&&(0,a.jsx)("div",{className:$.default.progress,children:(0,a.jsx)("div",{className:$.default.progressBar,children:(0,a.jsx)("div",{className:$.default.progressFill,style:{width:`${W}%`}})})}),(0,a.jsxs)("div",{className:$.default.logPanel,children:[(0,a.jsxs)("div",{className:$.default.logHeader,children:[(0,a.jsx)("span",{className:$.default.logTitle,children:"Aktivitet"}),P.length>0&&(0,a.jsx)("button",{className:$.default.logClear,onClick:()=>ei("batch"),children:"Rensa"})]}),(0,a.jsx)("div",{className:$.default.logContent,children:0===P.length?(0,a.jsx)("div",{className:$.default.logEmpty,children:"Starta sökning för att se aktivitet"}):P.map(e=>(0,a.jsxs)("div",{className:`${$.default.logLine} ${"success"===e.type?$.default.logLineSuccess:"warning"===e.type?$.default.logLineWarning:"error"===e.type?$.default.logLineError:"step"===e.type?$.default.logLineStep:$.default.logLineInfo}`,children:[(0,a.jsx)("span",{className:$.default.logTime,children:e.time}),(0,a.jsx)("span",{className:$.default.logMsg,children:e.message})]},e.id))})]})]}),"status"===l&&(0,a.jsxs)("div",{className:$.default.view,children:[(0,a.jsxs)("div",{className:$.default.statsGrid,children:[(0,a.jsxs)("div",{className:$.default.statCard,children:[(0,a.jsx)(w.Activity,{className:"w-4 h-4"}),(0,a.jsxs)("div",{className:$.default.statContent,children:[(0,a.jsx)("div",{className:$.default.statLabel,children:"API"}),(0,a.jsx)("div",{className:`${$.default.statValue} ${$.default.statValueOnline}`,children:"Ansluten"})]})]}),(0,a.jsxs)("div",{className:$.default.statCard,children:[(0,a.jsx)(g.Building2,{className:"w-4 h-4"}),(0,a.jsxs)("div",{className:$.default.statContent,children:[(0,a.jsx)("div",{className:$.default.statLabel,children:"Bevakade"}),(0,a.jsx)("div",{className:$.default.statValue,children:J.length})]})]})]}),(0,a.jsx)("div",{className:$.default.actionRow,children:(0,a.jsx)("button",{className:`${$.default.btn} ${$.default.btnGhost}`,onClick:eh,children:"Testa anslutning"})}),(0,a.jsxs)("div",{className:$.default.logPanel,children:[(0,a.jsxs)("div",{className:$.default.logHeader,children:[(0,a.jsx)("span",{className:$.default.logTitle,children:"Aktivitet"}),X.length>0&&(0,a.jsx)("button",{className:$.default.logClear,onClick:()=>ei("status"),children:"Rensa"})]}),(0,a.jsx)("div",{className:$.default.logContent,ref:ea,children:0===X.length?(0,a.jsx)("div",{className:$.default.logEmpty,children:"Starta en körning för att se aktivitet"}):X.map(e=>(0,a.jsxs)("div",{className:`${$.default.logLine} ${"success"===e.type?$.default.logLineSuccess:"warning"===e.type?$.default.logLineWarning:"error"===e.type?$.default.logLineError:"step"===e.type?$.default.logLineStep:$.default.logLineInfo}`,children:[(0,a.jsx)("span",{className:$.default.logTime,children:e.time}),(0,a.jsx)("span",{className:$.default.logMsg,children:e.message})]},e.id))})]})]})]})]})]})}var B=e.i(123781),R=e.i(489865),D=e.i(500230),F=e.i(857089);function H(){let e=(0,m.useRouter)(),[s,l]=(0,t.useState)("button"),[n,i]=(0,t.useState)("search"),[r,d]=(0,t.useState)("online"),[c,o]=(0,t.useState)(!1),[u,f]=(0,t.useState)(!1),[p,j]=(0,t.useState)(""),[N,b]=(0,t.useState)([]),[v,E]=(0,t.useState)(!1),[T,I]=(0,t.useState)([]),A=(0,t.useRef)(null),[H,P]=(0,t.useState)(!1),[V,O]=(0,t.useState)(0),[G,W]=(0,t.useState)([]),[M,U]=(0,t.useState)({total:0,enriched:0,failed:0,skipped:0}),[z,J]=(0,t.useState)("--:--"),[q,X]=(0,t.useState)([]),[Q,Z]=(0,t.useState)(new Set),[Y,ee]=(0,t.useState)(!1),[ea,es]=(0,t.useState)(!1),[et,el]=(0,t.useState)(!1),[en,ei]=(0,t.useState)(null),[er,ed]=(0,t.useState)(!1),ec=(0,t.useRef)(0),eo=(0,t.useRef)(null),eu=(0,t.useRef)(null),em=(0,t.useRef)(null);S(em,()=>{"menu"===s&&ej(),"expanded"===s&&eb()},"button"!==s);let eh=(0,t.useCallback)((e,a="info")=>{let s=new Date().toLocaleTimeString("sv-SE",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),t={id:`log-${++ec.current}`,time:s,message:e,type:a};W(e=>[...e.slice(-100),t])},[]);(0,t.useEffect)(()=>{eo.current&&(eo.current.scrollTop=eo.current.scrollHeight)},[G]),(0,t.useEffect)(()=>{ed(H||v)},[H,v]),(0,t.useEffect)(()=>{try{let e=localStorage.getItem("allabolag-recent-searches");if(e){let a=JSON.parse(e);I(a.slice(0,5))}}catch{}},[]);let eg=(e,a)=>{let s={orgNr:e,name:a,timestamp:Date.now()};I(a=>{let t=[s,...a.filter(a=>a.orgNr!==e)].slice(0,5);try{localStorage.setItem("allabolag-recent-searches",JSON.stringify(t))}catch{}return t})},ef=(0,t.useCallback)(async(e,a=0)=>{if(!e.trim()||e.length<2)return void b([]);E(!0),d("working"),eh(`S\xf6ker: "${e}"...`,"step");try{let a=await fetch(`/api/bolag/search?q=${encodeURIComponent(e.trim())}`);if(!a.ok)throw Error(`API error: ${a.status}`);let s=await a.json();s.results&&s.results.length>0?(b(s.results.slice(0,8)),eh(`Hittade ${s.results.length} bolag`,"success")):(b([]),eh("Inga bolag hittades","warning"))}catch(t){let s=t instanceof Error?t.message:"Okänt fel";if(a<2)return eh(`Fel: ${s}. F\xf6rs\xf6ker igen...`,"warning"),await new Promise(e=>setTimeout(e,1e3)),ef(e,a+1);eh(`Fel: ${s}`,"error"),b([])}d("online"),E(!1)},[eh]),ex=(0,t.useCallback)(async()=>{ee(!0);try{let e=await fetch("/api/bevakning");if(e.ok){let a=(await e.json()).companies||[];X(a),Z(new Set(a.map(e=>e.id)))}}catch{}ee(!1)},[]);(0,t.useEffect)(()=>{"expanded"===s&&"enrich"===n&&ex()},[s,n,ex]);let ep=()=>W([]),ej=()=>{o(!1),setTimeout(()=>l("button"),250)},eN=e=>{o(!1),i(e),setTimeout(()=>{l("expanded"),setTimeout(()=>f(!0),10)},180),d("online")},eb=()=>{f(!1),setTimeout(()=>l("button"),220)},ev=async(e=0)=>{P(!0),d("working"),O(0),U({total:0,enriched:0,failed:0,skipped:0}),el(!1),ei(null);let a=q.filter(e=>Q.has(e.id));eh(`Startar berikning av ${a.length} bolag...`,"step");try{eu.current=new AbortController;let a=await fetch("/api/bevakning/enrich/stream",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({batchSize:50,companyIds:Array.from(Q)}),signal:eu.current.signal});if(429===a.status){let s=a.headers.get("Retry-After"),t=s?parseInt(s,10):60;if(el(!0),ei(t),eh(`Rate limited. V\xe4nta ${t} sekunder...`,"warning"),e<2)return await ey(1e3*t),el(!1),ev(e+1);P(!1),d("online");return}if(!a.ok)throw Error(`API error: ${a.status}`);let s=a.body?.getReader();if(!s)throw Error("No response body");let t=new TextDecoder;for(;;){let{done:e,value:a}=await s.read();if(e)break;for(let e of t.decode(a).split("\n").filter(Boolean))if(e.startsWith("data: "))try{let a=JSON.parse(e.slice(6));ek(a)}catch{}}J(new Date().toLocaleTimeString("sv-SE",{hour:"2-digit",minute:"2-digit"})),eh("Berikning slutförd","success")}catch(a){if(a instanceof Error&&"AbortError"===a.name);else{let s=a instanceof Error?a.message:"Okänt fel";if(e<2)return eh(`Fel: ${s}. F\xf6rs\xf6ker igen...`,"warning"),await ey(1e3),ev(e+1);eh(`Fel: ${s}`,"error")}}P(!1),d("online"),eu.current=null,setTimeout(()=>O(0),1e3)},ek=e=>{switch(e.type){case"start":eh(e.message||"Startar...","step"),e.total&&U(a=>({...a,total:e.total}));break;case"progress":void 0!==e.progress&&O(e.progress),e.company&&eh(`Bearbetar: ${e.company}`,"info");break;case"success":eh(e.message||`${e.company}: OK`,"success"),U(e=>({...e,enriched:e.enriched+1}));break;case"skip":eh(e.message||`${e.company}: Hoppades \xf6ver`,"info"),U(e=>({...e,skipped:e.skipped+1}));break;case"warning":eh(e.message||"Varning","warning");break;case"error":eh(e.message||`${e.company}: Misslyckades`,"error"),U(e=>({...e,failed:e.failed+1}));break;case"complete":void 0!==e.enriched&&U({total:e.total||0,enriched:e.enriched||0,failed:e.failed||0,skipped:e.skipped||0}),O(100)}},ey=e=>new Promise(a=>setTimeout(a,e)),e_=async()=>{eh("Testar anslutning...","step"),d("working");try{let e=await fetch("/api/health");if(e.ok){let a=await e.json();eh("API: OK","success"),eh(`Databas: ${"connected"===a.database?"OK":"Fel"}`,"connected"===a.database?"success":"error"),eh("Anslutning verifierad","success")}else eh("Anslutning misslyckades","error")}catch{eh("Kunde inte nå servern","error")}d("online")};return(0,a.jsxs)("div",{className:$.default.widget,ref:em,children:[ea&&(0,a.jsx)("div",{className:$.default.confirmOverlay,onClick:()=>es(!1),children:(0,a.jsxs)("div",{className:$.default.confirmDialog,onClick:e=>e.stopPropagation(),children:[(0,a.jsx)("div",{className:$.default.confirmTitle,children:"Bekräfta berikning"}),(0,a.jsxs)("div",{className:$.default.confirmMessage,children:["Du håller på att berika ",Q.size," bolag med data från Allabolag. Detta kan ta några minuter beroende på antalet bolag."]}),(0,a.jsxs)("div",{className:$.default.confirmActions,children:[(0,a.jsx)("button",{className:`${$.default.btn} ${$.default.btnGhost}`,onClick:()=>es(!1),children:"Avbryt"}),(0,a.jsx)("button",{className:`${$.default.btn} ${$.default.btnPrimaryBlue}`,onClick:()=>{es(!1),ev()},children:"Starta berikning"})]})]})}),"button"===s&&(0,a.jsxs)("button",{className:$.default.button,onClick:()=>{l("menu"),setTimeout(()=>o(!0),10)},disabled:er,children:[(0,a.jsx)("div",{className:$.default.btnLogo,children:(0,a.jsx)("img",{src:"/logos/allabolag.png",alt:"Allabolag"})}),(0,a.jsx)("span",{className:$.default.btnSubtitle,children:"Bolagsdata"}),(0,a.jsx)(k.ChevronRight,{className:`${$.default.chevron} w-4 h-4`}),er&&(0,a.jsx)("div",{className:`${$.default.loadingSpinner} ${$.default.loadingSpinnerBlue}`})]}),"menu"===s&&(0,a.jsxs)("div",{className:`${$.default.menu} ${c?$.default.menuVisible:""}`,children:[(0,a.jsxs)("div",{className:$.default.menuHeader,children:[(0,a.jsxs)("div",{className:$.default.menuTitle,children:[(0,a.jsx)("div",{className:`${$.default.menuTitleIcon} ${$.default.menuTitleIconBlue}`,children:(0,a.jsx)(B.Database,{className:"w-3 h-3"})}),"Berika data"]}),(0,a.jsx)("button",{className:$.default.menuClose,onClick:ej,children:(0,a.jsx)(_.X,{className:"w-3.5 h-3.5"})})]}),(0,a.jsxs)("div",{className:$.default.menuItems,children:[(0,a.jsxs)("div",{className:$.default.menuItem,onClick:()=>eN("search"),children:[(0,a.jsx)("div",{className:`${$.default.menuIcon} ${$.default.menuIconBlue}`,children:(0,a.jsx)(h.Search,{className:"w-4 h-4"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:$.default.menuLabel,children:"Sök bolag"}),(0,a.jsx)("div",{className:$.default.menuDesc,children:"Sök på namn eller org.nr"})]})]}),(0,a.jsxs)("div",{className:$.default.menuItem,onClick:()=>eN("enrich"),children:[(0,a.jsx)("div",{className:`${$.default.menuIcon} ${$.default.menuIconBlue}`,children:(0,a.jsx)(K.RefreshCw,{className:"w-4 h-4"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:$.default.menuLabel,children:"Berika bolag"}),(0,a.jsx)("div",{className:$.default.menuDesc,children:q.length>0?`Uppdatera ${q.length} bolag fr\xe5n Allabolag`:"Hämta data från Allabolag"})]})]}),(0,a.jsxs)("div",{className:$.default.menuItem,onClick:()=>eN("status"),children:[(0,a.jsx)("div",{className:`${$.default.menuIcon} ${$.default.menuIconBlue}`,children:(0,a.jsx)(w.Activity,{className:"w-4 h-4"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:$.default.menuLabel,children:"Status"}),(0,a.jsx)("div",{className:$.default.menuDesc,children:"Anslutning och hälsa"})]})]})]})]}),"expanded"===s&&(0,a.jsxs)("div",{className:`${$.default.expanded} ${u?$.default.expandedVisible:""}`,children:[(0,a.jsxs)("div",{className:$.default.expandedHeader,children:[(0,a.jsxs)("div",{className:$.default.expandedTitle,children:[(0,a.jsx)("div",{className:`${$.default.statusDot} ${"online"===r?$.default.statusDotOnline:"working"===r?$.default.statusDotWorkingBlue:""}`}),(0,a.jsx)("span",{children:{search:"Sök bolag",enrich:"Berika bolag",status:"Status"}[n]})]}),(0,a.jsxs)("div",{className:$.default.headerActions,children:[(0,a.jsx)("button",{className:$.default.headerBtn,onClick:()=>{f(!1),setTimeout(()=>{l("menu"),setTimeout(()=>o(!0),10)},220)},children:(0,a.jsx)(y.ChevronLeft,{className:"w-3.5 h-3.5"})}),(0,a.jsx)("button",{className:$.default.headerBtn,onClick:eb,children:(0,a.jsx)(_.X,{className:"w-3.5 h-3.5"})})]})]}),(0,a.jsxs)("div",{className:$.default.expandedBody,children:["search"===n&&(0,a.jsxs)("div",{className:$.default.view,children:[(0,a.jsxs)("div",{className:$.default.inputGroup,children:[(0,a.jsx)("input",{type:"text",className:$.default.input,placeholder:"Företagsnamn eller org.nr...",value:p,onChange:e=>{var a;j(a=e.target.value),A.current&&clearTimeout(A.current),a.length>=2?A.current=setTimeout(()=>{ef(a)},300):b([])},onKeyDown:e=>"Enter"===e.key&&ef(p),autoFocus:!0}),(0,a.jsx)("button",{className:`${$.default.btn} ${$.default.btnPrimaryBlue}`,onClick:()=>ef(p),disabled:v||p.length<2,children:v?"...":"Sök"})]}),N.length>0&&(0,a.jsxs)("div",{className:$.default.projects,children:[(0,a.jsxs)("div",{className:$.default.sectionTitle,children:[(0,a.jsx)(g.Building2,{className:"w-3.5 h-3.5"}),"Resultat (",N.length,")"]}),N.map(s=>(0,a.jsx)("div",{className:$.default.project,onClick:()=>{eg(s.orgNr,s.name),eh(`\xd6ppnar: ${s.name}`,"success"),eb(),e.push(`/bolag/${s.orgNr}`)},children:(0,a.jsxs)("div",{className:$.default.projectHeader,children:[(0,a.jsx)("div",{className:$.default.projectTitle,children:s.name}),(0,a.jsx)("div",{className:$.default.projectId,children:s.orgNr})]})},s.orgNr))]}),0===N.length&&T.length>0&&!p&&(0,a.jsxs)("div",{className:$.default.projects,children:[(0,a.jsxs)("div",{className:$.default.sectionTitle,children:[(0,a.jsx)(x.Clock,{className:"w-3.5 h-3.5"}),"Senaste sökningar"]}),T.map(s=>(0,a.jsx)("div",{className:$.default.project,onClick:()=>{eg(s.orgNr,s.name),eb(),e.push(`/bolag/${s.orgNr}`)},children:(0,a.jsxs)("div",{className:$.default.projectHeader,children:[(0,a.jsx)("div",{className:$.default.projectTitle,children:s.name}),(0,a.jsx)("div",{className:$.default.projectId,children:s.orgNr})]})},s.orgNr))]}),(0,a.jsxs)("div",{className:$.default.logPanel,children:[(0,a.jsxs)("div",{className:$.default.logHeader,children:[(0,a.jsx)("span",{className:$.default.logTitle,children:"Aktivitet"}),G.length>0&&(0,a.jsx)("button",{className:$.default.logClear,onClick:ep,children:"Rensa"})]}),(0,a.jsx)("div",{className:$.default.logContent,ref:eo,children:0===G.length?(0,a.jsx)("div",{className:$.default.logEmpty,children:"Sök efter ett företag för att se aktivitet"}):G.map(e=>(0,a.jsxs)("div",{className:`${$.default.logLine} ${"success"===e.type?$.default.logLineSuccess:"warning"===e.type?$.default.logLineWarning:"error"===e.type?$.default.logLineError:"step"===e.type?$.default.logLineStep:$.default.logLineInfo}`,children:[(0,a.jsx)("span",{className:$.default.logTime,children:e.time}),(0,a.jsx)("span",{className:$.default.logMsg,children:e.message})]},e.id))})]})]}),"enrich"===n&&(0,a.jsxs)("div",{className:$.default.view,children:[et&&(0,a.jsxs)("div",{className:$.default.rateLimitWarning,children:[(0,a.jsx)(D.AlertTriangle,{className:"w-4 h-4"}),(0,a.jsxs)("span",{children:["Rate limited. ",en?`F\xf6rs\xf6ker igen om ${en}s...`:"Vänta innan du försöker igen."]})]}),(0,a.jsxs)("div",{className:$.default.statsGrid,children:[(0,a.jsxs)("div",{className:$.default.statCard,children:[(0,a.jsx)(g.Building2,{className:"w-4 h-4"}),(0,a.jsxs)("div",{className:$.default.statContent,children:[(0,a.jsx)("div",{className:$.default.statLabel,children:"Valda"}),(0,a.jsxs)("div",{className:$.default.statValue,children:[Q.size," / ",q.length]})]})]}),(0,a.jsxs)("div",{className:$.default.statCard,children:[(0,a.jsx)(R.CheckCircle,{className:"w-4 h-4"}),(0,a.jsxs)("div",{className:$.default.statContent,children:[(0,a.jsx)("div",{className:$.default.statLabel,children:"Berikade"}),(0,a.jsx)("div",{className:`${$.default.statValue} ${$.default.statValueSuccess}`,children:M.enriched})]})]})]}),!H&&(0,a.jsxs)("div",{className:$.default.companyFilter,children:[(0,a.jsxs)("div",{className:$.default.companyFilterHeader,children:[(0,a.jsx)("span",{className:$.default.companyFilterTitle,children:"Välj bolag"}),(0,a.jsxs)("div",{className:$.default.companyFilterActions,children:[(0,a.jsx)("button",{className:$.default.companyFilterAction,onClick:()=>{Z(new Set(q.map(e=>e.id)))},children:"Alla"}),(0,a.jsx)("button",{className:$.default.companyFilterAction,onClick:()=>{Z(new Set)},children:"Inga"})]})]}),Y?(0,a.jsx)("div",{className:$.default.logEmpty,children:"Laddar bolag..."}):(0,a.jsx)("div",{className:$.default.companyList,children:q.map(e=>(0,a.jsxs)("div",{className:`${$.default.companyItem} ${Q.has(e.id)?$.default.companyItemSelected:""}`,onClick:()=>{var a;return a=e.id,void Z(e=>{let s=new Set(e);return s.has(a)?s.delete(a):s.add(a),s})},children:[(0,a.jsx)("div",{className:`${$.default.companyCheckbox} ${Q.has(e.id)?$.default.companyCheckboxChecked:""}`,children:Q.has(e.id)&&(0,a.jsx)(F.Check,{className:"w-3 h-3 text-white"})}),(0,a.jsx)("span",{className:$.default.companyName,children:e.name}),(0,a.jsx)("span",{className:$.default.companyOrgNr,children:e.orgNumber})]},e.id))})]}),(0,a.jsx)("div",{className:$.default.actionRow,children:(0,a.jsx)("button",{className:`${$.default.btn} ${H?$.default.btnDanger:$.default.btnPrimaryBlue}`,onClick:()=>{if(H){eu.current&&eu.current.abort(),P(!1),d("online"),eh("Avbruten av användare","warning");return}0===Q.size?eh("Inga bolag valda","warning"):es(!0)},style:{flex:1},disabled:et,children:H?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(L,{className:"w-3.5 h-3.5"}),"Stoppa"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(C.Play,{className:"w-3.5 h-3.5"}),"Starta berikning"]})})}),V>0&&(0,a.jsxs)("div",{className:`${$.default.progress} ${$.default.progressWithText}`,children:[(0,a.jsx)("div",{className:$.default.progressBar,children:(0,a.jsx)("div",{className:`${$.default.progressFill} ${$.default.progressFillBlue}`,style:{width:`${V}%`}})}),(0,a.jsxs)("span",{className:$.default.progressText,children:[Math.round(V),"%"]})]}),(M.enriched>0||M.failed>0||M.skipped>0)&&(0,a.jsxs)("div",{className:$.default.summary,children:[(0,a.jsxs)("span",{className:`${$.default.summaryItem} ${$.default.summaryItemSuccess}`,children:[M.enriched," berikade"]}),M.skipped>0&&(0,a.jsxs)("span",{className:$.default.summaryItem,children:[M.skipped," hoppades över"]}),M.failed>0&&(0,a.jsxs)("span",{className:`${$.default.summaryItem} ${$.default.summaryItemError}`,children:[M.failed," misslyckades"]})]}),(0,a.jsxs)("div",{className:$.default.logPanel,children:[(0,a.jsxs)("div",{className:$.default.logHeader,children:[(0,a.jsx)("span",{className:$.default.logTitle,children:"Aktivitet"}),G.length>0&&(0,a.jsx)("button",{className:$.default.logClear,onClick:ep,children:"Rensa"})]}),(0,a.jsx)("div",{className:$.default.logContent,ref:eo,children:0===G.length?(0,a.jsx)("div",{className:$.default.logEmpty,children:"Starta berikning för att se aktivitet"}):G.map(e=>(0,a.jsxs)("div",{className:`${$.default.logLine} ${"success"===e.type?$.default.logLineSuccess:"warning"===e.type?$.default.logLineWarning:"error"===e.type?$.default.logLineError:"step"===e.type?$.default.logLineStep:$.default.logLineInfo}`,children:[(0,a.jsx)("span",{className:$.default.logTime,children:e.time}),(0,a.jsx)("span",{className:$.default.logMsg,children:e.message})]},e.id))})]})]}),"status"===n&&(0,a.jsxs)("div",{className:$.default.view,children:[(0,a.jsxs)("div",{className:$.default.statsGrid,children:[(0,a.jsxs)("div",{className:$.default.statCard,children:[(0,a.jsx)(w.Activity,{className:"w-4 h-4"}),(0,a.jsxs)("div",{className:$.default.statContent,children:[(0,a.jsx)("div",{className:$.default.statLabel,children:"API"}),(0,a.jsx)("div",{className:`${$.default.statValue} ${$.default.statValueOnline}`,children:"Ansluten"})]})]}),(0,a.jsxs)("div",{className:$.default.statCard,children:[(0,a.jsx)(x.Clock,{className:"w-4 h-4"}),(0,a.jsxs)("div",{className:$.default.statContent,children:[(0,a.jsx)("div",{className:$.default.statLabel,children:"Senaste"}),(0,a.jsx)("div",{className:$.default.statValue,children:z})]})]})]}),(0,a.jsx)("div",{className:$.default.actionRow,children:(0,a.jsx)("button",{className:`${$.default.btn} ${$.default.btnGhost}`,onClick:e_,children:"Testa anslutning"})}),(0,a.jsxs)("div",{className:$.default.logPanel,children:[(0,a.jsxs)("div",{className:$.default.logHeader,children:[(0,a.jsx)("span",{className:$.default.logTitle,children:"Aktivitet"}),G.length>0&&(0,a.jsx)("button",{className:$.default.logClear,onClick:ep,children:"Rensa"})]}),(0,a.jsx)("div",{className:$.default.logContent,children:0===G.length?(0,a.jsx)("div",{className:$.default.logEmpty,children:"Ingen aktivitet"}):G.map(e=>(0,a.jsxs)("div",{className:`${$.default.logLine} ${"success"===e.type?$.default.logLineSuccess:"warning"===e.type?$.default.logLineWarning:"error"===e.type?$.default.logLineError:"step"===e.type?$.default.logLineStep:$.default.logLineInfo}`,children:[(0,a.jsx)("span",{className:$.default.logTime,children:e.time}),(0,a.jsx)("span",{className:$.default.logMsg,children:e.message})]},e.id))})]})]})]})]})]})}var P=e.i(44748),V=e.i(619988),O=e.i(90658),G=e.i(730221);function W(){let[e,s]=(0,t.useState)("button"),[l,n]=(0,t.useState)("search"),[i,r]=(0,t.useState)("online"),[d,c]=(0,t.useState)(!1),[o,u]=(0,t.useState)(!1),[m,f]=(0,t.useState)(""),[p,j]=(0,t.useState)(null),[N,b]=(0,t.useState)(!1),[v,E]=(0,t.useState)([]),[T,I]=(0,t.useState)([]),[A,B]=(0,t.useState)(!1),[R,D]=(0,t.useState)(0),[F,H]=(0,t.useState)("--:--"),[W,M]=(0,t.useState)([]),[U,z]=(0,t.useState)([]),[J,q]=(0,t.useState)([]),[X,Q]=(0,t.useState)({}),[Z,Y]=(0,t.useState)(""),[ee,ea]=(0,t.useState)(null),[es,et]=(0,t.useState)([]),[el,en]=(0,t.useState)(!1),[ei,er]=(0,t.useState)(!1),ed=(0,t.useRef)(0),ec=(0,t.useRef)(null),eo=(0,t.useRef)(null),eu=(0,t.useRef)(!1);S(eo,()=>{"menu"===e&&ef(),"expanded"===e&&ep()},"button"!==e);let em=(0,t.useCallback)((e,a,s="info")=>{let t=new Date().toLocaleTimeString("sv-SE",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),l={id:`log-${++ed.current}`,time:t,message:a,type:s};"search"===e?E(e=>[...e.slice(-50),l]):"batch"===e?I(e=>[...e.slice(-50),l]):"linkedin"===e?et(e=>[...e.slice(-50),l]):q(e=>[...e.slice(-50),l])},[]);(0,t.useEffect)(()=>{ec.current&&(ec.current.scrollTop=ec.current.scrollHeight)},[v,T,J,es]);let eh=(0,t.useCallback)(async()=>{try{let e=await fetch("/api/bevakning");if(e.ok){let a=await e.json();M(a.companies||[])}}catch(e){console.error("Failed to fetch watched companies:",e)}},[]);(0,t.useEffect)(()=>{"expanded"===e&&"batch"===l&&eh()},[e,l,eh]),(0,t.useEffect)(()=>{er(N||A||el)},[N,A,el]);let eg=e=>{"search"===e?E([]):"batch"===e?I([]):"linkedin"===e?et([]):q([])},ef=()=>{c(!1),setTimeout(()=>s("button"),250)},ex=e=>{c(!1),n(e),setTimeout(()=>{s("expanded"),setTimeout(()=>u(!0),10)},180),r("online")},ep=()=>{u(!1),setTimeout(()=>s("button"),220)},ej=async(e=0)=>{if(m.trim()){b(!0),r("working"),j(null),em("search",`S\xf6ker logo f\xf6r: "${m}"...`,"step");try{let e=await fetch(`/api/media/logo?domain=${encodeURIComponent(m.trim())}&all=true`);if(!e.ok)throw Error(`API error: ${e.status}`);let a=await e.json();if(a.success&&a.files.length>0)for(let e of(j(a),em("search",`Hittade ${a.files.length} logotyp(er) via ${a.source}`,"success"),a.files)){let a=e.width?`${e.width}x${e.height}`:"okänd storlek";em("search",`  ${e.format.toUpperCase()} (${e.type}) - ${a}`,"info")}else em("search",a.error||"Ingen logo hittades","warning")}catch(s){let a=s instanceof Error?s.message:"Okänt fel";if(e<2)return em("search",`Fel: ${a}. F\xf6rs\xf6ker igen...`,"warning"),await ev(1e3),ej(e+1);em("search",`Fel: ${a}`,"error")}r("online"),b(!1)}},eN=async()=>{if(A){eu.current=!1,B(!1),em("batch","Avbruten av användare","warning"),r("online"),D(0);return}let e=W;if(0===e.length){em("batch","Hämtar bevakade bolag...","step");try{let a=await fetch("/api/bevakning");a.ok&&(e=(await a.json()).companies||[],M(e))}catch{em("batch","Kunde inte hämta bevakade bolag","error");return}}if(0===e.length)return void em("batch","Inga bevakade bolag att hämta logos för","warning");eu.current=!0,B(!0),z([]),em("batch",`Startar logo-h\xe4mtning f\xf6r ${e.length} bolag...`,"step"),r("working"),D(0);let a=0,s=[],t={};for(let l=0;l<e.length&&eu.current;l++){let n=e[l],i=(l+1)/e.length*100,r=n.domain||ey(n.name);em("batch",`S\xf6ker: ${n.name} (${r})...`,"info"),D(i-5);try{let e=await fetch(`/api/media/logo?domain=${encodeURIComponent(r)}`);if(!eu.current)break;if(e.ok){let l=await e.json();if(s.push(l),l.success){em("batch",`${n.name}: OK (${l.source})`,"success"),a++;let e=l.source||"unknown";t[e]||(t[e]={success:0,fail:0}),t[e].success++}else em("batch",`${n.name}: Ingen logo`,"warning")}else em("batch",`${n.name}: API-fel`,"warning")}catch{em("batch",`${n.name}: Misslyckades`,"error")}D(i),eu.current&&l<e.length-1&&await ev(300)}eu.current&&(z(s),Q(t),em("batch",`K\xf6rning slutf\xf6rd: ${a}/${e.length} logos h\xe4mtade`,"success"),H(new Date().toLocaleTimeString("sv-SE",{hour:"2-digit",minute:"2-digit"}))),eu.current=!1,B(!1),r("online"),setTimeout(()=>D(0),1e3)},eb=async()=>{for(let e of(em("status","Testar API-anslutningar...","step"),r("working"),[{name:"Brandfetch API",domain:"google.com"},{name:"Unavatar",domain:"spotify.com"},{name:"Google Favicons",domain:"github.com"}])){em("status",`Testar ${e.name}...`,"info"),await ev(300);try{let a=await fetch(`/api/media/logo?domain=${e.domain}`);if(a.ok){let s=await a.json();s.success?em("status",`${e.name}: OK (${s.source})`,"success"):em("status",`${e.name}: Ingen logo`,"warning")}else em("status",`${e.name}: Fel (${a.status})`,"error")}catch{em("status",`${e.name}: Kunde inte n\xe5`,"error")}}em("status","Test slutfört","success"),r("online")},ev=e=>new Promise(a=>setTimeout(a,e)),ek=async()=>{if(Z.trim()){en(!0),r("working"),ea(null),em("linkedin",`S\xf6ker LinkedIn-profil f\xf6r: "${Z}"...`,"step");try{let e=await fetch(`/api/media/linkedin?company=${encodeURIComponent(Z.trim())}`);if(!e.ok)throw Error(`API error: ${e.status}`);let a=await e.json();a.success&&a.data?(ea(a),em("linkedin",`Hittade: ${a.data.name||Z}`,"success"),a.data.industry&&em("linkedin",`Bransch: ${a.data.industry}`,"info"),a.data.company_size&&em("linkedin",`Storlek: ${a.data.company_size}`,"info"),a.data.headquarters&&em("linkedin",`HQ: ${a.data.headquarters}`,"info")):em("linkedin",a.error||"Ingen LinkedIn-profil hittades","warning")}catch(a){let e=a instanceof Error?a.message:"Okänt fel";em("linkedin",`Fel: ${e}`,"error")}r("online"),en(!1)}},ey=e=>{let a=e.toLowerCase().replace(/\s*(ab|aktiebolag|hb|kb|ek\.?\s*för\.?|ekonomisk förening)\s*$/i,"").trim().replace(/\s+/g,"").replace(/[åä]/g,"a").replace(/ö/g,"o").replace(/[^a-z0-9]/g,"");return`${a}.se`},e_=async(e,a)=>{try{let s=await fetch(e.url),t=await s.blob(),l=window.URL.createObjectURL(t),n=document.createElement("a");n.href=l,n.download=`${a.replace(/\./g,"_")}_logo.${e.format}`,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(l),em("search",`Laddade ner ${e.format.toUpperCase()} logo`,"success")}catch{em("search","Kunde inte ladda ner logo","error")}};return(0,t.useEffect)(()=>()=>{eu.current=!1},[]),(0,a.jsxs)("div",{className:$.default.widget,ref:eo,children:["button"===e&&(0,a.jsxs)("button",{className:$.default.button,onClick:()=>{s("menu"),setTimeout(()=>c(!0),10)},disabled:ei,children:[(0,a.jsx)("div",{className:$.default.btnLogo,children:(0,a.jsx)(P.Image,{className:"w-8 h-8",strokeWidth:1.5})}),(0,a.jsx)("span",{className:$.default.btnSubtitle,children:"Media & Logos"}),(0,a.jsx)(k.ChevronRight,{className:`${$.default.chevron} w-4 h-4`}),ei&&(0,a.jsx)("div",{className:$.default.loadingSpinner})]}),"menu"===e&&(0,a.jsxs)("div",{className:`${$.default.menu} ${d?$.default.menuVisible:""}`,children:[(0,a.jsxs)("div",{className:$.default.menuHeader,children:[(0,a.jsxs)("div",{className:$.default.menuTitle,children:[(0,a.jsx)("div",{className:`${$.default.menuTitleIcon} ${$.default.menuTitleIconGreen}`,children:(0,a.jsx)(P.Image,{className:"w-3 h-3"})}),"Media"]}),(0,a.jsx)("button",{className:$.default.menuClose,onClick:ef,children:(0,a.jsx)(_.X,{className:"w-3.5 h-3.5"})})]}),(0,a.jsxs)("div",{className:$.default.menuItems,children:[(0,a.jsxs)("div",{className:$.default.menuItem,onClick:()=>ex("search"),children:[(0,a.jsx)("div",{className:$.default.menuIcon,children:(0,a.jsx)(h.Search,{className:"w-4 h-4"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:$.default.menuLabel,children:"Hämta logo"}),(0,a.jsx)("div",{className:$.default.menuDesc,children:"Sök på domän eller bolagsnamn"})]})]}),(0,a.jsxs)("div",{className:$.default.menuItem,onClick:()=>ex("batch"),children:[(0,a.jsx)("div",{className:$.default.menuIcon,children:(0,a.jsx)(K.RefreshCw,{className:"w-4 h-4"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:$.default.menuLabel,children:"Batch-hämtning"}),(0,a.jsx)("div",{className:$.default.menuDesc,children:"Hämta logos för alla bevakade bolag"})]})]}),(0,a.jsxs)("div",{className:$.default.menuItem,onClick:()=>ex("linkedin"),children:[(0,a.jsx)("div",{className:$.default.menuIcon,children:(0,a.jsx)(G.Linkedin,{className:"w-4 h-4"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:$.default.menuLabel,children:"LinkedIn"}),(0,a.jsx)("div",{className:$.default.menuDesc,children:"Hämta bolagsprofil från LinkedIn"})]})]}),(0,a.jsxs)("div",{className:$.default.menuItem,onClick:()=>ex("status"),children:[(0,a.jsx)("div",{className:$.default.menuIcon,children:(0,a.jsx)(w.Activity,{className:"w-4 h-4"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:$.default.menuLabel,children:"Status"}),(0,a.jsx)("div",{className:$.default.menuDesc,children:"API-status och statistik"})]})]})]})]}),"expanded"===e&&(0,a.jsxs)("div",{className:`${$.default.expanded} ${o?$.default.expandedVisible:""}`,children:[(0,a.jsxs)("div",{className:$.default.expandedHeader,children:[(0,a.jsxs)("div",{className:$.default.expandedTitle,children:[(0,a.jsx)("div",{className:`${$.default.statusDot} ${"online"===i?$.default.statusDotOnline:"working"===i?$.default.statusDotWorking:""}`}),(0,a.jsx)("span",{children:{search:"Hämta logo",batch:"Batch-hämtning",status:"Status",linkedin:"LinkedIn"}[l]})]}),(0,a.jsxs)("div",{className:$.default.headerActions,children:[(0,a.jsx)("button",{className:$.default.headerBtn,onClick:()=>{u(!1),setTimeout(()=>{s("menu"),setTimeout(()=>c(!0),10)},220)},children:(0,a.jsx)(y.ChevronLeft,{className:"w-3.5 h-3.5"})}),(0,a.jsx)("button",{className:$.default.headerBtn,onClick:ep,children:(0,a.jsx)(_.X,{className:"w-3.5 h-3.5"})})]})]}),(0,a.jsxs)("div",{className:$.default.expandedBody,children:["search"===l&&(0,a.jsxs)("div",{className:$.default.view,children:[(0,a.jsxs)("div",{className:$.default.inputGroup,children:[(0,a.jsx)("input",{type:"text",className:$.default.input,placeholder:"Domän (t.ex. volvo.com)...",value:m,onChange:e=>f(e.target.value),onKeyDown:e=>"Enter"===e.key&&ej(),autoFocus:!0}),(0,a.jsx)("button",{className:`${$.default.btn} ${$.default.btnPrimary}`,onClick:()=>ej(),disabled:N,children:N?"...":"Sök"})]}),p&&p.success&&p.files.length>0&&(0,a.jsxs)("div",{className:$.default.projects,children:[(0,a.jsxs)("div",{className:$.default.sectionTitle,children:[(0,a.jsx)(P.Image,{className:"w-3.5 h-3.5"}),"Resultat (",p.files.length,")"]}),(0,a.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px",marginBottom:"12px"},children:p.files.slice(0,4).map((e,s)=>(0,a.jsxs)("div",{style:{background:"var(--widget-surface)",borderRadius:"8px",padding:"12px",display:"flex",flexDirection:"column",alignItems:"center",gap:"8px",flex:"1 1 calc(50% - 4px)",minWidth:"120px"},children:[(0,a.jsx)("div",{style:{width:"80px",height:"60px",display:"flex",alignItems:"center",justifyContent:"center",background:"white",borderRadius:"4px",padding:"8px"},children:(0,a.jsx)("img",{src:e.url,alt:`Logo ${e.type}`,style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"},onError:e=>{e.target.style.display="none"}})}),(0,a.jsxs)("div",{style:{fontSize:"10px",color:"var(--widget-text-dim)",textAlign:"center"},children:[e.format.toUpperCase()," ",e.width?`(${e.width}px)`:""]}),(0,a.jsxs)("div",{style:{display:"flex",gap:"4px"},children:[(0,a.jsx)("button",{className:`${$.default.btn} ${$.default.btnGhost}`,style:{padding:"4px 8px",fontSize:"10px"},onClick:()=>e_(e,p.domain),children:(0,a.jsx)(V.Download,{className:"w-3 h-3"})}),(0,a.jsx)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:`${$.default.btn} ${$.default.btnGhost}`,style:{padding:"4px 8px",fontSize:"10px"},children:(0,a.jsx)(O.ExternalLink,{className:"w-3 h-3"})})]})]},s))})]}),(0,a.jsxs)("div",{className:$.default.logPanel,children:[(0,a.jsxs)("div",{className:$.default.logHeader,children:[(0,a.jsx)("span",{className:$.default.logTitle,children:"Aktivitet"}),v.length>0&&(0,a.jsx)("button",{className:$.default.logClear,onClick:()=>eg("search"),children:"Rensa"})]}),(0,a.jsx)("div",{className:$.default.logContent,ref:ec,children:0===v.length?(0,a.jsx)("div",{className:$.default.logEmpty,children:"Sök efter en domän för att hämta logo"}):v.map(e=>(0,a.jsxs)("div",{className:`${$.default.logLine} ${"success"===e.type?$.default.logLineSuccess:"warning"===e.type?$.default.logLineWarning:"error"===e.type?$.default.logLineError:"step"===e.type?$.default.logLineStep:$.default.logLineInfo}`,children:[(0,a.jsx)("span",{className:$.default.logTime,children:e.time}),(0,a.jsx)("span",{className:$.default.logMsg,children:e.message})]},e.id))})]})]}),"batch"===l&&(0,a.jsxs)("div",{className:$.default.view,children:[(0,a.jsxs)("div",{className:$.default.statsGrid,children:[(0,a.jsxs)("div",{className:$.default.statCard,children:[(0,a.jsx)(g.Building2,{className:"w-4 h-4"}),(0,a.jsxs)("div",{className:$.default.statContent,children:[(0,a.jsx)("div",{className:$.default.statLabel,children:"Bevakade"}),(0,a.jsx)("div",{className:$.default.statValue,children:W.length||"..."})]})]}),(0,a.jsxs)("div",{className:$.default.statCard,children:[(0,a.jsx)(x.Clock,{className:"w-4 h-4"}),(0,a.jsxs)("div",{className:$.default.statContent,children:[(0,a.jsx)("div",{className:$.default.statLabel,children:"Senaste"}),(0,a.jsx)("div",{className:$.default.statValue,children:F})]})]})]}),(0,a.jsx)("div",{className:$.default.actionRow,children:(0,a.jsx)("button",{className:`${$.default.btn} ${A?$.default.btnDanger:$.default.btnSuccess}`,onClick:eN,style:{flex:1},children:A?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(L,{className:"w-3.5 h-3.5"}),"Stoppa"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(C.Play,{className:"w-3.5 h-3.5"}),"Starta hämtning"]})})}),R>0&&(0,a.jsx)("div",{className:$.default.progress,children:(0,a.jsx)("div",{className:$.default.progressBar,children:(0,a.jsx)("div",{className:$.default.progressFill,style:{width:`${R}%`}})})}),U.length>0&&!A&&(0,a.jsxs)("div",{className:$.default.summary,children:[(0,a.jsxs)("span",{className:`${$.default.summaryItem} ${$.default.summaryItemSuccess}`,children:[U.filter(e=>e.success).length," hämtade"]}),(0,a.jsxs)("span",{className:$.default.summaryItem,children:[U.filter(e=>!e.success).length," missade"]})]}),(0,a.jsxs)("div",{className:$.default.logPanel,children:[(0,a.jsxs)("div",{className:$.default.logHeader,children:[(0,a.jsx)("span",{className:$.default.logTitle,children:"Aktivitet"}),T.length>0&&(0,a.jsx)("button",{className:$.default.logClear,onClick:()=>eg("batch"),children:"Rensa"})]}),(0,a.jsx)("div",{className:$.default.logContent,children:0===T.length?(0,a.jsx)("div",{className:$.default.logEmpty,children:"Starta hämtning för att se aktivitet"}):T.map(e=>(0,a.jsxs)("div",{className:`${$.default.logLine} ${"success"===e.type?$.default.logLineSuccess:"warning"===e.type?$.default.logLineWarning:"error"===e.type?$.default.logLineError:"step"===e.type?$.default.logLineStep:$.default.logLineInfo}`,children:[(0,a.jsx)("span",{className:$.default.logTime,children:e.time}),(0,a.jsx)("span",{className:$.default.logMsg,children:e.message})]},e.id))})]})]}),"linkedin"===l&&(0,a.jsxs)("div",{className:$.default.view,children:[(0,a.jsxs)("div",{className:$.default.inputGroup,children:[(0,a.jsx)("input",{type:"text",className:$.default.input,placeholder:"Bolagsnamn (t.ex. volvo, klarna)...",value:Z,onChange:e=>Y(e.target.value),onKeyDown:e=>"Enter"===e.key&&ek(),autoFocus:!0}),(0,a.jsx)("button",{className:`${$.default.btn} ${$.default.btnPrimary}`,onClick:ek,disabled:el,children:el?"...":"Sök"})]}),ee&&ee.success&&ee.data&&(0,a.jsxs)("div",{className:$.default.projects,children:[(0,a.jsxs)("div",{className:$.default.sectionTitle,children:[(0,a.jsx)(G.Linkedin,{className:"w-3.5 h-3.5"}),ee.data.name||ee.company]}),(0,a.jsxs)("div",{style:{background:"var(--widget-surface)",borderRadius:"8px",padding:"12px",marginBottom:"12px"},children:[ee.data.about_us&&(0,a.jsx)("p",{style:{fontSize:"12px",color:"var(--widget-text)",lineHeight:"1.5",marginBottom:"12px"},children:ee.data.about_us.length>200?ee.data.about_us.slice(0,200)+"...":ee.data.about_us}),(0,a.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px",fontSize:"11px"},children:[ee.data.industry&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{style:{color:"var(--widget-text-dim)"},children:"Bransch:"})," ",(0,a.jsx)("span",{style:{color:"var(--widget-text)"},children:ee.data.industry})]}),ee.data.company_size&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{style:{color:"var(--widget-text-dim)"},children:"Storlek:"})," ",(0,a.jsx)("span",{style:{color:"var(--widget-text)"},children:ee.data.company_size})]}),ee.data.headquarters&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{style:{color:"var(--widget-text-dim)"},children:"HQ:"})," ",(0,a.jsx)("span",{style:{color:"var(--widget-text)"},children:ee.data.headquarters})]}),ee.data.founded&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{style:{color:"var(--widget-text-dim)"},children:"Grundat:"})," ",(0,a.jsx)("span",{style:{color:"var(--widget-text)"},children:ee.data.founded})]}),ee.data.headcount&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{style:{color:"var(--widget-text-dim)"},children:"Anställda:"})," ",(0,a.jsx)("span",{style:{color:"var(--widget-text)"},children:ee.data.headcount.toLocaleString()})]}),ee.data.website&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{style:{color:"var(--widget-text-dim)"},children:"Webb:"})," ",(0,a.jsx)("a",{href:ee.data.website,target:"_blank",rel:"noopener noreferrer",style:{color:"var(--widget-accent)"},children:ee.data.website.replace(/^https?:\/\//,"")})]})]}),ee.data.specialties&&ee.data.specialties.length>0&&(0,a.jsx)("div",{style:{marginTop:"8px",display:"flex",flexWrap:"wrap",gap:"4px"},children:ee.data.specialties.slice(0,5).map((e,s)=>(0,a.jsx)("span",{style:{background:"var(--widget-bg)",padding:"2px 6px",borderRadius:"4px",fontSize:"10px",color:"var(--widget-text-dim)"},children:e},s))}),ee.linkedinUrl&&(0,a.jsx)("div",{style:{marginTop:"12px"},children:(0,a.jsxs)("a",{href:ee.linkedinUrl,target:"_blank",rel:"noopener noreferrer",className:`${$.default.btn} ${$.default.btnGhost}`,style:{fontSize:"11px"},children:[(0,a.jsx)(O.ExternalLink,{className:"w-3 h-3"}),"Öppna på LinkedIn"]})})]})]}),(0,a.jsxs)("div",{className:$.default.logPanel,children:[(0,a.jsxs)("div",{className:$.default.logHeader,children:[(0,a.jsx)("span",{className:$.default.logTitle,children:"Aktivitet"}),es.length>0&&(0,a.jsx)("button",{className:$.default.logClear,onClick:()=>eg("linkedin"),children:"Rensa"})]}),(0,a.jsx)("div",{className:$.default.logContent,ref:ec,children:0===es.length?(0,a.jsx)("div",{className:$.default.logEmpty,children:"Sök efter ett bolag för att hämta LinkedIn-profil"}):es.map(e=>(0,a.jsxs)("div",{className:`${$.default.logLine} ${"success"===e.type?$.default.logLineSuccess:"warning"===e.type?$.default.logLineWarning:"error"===e.type?$.default.logLineError:"step"===e.type?$.default.logLineStep:$.default.logLineInfo}`,children:[(0,a.jsx)("span",{className:$.default.logTime,children:e.time}),(0,a.jsx)("span",{className:$.default.logMsg,children:e.message})]},e.id))})]})]}),"status"===l&&(0,a.jsxs)("div",{className:$.default.view,children:[(0,a.jsxs)("div",{className:$.default.statsGrid,children:[(0,a.jsxs)("div",{className:$.default.statCard,children:[(0,a.jsx)(w.Activity,{className:"w-4 h-4"}),(0,a.jsxs)("div",{className:$.default.statContent,children:[(0,a.jsx)("div",{className:$.default.statLabel,children:"API"}),(0,a.jsx)("div",{className:`${$.default.statValue} ${$.default.statValueOnline}`,children:"6 källor"})]})]}),(0,a.jsxs)("div",{className:$.default.statCard,children:[(0,a.jsx)(P.Image,{className:"w-4 h-4"}),(0,a.jsxs)("div",{className:$.default.statContent,children:[(0,a.jsx)("div",{className:$.default.statLabel,children:"Format"}),(0,a.jsx)("div",{className:$.default.statValue,children:"SVG, PNG"})]})]})]}),(0,a.jsxs)("div",{className:$.default.projects,style:{marginBottom:"12px"},children:[(0,a.jsxs)("div",{className:$.default.sectionTitle,children:[(0,a.jsx)(w.Activity,{className:"w-3.5 h-3.5"}),"API-källor (prioritetsordning)"]}),[{name:"Brandfetch API",desc:"SVG/PNG, flera storlekar"},{name:"Brandfetch CDN",desc:"Snabb, en fil"},{name:"Unavatar",desc:"Aggregerar källor"},{name:"Google Favicons",desc:"128px ikoner"},{name:"DuckDuckGo",desc:"ICO-ikoner"},{name:"Logo.dev",desc:"Backup"}].map((e,s)=>(0,a.jsx)("div",{className:$.default.project,style:{cursor:"default"},children:(0,a.jsxs)("div",{className:$.default.projectHeader,children:[(0,a.jsxs)("div",{className:$.default.projectTitle,children:[s+1,". ",e.name]}),(0,a.jsx)("div",{className:$.default.projectId,children:e.desc})]})},s))]}),(0,a.jsx)("div",{className:$.default.actionRow,children:(0,a.jsx)("button",{className:`${$.default.btn} ${$.default.btnGhost}`,onClick:eb,children:"Testa anslutningar"})}),(0,a.jsxs)("div",{className:$.default.logPanel,children:[(0,a.jsxs)("div",{className:$.default.logHeader,children:[(0,a.jsx)("span",{className:$.default.logTitle,children:"Aktivitet"}),J.length>0&&(0,a.jsx)("button",{className:$.default.logClear,onClick:()=>eg("status"),children:"Rensa"})]}),(0,a.jsx)("div",{className:$.default.logContent,ref:ec,children:0===J.length?(0,a.jsx)("div",{className:$.default.logEmpty,children:"Testa anslutningar för att se status"}):J.map(e=>(0,a.jsxs)("div",{className:`${$.default.logLine} ${"success"===e.type?$.default.logLineSuccess:"warning"===e.type?$.default.logLineWarning:"error"===e.type?$.default.logLineError:"step"===e.type?$.default.logLineStep:$.default.logLineInfo}`,children:[(0,a.jsx)("span",{className:$.default.logTime,children:e.time}),(0,a.jsx)("span",{className:$.default.logMsg,children:e.message})]},e.id))})]})]})]})]})]})}var M=e.i(942103),U=e.i(869270);function z(){let{history:e,addToHistory:n,clearHistory:i}=function(){let{data:e,status:a}=(0,l.useSession)(),[s,n]=(0,t.useState)([]),[i,r]=(0,t.useState)(!1),u=(0,t.useRef)(!1);return(0,t.useEffect)(()=>{(async()=>{if(n(c()),"authenticated"===a&&e?.user&&!u.current)try{let e=await fetch("/api/bolag/history");if(e.ok){let a=await e.json();a.history&&a.history.length>0&&(n(a.history),o(a.history),u.current=!0)}}catch{}r(!0)})()},[e?.user,a]),(0,t.useEffect)(()=>{(async()=>{if("authenticated"!==a||!e?.user||u.current)return;let s=c();if(0!==s.length)try{let e=await fetch("/api/bolag/history");if(e.ok){let a=await e.json();if(a.history&&a.history.length>0)return}for(let e of s)await fetch("/api/bolag/history",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orgNr:e.orgNr,name:e.name})})}catch{}})()},[e?.user,a]),{history:s,addToHistory:(0,t.useCallback)(async(a,s)=>{let t={orgNr:a,name:s,timestamp:Date.now()};if(n(e=>{let s=[t,...e.filter(e=>e.orgNr!==a)].slice(0,8);return o(s),s}),e?.user)try{await fetch("/api/bolag/history",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orgNr:a,name:s})})}catch{}},[e?.user]),clearHistory:(0,t.useCallback)(async()=>{if(n([]),localStorage.removeItem(d),e?.user)try{await fetch("/api/bolag/history",{method:"DELETE"})}catch{}},[e?.user]),isLoaded:i}}();return(0,a.jsx)("main",{className:"min-h-screen bg-background text-foreground",children:(0,a.jsxs)("div",{className:"page-wrapper page-content",children:[(0,a.jsxs)("header",{className:"page-header text-center max-w-2xl mx-auto",children:[(0,a.jsx)("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-gradient-to-br from-blue-500 to-indigo-600 text-white mb-6 shadow-lg",children:(0,a.jsx)(g.Building2,{className:"w-8 h-8"})}),(0,a.jsx)("h1",{className:"page-title",children:"Bolagsinfo"}),(0,a.jsx)("p",{className:"page-subtitle",children:"Utforska svenska bolag med data från flera officiella källor"})]}),(0,a.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,a.jsxs)(s.Card,{className:"shadow-lg border-2 border-border/50 hover:border-blue-200 dark:hover:border-blue-800/50 transition-colors",children:[(0,a.jsxs)(s.CardHeader,{className:"text-center pb-2",children:[(0,a.jsxs)("div",{className:"inline-flex items-center justify-center gap-2 text-muted-foreground mb-2",children:[(0,a.jsx)(h.Search,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"text-xs font-medium uppercase tracking-wider",children:"Sök företag"})]}),(0,a.jsx)(s.CardDescription,{className:"text-base",children:"Sök på företagsnamn eller organisationsnummer"})]}),(0,a.jsxs)(s.CardContent,{className:"pt-0",children:[(0,a.jsx)(v,{placeholder:"T.ex. Spotify eller 556703-7485...",recentSearches:e,onSelectResult:e=>n(e.orgNr,e.name)}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)(u,{history:e,onClear:i})})]})]}),(0,a.jsxs)("div",{className:"mt-8",children:[(0,a.jsxs)("h2",{className:"text-section mb-4 flex items-center gap-2",children:[(0,a.jsx)(B.Database,{className:"w-4 h-4 text-muted-foreground"}),"Verktyg"]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:[(0,a.jsx)(E,{}),(0,a.jsx)(A,{}),(0,a.jsx)(H,{}),(0,a.jsx)(W,{})]})]}),(0,a.jsx)("div",{className:"mt-8",children:(0,a.jsx)(r,{})})]}),(0,a.jsxs)("div",{className:"mt-16",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)("h2",{className:"section-title mb-2",children:"Datakällor"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Information aggregeras från flera officiella källor"})]}),(0,a.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-4 max-w-4xl mx-auto",children:[(0,a.jsxs)("div",{className:"source-card group",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-lg bg-emerald-500/10 dark:bg-emerald-500/20 flex items-center justify-center group-hover:scale-110 transition-transform",children:(0,a.jsx)(I.FileText,{className:"w-5 h-5 text-emerald-600 dark:text-emerald-400"})}),(0,a.jsx)("h3",{className:"font-semibold text-foreground",children:"Bolagsverket"})]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground leading-relaxed",children:"Officiell registreringsinformation, styrelse och kungörelser"})]}),(0,a.jsxs)("div",{className:"source-card group",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-lg bg-orange-500/10 dark:bg-orange-500/20 flex items-center justify-center group-hover:scale-110 transition-transform",children:(0,a.jsx)(U.TrendingUp,{className:"w-5 h-5 text-orange-600 dark:text-orange-400"})}),(0,a.jsx)("h3",{className:"font-semibold text-foreground",children:"Allabolag"})]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground leading-relaxed",children:"Bokslut, nyckeltal, ägare och befattningshavare"})]}),(0,a.jsxs)("div",{className:"source-card group",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-lg bg-green-500/10 dark:bg-green-500/20 flex items-center justify-center group-hover:scale-110 transition-transform",children:(0,a.jsx)(M.Lightbulb,{className:"w-5 h-5 text-green-600 dark:text-green-400"})}),(0,a.jsx)("h3",{className:"font-semibold text-foreground",children:"Vinnova"})]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground leading-relaxed",children:"Innovationsbidrag och forskningsprojekt"})]}),(0,a.jsxs)("div",{className:"source-card group",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-lg bg-purple-500/10 dark:bg-purple-500/20 flex items-center justify-center group-hover:scale-110 transition-transform",children:(0,a.jsx)(P.Image,{className:"w-5 h-5 text-purple-600 dark:text-purple-400"})}),(0,a.jsx)("h3",{className:"font-semibold text-foreground",children:"Media"})]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground leading-relaxed",children:"Logotyper och varumärken via 6 API-källor"})]})]})]}),(0,a.jsx)("div",{className:"mt-16 pt-8 border-t border-border",children:(0,a.jsxs)("div",{className:"flex flex-wrap justify-center gap-8 text-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-2xl font-bold text-foreground font-mono",children:"1.2M+"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground uppercase tracking-wider",children:"Registrerade bolag"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-2xl font-bold text-foreground font-mono",children:"4"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground uppercase tracking-wider",children:"Datakällor"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-2xl font-bold text-foreground font-mono",children:"Realtid"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground uppercase tracking-wider",children:"Uppdateringar"})]})]})})]})})}e.s(["default",()=>z],194179)}]);

//# debugId=28a54478-0488-6c2c-f99a-1d308ff708f0
//# sourceMappingURL=c6938aaad73a0cf5.js.map